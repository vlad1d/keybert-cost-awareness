{"Id": "75248776", "PostTypeId": "1", "CreationDate": "2023-01-26T16:12:58.697", "Score": "1", "ViewCount": "79", "Body": "<p>Im currently trying to set up an AWS EC2 Instance &amp; integrated API-Gateway with terraform.\nI watched the tutorial of Anton Putra: <a href=\"https://www.youtube.com/watch?v=XhS2JbPg8jA&amp;t=287s\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=XhS2JbPg8jA&amp;t=287s</a>\nand also cloned his code: <a href=\"https://github.com/antonputra/tutorials/tree/main/lessons/118\" rel=\"nofollow noreferrer\">https://github.com/antonputra/tutorials/tree/main/lessons/118</a></p>\n<p>I simply wanted to rename some of the resources and apply the terraform.\n&quot;terraform init&quot; works but when i run &quot;terraform apply&quot;, i get this message:\n<a href=\"https://i.stack.imgur.com/MgorZ.png\" rel=\"nofollow noreferrer\">CMD Error Message</a></p>\n<p>This is the code from the file its complaining about:</p>\n<pre><code>resource &quot;aws_acm_certificate&quot; &quot;gradebook&quot; {\n\u00a0\u00a0\u00a0 domain_name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = &quot;gradebook.bmeisn.com&quot;\n\u00a0\u00a0\u00a0 validation_method = &quot;DNS&quot;\n}\u00a0\n\ndata &quot;aws_route53_zone&quot; &quot;gradebook-r53z&quot; {\n\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = &quot;bmeisn.com&quot;\n\u00a0\u00a0\u00a0 private_zone\u00a0\u00a0\u00a0\u00a0\u00a0 = false\n}\u00a0\n\nresource &quot;aws_route53_record&quot; &quot;gradebook-r53r&quot; {\n\u00a0\u00a0\u00a0 for_each = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 for dvo in aws_acm_certificate.gradebook.domain_validation_options : dvo.domain_name =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0 = dvo.resource_record_name\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 record\u00a0\u00a0\u00a0 = dvo.resource_record_value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type\u00a0\u00a0\u00a0 = dvo.resource_record_type\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 }\n\u00a0\u00a0\u00a0 }\u00a0\u00a0\u00a0\u00a0 \n    allow_overwrite = true\n\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = each.value.name\n\u00a0\u00a0\u00a0 records\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = [each.value.record]\n\u00a0\u00a0\u00a0 ttl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = 60\n\u00a0\u00a0\u00a0 type\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = each.value.type\n\u00a0\u00a0\u00a0 zone_id\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = data.aws_route53_zone.gradebook-r53z.zone_id\n}\u00a0\n\nresource &quot;aws_acm_certificate_validation&quot; &quot;gradebook&quot; {\n\u00a0\u00a0\u00a0 certificate_arn\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_acm_certificate.gradebook.arn\n\u00a0\u00a0\u00a0 validation_record_fqdns\u00a0\u00a0\u00a0 = [for record in aws_route53_record.gradebook-r53r : record.fqdn ]\n}\n</code></pre>\n<p>I read that it might be because of the domain so heres the tf file for that aswell:</p>\n<pre><code>resource &quot;aws_apigatewayv2_domain_name&quot; &quot;gradebook&quot; {\n\u00a0 domain_name = &quot;gradebook.bmeisn.com&quot;\u00a0\u00a0 domain_name_configuration {\n\u00a0\u00a0\u00a0 certificate_arn = aws_acm_certificate.gradebook.arn\n\u00a0\u00a0\u00a0 endpoint_type\u00a0\u00a0 = &quot;REGIONAL&quot;\n\u00a0\u00a0\u00a0 security_policy = &quot;TLS_1_2&quot;\n\u00a0 }\u00a0\u00a0 \ndepends_on = [aws_acm_certificate_validation.gradebook]\n}\u00a0\nresource &quot;aws_route53_record&quot; &quot;gradebook-r53r-02&quot; {\n\u00a0 name\u00a0\u00a0\u00a0 = aws_apigatewayv2_domain_name.gradebook.domain_name\n\u00a0 type\u00a0\u00a0\u00a0 = &quot;A&quot;\n\u00a0 zone_id = data.aws_route53_zone.gradebook-r53z.zone_id\u00a0\u00a0 alias {\n\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_domain_name.gradebook.domain_name_configuration[0].target_domain_name\n\u00a0\u00a0\u00a0 zone_id\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_domain_name.gradebook.domain_name_configuration[0].hosted_zone_id\n\u00a0\u00a0\u00a0 evaluate_target_health = false\n\u00a0 }\n}\u00a0\nresource &quot;aws_apigatewayv2_api_mapping&quot; &quot;gradebook-map&quot; {\n\u00a0 api_id\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_api.gradebook-agw.id\n\u00a0 domain_name = aws_apigatewayv2_domain_name.gradebook.id\n\u00a0 stage\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_stage.dev.id\n}\u00a0\noutput &quot;custom_domain_api-v2&quot; {\n\u00a0 value = &quot;https://${aws_apigatewayv2_api_mapping.gradebook-map.domain_name}/health&quot;\n}\n</code></pre>\n<p>The whole setup around it seems to work so im assuming i did something wrong here, i just cant figure out what exactly as im not very experienced with this technology.</p>\n<p>Also if this question is missing any important info, let me know.</p>\n", "OwnerUserId": "20392136", "LastActivityDate": "2023-01-27T00:10:09.133", "Title": "(AWS) Terraform: \"no matching Route53Zone found\"", "Tags": "<amazon-web-services><amazon-ec2><terraform><aws-api-gateway>", "AnswerCount": "1", "CommentCount": "6", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "132784927", "PostId": "75248776", "Score": "1", "Text": "Have you registered that domain in Route53?", "CreationDate": "2023-01-26T16:33:47.510", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Have you registered that domain in Route53?", "keywords": ["domain"]}]}, {"Id": "132785325", "PostId": "75248776", "Score": "0", "Text": "Im not exactly sure, how do i do that? @MarkoE", "CreationDate": "2023-01-26T16:53:58.890", "UserId": "20392136", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "132785768", "PostId": "75248776", "Score": "0", "Text": "Well, you can't simply use a domain someone else had registered, you have to have one yourself. As for how you do it, there is plenty documentation which can guide ypu through the required steps. Note that registering a domain comes with a cost.", "CreationDate": "2023-01-26T17:15:38.960", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Well, you can't simply use a domain someone else had registered, you have to have one yourself. ", "keywords": ["domain"]}, {"source": "Text", "text": "Note that registering a domain comes with a cost.", "keywords": ["cost", "domain"]}]}, {"Id": "132788066", "PostId": "75248776", "Score": "0", "Text": "am i not creating the domain with this tf file? @MarkoE", "CreationDate": "2023-01-26T19:32:22.490", "UserId": "20392136", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "am i not creating the domain with this tf file? ", "keywords": ["domain"]}]}, {"Id": "132789353", "PostId": "75248776", "Score": "1", "Text": "You are not. You are using a data source to get details about an existing domain, and then trying to create a record in that domain.", "CreationDate": "2023-01-26T21:00:33.573", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You are using a data source to get details about an existing domain, and then trying to create a record in that domain.", "keywords": ["domain"]}]}, {"Id": "132791828", "PostId": "75248776", "Score": "0", "Text": "Any TF resource that has a prefix of `data` is doing a lookup, rather than creating so it\u2019s managed outside of TF and must already exist. https://developer.hashicorp.com/terraform/language/data-sources", "CreationDate": "2023-01-27T00:38:44.193", "UserId": "83096", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "286889766", "PostHistoryTypeId": "2", "PostId": "75248776", "RevisionGUID": "ee6261b8-b638-48c8-90e0-76e5519099f4", "CreationDate": "2023-01-26T16:12:58.697", "UserId": "20392136", "Text": "Im currently trying to set up an AWS EC2 Instance & integrated API-Gateway with terraform. \r\nI watched the tutorial of Anton Putra: https://www.youtube.com/watch?v=XhS2JbPg8jA&t=287s\r\nand also cloned his code: https://github.com/antonputra/tutorials/tree/main/lessons/118\r\n\r\n\r\n\r\nI simply wanted to rename some of the resources and apply the terraform. \r\n\"terraform init\" works but when i run \"terraform apply\", i get this message:\r\n[CMD Error Message](https://i.stack.imgur.com/MgorZ.png)\r\n\r\nThis is the code from the file its complaining about: \r\n\r\n```\r\nresource \"aws_acm_certificate\" \"gradebook\" {\r\n\u00a0\u00a0\u00a0 domain_name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = \"gradebook.bmeisn.com\"\r\n\u00a0\u00a0\u00a0 validation_method = \"DNS\"\r\n}\u00a0\r\n\r\ndata \"aws_route53_zone\" \"gradebook-r53z\" {\r\n\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = \"bmeisn.com\"\r\n\u00a0\u00a0\u00a0 private_zone\u00a0\u00a0\u00a0\u00a0\u00a0 = false\r\n}\u00a0\r\n\r\nresource \"aws_route53_record\" \"gradebook-r53r\" {\r\n\u00a0\u00a0\u00a0 for_each = {\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 for dvo in aws_acm_certificate.gradebook.domain_validation_options : dvo.domain_name => {\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0 = dvo.resource_record_name\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 record\u00a0\u00a0\u00a0 = dvo.resource_record_value\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type\u00a0\u00a0\u00a0 = dvo.resource_record_type\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 }\r\n\u00a0\u00a0\u00a0 }\u00a0\u00a0\u00a0\u00a0 \r\n    allow_overwrite = true\r\n\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = each.value.name\r\n\u00a0\u00a0\u00a0 records\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = [each.value.record]\r\n\u00a0\u00a0\u00a0 ttl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = 60\r\n\u00a0\u00a0\u00a0 type\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = each.value.type\r\n\u00a0\u00a0\u00a0 zone_id\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = data.aws_route53_zone.gradebook-r53z.zone_id\r\n}\u00a0\r\n\r\nresource \"aws_acm_certificate_validation\" \"gradebook\" {\r\n\u00a0\u00a0\u00a0 certificate_arn\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_acm_certificate.gradebook.arn\r\n\u00a0\u00a0\u00a0 validation_record_fqdns\u00a0\u00a0\u00a0 = [for record in aws_route53_record.gradebook-r53r : record.fqdn ]\r\n}\r\n```\r\n\r\n\r\nI read that it might be because of the domain so heres the tf file for that aswell:\r\n\r\n```\r\nresource \"aws_apigatewayv2_domain_name\" \"gradebook\" {\r\n\u00a0 domain_name = \"gradebook.bmeisn.com\"\u00a0\u00a0 domain_name_configuration {\r\n\u00a0\u00a0\u00a0 certificate_arn = aws_acm_certificate.gradebook.arn\r\n\u00a0\u00a0\u00a0 endpoint_type\u00a0\u00a0 = \"REGIONAL\"\r\n\u00a0\u00a0\u00a0 security_policy = \"TLS_1_2\"\r\n\u00a0 }\u00a0\u00a0 \r\ndepends_on = [aws_acm_certificate_validation.gradebook]\r\n}\u00a0\r\nresource \"aws_route53_record\" \"gradebook-r53r-02\" {\r\n\u00a0 name\u00a0\u00a0\u00a0 = aws_apigatewayv2_domain_name.gradebook.domain_name\r\n\u00a0 type\u00a0\u00a0\u00a0 = \"A\"\r\n\u00a0 zone_id = data.aws_route53_zone.gradebook-r53z.zone_id\u00a0\u00a0 alias {\r\n\u00a0\u00a0\u00a0 name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_domain_name.gradebook.domain_name_configuration[0].target_domain_name\r\n\u00a0\u00a0\u00a0 zone_id\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_domain_name.gradebook.domain_name_configuration[0].hosted_zone_id\r\n\u00a0\u00a0\u00a0 evaluate_target_health = false\r\n\u00a0 }\r\n}\u00a0\r\nresource \"aws_apigatewayv2_api_mapping\" \"gradebook-map\" {\r\n\u00a0 api_id\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_api.gradebook-agw.id\r\n\u00a0 domain_name = aws_apigatewayv2_domain_name.gradebook.id\r\n\u00a0 stage\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 = aws_apigatewayv2_stage.dev.id\r\n}\u00a0\r\noutput \"custom_domain_api-v2\" {\r\n\u00a0 value = \"https://${aws_apigatewayv2_api_mapping.gradebook-map.domain_name}/health\"\r\n}\r\n```\r\n\r\nThe whole setup around it seems to work so im assuming i did something wrong here, i just cant figure out what exactly as im not very experienced with this technology. \r\n\r\nAlso if this question is missing any important info, let me know. \r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Im currently trying to set up an AWS EC2 Instance & integrated API-Gateway with terraform. ", "keywords": ["instance"]}, {"source": "Text", "text": "I read that it might be because of the domain so heres the tf file for that aswell: ``` resource \"aws_apigatewayv2_domain_name\" \"gradebook\" { domain_name = \"gradebook.bmeisn.com\" domain_name_configuration { certificate_arn = aws_acm_certificate.gradebook.arn endpoint_type = \"REGIONAL\" security_policy = \"TLS_1_2\" } depends_on = [aws_acm_certificate_validation.gradebook] } resource \"aws_route53_record\" \"gradebook-r53r-02\" { name = aws_apigatewayv2_domain_name.gradebook.domain_name type = \"A\" zone_id = data.aws_route53_zone.gradebook-r53z.zone_id alias { name = aws_apigatewayv2_domain_name.gradebook.domain_name_configuration[0].target_domain_name zone_id = aws_apigatewayv2_domain_name.gradebook.domain_name_configuration[0].hosted_zone_id evaluate_target_health = false } } resource \"aws_apigatewayv2_api_mapping\" \"gradebook-map\" { api_id = aws_apigatewayv2_api.gradebook-agw.id domain_name = aws_apigatewayv2_domain_name.gradebook.id stage = aws_apigatewayv2_stage.dev.id } output \"custom_domain_api-v2\" { value = \"https://${aws_apigatewayv2_api_mapping.gradebook-map.domain_name}/health\" } ``` ", "keywords": ["domain"]}]}, {"Id": "286889768", "PostHistoryTypeId": "1", "PostId": "75248776", "RevisionGUID": "ee6261b8-b638-48c8-90e0-76e5519099f4", "CreationDate": "2023-01-26T16:12:58.697", "UserId": "20392136", "Text": "(AWS) Terraform: \"no matching Route53Zone found\"", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "286889769", "PostHistoryTypeId": "3", "PostId": "75248776", "RevisionGUID": "ee6261b8-b638-48c8-90e0-76e5519099f4", "CreationDate": "2023-01-26T16:12:58.697", "UserId": "20392136", "Text": "<amazon-web-services><amazon-ec2><terraform><aws-api-gateway>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "286889770", "PostHistoryTypeId": "66", "PostId": "75248776", "RevisionGUID": "ee6261b8-b638-48c8-90e0-76e5519099f4", "CreationDate": "2023-01-26T16:12:58.697", "UserId": "20392136", "filtered-sentences": []}], "answers": [{"Id": "75252896", "PostTypeId": "2", "ParentId": "75248776", "CreationDate": "2023-01-27T00:10:09.133", "Score": "0", "Body": "<p>As pointed out in the comments, you aren't exactly creating your Route 53 zone. If you're committed to do it via Terraform (I'd personally advise against it but it's your choice to make) <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_zone\" rel=\"nofollow noreferrer\"><code>aws_route53_zone</code></a> resource is what you seek, it also has example on how to reference a zone you're to create.<br />\nIn case you still get messages about it being absent AFTER referencing <em>zone resource you are creating</em> (Terraform borking the resource creating order), then just use <a href=\"https://developer.hashicorp.com/terraform/language/meta-arguments/depends_on\" rel=\"nofollow noreferrer\"><code>depends_on</code></a> and call it a day.</p>\n", "OwnerUserId": "21089721", "LastActivityDate": "2023-01-27T00:10:09.133", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "286912940", "PostHistoryTypeId": "2", "PostId": "75252896", "RevisionGUID": "3b6bf4d2-d1fa-4b99-897b-a2d0274c57b7", "CreationDate": "2023-01-27T00:10:09.133", "UserId": "21089721", "Text": "As pointed out in the comments, you aren't exactly creating your Route 53 zone. If you're committed to do it via Terraform (I'd personally advise against it but it's your choice to make) [`aws_route53_zone`][2] resource is what you seek, it also has example on how to reference a zone you're to create.\\\r\nIn case you still get messages about it being absent AFTER referencing *zone resource you are creating* (Terraform borking the resource creating order), then just use [`depends_on`][3] and call it a day.\r\n\r\n\r\n  [1]: https://stackoverflow.com/users/8343484/marko-e\r\n  [2]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_zone\r\n  [3]: https://developer.hashicorp.com/terraform/language/meta-arguments/depends_on", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "Im currently trying to set up an AWS EC2 Instance & integrated API-Gateway with terraform. ", "keywords": ["instance"]}, {"source": "Body", "text": "This is the code from the file its complaining about: I read that it might be because of the domain so heres the tf file for that aswell: The whole setup around it seems to work so im assuming i did something wrong here, i just cant figure out what exactly as im not very experienced with this technology. ", "keywords": ["domain"]}]}