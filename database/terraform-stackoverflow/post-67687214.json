{"Id": "67687214", "PostTypeId": "1", "CreationDate": "2021-05-25T11:41:53.953", "Score": "1", "ViewCount": "1922", "Body": "<p>How to reference List of objects variables in terraform module block</p>\n<p><em>Variables.tf</em></p>\n<pre><code>variable &quot;list_views_datasets&quot; {\n  description = &quot;List of Views in the Datasets&quot;\n  type = list(object({\n    dataset_id   = string\n    dataset_name = string\n    views = list(object({\n      view_id        = string,\n      query          = string,\n      use_legacy_sql = bool,\n      labels         = map(string),\n    }))\n  }))\n  default = []\n}\n</code></pre>\n<p>tfvars:</p>\n<pre><code>list_views_datasets = [\n  {\n      dataset_id       = &quot;testservice&quot;\n      dataset_name     = &quot;testservice&quot;\n      views            =  [\n      {\n        view_id        = &quot;issue-data&quot;,\n        use_legacy_sql = false,\n        query          = &quot;.test.sql&quot;\n        # unfortunately we have to repeat the project id, dataset id and table id in here.\n        labels     = {\n          env      = &quot;dev&quot;\n          billable = &quot;true&quot;\n          owner    = &quot;dev&quot;\n        }\n      },\n    ]\n  },\n</code></pre>\n<p><em>Main.tf</em></p>\n<pre><code>  module &quot;bigquery_views&quot; {\n  source  = &quot;terraform-google-modules/bigquery/google&quot;\n  version = &quot;4.3.0&quot;\n\n  depends_on = [module.bigquery]\n\n  for_each       = { for list_view in var.list_views_datasets : list_view.dataset_id =&gt; list_view }\n  dataset_id     = each.value.dataset_id\n  dataset_name   = each.value.dataset_name\n  description    = var.views_description\n  project_id     = var.project_id\n  location       = var.location\n  views          = {\n    view_id        = each.value.views[view_id]\n    labels         = each.value.views[labels]\n    query          = file(each.value.views[query])\n    use_legacy_sql = each.value.views[use_legacy_sql]\n\n  } \n  dataset_labels = var.dataset_labels\n\n  access = [\n    {\n      role          = &quot;roles/bigquery.dataOwner&quot;\n      special_group = &quot;projectOwners&quot;\n    }\n  ]\n}\n</code></pre>\n<blockquote>\n<p>Now i am planning to reference the variable in my module block but i am not sure whether i have referenced corretly the views, query,\nlabels value in my mobule block</p>\n</blockquote>\n", "OwnerUserId": "13312184", "LastEditorUserId": "13312184", "LastEditDate": "2021-05-25T11:58:24.107", "LastActivityDate": "2021-05-26T00:16:01.950", "Title": "How to reference the list of objects variables in Terrraform configuration block or modules", "Tags": "<terraform><terraform-provider-gcp>", "AnswerCount": "1", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "119640707", "PostId": "67687214", "Score": "2", "Text": "Which lines throws what error exactly? In what are those statements enclosed? In its current form they do not make much sense because right now the `description` and `for_each` are on the same level.", "CreationDate": "2021-05-25T11:43:53.717", "UserId": "2442804", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "119640766", "PostId": "67687214", "Score": "0", "Text": "@luk2302 - Description is variable defined in variables.tf. foreach block is defined in my configuration file. since in one variable we have defined nested listed of objects. i am not sure how to reference it in configuration file as a key value pair", "CreationDate": "2021-05-25T11:46:16.703", "UserId": "13312184", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "247236549", "PostHistoryTypeId": "2", "PostId": "67687214", "RevisionGUID": "5e27f662-9b89-4c32-a8cf-0dd8d7d86085", "CreationDate": "2021-05-25T11:41:53.953", "UserId": "13312184", "Text": "**How to reference List of objects variables in terraform module block**\r\n  \r\n  \r\n\r\n    description = \"List of Views\"\r\n      type = list(object({\r\n        dataset_id   = string\r\n        dataset_name = string\r\n        views = list(object({\r\n          view_id        = string,\r\n          query          = string,\r\n          use_legacy_sql = bool,\r\n          labels         = map(string),\r\n        }))\r\n      }))\r\n      default = []\r\n    }\r\n    for_each       = { for list_view in var.list_views_datasets : list_view.dataset_id => list_view }\r\n      dataset_id     = each.value.dataset_id\r\n      dataset_name   = each.value.dataset_name\r\n      description    = var.views_description\r\n      project_id     = var.project_id\r\n      location       = var.location\r\n      views          = {\r\n        view_id        = each.value.views[view_id]\r\n        labels         = each.value.views[labels]\r\n        query          = file(each.value.views[query])\r\n        use_legacy_sql = each.value.views[use_legacy_sql]\r\n    \r\n      }\r\n\r\n\r\n> I tried to reference the variable using the above definition but it\r\n> throws an error message saying that it not properly referenced\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "247236550", "PostHistoryTypeId": "1", "PostId": "67687214", "RevisionGUID": "5e27f662-9b89-4c32-a8cf-0dd8d7d86085", "CreationDate": "2021-05-25T11:41:53.953", "UserId": "13312184", "Text": "How to reference the list of objects variables in Terrraform configuration block or modules", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "247236551", "PostHistoryTypeId": "3", "PostId": "67687214", "RevisionGUID": "5e27f662-9b89-4c32-a8cf-0dd8d7d86085", "CreationDate": "2021-05-25T11:41:53.953", "UserId": "13312184", "Text": "<terraform><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "247236606", "PostHistoryTypeId": "5", "PostId": "67687214", "RevisionGUID": "6ce142c9-a3e3-49ff-b58b-6ed87fb3f090", "CreationDate": "2021-05-25T11:42:27.033", "UserId": "2442804", "Comment": "deleted 9 characters in body", "Text": "How to reference List of objects variables in terraform module block\r\n  \r\n  \r\n\r\n    description = \"List of Views\"\r\n      type = list(object({\r\n        dataset_id   = string\r\n        dataset_name = string\r\n        views = list(object({\r\n          view_id        = string,\r\n          query          = string,\r\n          use_legacy_sql = bool,\r\n          labels         = map(string),\r\n        }))\r\n      }))\r\n      default = []\r\n    }\r\n    for_each       = { for list_view in var.list_views_datasets : list_view.dataset_id => list_view }\r\n      dataset_id     = each.value.dataset_id\r\n      dataset_name   = each.value.dataset_name\r\n      description    = var.views_description\r\n      project_id     = var.project_id\r\n      location       = var.location\r\n      views          = {\r\n        view_id        = each.value.views[view_id]\r\n        labels         = each.value.views[labels]\r\n        query          = file(each.value.views[query])\r\n        use_legacy_sql = each.value.views[use_legacy_sql]\r\n    \r\n      }\r\n\r\n\r\nI tried to reference the variable using the above definition but it throws an error message saying that it not properly referenced\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "247237560", "PostHistoryTypeId": "5", "PostId": "67687214", "RevisionGUID": "173720eb-ad87-4e19-8609-907ad7b647d6", "CreationDate": "2021-05-25T11:58:24.107", "UserId": "13312184", "Comment": "added 1085 characters in body", "Text": "How to reference List of objects variables in terraform module block\r\n  \r\n\r\n*Variables.tf*\r\n\r\n    variable \"list_views_datasets\" {\r\n      description = \"List of Views in the Datasets\"\r\n      type = list(object({\r\n        dataset_id   = string\r\n        dataset_name = string\r\n        views = list(object({\r\n          view_id        = string,\r\n          query          = string,\r\n          use_legacy_sql = bool,\r\n          labels         = map(string),\r\n        }))\r\n      }))\r\n      default = []\r\n    }\r\n\r\n\r\n\r\ntfvars:\r\n\r\n    list_views_datasets = [\r\n      {\r\n          dataset_id       = \"testservice\"\r\n          dataset_name     = \"testservice\"\r\n          views            =  [\r\n          {\r\n            view_id        = \"issue-data\",\r\n            use_legacy_sql = false,\r\n            query          = \".test.sql\"\r\n            # unfortunately we have to repeat the project id, dataset id and table id in here.\r\n            labels     = {\r\n              env      = \"dev\"\r\n              billable = \"true\"\r\n              owner    = \"dev\"\r\n            }\r\n          },\r\n        ]\r\n      },\r\n\r\n\r\n*Main.tf*\r\n\r\n      module \"bigquery_views\" {\r\n      source  = \"terraform-google-modules/bigquery/google\"\r\n      version = \"4.3.0\"\r\n    \r\n      depends_on = [module.bigquery]\r\n    \r\n      for_each       = { for list_view in var.list_views_datasets : list_view.dataset_id => list_view }\r\n      dataset_id     = each.value.dataset_id\r\n      dataset_name   = each.value.dataset_name\r\n      description    = var.views_description\r\n      project_id     = var.project_id\r\n      location       = var.location\r\n      views          = {\r\n        view_id        = each.value.views[view_id]\r\n        labels         = each.value.views[labels]\r\n        query          = file(each.value.views[query])\r\n        use_legacy_sql = each.value.views[use_legacy_sql]\r\n    \r\n      } \r\n      dataset_labels = var.dataset_labels\r\n    \r\n      access = [\r\n        {\r\n          role          = \"roles/bigquery.dataOwner\"\r\n          special_group = \"projectOwners\"\r\n        }\r\n      ]\r\n    }\r\n\r\n\r\n\r\n\r\n> Now i am planning to reference the variable in my module block but i am not sure whether i have referenced corretly the views, query,\r\nlabels value in my mobule block\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "How to reference List of objects variables in terraform module block *Variables.tf* variable \"list_views_datasets\" { description = \"List of Views in the Datasets\" type = list(object({ dataset_id = string dataset_name = string views = list(object({ view_id = string, query = string, use_legacy_sql = bool, labels = map(string), })) })) default = [] } tfvars: list_views_datasets = [ { dataset_id = \"testservice\" dataset_name = \"testservice\" views = [ { view_id = \"issue-data\", use_legacy_sql = false, query = \".test.sql\" # unfortunately we have to repeat the project id, dataset id and table id in here. labels = { env = \"dev\" billable = \"true\" owner = \"dev\" } }, ] }, *Main.tf* module \"bigquery_views\" { source = \"terraform-google-modules/bigquery/google\" version = \"4.3.0\" depends_on = [module.bigquery] for_each = { for list_view in var.list_views_datasets : list_view.dataset_id => list_view } dataset_id = each.value.dataset_id dataset_name = each.value.dataset_name description = var.views_description project_id = var.project_id location = var.location views = { view_id = each.value.views[view_id] labels = each.value.views[labels] query = file(each.value.views[query]) use_legacy_sql = each.value.views[use_legacy_sql] } dataset_labels = var.dataset_labels access = [ { role = \"roles/bigquery.dataOwner\" special_group = \"projectOwners\" } ] } > Now i am planning to reference the variable in my module block but i am not sure whether i have referenced corretly the views, query, labels value in my mobule block", "keywords": ["bill", "test"]}]}], "answers": [{"Id": "67697062", "PostTypeId": "2", "ParentId": "67687214", "CreationDate": "2021-05-26T00:16:01.950", "Score": "0", "Body": "<p>Sadly you <strong>can't do this</strong>. You have to pass entire <code>list_views_datasets</code> into your module as one variable, or use <code>for_each</code> at the module level. In the second case you will create multiple modules.</p>\n", "OwnerUserId": "248823", "LastActivityDate": "2021-05-26T00:16:01.950", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "247277471", "PostHistoryTypeId": "2", "PostId": "67697062", "RevisionGUID": "aaa6f169-65bb-49e5-ac64-90dee2b1e0c8", "CreationDate": "2021-05-26T00:16:01.950", "UserId": "248823", "Text": "Sadly you **can't do this**. You have to pass entire `list_views_datasets` into your module as one variable, or use `for_each` at the module level. In the second case you will create multiple modules.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}