{"Id": "35134584", "PostTypeId": "1", "CreationDate": "2016-02-01T15:47:06.583", "Score": "3", "ViewCount": "4593", "Body": "<p>I've started to get into <a href=\"https://www.terraform.io/\" rel=\"nofollow\">Terraform</a> and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers.</p>\n\n<p>I use some third-party services through the Azure marketplace, similar to Heroku's Add-Ons.  I see a facility in Terraform for Heroku Add-On declarations, but not for Azure marketplace subscriptions.  How can I do this?</p>\n\n<p><strong>Update:</strong>\nHow do I create an Azure marketplace order/subscription via Terraform?</p>\n", "OwnerUserId": "1351335", "LastEditorUserId": "1351335", "LastEditDate": "2016-02-08T10:01:20.073", "LastActivityDate": "2022-10-28T20:50:12.550", "Title": "Terraform with Azure Marketplace", "Tags": "<azure><azure-marketplace><terraform>", "AnswerCount": "2", "CommentCount": "4", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "57989940", "PostId": "35134584", "Score": "0", "Text": "I'm not sure I understand the question, but... if a service/image isn't available in the marketplace, it's up to you to spin it up on your own (in whichever way is most appropriate for the tool in question).", "CreationDate": "2016-02-01T16:07:06.213", "UserId": "272109", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "57994276", "PostId": "35134584", "Score": "0", "Text": "The question is \"How do I create an Azure marketplace order/subscription via Terraform\"", "CreationDate": "2016-02-01T17:56:19.833", "UserId": "1351335", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "58015511", "PostId": "35134584", "Score": "0", "Text": "As @DavidMakogon mentioned, if it is not in the Azure Marketplace you have to create in on your own. Or ask Terraform to publish something to the Azure Marketplace what you can use. I also did a search on the Azure Marketplace and it seems there is no offer from them. (https://azure.microsoft.com/en-us/marketplace/?term=terraform)", "CreationDate": "2016-02-02T08:25:02.040", "UserId": "3050226", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "58055406", "PostId": "35134584", "Score": "0", "Text": "@PeterKirchner Terraform shouldn't need to publish anything to the marketplace or be in the marketplace to do this--it's a DevOps tool that leverages existing IaaS APIs to create, destroy, etc. instances. I have already used it to create Heroku AddOns, for example, and Terraform has no need of a published AddOn.", "CreationDate": "2016-02-03T04:42:38.623", "UserId": "1351335", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "history": [{"Id": "109798719", "PostHistoryTypeId": "2", "PostId": "35134584", "RevisionGUID": "3deb5474-89f0-403c-9ac5-a63ded5cdcaa", "CreationDate": "2016-02-01T15:47:06.583", "UserId": "1351335", "Text": "I've started to get into Terraform and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers.\r\n\r\nI use some third-party services through the Azure marketplace, similar to Heroku's Add-Ons.  I see a facility in Terraform for Heroku Add-On declarations, but not for Azure marketplace subscriptions.  How can I do this?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "I've started to get into Terraform and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers. ", "keywords": ["cost"]}]}, {"Id": "109798720", "PostHistoryTypeId": "1", "PostId": "35134584", "RevisionGUID": "3deb5474-89f0-403c-9ac5-a63ded5cdcaa", "CreationDate": "2016-02-01T15:47:06.583", "UserId": "1351335", "Text": "Terraform with Azure Marketplace", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "109798721", "PostHistoryTypeId": "3", "PostId": "35134584", "RevisionGUID": "3deb5474-89f0-403c-9ac5-a63ded5cdcaa", "CreationDate": "2016-02-01T15:47:06.583", "UserId": "1351335", "Text": "<azure><azure-marketplace><terraform>", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "109808797", "PostHistoryTypeId": "5", "PostId": "35134584", "RevisionGUID": "925a6efb-101d-4a92-8435-b6ecf4c3f7dc", "CreationDate": "2016-02-01T17:56:35.320", "UserId": "1351335", "Comment": "added 89 characters in body", "Text": "I've started to get into Terraform and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers.\r\n\r\nI use some third-party services through the Azure marketplace, similar to Heroku's Add-Ons.  I see a facility in Terraform for Heroku Add-On declarations, but not for Azure marketplace subscriptions.  How can I do this?\r\n\r\n\r\n**Update:**\r\nHow do I create an Azure marketplace order/subscription via Terraform?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "I've started to get into Terraform and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers. ", "keywords": ["cost"]}]}, {"Id": "110321235", "PostHistoryTypeId": "5", "PostId": "35134584", "RevisionGUID": "f5c45f6c-5e2d-4f10-aa17-f2a801e90b66", "CreationDate": "2016-02-08T10:01:20.073", "UserId": "1351335", "Comment": "added 29 characters in body", "Text": "I've started to get into [Terraform](https://www.terraform.io/) and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers.\r\n\r\nI use some third-party services through the Azure marketplace, similar to Heroku's Add-Ons.  I see a facility in Terraform for Heroku Add-On declarations, but not for Azure marketplace subscriptions.  How can I do this?\r\n\r\n\r\n**Update:**\r\nHow do I create an Azure marketplace order/subscription via Terraform?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "I've started to get into [Terraform](https://www.terraform.io/) and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers. ", "keywords": ["cost"]}]}], "answers": [{"Id": "48302847", "PostTypeId": "2", "ParentId": "35134584", "CreationDate": "2018-01-17T13:56:04.540", "Score": "4", "Body": "<p>If I understand your preoblem correctly I think the key is to create declare VM with the following sections with placeholder replaced;</p>\n\n<pre><code>plan {\n    publisher = \"${publisher}\" // e.g. bitnami\n    product = \"${offer}\"  // e.g. elk\n    name = \"${sku}\"  // e.g. 46\n}\n\nstorage_image_reference {\n    publisher = \"${publisher}\" // e.g. bitnami\n    offer = \"${offer}\" // e.g. elk\n    sku = \"${sku}\" // e.g. 46\n    version = \"${version}\"  // e.g. latest\n}\n</code></pre>\n\n<p>So a complete VM resource definition would lok something like this.</p>\n\n<pre><code>resource \"azurerm_virtual_machine\" \"virtual_machine\" {\n    count = \"${var.vm_count}\"\n    name = \"${element(module.template.vm_names, count.index)}\"\n    location = \"${var.location}\"\n    resource_group_name = \"${var.resource_group_name}\"\n    network_interface_ids = [\"${element(azurerm_network_interface.network_interface.*.id, count.index)}\"]\n    vm_size = \"${var.vm_size}\"\n    delete_data_disks_on_termination = true\n    delete_os_disk_on_termination = true\n\nplan {\n    publisher = \"${var.publisher}\"\n    product = \"${var.offer}\"\n    name = \"${var.sku}\"\n}\n\nboot_diagnostics {\n    enabled = true\n    storage_uri = \"${var.boot_diagnostics_storage_url}\"\n}\n\nstorage_image_reference {\n    publisher = \"${var.publisher}\"\n    offer = \"${var.offer}\"\n    sku = \"${var.sku}\"\n    version = \"${var.version}\"\n}\n\nstorage_os_disk {\n    name = \"primarydisk\"\n    vhd_uri = \"${join(\"\", list(var.disks_container_url, \"/\" , element(module.template.vm_names, count.index), \".vhd\"))}\"\n    caching = \"ReadWrite\"\n    create_option = \"FromImage\"\n}\n\nos_profile {\n    computer_name = \"${element(module.template.vm_names, count.index)}\"\n    admin_username = \"${element(module.template.user_names, count.index)}\"\n}\n\nos_profile_linux_config {\n    disable_password_authentication = true\n    ssh_keys = [{\n        path     = \"/home/${element(module.template.user_names, count.index)}/.ssh/authorized_keys\"\n        key_data = \"${replace(file(\"../vars/keys/vm.pub\"),\"\\n\",\"\")}\"\n    }]\n}\n\ntags {\n    environment = \"${var.resource_group_name}\"\n}\n}\n</code></pre>\n", "OwnerUserId": "231999", "LastActivityDate": "2018-01-17T13:56:04.540", "CommentCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "164855591", "PostHistoryTypeId": "2", "PostId": "48302847", "RevisionGUID": "cb32e3c3-11fd-4019-bbb1-a6dd1f21f66e", "CreationDate": "2018-01-17T13:56:04.540", "UserId": "231999", "Text": "If I understand your preoblem correctly I think the key is to create declare VM with the following sections with placeholder replaced;\r\n    \r\n    plan {\r\n        publisher = \"${publisher}\" // e.g. bitnami\r\n        product = \"${offer}\"  // e.g. elk\r\n        name = \"${sku}\"  // e.g. 46\r\n    }\r\n\r\n    storage_image_reference {\r\n        publisher = \"${publisher}\" // e.g. bitnami\r\n        offer = \"${offer}\" // e.g. elk\r\n        sku = \"${sku}\" // e.g. 46\r\n        version = \"${version}\"  // e.g. latest\r\n    }\r\n\r\nSo a complete VM resource definition would lok something like this.\r\n\r\n     \r\n    resource \"azurerm_virtual_machine\" \"virtual_machine\" {\r\n        count = \"${var.vm_count}\"\r\n        name = \"${element(module.template.vm_names, count.index)}\"\r\n        location = \"${var.location}\"\r\n        resource_group_name = \"${var.resource_group_name}\"\r\n        network_interface_ids = [\"${element(azurerm_network_interface.network_interface.*.id, count.index)}\"]\r\n        vm_size = \"${var.vm_size}\"\r\n        delete_data_disks_on_termination = true\r\n        delete_os_disk_on_termination = true\r\n        \r\n    plan {\r\n        publisher = \"${var.publisher}\"\r\n        product = \"${var.offer}\"\r\n        name = \"${var.sku}\"\r\n    }\r\n\r\n    boot_diagnostics {\r\n        enabled = true\r\n        storage_uri = \"${var.boot_diagnostics_storage_url}\"\r\n    }\r\n\r\n    storage_image_reference {\r\n        publisher = \"${var.publisher}\"\r\n        offer = \"${var.offer}\"\r\n        sku = \"${var.sku}\"\r\n        version = \"${var.version}\"\r\n    }\r\n\r\n    storage_os_disk {\r\n        name = \"primarydisk\"\r\n        vhd_uri = \"${join(\"\", list(var.disks_container_url, \"/\" , element(module.template.vm_names, count.index), \".vhd\"))}\"\r\n        caching = \"ReadWrite\"\r\n        create_option = \"FromImage\"\r\n    }\r\n\r\n    os_profile {\r\n        computer_name = \"${element(module.template.vm_names, count.index)}\"\r\n        admin_username = \"${element(module.template.user_names, count.index)}\"\r\n    }\r\n\r\n    os_profile_linux_config {\r\n        disable_password_authentication = true\r\n        ssh_keys = [{\r\n            path     = \"/home/${element(module.template.user_names, count.index)}/.ssh/authorized_keys\"\r\n            key_data = \"${replace(file(\"../vars/keys/vm.pub\"),\"\\n\",\"\")}\"\r\n        }]\r\n    }\r\n\r\n    tags {\r\n        environment = \"${var.resource_group_name}\"\r\n    }\r\n    }", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "74240768", "PostTypeId": "2", "ParentId": "35134584", "CreationDate": "2022-10-28T20:50:12.550", "Score": "-1", "Body": "<p>resource &quot;azurerm_marketplace_agreement&quot;</p>\n", "OwnerUserId": "2795697", "LastActivityDate": "2022-10-28T20:50:12.550", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133730225", "PostId": "74240768", "Score": "0", "Text": "As stated, this answer is not complete or helpful.  You could improve it by explaining when an agreement is necessary and what it entails.", "CreationDate": "2023-03-22T12:28:11.367", "UserId": "584674", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "281073699", "PostHistoryTypeId": "2", "PostId": "74240768", "RevisionGUID": "9d8c37b7-2719-4be1-9d74-e4b8fba8060d", "CreationDate": "2022-10-28T20:50:12.550", "UserId": "2795697", "Text": "resource \"azurerm_marketplace_agreement\"", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "I've started to get into Terraform and am loving it, since for cost reasons I have my services across a number of infrastructure providers, so it makes it easy to replicate full services without issues across IaaS providers. ", "keywords": ["cost"]}]}