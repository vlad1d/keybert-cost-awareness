{"Id": "52712637", "PostTypeId": "1", "AcceptedAnswerId": "52720106", "CreationDate": "2018-10-09T02:46:49.143", "Score": "0", "ViewCount": "1036", "Body": "<p>I have a wonderful terraform plan that perfectly describes my infrastructure in Google Cloud Platform, however, I have a problem: since my repository isn't perfectly private, some steps of my plan are encrypted and must be decrypted using <a href=\"https://cloud.google.com/kms/\" rel=\"nofollow noreferrer\">Google Key Management Service</a>.</p>\n\n<p>This means my plan must be broken down into two terraform phases:</p>\n\n<ol>\n<li>Setup the Google Cloud Project and create a Key Ring and Key (after this, I encrypt secrets and put them in a <code>variables.tf</code> file)</li>\n<li>Apply the entire plan.</li>\n</ol>\n\n<p>Does Terraform support a way to break down my plan into phases? How should I go around implementing this?</p>\n", "OwnerUserId": "3970701", "LastActivityDate": "2018-10-09T11:35:09.387", "Title": "How do I run a Terraform plan in multiple steps / phases?", "Tags": "<terraform><terraform-provider-gcp>", "AnswerCount": "1", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "92358423", "PostId": "52712637", "Score": "0", "Text": "It's not completely clear what steps you're having to perform and what the point of them is. Can you elaborate with a worked example including Terraform code and all the steps you'd like to run? It sounds like there might be a better way to do what you want but I'm not sure without seeing exactly what you're trying to do", "CreationDate": "2018-10-09T08:28:13.467", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "183353914", "PostHistoryTypeId": "2", "PostId": "52712637", "RevisionGUID": "5b06cd21-d7dc-4377-aa4c-0f9c057ee338", "CreationDate": "2018-10-09T02:46:49.143", "UserId": "3970701", "Text": "I have a wonderful terraform plan that perfectly describes my infrastructure in Google Cloud Platform, however, I have a problem: since my repository isn't perfectly private, some steps of my plan are encrypted and must be decrypted using [Google Key Management Service][1].\r\n\r\nThis means my plan must be broken down into two terraform phases:\r\n\r\n 1. Setup the Google Cloud Project and create a Key Ring and Key (after this, I encrypt secrets and put them in a `variables.tf` file)\r\n 2. Apply the entire plan.\r\n\r\nDoes Terraform support a way to break down my plan into phases? How should I go around implementing this?\r\n\r\n  [1]: https://cloud.google.com/kms/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183353915", "PostHistoryTypeId": "1", "PostId": "52712637", "RevisionGUID": "5b06cd21-d7dc-4377-aa4c-0f9c057ee338", "CreationDate": "2018-10-09T02:46:49.143", "UserId": "3970701", "Text": "How do I run a Terraform plan in multiple steps / phases?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183353916", "PostHistoryTypeId": "3", "PostId": "52712637", "RevisionGUID": "5b06cd21-d7dc-4377-aa4c-0f9c057ee338", "CreationDate": "2018-10-09T02:46:49.143", "UserId": "3970701", "Text": "<terraform><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "52720106", "PostTypeId": "2", "ParentId": "52712637", "CreationDate": "2018-10-09T11:35:09.387", "Score": "1", "Body": "<p>Though terraform enables us to automate the resources creation, some preliminary steps need to be done manually, like account creation, billing setup, etc. Similarly for Google cloud setup, the project needs to be created prior running terrform scripts since terraform google provider requires the project details.</p>\n\n<p>The project creation and terraform variables for the keys (as environment variables) can be generated through shell scripts. Then the shell script and the terraform scripts can be sequenced in execution using a make file.</p>\n\n<p>The below link might be helpful for you to create GCP project through shell scripts.\n<a href=\"https://medium.com/google-cloud/how-to-automate-project-creation-using-gcloud-4e71d9a70047\" rel=\"nofollow noreferrer\">https://medium.com/google-cloud/how-to-automate-project-creation-using-gcloud-4e71d9a70047</a></p>\n", "OwnerUserId": "10283298", "LastActivityDate": "2018-10-09T11:35:09.387", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "183384641", "PostHistoryTypeId": "2", "PostId": "52720106", "RevisionGUID": "47fd9416-8c95-4a21-9d41-312b6e5bcc4b", "CreationDate": "2018-10-09T11:35:09.387", "UserId": "10283298", "Text": "Though terraform enables us to automate the resources creation, some preliminary steps need to be done manually, like account creation, billing setup, etc. Similarly for Google cloud setup, the project needs to be created prior running terrform scripts since terraform google provider requires the project details.\r\n\r\nThe project creation and terraform variables for the keys (as environment variables) can be generated through shell scripts. Then the shell script and the terraform scripts can be sequenced in execution using a make file.\r\n\r\nThe below link might be helpful for you to create GCP project through shell scripts.\r\nhttps://medium.com/google-cloud/how-to-automate-project-creation-using-gcloud-4e71d9a70047\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Though terraform enables us to automate the resources creation, some preliminary steps need to be done manually, like account creation, billing setup, etc. ", "keywords": ["bill"]}, {"source": "Text", "text": "Similarly for Google cloud setup, the project needs to be created prior running terrform scripts since terraform google provider requires the project details. ", "keywords": ["provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "Though terraform enables us to automate the resources creation, some preliminary steps need to be done manually, like account creation, billing setup, etc. ", "keywords": ["bill"]}, {"source": "Body", "text": "Similarly for Google cloud setup, the project needs to be created prior running terrform scripts since terraform google provider requires the project details. ", "keywords": ["provider"]}]}], "contains-topic": true, "filtered-sentences": []}