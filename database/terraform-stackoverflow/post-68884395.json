{"Id": "68884395", "PostTypeId": "1", "AcceptedAnswerId": "68884518", "CreationDate": "2021-08-22T19:08:24.883", "Score": "1", "ViewCount": "542", "Body": "<p>I have just discovered <a href=\"https://terraform-compliance.com/pages/bdd-references/when.html\" rel=\"nofollow noreferrer\">terraform compliance</a> and am testing it out against my terraform code that deploys resources to GCP.</p>\n<p>GCP labels enable fine-grained cost analysis and every labels attribute is a map (<a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels\" rel=\"nofollow noreferrer\">bigquery_dataset#labels</a>) so I would like to verify that every resource that has a <code>labels</code> argument includes a certain key that we use for analysing costs. Here is an example terraform configuration:</p>\n<pre><code>variable &quot;project&quot;{\n type = string\n}\n\nprovider &quot;google&quot; {\n  region = &quot;europe-west2&quot;\n}\n\nresource &quot;google_bigquery_dataset&quot; &quot;dataset1&quot; {\n  dataset_id    = &quot;dataset1&quot;\n  project       = var.project\n  labels        = { &quot;label1&quot; : &quot;some_value&quot; }\n}\n\nresource &quot;google_bigquery_dataset&quot; &quot;dataset2&quot; {\n  dataset_id    = &quot;dataset2&quot;\n  project       = var.project\n  labels        = { &quot;anotherlabel&quot; : &quot;some_value&quot; }\n}\n\nresource &quot;google_bigquery_dataset&quot; &quot;dataset3&quot; {\n  dataset_id    = &quot;dataset3&quot;\n  project       = var.project\n}\n</code></pre>\n<p>dataset3 is not acceptable because it doesn't have any labels. dataset2 is unacceptable because while it does have labels, it doesn't have the one I want it to  have, <code>label1</code></p>\n<p>I would like to use terraform compliance to check for these anomolies but I can't figure out how. here is my feature file, <code>test.feature</code>:</p>\n<pre><code>Feature: Terraform Compliance\n\nScenario: My scenario\n    Given I have any resource defined\n    When it has labels\n    Then it must contain label1\n</code></pre>\n<p>I then issue :</p>\n<pre class=\"lang-sh prettyprint-override\"><code>terraform init ^^ \\\n  terraform plan --var=project=myproject --out=plan.out &amp;&amp; \\\n  terraform-compliance --planfile plan.out -f .\n</code></pre>\n<p>which produces this output:</p>\n<blockquote>\n<p>terraform-compliance v1.3.24 initiated</p>\n<p>. Converting terraform plan file.<br />\n Features     : /tmp/tctest/<br />\n Plan File    : /tmp/tctest/plan.out.json</p>\n<p> Running tests. </p>\n<p>Feature: Terraform Compliance  # /tmp/terraformcompliancetest/test.feature</p>\n<pre><code>Scenario: My scenario\n    Given I have any resource defined\n    When it has labels\n            Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property.\n            Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property.\n    Then it must contain label1\n      Failure:\n</code></pre>\n<p>1 features (0 passed, 1 failed)<br />\n1 scenarios (0 passed, 1 failed)<br />\n3 steps (2 passed, 1 failed)<br />\nRun 1629659085 finished within a moment</p>\n</blockquote>\n<p>Clearly this isn't giving me what I want. I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. Can anyone help?</p>\n<hr />\n<p>UPDATE As <a href=\"https://twitter.com/terraformtest/status/1429524432830222343?s=20\" rel=\"nofollow noreferrer\">requested on twitter</a>, here is the contents of plan.out.json</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n    &quot;format_version&quot;: &quot;0.1&quot;,\n    &quot;terraform_version&quot;: &quot;0.14.7&quot;,\n    &quot;variables&quot;: {\n        &quot;project&quot;: {\n            &quot;value&quot;: &quot;myproject&quot;\n        }\n    },\n    &quot;planned_values&quot;: {\n        &quot;root_module&quot;: {\n            &quot;resources&quot;: [\n                {\n                    &quot;address&quot;: &quot;google_bigquery_dataset.dataset1&quot;,\n                    &quot;mode&quot;: &quot;managed&quot;,\n                    &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n                    &quot;name&quot;: &quot;dataset1&quot;,\n                    &quot;provider_name&quot;: &quot;registry.terraform.io/hashicorp/google&quot;,\n                    &quot;schema_version&quot;: 0,\n                    &quot;values&quot;: {\n                        &quot;dataset_id&quot;: &quot;dataset1&quot;,\n                        &quot;default_encryption_configuration&quot;: [],\n                        &quot;default_partition_expiration_ms&quot;: null,\n                        &quot;default_table_expiration_ms&quot;: null,\n                        &quot;delete_contents_on_destroy&quot;: false,\n                        &quot;description&quot;: null,\n                        &quot;friendly_name&quot;: null,\n                        &quot;labels&quot;: {\n                            &quot;label1&quot;: &quot;some_value&quot;\n                        },\n                        &quot;location&quot;: &quot;US&quot;,\n                        &quot;project&quot;: &quot;myproject&quot;,\n                        &quot;timeouts&quot;: null\n                    }\n                },\n                {\n                    &quot;address&quot;: &quot;google_bigquery_dataset.dataset2&quot;,\n                    &quot;mode&quot;: &quot;managed&quot;,\n                    &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n                    &quot;name&quot;: &quot;dataset2&quot;,\n                    &quot;provider_name&quot;: &quot;registry.terraform.io/hashicorp/google&quot;,\n                    &quot;schema_version&quot;: 0,\n                    &quot;values&quot;: {\n                        &quot;dataset_id&quot;: &quot;dataset2&quot;,\n                        &quot;default_encryption_configuration&quot;: [],\n                        &quot;default_partition_expiration_ms&quot;: null,\n                        &quot;default_table_expiration_ms&quot;: null,\n                        &quot;delete_contents_on_destroy&quot;: false,\n                        &quot;description&quot;: null,\n                        &quot;friendly_name&quot;: null,\n                        &quot;labels&quot;: {\n                            &quot;anotherlabel&quot;: &quot;some_value&quot;\n                        },\n                        &quot;location&quot;: &quot;US&quot;,\n                        &quot;project&quot;: &quot;myproject&quot;,\n                        &quot;timeouts&quot;: null\n                    }\n                },\n                {\n                    &quot;address&quot;: &quot;google_bigquery_dataset.dataset3&quot;,\n                    &quot;mode&quot;: &quot;managed&quot;,\n                    &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n                    &quot;name&quot;: &quot;dataset3&quot;,\n                    &quot;provider_name&quot;: &quot;registry.terraform.io/hashicorp/google&quot;,\n                    &quot;schema_version&quot;: 0,\n                    &quot;values&quot;: {\n                        &quot;dataset_id&quot;: &quot;dataset3&quot;,\n                        &quot;default_encryption_configuration&quot;: [],\n                        &quot;default_partition_expiration_ms&quot;: null,\n                        &quot;default_table_expiration_ms&quot;: null,\n                        &quot;delete_contents_on_destroy&quot;: false,\n                        &quot;description&quot;: null,\n                        &quot;friendly_name&quot;: null,\n                        &quot;labels&quot;: null,\n                        &quot;location&quot;: &quot;US&quot;,\n                        &quot;project&quot;: &quot;myproject&quot;,\n                        &quot;timeouts&quot;: null\n                    }\n                }\n            ]\n        }\n    },\n    &quot;resource_changes&quot;: [\n        {\n            &quot;address&quot;: &quot;google_bigquery_dataset.dataset1&quot;,\n            &quot;mode&quot;: &quot;managed&quot;,\n            &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n            &quot;name&quot;: &quot;dataset1&quot;,\n            &quot;provider_name&quot;: &quot;registry.terraform.io/hashicorp/google&quot;,\n            &quot;change&quot;: {\n                &quot;actions&quot;: [\n                    &quot;create&quot;\n                ],\n                &quot;before&quot;: null,\n                &quot;after&quot;: {\n                    &quot;dataset_id&quot;: &quot;dataset1&quot;,\n                    &quot;default_encryption_configuration&quot;: [],\n                    &quot;default_partition_expiration_ms&quot;: null,\n                    &quot;default_table_expiration_ms&quot;: null,\n                    &quot;delete_contents_on_destroy&quot;: false,\n                    &quot;description&quot;: null,\n                    &quot;friendly_name&quot;: null,\n                    &quot;labels&quot;: {\n                        &quot;label1&quot;: &quot;some_value&quot;\n                    },\n                    &quot;location&quot;: &quot;US&quot;,\n                    &quot;project&quot;: &quot;myproject&quot;,\n                    &quot;timeouts&quot;: null\n                },\n                &quot;after_unknown&quot;: {\n                    &quot;access&quot;: true,\n                    &quot;creation_time&quot;: true,\n                    &quot;default_encryption_configuration&quot;: [],\n                    &quot;etag&quot;: true,\n                    &quot;id&quot;: true,\n                    &quot;labels&quot;: {},\n                    &quot;last_modified_time&quot;: true,\n                    &quot;self_link&quot;: true\n                }\n            }\n        },\n        {\n            &quot;address&quot;: &quot;google_bigquery_dataset.dataset2&quot;,\n            &quot;mode&quot;: &quot;managed&quot;,\n            &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n            &quot;name&quot;: &quot;dataset2&quot;,\n            &quot;provider_name&quot;: &quot;registry.terraform.io/hashicorp/google&quot;,\n            &quot;change&quot;: {\n                &quot;actions&quot;: [\n                    &quot;create&quot;\n                ],\n                &quot;before&quot;: null,\n                &quot;after&quot;: {\n                    &quot;dataset_id&quot;: &quot;dataset2&quot;,\n                    &quot;default_encryption_configuration&quot;: [],\n                    &quot;default_partition_expiration_ms&quot;: null,\n                    &quot;default_table_expiration_ms&quot;: null,\n                    &quot;delete_contents_on_destroy&quot;: false,\n                    &quot;description&quot;: null,\n                    &quot;friendly_name&quot;: null,\n                    &quot;labels&quot;: {\n                        &quot;anotherlabel&quot;: &quot;some_value&quot;\n                    },\n                    &quot;location&quot;: &quot;US&quot;,\n                    &quot;project&quot;: &quot;myproject&quot;,\n                    &quot;timeouts&quot;: null\n                },\n                &quot;after_unknown&quot;: {\n                    &quot;access&quot;: true,\n                    &quot;creation_time&quot;: true,\n                    &quot;default_encryption_configuration&quot;: [],\n                    &quot;etag&quot;: true,\n                    &quot;id&quot;: true,\n                    &quot;labels&quot;: {},\n                    &quot;last_modified_time&quot;: true,\n                    &quot;self_link&quot;: true\n                }\n            }\n        },\n        {\n            &quot;address&quot;: &quot;google_bigquery_dataset.dataset3&quot;,\n            &quot;mode&quot;: &quot;managed&quot;,\n            &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n            &quot;name&quot;: &quot;dataset3&quot;,\n            &quot;provider_name&quot;: &quot;registry.terraform.io/hashicorp/google&quot;,\n            &quot;change&quot;: {\n                &quot;actions&quot;: [\n                    &quot;create&quot;\n                ],\n                &quot;before&quot;: null,\n                &quot;after&quot;: {\n                    &quot;dataset_id&quot;: &quot;dataset3&quot;,\n                    &quot;default_encryption_configuration&quot;: [],\n                    &quot;default_partition_expiration_ms&quot;: null,\n                    &quot;default_table_expiration_ms&quot;: null,\n                    &quot;delete_contents_on_destroy&quot;: false,\n                    &quot;description&quot;: null,\n                    &quot;friendly_name&quot;: null,\n                    &quot;labels&quot;: null,\n                    &quot;location&quot;: &quot;US&quot;,\n                    &quot;project&quot;: &quot;myproject&quot;,\n                    &quot;timeouts&quot;: null\n                },\n                &quot;after_unknown&quot;: {\n                    &quot;access&quot;: true,\n                    &quot;creation_time&quot;: true,\n                    &quot;default_encryption_configuration&quot;: [],\n                    &quot;etag&quot;: true,\n                    &quot;id&quot;: true,\n                    &quot;last_modified_time&quot;: true,\n                    &quot;self_link&quot;: true\n                }\n            }\n        }\n    ],\n    &quot;configuration&quot;: {\n        &quot;provider_config&quot;: {\n            &quot;google&quot;: {\n                &quot;name&quot;: &quot;google&quot;,\n                &quot;expressions&quot;: {\n                    &quot;region&quot;: {\n                        &quot;constant_value&quot;: &quot;europe-west2&quot;\n                    }\n                }\n            }\n        },\n        &quot;root_module&quot;: {\n            &quot;resources&quot;: [\n                {\n                    &quot;address&quot;: &quot;google_bigquery_dataset.dataset1&quot;,\n                    &quot;mode&quot;: &quot;managed&quot;,\n                    &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n                    &quot;name&quot;: &quot;dataset1&quot;,\n                    &quot;provider_config_key&quot;: &quot;google&quot;,\n                    &quot;expressions&quot;: {\n                        &quot;dataset_id&quot;: {\n                            &quot;constant_value&quot;: &quot;dataset1&quot;\n                        },\n                        &quot;labels&quot;: {\n                            &quot;constant_value&quot;: {\n                                &quot;label1&quot;: &quot;some_value&quot;\n                            }\n                        },\n                        &quot;project&quot;: {\n                            &quot;references&quot;: [\n                                &quot;var.project&quot;\n                            ]\n                        }\n                    },\n                    &quot;schema_version&quot;: 0\n                },\n                {\n                    &quot;address&quot;: &quot;google_bigquery_dataset.dataset2&quot;,\n                    &quot;mode&quot;: &quot;managed&quot;,\n                    &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n                    &quot;name&quot;: &quot;dataset2&quot;,\n                    &quot;provider_config_key&quot;: &quot;google&quot;,\n                    &quot;expressions&quot;: {\n                        &quot;dataset_id&quot;: {\n                            &quot;constant_value&quot;: &quot;dataset2&quot;\n                        },\n                        &quot;labels&quot;: {\n                            &quot;constant_value&quot;: {\n                                &quot;anotherlabel&quot;: &quot;some_value&quot;\n                            }\n                        },\n                        &quot;project&quot;: {\n                            &quot;references&quot;: [\n                                &quot;var.project&quot;\n                            ]\n                        }\n                    },\n                    &quot;schema_version&quot;: 0\n                },\n                {\n                    &quot;address&quot;: &quot;google_bigquery_dataset.dataset3&quot;,\n                    &quot;mode&quot;: &quot;managed&quot;,\n                    &quot;type&quot;: &quot;google_bigquery_dataset&quot;,\n                    &quot;name&quot;: &quot;dataset3&quot;,\n                    &quot;provider_config_key&quot;: &quot;google&quot;,\n                    &quot;expressions&quot;: {\n                        &quot;dataset_id&quot;: {\n                            &quot;constant_value&quot;: &quot;dataset3&quot;\n                        },\n                        &quot;project&quot;: {\n                            &quot;references&quot;: [\n                                &quot;var.project&quot;\n                            ]\n                        }\n                    },\n                    &quot;schema_version&quot;: 0\n                }\n            ],\n            &quot;variables&quot;: {\n                &quot;project&quot;: {}\n            }\n        }\n    }\n}\n</code></pre>\n", "OwnerUserId": "201657", "LastEditorUserId": "201657", "LastEditDate": "2021-08-22T20:18:28.397", "LastActivityDate": "2021-08-22T20:18:28.397", "Title": "Terraform compliance: how do i check that my GCP resources have a label with a given key?", "Tags": "<terraform>", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "252429618", "PostHistoryTypeId": "2", "PostId": "68884395", "RevisionGUID": "3d96f95c-0bff-49de-aa13-1f29a660c973", "CreationDate": "2021-08-22T19:08:24.883", "UserId": "201657", "Text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. \r\n\r\nGCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. Here is an example terraform configuration:\r\n\r\n```hcl\r\nvariable \"project\"{\r\n type = string\r\n}\r\n\r\nprovider \"google\" {\r\n  region = \"europe-west2\"\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset1\" {\r\n  dataset_id    = \"dataset1\"\r\n  project       = var.project\r\n  labels        = { \"label1\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset2\" {\r\n  dataset_id    = \"dataset2\"\r\n  project       = var.project\r\n  labels        = { \"anotherlabel\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset3\" {\r\n  dataset_id    = \"dataset3\"\r\n  project       = var.project\r\n}\r\n```\r\n\r\ndataset3 is not acceptable because it doesn't have any labels. dataset2 is unacceptable because while it does have labels, it doesn't have the one I want it to  have, `label1`\r\n\r\nI would like to use terraform compliance to check for these anomolies but I can't figure out how. here is my feature file, `test.feature`:\r\n\r\n```gherkin\r\nFeature: Terraform Compliance\r\n\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it must contain label1\r\n```\r\n\r\nI then issue :\r\n\r\n```bash\r\nterraform plan --var=project=msm-groupdata-datalake-dev --out=plan.out && \\\r\n  terraform-compliance --planfile plan.out -f .\r\n```\r\n\r\nwhich produces this output:\r\n\r\n> terraform-compliance v1.3.24 initiated\r\n> \r\n> . Converting terraform plan file.  \r\n>  Features     : /tmp/terraformcompliancetest/  \r\n>  Plan File    : /tmp/terraformcompliancetest/plan.out.json  \r\n> \r\n>  Running tests. \r\n> \r\n> Feature: Terraform Compliance  # /tmp/terraformcompliancetest/test.feature\r\n> \r\n>     Scenario: My scenario\r\n>         Given I have any resource defined\r\n>         When it has labels\r\n>                 Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property.\r\n>                 Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property.\r\n>         Then it must contain label1\r\n>           Failure:\r\n> \r\n> 1 features (0 passed, 1 failed)  \r\n> 1 scenarios (0 passed, 1 failed)  \r\n> 3 steps (2 passed, 1 failed)  \r\n> Run 1629659085 finished within a moment\r\n\r\nClearly this isn't giving me what I want. I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. Can anyone help?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. ", "keywords": ["test"]}, {"source": "Text", "text": "GCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. ", "keywords": ["cost"]}, {"source": "Text", "text": "Here is an example terraform configuration: ```hcl variable \"project\"{ type = string } provider \"google\" { region = \"europe-west2\" } resource \"google_bigquery_dataset\" \"dataset1\" { dataset_id = \"dataset1\" project = var.project labels = { \"label1\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset2\" { dataset_id = \"dataset2\" project = var.project labels = { \"anotherlabel\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset3\" { dataset_id = \"dataset3\" project = var.project } ``` dataset3 is not acceptable because it doesn't have any labels. ", "keywords": ["provider"]}, {"source": "Text", "text": "here is my feature file, `test.feature`: ```gherkin Feature: Terraform Compliance Scenario: My scenario Given I have any resource defined When it has labels Then it must contain label1 ``` I then issue : ```bash terraform plan --var=project=msm-groupdata-datalake-dev --out=plan.out && \\ terraform-compliance --planfile plan.out -f . ``` which produces this output: > terraform-compliance v1.3.24 initiated > > . ", "keywords": ["feature", "test"]}, {"source": "Text", "text": "Converting terraform plan file. > Features : /tmp/terraformcompliancetest/ > Plan File : /tmp/terraformcompliancetest/plan.out.json > > Running tests. > > Feature: Terraform Compliance # /tmp/terraformcompliancetest/test.feature > > Scenario: My scenario > Given I have any resource defined > When it has labels > Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property. > Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property. > Then it must contain label1 > Failure: > > 1 features (0 passed, 1 failed) > 1 scenarios (0 passed, 1 failed) > 3 steps (2 passed, 1 failed) > ", "keywords": ["feature", "test"]}, {"source": "Text", "text": "I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. ", "keywords": ["feature"]}]}, {"Id": "252429619", "PostHistoryTypeId": "1", "PostId": "68884395", "RevisionGUID": "3d96f95c-0bff-49de-aa13-1f29a660c973", "CreationDate": "2021-08-22T19:08:24.883", "UserId": "201657", "Text": "Terraform compliance: how do i check that my GCP resources have a label with a given key?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "252429620", "PostHistoryTypeId": "3", "PostId": "68884395", "RevisionGUID": "3d96f95c-0bff-49de-aa13-1f29a660c973", "CreationDate": "2021-08-22T19:08:24.883", "UserId": "201657", "Text": "<terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "252430231", "PostHistoryTypeId": "5", "PostId": "68884395", "RevisionGUID": "80950d9a-3376-4593-be5b-7f8cc8413d95", "CreationDate": "2021-08-22T19:27:47.623", "UserId": "201657", "Comment": "deleted 17 characters in body", "Text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. \r\n\r\nGCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. Here is an example terraform configuration:\r\n\r\n```hcl\r\nvariable \"project\"{\r\n type = string\r\n}\r\n\r\nprovider \"google\" {\r\n  region = \"europe-west2\"\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset1\" {\r\n  dataset_id    = \"dataset1\"\r\n  project       = var.project\r\n  labels        = { \"label1\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset2\" {\r\n  dataset_id    = \"dataset2\"\r\n  project       = var.project\r\n  labels        = { \"anotherlabel\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset3\" {\r\n  dataset_id    = \"dataset3\"\r\n  project       = var.project\r\n}\r\n```\r\n\r\ndataset3 is not acceptable because it doesn't have any labels. dataset2 is unacceptable because while it does have labels, it doesn't have the one I want it to  have, `label1`\r\n\r\nI would like to use terraform compliance to check for these anomolies but I can't figure out how. here is my feature file, `test.feature`:\r\n\r\n```gherkin\r\nFeature: Terraform Compliance\r\n\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it must contain label1\r\n```\r\n\r\nI then issue :\r\n\r\n```bash\r\nterraform init ^^ \\\r\n  terraform plan --var=project=myproject --out=plan.out && \\\r\n  terraform-compliance --planfile plan.out -f .\r\n```\r\n\r\nwhich produces this output:\r\n\r\n> terraform-compliance v1.3.24 initiated\r\n> \r\n> . Converting terraform plan file.  \r\n>  Features     : /tmp/terraformcompliancetest/  \r\n>  Plan File    : /tmp/terraformcompliancetest/plan.out.json  \r\n> \r\n>  Running tests. \r\n> \r\n> Feature: Terraform Compliance  # /tmp/terraformcompliancetest/test.feature\r\n> \r\n>     Scenario: My scenario\r\n>         Given I have any resource defined\r\n>         When it has labels\r\n>                 Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property.\r\n>                 Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property.\r\n>         Then it must contain label1\r\n>           Failure:\r\n> \r\n> 1 features (0 passed, 1 failed)  \r\n> 1 scenarios (0 passed, 1 failed)  \r\n> 3 steps (2 passed, 1 failed)  \r\n> Run 1629659085 finished within a moment\r\n\r\nClearly this isn't giving me what I want. I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. Can anyone help?\r\n\r\n---\r\n\r\nUPDATE As requested on twitter, here is the contents of plan.out.json\r\n```json\r\n{\"format_version\":\"0.1\",\"terraform_version\":\"0.14.7\",\"variables\":{\"project\":{\"value\":\"msm-groupdata-datalake-dev\"}},\"planned_values\":{\"root_module\":{\"resources\":[{\"address\":\"google_bigquery_dataset.dataset1\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset1\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"schema_version\":0,\"values\":{\"dataset_id\":\"dataset1\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"label1\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null}},{\"address\":\"google_bigquery_dataset.dataset2\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset2\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"schema_version\":0,\"values\":{\"dataset_id\":\"dataset2\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"anotherlabel\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null}},{\"address\":\"google_bigquery_dataset.dataset3\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset3\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"schema_version\":0,\"values\":{\"dataset_id\":\"dataset3\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":null,\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null}}]}},\"resource_changes\":[{\"address\":\"google_bigquery_dataset.dataset1\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset1\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"change\":{\"actions\":[\"create\"],\"before\":null,\"after\":{\"dataset_id\":\"dataset1\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"label1\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null},\"after_unknown\":{\"access\":true,\"creation_time\":true,\"default_encryption_configuration\":[],\"etag\":true,\"id\":true,\"labels\":{},\"last_modified_time\":true,\"self_link\":true}}},{\"address\":\"google_bigquery_dataset.dataset2\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset2\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"change\":{\"actions\":[\"create\"],\"before\":null,\"after\":{\"dataset_id\":\"dataset2\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"anotherlabel\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null},\"after_unknown\":{\"access\":true,\"creation_time\":true,\"default_encryption_configuration\":[],\"etag\":true,\"id\":true,\"labels\":{},\"last_modified_time\":true,\"self_link\":true}}},{\"address\":\"google_bigquery_dataset.dataset3\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset3\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"change\":{\"actions\":[\"create\"],\"before\":null,\"after\":{\"dataset_id\":\"dataset3\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":null,\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null},\"after_unknown\":{\"access\":true,\"creation_time\":true,\"default_encryption_configuration\":[],\"etag\":true,\"id\":true,\"last_modified_time\":true,\"self_link\":true}}}],\"configuration\":{\"provider_config\":{\"google\":{\"name\":\"google\",\"expressions\":{\"region\":{\"constant_value\":\"europe-west2\"}}}},\"root_module\":{\"resources\":[{\"address\":\"google_bigquery_dataset.dataset1\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset1\",\"provider_config_key\":\"google\",\"expressions\":{\"dataset_id\":{\"constant_value\":\"dataset1\"},\"labels\":{\"constant_value\":{\"label1\":\"some_value\"}},\"project\":{\"references\":[\"var.project\"]}},\"schema_version\":0},{\"address\":\"google_bigquery_dataset.dataset2\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset2\",\"provider_config_key\":\"google\",\"expressions\":{\"dataset_id\":{\"constant_value\":\"dataset2\"},\"labels\":{\"constant_value\":{\"anotherlabel\":\"some_value\"}},\"project\":{\"references\":[\"var.project\"]}},\"schema_version\":0},{\"address\":\"google_bigquery_dataset.dataset3\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset3\",\"provider_config_key\":\"google\",\"expressions\":{\"dataset_id\":{\"constant_value\":\"dataset3\"},\"project\":{\"references\":[\"var.project\"]}},\"schema_version\":0}],\"variables\":{\"project\":{}}}}}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. ", "keywords": ["test"]}, {"source": "Text", "text": "GCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. ", "keywords": ["cost"]}, {"source": "Text", "text": "Here is an example terraform configuration: ```hcl variable \"project\"{ type = string } provider \"google\" { region = \"europe-west2\" } resource \"google_bigquery_dataset\" \"dataset1\" { dataset_id = \"dataset1\" project = var.project labels = { \"label1\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset2\" { dataset_id = \"dataset2\" project = var.project labels = { \"anotherlabel\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset3\" { dataset_id = \"dataset3\" project = var.project } ``` dataset3 is not acceptable because it doesn't have any labels. ", "keywords": ["provider"]}, {"source": "Text", "text": "here is my feature file, `test.feature`: ```gherkin Feature: Terraform Compliance Scenario: My scenario Given I have any resource defined When it has labels Then it must contain label1 ``` I then issue : ```bash terraform init ^^ \\ terraform plan --var=project=myproject --out=plan.out && \\ terraform-compliance --planfile plan.out -f . ``` which produces this output: > terraform-compliance v1.3.24 initiated > > . Converting terraform plan file. > Features : /tmp/terraformcompliancetest/ > Plan File : /tmp/terraformcompliancetest/plan.out.json > > Running tests. > > Feature: Terraform Compliance # /tmp/terraformcompliancetest/test.feature > > Scenario: My scenario > Given I have any resource defined > When it has labels > Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property. > Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property. > Then it must contain label1 > Failure: > > 1 features (0 passed, 1 failed) > 1 scenarios (0 passed, 1 failed) > 3 steps (2 passed, 1 failed) > ", "keywords": ["feature", "test"]}, {"source": "Text", "text": "I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. ", "keywords": ["feature"]}, {"source": "Text", "text": "As requested on twitter, here is the contents of plan.out.json ```json {\"format_version\":\"0.1\",\"terraform_version\":\"0.14.7\",\"variables\":{\"project\":{\"value\":\"msm-groupdata-datalake-dev\"}},\"planned_values\":{\"root_module\":{\"resources\":[{\"address\":\"google_bigquery_dataset.dataset1\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset1\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"schema_version\":0,\"values\":{\"dataset_id\":\"dataset1\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"label1\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null}},{\"address\":\"google_bigquery_dataset.dataset2\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset2\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"schema_version\":0,\"values\":{\"dataset_id\":\"dataset2\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"anotherlabel\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null}},{\"address\":\"google_bigquery_dataset.dataset3\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset3\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"schema_version\":0,\"values\":{\"dataset_id\":\"dataset3\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":null,\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null}}]}},\"resource_changes\":[{\"address\":\"google_bigquery_dataset.dataset1\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset1\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"change\":{\"actions\":[\"create\"],\"before\":null,\"after\":{\"dataset_id\":\"dataset1\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"label1\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null},\"after_unknown\":{\"access\":true,\"creation_time\":true,\"default_encryption_configuration\":[],\"etag\":true,\"id\":true,\"labels\":{},\"last_modified_time\":true,\"self_link\":true}}},{\"address\":\"google_bigquery_dataset.dataset2\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset2\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"change\":{\"actions\":[\"create\"],\"before\":null,\"after\":{\"dataset_id\":\"dataset2\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":{\"anotherlabel\":\"some_value\"},\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null},\"after_unknown\":{\"access\":true,\"creation_time\":true,\"default_encryption_configuration\":[],\"etag\":true,\"id\":true,\"labels\":{},\"last_modified_time\":true,\"self_link\":true}}},{\"address\":\"google_bigquery_dataset.dataset3\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset3\",\"provider_name\":\"registry.terraform.io/hashicorp/google\",\"change\":{\"actions\":[\"create\"],\"before\":null,\"after\":{\"dataset_id\":\"dataset3\",\"default_encryption_configuration\":[],\"default_partition_expiration_ms\":null,\"default_table_expiration_ms\":null,\"delete_contents_on_destroy\":false,\"description\":null,\"friendly_name\":null,\"labels\":null,\"location\":\"US\",\"project\":\"msm-groupdata-datalake-dev\",\"timeouts\":null},\"after_unknown\":{\"access\":true,\"creation_time\":true,\"default_encryption_configuration\":[],\"etag\":true,\"id\":true,\"last_modified_time\":true,\"self_link\":true}}}],\"configuration\":{\"provider_config\":{\"google\":{\"name\":\"google\",\"expressions\":{\"region\":{\"constant_value\":\"europe-west2\"}}}},\"root_module\":{\"resources\":[{\"address\":\"google_bigquery_dataset.dataset1\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset1\",\"provider_config_key\":\"google\",\"expressions\":{\"dataset_id\":{\"constant_value\":\"dataset1\"},\"labels\":{\"constant_value\":{\"label1\":\"some_value\"}},\"project\":{\"references\":[\"var.project\"]}},\"schema_version\":0},{\"address\":\"google_bigquery_dataset.dataset2\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset2\",\"provider_config_key\":\"google\",\"expressions\":{\"dataset_id\":{\"constant_value\":\"dataset2\"},\"labels\":{\"constant_value\":{\"anotherlabel\":\"some_value\"}},\"project\":{\"references\":[\"var.project\"]}},\"schema_version\":0},{\"address\":\"google_bigquery_dataset.dataset3\",\"mode\":\"managed\",\"type\":\"google_bigquery_dataset\",\"name\":\"dataset3\",\"provider_config_key\":\"google\",\"expressions\":{\"dataset_id\":{\"constant_value\":\"dataset3\"},\"project\":{\"references\":[\"var.project\"]}},\"schema_version\":0}],\"variables\":{\"project\":{}}}}} `", "keywords": ["billing mode", "change"]}]}, {"Id": "252430434", "PostHistoryTypeId": "5", "PostId": "68884395", "RevisionGUID": "8d48fa07-0057-4dd2-9887-2a348f752eef", "CreationDate": "2021-08-22T19:34:32.380", "UserId": "201657", "Comment": "added 69 characters in body", "Text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. \r\n\r\nGCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. Here is an example terraform configuration:\r\n\r\n```hcl\r\nvariable \"project\"{\r\n type = string\r\n}\r\n\r\nprovider \"google\" {\r\n  region = \"europe-west2\"\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset1\" {\r\n  dataset_id    = \"dataset1\"\r\n  project       = var.project\r\n  labels        = { \"label1\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset2\" {\r\n  dataset_id    = \"dataset2\"\r\n  project       = var.project\r\n  labels        = { \"anotherlabel\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset3\" {\r\n  dataset_id    = \"dataset3\"\r\n  project       = var.project\r\n}\r\n```\r\n\r\ndataset3 is not acceptable because it doesn't have any labels. dataset2 is unacceptable because while it does have labels, it doesn't have the one I want it to  have, `label1`\r\n\r\nI would like to use terraform compliance to check for these anomolies but I can't figure out how. here is my feature file, `test.feature`:\r\n\r\n```gherkin\r\nFeature: Terraform Compliance\r\n\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it must contain label1\r\n```\r\n\r\nI then issue :\r\n\r\n```bash\r\nterraform init ^^ \\\r\n  terraform plan --var=project=myproject --out=plan.out && \\\r\n  terraform-compliance --planfile plan.out -f .\r\n```\r\n\r\nwhich produces this output:\r\n\r\n> terraform-compliance v1.3.24 initiated\r\n> \r\n> . Converting terraform plan file.  \r\n>  Features     : /tmp/terraformcompliancetest/  \r\n>  Plan File    : /tmp/terraformcompliancetest/plan.out.json  \r\n> \r\n>  Running tests. \r\n> \r\n> Feature: Terraform Compliance  # /tmp/terraformcompliancetest/test.feature\r\n> \r\n>     Scenario: My scenario\r\n>         Given I have any resource defined\r\n>         When it has labels\r\n>                 Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property.\r\n>                 Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property.\r\n>         Then it must contain label1\r\n>           Failure:\r\n> \r\n> 1 features (0 passed, 1 failed)  \r\n> 1 scenarios (0 passed, 1 failed)  \r\n> 3 steps (2 passed, 1 failed)  \r\n> Run 1629659085 finished within a moment\r\n\r\nClearly this isn't giving me what I want. I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. Can anyone help?\r\n\r\n---\r\n\r\nUPDATE As [requested on twitter](https://twitter.com/terraformtest/status/1429524432830222343?s=20), here is the contents of plan.out.json\r\n```json\r\n{\r\n    \"format_version\": \"0.1\",\r\n    \"terraform_version\": \"0.14.7\",\r\n    \"variables\": {\r\n        \"project\": {\r\n            \"value\": \"myproject\"\r\n        }\r\n    },\r\n    \"planned_values\": {\r\n        \"root_module\": {\r\n            \"resources\": [\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset1\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset1\",\r\n                    \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n                    \"schema_version\": 0,\r\n                    \"values\": {\r\n                        \"dataset_id\": \"dataset1\",\r\n                        \"default_encryption_configuration\": [],\r\n                        \"default_partition_expiration_ms\": null,\r\n                        \"default_table_expiration_ms\": null,\r\n                        \"delete_contents_on_destroy\": false,\r\n                        \"description\": null,\r\n                        \"friendly_name\": null,\r\n                        \"labels\": {\r\n                            \"label1\": \"some_value\"\r\n                        },\r\n                        \"location\": \"US\",\r\n                        \"project\": \"myproject\",\r\n                        \"timeouts\": null\r\n                    }\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset2\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset2\",\r\n                    \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n                    \"schema_version\": 0,\r\n                    \"values\": {\r\n                        \"dataset_id\": \"dataset2\",\r\n                        \"default_encryption_configuration\": [],\r\n                        \"default_partition_expiration_ms\": null,\r\n                        \"default_table_expiration_ms\": null,\r\n                        \"delete_contents_on_destroy\": false,\r\n                        \"description\": null,\r\n                        \"friendly_name\": null,\r\n                        \"labels\": {\r\n                            \"anotherlabel\": \"some_value\"\r\n                        },\r\n                        \"location\": \"US\",\r\n                        \"project\": \"myproject\",\r\n                        \"timeouts\": null\r\n                    }\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset3\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset3\",\r\n                    \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n                    \"schema_version\": 0,\r\n                    \"values\": {\r\n                        \"dataset_id\": \"dataset3\",\r\n                        \"default_encryption_configuration\": [],\r\n                        \"default_partition_expiration_ms\": null,\r\n                        \"default_table_expiration_ms\": null,\r\n                        \"delete_contents_on_destroy\": false,\r\n                        \"description\": null,\r\n                        \"friendly_name\": null,\r\n                        \"labels\": null,\r\n                        \"location\": \"US\",\r\n                        \"project\": \"myproject\",\r\n                        \"timeouts\": null\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    \"resource_changes\": [\r\n        {\r\n            \"address\": \"google_bigquery_dataset.dataset1\",\r\n            \"mode\": \"managed\",\r\n            \"type\": \"google_bigquery_dataset\",\r\n            \"name\": \"dataset1\",\r\n            \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n            \"change\": {\r\n                \"actions\": [\r\n                    \"create\"\r\n                ],\r\n                \"before\": null,\r\n                \"after\": {\r\n                    \"dataset_id\": \"dataset1\",\r\n                    \"default_encryption_configuration\": [],\r\n                    \"default_partition_expiration_ms\": null,\r\n                    \"default_table_expiration_ms\": null,\r\n                    \"delete_contents_on_destroy\": false,\r\n                    \"description\": null,\r\n                    \"friendly_name\": null,\r\n                    \"labels\": {\r\n                        \"label1\": \"some_value\"\r\n                    },\r\n                    \"location\": \"US\",\r\n                    \"project\": \"myproject\",\r\n                    \"timeouts\": null\r\n                },\r\n                \"after_unknown\": {\r\n                    \"access\": true,\r\n                    \"creation_time\": true,\r\n                    \"default_encryption_configuration\": [],\r\n                    \"etag\": true,\r\n                    \"id\": true,\r\n                    \"labels\": {},\r\n                    \"last_modified_time\": true,\r\n                    \"self_link\": true\r\n                }\r\n            }\r\n        },\r\n        {\r\n            \"address\": \"google_bigquery_dataset.dataset2\",\r\n            \"mode\": \"managed\",\r\n            \"type\": \"google_bigquery_dataset\",\r\n            \"name\": \"dataset2\",\r\n            \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n            \"change\": {\r\n                \"actions\": [\r\n                    \"create\"\r\n                ],\r\n                \"before\": null,\r\n                \"after\": {\r\n                    \"dataset_id\": \"dataset2\",\r\n                    \"default_encryption_configuration\": [],\r\n                    \"default_partition_expiration_ms\": null,\r\n                    \"default_table_expiration_ms\": null,\r\n                    \"delete_contents_on_destroy\": false,\r\n                    \"description\": null,\r\n                    \"friendly_name\": null,\r\n                    \"labels\": {\r\n                        \"anotherlabel\": \"some_value\"\r\n                    },\r\n                    \"location\": \"US\",\r\n                    \"project\": \"myproject\",\r\n                    \"timeouts\": null\r\n                },\r\n                \"after_unknown\": {\r\n                    \"access\": true,\r\n                    \"creation_time\": true,\r\n                    \"default_encryption_configuration\": [],\r\n                    \"etag\": true,\r\n                    \"id\": true,\r\n                    \"labels\": {},\r\n                    \"last_modified_time\": true,\r\n                    \"self_link\": true\r\n                }\r\n            }\r\n        },\r\n        {\r\n            \"address\": \"google_bigquery_dataset.dataset3\",\r\n            \"mode\": \"managed\",\r\n            \"type\": \"google_bigquery_dataset\",\r\n            \"name\": \"dataset3\",\r\n            \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n            \"change\": {\r\n                \"actions\": [\r\n                    \"create\"\r\n                ],\r\n                \"before\": null,\r\n                \"after\": {\r\n                    \"dataset_id\": \"dataset3\",\r\n                    \"default_encryption_configuration\": [],\r\n                    \"default_partition_expiration_ms\": null,\r\n                    \"default_table_expiration_ms\": null,\r\n                    \"delete_contents_on_destroy\": false,\r\n                    \"description\": null,\r\n                    \"friendly_name\": null,\r\n                    \"labels\": null,\r\n                    \"location\": \"US\",\r\n                    \"project\": \"myproject\",\r\n                    \"timeouts\": null\r\n                },\r\n                \"after_unknown\": {\r\n                    \"access\": true,\r\n                    \"creation_time\": true,\r\n                    \"default_encryption_configuration\": [],\r\n                    \"etag\": true,\r\n                    \"id\": true,\r\n                    \"last_modified_time\": true,\r\n                    \"self_link\": true\r\n                }\r\n            }\r\n        }\r\n    ],\r\n    \"configuration\": {\r\n        \"provider_config\": {\r\n            \"google\": {\r\n                \"name\": \"google\",\r\n                \"expressions\": {\r\n                    \"region\": {\r\n                        \"constant_value\": \"europe-west2\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        \"root_module\": {\r\n            \"resources\": [\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset1\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset1\",\r\n                    \"provider_config_key\": \"google\",\r\n                    \"expressions\": {\r\n                        \"dataset_id\": {\r\n                            \"constant_value\": \"dataset1\"\r\n                        },\r\n                        \"labels\": {\r\n                            \"constant_value\": {\r\n                                \"label1\": \"some_value\"\r\n                            }\r\n                        },\r\n                        \"project\": {\r\n                            \"references\": [\r\n                                \"var.project\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"schema_version\": 0\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset2\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset2\",\r\n                    \"provider_config_key\": \"google\",\r\n                    \"expressions\": {\r\n                        \"dataset_id\": {\r\n                            \"constant_value\": \"dataset2\"\r\n                        },\r\n                        \"labels\": {\r\n                            \"constant_value\": {\r\n                                \"anotherlabel\": \"some_value\"\r\n                            }\r\n                        },\r\n                        \"project\": {\r\n                            \"references\": [\r\n                                \"var.project\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"schema_version\": 0\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset3\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset3\",\r\n                    \"provider_config_key\": \"google\",\r\n                    \"expressions\": {\r\n                        \"dataset_id\": {\r\n                            \"constant_value\": \"dataset3\"\r\n                        },\r\n                        \"project\": {\r\n                            \"references\": [\r\n                                \"var.project\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"schema_version\": 0\r\n                }\r\n            ],\r\n            \"variables\": {\r\n                \"project\": {}\r\n            }\r\n        }\r\n    }\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. ", "keywords": ["test"]}, {"source": "Text", "text": "GCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. ", "keywords": ["cost"]}, {"source": "Text", "text": "Here is an example terraform configuration: ```hcl variable \"project\"{ type = string } provider \"google\" { region = \"europe-west2\" } resource \"google_bigquery_dataset\" \"dataset1\" { dataset_id = \"dataset1\" project = var.project labels = { \"label1\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset2\" { dataset_id = \"dataset2\" project = var.project labels = { \"anotherlabel\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset3\" { dataset_id = \"dataset3\" project = var.project } ``` dataset3 is not acceptable because it doesn't have any labels. ", "keywords": ["provider"]}, {"source": "Text", "text": "here is my feature file, `test.feature`: ```gherkin Feature: Terraform Compliance Scenario: My scenario Given I have any resource defined When it has labels Then it must contain label1 ``` I then issue : ```bash terraform init ^^ \\ terraform plan --var=project=myproject --out=plan.out && \\ terraform-compliance --planfile plan.out -f . ``` which produces this output: > terraform-compliance v1.3.24 initiated > > . Converting terraform plan file. > Features : /tmp/terraformcompliancetest/ > Plan File : /tmp/terraformcompliancetest/plan.out.json > > Running tests. > > Feature: Terraform Compliance # /tmp/terraformcompliancetest/test.feature > > Scenario: My scenario > Given I have any resource defined > When it has labels > Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property. > Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property. > Then it must contain label1 > Failure: > > 1 features (0 passed, 1 failed) > 1 scenarios (0 passed, 1 failed) > 3 steps (2 passed, 1 failed) > Run 1629659085 finished within a moment ", "keywords": ["feature", "test"]}, {"source": "Text", "text": "I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. ", "keywords": ["feature"]}, {"source": "Text", "text": "Can anyone help? --- UPDATE As [requested on twitter](https://twitter.com/terraformtest/status/1429524432830222343?s=20), here is the contents of plan.out.json ```json { \"format_version\": \"0.1\", \"terraform_version\": \"0.14.7\", \"variables\": { \"project\": { \"value\": \"myproject\" } }, \"planned_values\": { \"root_module\": { \"resources\": [ { \"address\": \"google_bigquery_dataset.dataset1\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset1\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"schema_version\": 0, \"values\": { \"dataset_id\": \"dataset1\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"label1\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null } }, { \"address\": \"google_bigquery_dataset.dataset2\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset2\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"schema_version\": 0, \"values\": { \"dataset_id\": \"dataset2\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"anotherlabel\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null } }, { \"address\": \"google_bigquery_dataset.dataset3\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset3\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"schema_version\": 0, \"values\": { \"dataset_id\": \"dataset3\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": null, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null } } ] } }, \"resource_changes\": [ { \"address\": \"google_bigquery_dataset.dataset1\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset1\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"change\": { \"actions\": [ \"create\" ], \"before\": null, \"after\": { \"dataset_id\": \"dataset1\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"label1\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null }, \"after_unknown\": { \"access\": true, \"creation_time\": true, \"default_encryption_configuration\": [], \"etag\": true, \"id\": true, \"labels\": {}, \"last_modified_time\": true, \"self_link\": true } } }, { \"address\": \"google_bigquery_dataset.dataset2\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset2\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"change\": { \"actions\": [ \"create\" ], \"before\": null, \"after\": { \"dataset_id\": \"dataset2\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"anotherlabel\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null }, \"after_unknown\": { \"access\": true, \"creation_time\": true, \"default_encryption_configuration\": [], \"etag\": true, \"id\": true, \"labels\": {}, \"last_modified_time\": true, \"self_link\": true } } }, { \"address\": \"google_bigquery_dataset.dataset3\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset3\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"change\": { \"actions\": [ \"create\" ], \"before\": null, \"after\": { \"dataset_id\": \"dataset3\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": null, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null }, \"after_unknown\": { \"access\": true, \"creation_time\": true, \"default_encryption_configuration\": [], \"etag\": true, \"id\": true, \"last_modified_time\": true, \"self_link\": true } } } ], \"configuration\": { \"provider_config\": { \"google\": { \"name\": \"google\", \"expressions\": { \"region\": { \"constant_value\": \"europe-west2\" } } } }, \"root_module\": { \"resources\": [ { \"address\": \"google_bigquery_dataset.dataset1\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset1\", \"provider_config_key\": \"google\", \"expressions\": { \"dataset_id\": { \"constant_value\": \"dataset1\" }, \"labels\": { \"constant_value\": { \"label1\": \"some_value\" } }, \"project\": { \"references\": [ \"var.project\" ] } }, \"schema_version\": 0 }, { \"address\": \"google_bigquery_dataset.dataset2\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset2\", \"provider_config_key\": \"google\", \"expressions\": { \"dataset_id\": { \"constant_value\": \"dataset2\" }, \"labels\": { \"constant_value\": { \"anotherlabel\": \"some_value\" } }, \"project\": { \"references\": [ \"var.project\" ] } }, \"schema_version\": 0 }, { \"address\": \"google_bigquery_dataset.dataset3\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset3\", \"provider_config_key\": \"google\", \"expressions\": { \"dataset_id\": { \"constant_value\": \"dataset3\" ", "keywords": ["billing mode", "change"]}]}, {"Id": "252431689", "PostHistoryTypeId": "5", "PostId": "68884395", "RevisionGUID": "a434e752-016b-42aa-8a54-ab52516e283b", "CreationDate": "2021-08-22T20:18:28.397", "UserId": "201657", "Comment": "deleted 34 characters in body", "Text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. \r\n\r\nGCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. Here is an example terraform configuration:\r\n\r\n```hcl\r\nvariable \"project\"{\r\n type = string\r\n}\r\n\r\nprovider \"google\" {\r\n  region = \"europe-west2\"\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset1\" {\r\n  dataset_id    = \"dataset1\"\r\n  project       = var.project\r\n  labels        = { \"label1\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset2\" {\r\n  dataset_id    = \"dataset2\"\r\n  project       = var.project\r\n  labels        = { \"anotherlabel\" : \"some_value\" }\r\n}\r\n\r\nresource \"google_bigquery_dataset\" \"dataset3\" {\r\n  dataset_id    = \"dataset3\"\r\n  project       = var.project\r\n}\r\n```\r\n\r\ndataset3 is not acceptable because it doesn't have any labels. dataset2 is unacceptable because while it does have labels, it doesn't have the one I want it to  have, `label1`\r\n\r\nI would like to use terraform compliance to check for these anomolies but I can't figure out how. here is my feature file, `test.feature`:\r\n\r\n```gherkin\r\nFeature: Terraform Compliance\r\n\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it must contain label1\r\n```\r\n\r\nI then issue :\r\n\r\n```bash\r\nterraform init ^^ \\\r\n  terraform plan --var=project=myproject --out=plan.out && \\\r\n  terraform-compliance --planfile plan.out -f .\r\n```\r\n\r\nwhich produces this output:\r\n\r\n> terraform-compliance v1.3.24 initiated\r\n> \r\n> . Converting terraform plan file.  \r\n>  Features     : /tmp/tctest/  \r\n>  Plan File    : /tmp/tctest/plan.out.json  \r\n> \r\n>  Running tests. \r\n> \r\n> Feature: Terraform Compliance  # /tmp/terraformcompliancetest/test.feature\r\n> \r\n>     Scenario: My scenario\r\n>         Given I have any resource defined\r\n>         When it has labels\r\n>                 Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property.\r\n>                 Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property.\r\n>         Then it must contain label1\r\n>           Failure:\r\n> \r\n> 1 features (0 passed, 1 failed)  \r\n> 1 scenarios (0 passed, 1 failed)  \r\n> 3 steps (2 passed, 1 failed)  \r\n> Run 1629659085 finished within a moment\r\n\r\nClearly this isn't giving me what I want. I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. Can anyone help?\r\n\r\n---\r\n\r\nUPDATE As [requested on twitter](https://twitter.com/terraformtest/status/1429524432830222343?s=20), here is the contents of plan.out.json\r\n```json\r\n{\r\n    \"format_version\": \"0.1\",\r\n    \"terraform_version\": \"0.14.7\",\r\n    \"variables\": {\r\n        \"project\": {\r\n            \"value\": \"myproject\"\r\n        }\r\n    },\r\n    \"planned_values\": {\r\n        \"root_module\": {\r\n            \"resources\": [\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset1\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset1\",\r\n                    \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n                    \"schema_version\": 0,\r\n                    \"values\": {\r\n                        \"dataset_id\": \"dataset1\",\r\n                        \"default_encryption_configuration\": [],\r\n                        \"default_partition_expiration_ms\": null,\r\n                        \"default_table_expiration_ms\": null,\r\n                        \"delete_contents_on_destroy\": false,\r\n                        \"description\": null,\r\n                        \"friendly_name\": null,\r\n                        \"labels\": {\r\n                            \"label1\": \"some_value\"\r\n                        },\r\n                        \"location\": \"US\",\r\n                        \"project\": \"myproject\",\r\n                        \"timeouts\": null\r\n                    }\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset2\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset2\",\r\n                    \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n                    \"schema_version\": 0,\r\n                    \"values\": {\r\n                        \"dataset_id\": \"dataset2\",\r\n                        \"default_encryption_configuration\": [],\r\n                        \"default_partition_expiration_ms\": null,\r\n                        \"default_table_expiration_ms\": null,\r\n                        \"delete_contents_on_destroy\": false,\r\n                        \"description\": null,\r\n                        \"friendly_name\": null,\r\n                        \"labels\": {\r\n                            \"anotherlabel\": \"some_value\"\r\n                        },\r\n                        \"location\": \"US\",\r\n                        \"project\": \"myproject\",\r\n                        \"timeouts\": null\r\n                    }\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset3\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset3\",\r\n                    \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n                    \"schema_version\": 0,\r\n                    \"values\": {\r\n                        \"dataset_id\": \"dataset3\",\r\n                        \"default_encryption_configuration\": [],\r\n                        \"default_partition_expiration_ms\": null,\r\n                        \"default_table_expiration_ms\": null,\r\n                        \"delete_contents_on_destroy\": false,\r\n                        \"description\": null,\r\n                        \"friendly_name\": null,\r\n                        \"labels\": null,\r\n                        \"location\": \"US\",\r\n                        \"project\": \"myproject\",\r\n                        \"timeouts\": null\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    \"resource_changes\": [\r\n        {\r\n            \"address\": \"google_bigquery_dataset.dataset1\",\r\n            \"mode\": \"managed\",\r\n            \"type\": \"google_bigquery_dataset\",\r\n            \"name\": \"dataset1\",\r\n            \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n            \"change\": {\r\n                \"actions\": [\r\n                    \"create\"\r\n                ],\r\n                \"before\": null,\r\n                \"after\": {\r\n                    \"dataset_id\": \"dataset1\",\r\n                    \"default_encryption_configuration\": [],\r\n                    \"default_partition_expiration_ms\": null,\r\n                    \"default_table_expiration_ms\": null,\r\n                    \"delete_contents_on_destroy\": false,\r\n                    \"description\": null,\r\n                    \"friendly_name\": null,\r\n                    \"labels\": {\r\n                        \"label1\": \"some_value\"\r\n                    },\r\n                    \"location\": \"US\",\r\n                    \"project\": \"myproject\",\r\n                    \"timeouts\": null\r\n                },\r\n                \"after_unknown\": {\r\n                    \"access\": true,\r\n                    \"creation_time\": true,\r\n                    \"default_encryption_configuration\": [],\r\n                    \"etag\": true,\r\n                    \"id\": true,\r\n                    \"labels\": {},\r\n                    \"last_modified_time\": true,\r\n                    \"self_link\": true\r\n                }\r\n            }\r\n        },\r\n        {\r\n            \"address\": \"google_bigquery_dataset.dataset2\",\r\n            \"mode\": \"managed\",\r\n            \"type\": \"google_bigquery_dataset\",\r\n            \"name\": \"dataset2\",\r\n            \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n            \"change\": {\r\n                \"actions\": [\r\n                    \"create\"\r\n                ],\r\n                \"before\": null,\r\n                \"after\": {\r\n                    \"dataset_id\": \"dataset2\",\r\n                    \"default_encryption_configuration\": [],\r\n                    \"default_partition_expiration_ms\": null,\r\n                    \"default_table_expiration_ms\": null,\r\n                    \"delete_contents_on_destroy\": false,\r\n                    \"description\": null,\r\n                    \"friendly_name\": null,\r\n                    \"labels\": {\r\n                        \"anotherlabel\": \"some_value\"\r\n                    },\r\n                    \"location\": \"US\",\r\n                    \"project\": \"myproject\",\r\n                    \"timeouts\": null\r\n                },\r\n                \"after_unknown\": {\r\n                    \"access\": true,\r\n                    \"creation_time\": true,\r\n                    \"default_encryption_configuration\": [],\r\n                    \"etag\": true,\r\n                    \"id\": true,\r\n                    \"labels\": {},\r\n                    \"last_modified_time\": true,\r\n                    \"self_link\": true\r\n                }\r\n            }\r\n        },\r\n        {\r\n            \"address\": \"google_bigquery_dataset.dataset3\",\r\n            \"mode\": \"managed\",\r\n            \"type\": \"google_bigquery_dataset\",\r\n            \"name\": \"dataset3\",\r\n            \"provider_name\": \"registry.terraform.io/hashicorp/google\",\r\n            \"change\": {\r\n                \"actions\": [\r\n                    \"create\"\r\n                ],\r\n                \"before\": null,\r\n                \"after\": {\r\n                    \"dataset_id\": \"dataset3\",\r\n                    \"default_encryption_configuration\": [],\r\n                    \"default_partition_expiration_ms\": null,\r\n                    \"default_table_expiration_ms\": null,\r\n                    \"delete_contents_on_destroy\": false,\r\n                    \"description\": null,\r\n                    \"friendly_name\": null,\r\n                    \"labels\": null,\r\n                    \"location\": \"US\",\r\n                    \"project\": \"myproject\",\r\n                    \"timeouts\": null\r\n                },\r\n                \"after_unknown\": {\r\n                    \"access\": true,\r\n                    \"creation_time\": true,\r\n                    \"default_encryption_configuration\": [],\r\n                    \"etag\": true,\r\n                    \"id\": true,\r\n                    \"last_modified_time\": true,\r\n                    \"self_link\": true\r\n                }\r\n            }\r\n        }\r\n    ],\r\n    \"configuration\": {\r\n        \"provider_config\": {\r\n            \"google\": {\r\n                \"name\": \"google\",\r\n                \"expressions\": {\r\n                    \"region\": {\r\n                        \"constant_value\": \"europe-west2\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        \"root_module\": {\r\n            \"resources\": [\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset1\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset1\",\r\n                    \"provider_config_key\": \"google\",\r\n                    \"expressions\": {\r\n                        \"dataset_id\": {\r\n                            \"constant_value\": \"dataset1\"\r\n                        },\r\n                        \"labels\": {\r\n                            \"constant_value\": {\r\n                                \"label1\": \"some_value\"\r\n                            }\r\n                        },\r\n                        \"project\": {\r\n                            \"references\": [\r\n                                \"var.project\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"schema_version\": 0\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset2\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset2\",\r\n                    \"provider_config_key\": \"google\",\r\n                    \"expressions\": {\r\n                        \"dataset_id\": {\r\n                            \"constant_value\": \"dataset2\"\r\n                        },\r\n                        \"labels\": {\r\n                            \"constant_value\": {\r\n                                \"anotherlabel\": \"some_value\"\r\n                            }\r\n                        },\r\n                        \"project\": {\r\n                            \"references\": [\r\n                                \"var.project\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"schema_version\": 0\r\n                },\r\n                {\r\n                    \"address\": \"google_bigquery_dataset.dataset3\",\r\n                    \"mode\": \"managed\",\r\n                    \"type\": \"google_bigquery_dataset\",\r\n                    \"name\": \"dataset3\",\r\n                    \"provider_config_key\": \"google\",\r\n                    \"expressions\": {\r\n                        \"dataset_id\": {\r\n                            \"constant_value\": \"dataset3\"\r\n                        },\r\n                        \"project\": {\r\n                            \"references\": [\r\n                                \"var.project\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"schema_version\": 0\r\n                }\r\n            ],\r\n            \"variables\": {\r\n                \"project\": {}\r\n            }\r\n        }\r\n    }\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have just discovered [terraform compliance](https://terraform-compliance.com/pages/bdd-references/when.html) and am testing it out against my terraform code that deploys resources to GCP. ", "keywords": ["test"]}, {"source": "Text", "text": "GCP labels enable fine-grained cost analysis and every labels attribute is a map ([bigquery_dataset#labels](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#labels)) so I would like to verify that every resource that has a `labels` argument includes a certain key that we use for analysing costs. ", "keywords": ["cost"]}, {"source": "Text", "text": "Here is an example terraform configuration: ```hcl variable \"project\"{ type = string } provider \"google\" { region = \"europe-west2\" } resource \"google_bigquery_dataset\" \"dataset1\" { dataset_id = \"dataset1\" project = var.project labels = { \"label1\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset2\" { dataset_id = \"dataset2\" project = var.project labels = { \"anotherlabel\" : \"some_value\" } } resource \"google_bigquery_dataset\" \"dataset3\" { dataset_id = \"dataset3\" project = var.project } ``` dataset3 is not acceptable because it doesn't have any labels. ", "keywords": ["provider"]}, {"source": "Text", "text": "here is my feature file, `test.feature`: ```gherkin Feature: Terraform Compliance Scenario: My scenario Given I have any resource defined When it has labels Then it must contain label1 ``` I then issue : ```bash terraform init ^^ \\ terraform plan --var=project=myproject --out=plan.out && \\ terraform-compliance --planfile plan.out -f . ``` which produces this output: > terraform-compliance v1.3.24 initiated > > . Converting terraform plan file. > Features : /tmp/tctest/ > Plan File : /tmp/tctest/plan.out.json > > Running tests. > > Feature: Terraform Compliance # /tmp/terraformcompliancetest/test.feature > > Scenario: My scenario > Given I have any resource defined > When it has labels > Failure: google_bigquery_dataset.dataset2 (google_bigquery_dataset) does not have label1 property. > Failure: google_bigquery_dataset.dataset3 (google_bigquery_dataset) does not have label1 property. > Then it must contain label1 > Failure: > > 1 features (0 passed, 1 failed) > 1 scenarios (0 passed, 1 failed) > 3 steps (2 passed, 1 failed) > Run 1629659085 finished within a moment ", "keywords": ["feature", "test"]}, {"source": "Text", "text": "I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. ", "keywords": ["feature"]}, {"source": "Text", "text": "Can anyone help? --- UPDATE As [requested on twitter](https://twitter.com/terraformtest/status/1429524432830222343?s=20), here is the contents of plan.out.json ```json { \"format_version\": \"0.1\", \"terraform_version\": \"0.14.7\", \"variables\": { \"project\": { \"value\": \"myproject\" } }, \"planned_values\": { \"root_module\": { \"resources\": [ { \"address\": \"google_bigquery_dataset.dataset1\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset1\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"schema_version\": 0, \"values\": { \"dataset_id\": \"dataset1\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"label1\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null } }, { \"address\": \"google_bigquery_dataset.dataset2\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset2\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"schema_version\": 0, \"values\": { \"dataset_id\": \"dataset2\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"anotherlabel\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null } }, { \"address\": \"google_bigquery_dataset.dataset3\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset3\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"schema_version\": 0, \"values\": { \"dataset_id\": \"dataset3\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": null, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null } } ] } }, \"resource_changes\": [ { \"address\": \"google_bigquery_dataset.dataset1\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset1\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"change\": { \"actions\": [ \"create\" ], \"before\": null, \"after\": { \"dataset_id\": \"dataset1\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"label1\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null }, \"after_unknown\": { \"access\": true, \"creation_time\": true, \"default_encryption_configuration\": [], \"etag\": true, \"id\": true, \"labels\": {}, \"last_modified_time\": true, \"self_link\": true } } }, { \"address\": \"google_bigquery_dataset.dataset2\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset2\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"change\": { \"actions\": [ \"create\" ], \"before\": null, \"after\": { \"dataset_id\": \"dataset2\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": { \"anotherlabel\": \"some_value\" }, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null }, \"after_unknown\": { \"access\": true, \"creation_time\": true, \"default_encryption_configuration\": [], \"etag\": true, \"id\": true, \"labels\": {}, \"last_modified_time\": true, \"self_link\": true } } }, { \"address\": \"google_bigquery_dataset.dataset3\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset3\", \"provider_name\": \"registry.terraform.io/hashicorp/google\", \"change\": { \"actions\": [ \"create\" ], \"before\": null, \"after\": { \"dataset_id\": \"dataset3\", \"default_encryption_configuration\": [], \"default_partition_expiration_ms\": null, \"default_table_expiration_ms\": null, \"delete_contents_on_destroy\": false, \"description\": null, \"friendly_name\": null, \"labels\": null, \"location\": \"US\", \"project\": \"myproject\", \"timeouts\": null }, \"after_unknown\": { \"access\": true, \"creation_time\": true, \"default_encryption_configuration\": [], \"etag\": true, \"id\": true, \"last_modified_time\": true, \"self_link\": true } } } ], \"configuration\": { \"provider_config\": { \"google\": { \"name\": \"google\", \"expressions\": { \"region\": { \"constant_value\": \"europe-west2\" } } } }, \"root_module\": { \"resources\": [ { \"address\": \"google_bigquery_dataset.dataset1\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset1\", \"provider_config_key\": \"google\", \"expressions\": { \"dataset_id\": { \"constant_value\": \"dataset1\" }, \"labels\": { \"constant_value\": { \"label1\": \"some_value\" } }, \"project\": { \"references\": [ \"var.project\" ] } }, \"schema_version\": 0 }, { \"address\": \"google_bigquery_dataset.dataset2\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset2\", \"provider_config_key\": \"google\", \"expressions\": { \"dataset_id\": { \"constant_value\": \"dataset2\" }, \"labels\": { \"constant_value\": { \"anotherlabel\": \"some_value\" } }, \"project\": { \"references\": [ \"var.project\" ] } }, \"schema_version\": 0 }, { \"address\": \"google_bigquery_dataset.dataset3\", \"mode\": \"managed\", \"type\": \"google_bigquery_dataset\", \"name\": \"dataset3\", \"provider_config_key\": \"google\", \"expressions\": { \"dataset_id\": { \"constant_value\": \"dataset3\" ", "keywords": ["billing mode", "change"]}]}], "answers": [{"Id": "68884838", "PostTypeId": "2", "ParentId": "68884395", "CreationDate": "2021-08-22T20:15:35.047", "Score": "0", "Body": "<p>Had loads of help from @emre-erkunt and his reply almost gave me what I need (and will make that reply as an answer). I modified it slightly to include two scenarios:</p>\n<pre><code>Feature: Terraform Compliance\n\nScenario: Labels must be defined\n    Given I have resource that supports labels defined\n    When it has labels\n    Then it must have labels\n    Then its value must not be null\n\nScenario: Labels must include label1\n    Given I have resource that supports labels defined\n    When it has labels\n    Then it must have labels\n    Then it must have label1\n</code></pre>\n<p>Which returns:</p>\n<blockquote>\n<p>terraform-compliance v1.3.24 initiated</p>\n<p>. Converting terraform plan file.<br />\n Features     : /tmp/tctest/<br />\n Plan File    : /tmp/tctest/plan.out.json</p>\n<p> Running tests. </p>\n<p>Feature: Terraform Compliance  # /tmp/tctest/test.feature</p>\n<pre><code>Scenario: Labels must be defined  \n    Given I have resource that supports labels defined  \n    When it has labels  \n    Then it must have labels  \n            Failure: labels property in google_bigquery_dataset.dataset3 is considered to be Null. It is set to None.  \n    Then its value must not be null  \n      Failure:  \n\nScenario: Labels must include label1  \n    Given I have resource that supports labels defined  \n    When it has labels  \n    Then it must have labels  \n            Failure: google_bigquery_dataset.dataset2 (resource that supports labels) does not have label1 property.  \n            Failure: google_bigquery_dataset.dataset3 (resource that supports labels) does not have label1 property.  \n    Then it must have label1  \n      Failure:  \n</code></pre>\n<p>1 features (0 passed, 1 failed)<br />\n2 scenarios (0 passed, 2 failed)<br />\n8 steps (6 passed, 2 failed)<br />\nRun 1629663083 finished within a moment</p>\n</blockquote>\n<p>which is satisfactory and I think as close as I'm going to get to exactly what I want.</p>\n<p>Massive thank you to Emre.</p>\n", "OwnerUserId": "201657", "LastActivityDate": "2021-08-22T20:15:35.047", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "252431608", "PostHistoryTypeId": "2", "PostId": "68884838", "RevisionGUID": "a4300854-d8da-477d-866f-b5c1995a79c0", "CreationDate": "2021-08-22T20:15:35.047", "UserId": "201657", "Text": "Had loads of help from @emre-erkunt and his reply almost gave me what I need (and will make that reply as an answer). I modified it slightly to include two scenarios:\r\n\r\n```gherkin\r\nFeature: Terraform Compliance\r\n\r\nScenario: Labels must be defined\r\n    Given I have resource that supports labels defined\r\n    When it has labels\r\n    Then it must have labels\r\n    Then its value must not be null\r\n\r\nScenario: Labels must include label1\r\n    Given I have resource that supports labels defined\r\n    When it has labels\r\n    Then it must have labels\r\n    Then it must have label1\r\n```\r\n\r\nWhich returns:\r\n\r\n> terraform-compliance v1.3.24 initiated\r\n> \r\n> . Converting terraform plan file.  \r\n>  Features     : /tmp/tctest/  \r\n>  Plan File    : /tmp/tctest/plan.out.json  \r\n> \r\n>  Running tests.   \r\n> \r\n> Feature: Terraform Compliance  # /tmp/tctest/test.feature  \r\n> \r\n>     Scenario: Labels must be defined  \r\n>         Given I have resource that supports labels defined  \r\n>         When it has labels  \r\n>         Then it must have labels  \r\n>                 Failure: labels property in google_bigquery_dataset.dataset3 is considered to be Null. It is set to None.  \r\n>         Then its value must not be null  \r\n>           Failure:  \r\n> \r\n>     Scenario: Labels must include label1  \r\n>         Given I have resource that supports labels defined  \r\n>         When it has labels  \r\n>         Then it must have labels  \r\n>                 Failure: google_bigquery_dataset.dataset2 (resource that supports labels) does not have label1 property.  \r\n>                 Failure: google_bigquery_dataset.dataset3 (resource that supports labels) does not have label1 property.  \r\n>         Then it must have label1  \r\n>           Failure:  \r\n> \r\n> 1 features (0 passed, 1 failed)    \r\n> 2 scenarios (0 passed, 2 failed)  \r\n> 8 steps (6 passed, 2 failed)  \r\n> Run 1629663083 finished within a moment\r\n\r\nwhich is satisfactory and I think as close as I'm going to get to exactly what I want.\r\n\r\nMassive thank you to Emre.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I modified it slightly to include two scenarios: ```gherkin Feature: Terraform Compliance Scenario: Labels must be defined Given I have resource that supports labels defined When it has labels Then it must have labels Then its value must not be null Scenario: Labels must include label1 Given I have resource that supports labels defined When it has labels Then it must have labels Then it must have label1 ``` ", "keywords": ["feature"]}, {"source": "Text", "text": "Converting terraform plan file. > Features : /tmp/tctest/ > Plan File : /tmp/tctest/plan.out.json > > Running tests. > > Feature: Terraform Compliance # /tmp/tctest/test.feature > > Scenario: Labels must be defined > Given I have resource that supports labels defined > When it has labels > Then it must have labels > Failure: labels property in google_bigquery_dataset.dataset3 is considered to be Null. ", "keywords": ["feature", "test"]}]}], "filtered-sentences": [{"source": "Body", "text": "Features : /tmp/tctest/ Plan File : /tmp/tctest/plan.out.json Running tests. ", "keywords": ["test"]}, {"source": "Body", "text": "Feature: Terraform Compliance # /tmp/tctest/test.feature 1 features (0 passed, 1 failed) 2 scenarios (0 passed, 2 failed) 8 steps (6 passed, 2 failed) ", "keywords": ["feature", "test"]}]}, {"Id": "68884518", "PostTypeId": "2", "ParentId": "68884395", "CreationDate": "2021-08-22T19:27:06.063", "Score": "3", "Body": "<p>Writing it from mobile, so didnt try thoroughly.</p>\n<p>Can you please try ?</p>\n<pre><code>Scenario: My scenario\n    Given I have any resource defined\n    When it has labels\n    Then it must have labels\n    Then it must contain label1\n</code></pre>\n<p>As you see the fix is adding a \u201cthen\u201d after \u201cwhen\u201d because all \u201cWhen\u201d directives are for filtering while \u201cThen\u201d directives drills down the resource data.</p>\n<p>Hope it fixes :)</p>\n<p>//Edit:\nHere is the output I got ;</p>\n<pre><code> Running tests. \n\nFeature: test  \n\n    Scenario: My scenario\n        Given I have any resource defined\n        When it has labels\n        Then it must have labels\n        Failure: google_bigquery_dataset.dataset2 (any resource) does not have label1 property.\n        Failure: google_bigquery_dataset.dataset3 (any resource) does not have label1 property.\n        Then it must have label1\n          Failure:\n\n1 features (0 passed, 1 failed)\n1 scenarios (0 passed, 1 failed)\n4 steps (3 passed, 1 failed)\n</code></pre>\n", "OwnerUserId": "10546945", "LastEditorUserId": "10546945", "LastEditDate": "2021-08-22T19:42:11.133", "LastActivityDate": "2021-08-22T19:42:11.133", "CommentCount": "8", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "121739500", "PostId": "68884518", "Score": "0", "Text": "Hi, really appreciate the reply. That returned an error: `\u2757 ERROR: There is no step defintion for 'Then it has labels'.. Looks like a syntax error.` (typo on \"defintion\" isn't mine :) )", "CreationDate": "2021-08-22T19:32:57.543", "UserId": "201657", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121739526", "PostId": "68884518", "Score": "1", "Text": "oh sorry, fixing the post. Writing from mobile has problems :D", "CreationDate": "2021-08-22T19:35:11.577", "UserId": "10546945", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121739603", "PostId": "68884518", "Score": "1", "Text": "yep sounds like it gives the output you wanted. Posting the result to the post as well,.", "CreationDate": "2021-08-22T19:40:50.300", "UserId": "10546945", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121739653", "PostId": "68884518", "Score": "0", "Text": "Seen your edit, that *almost* gives me what I want :) I expected dataset3 to fail because it didn't have any value specified for label. it *is* failing, but not for the correct reason.", "CreationDate": "2021-08-22T19:45:26.670", "UserId": "201657", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121739800", "PostId": "68884518", "Score": "0", "Text": "Ah, I wonder if the reason that it didn;t complain about dataset3 not having labels is that even though the tf code doesn;t define anything for labels in plan.out.json I can see `\"labels\": null`. So the question becomes, how do i check that something isn't null", "CreationDate": "2021-08-22T19:55:32.320", "UserId": "201657", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121739900", "PostId": "68884518", "Score": "0", "Text": "With this : https://terraform-compliance.com/pages/bdd-references/then.html#then-its-value-condition-be-null :)", "CreationDate": "2021-08-22T20:02:49.697", "UserId": "10546945", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121739911", "PostId": "68884518", "Score": "0", "Text": "Instead of doing this, you can also start your Scenario with `Given I have resource that supports labels defined`", "CreationDate": "2021-08-22T20:03:42.427", "UserId": "10546945", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121740059", "PostId": "68884518", "Score": "0", "Text": "I marked your response as an answer and also posted a response of my own which built on what you provided. Thank you.", "CreationDate": "2021-08-22T20:16:39.517", "UserId": "201657", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "252430190", "PostHistoryTypeId": "2", "PostId": "68884518", "RevisionGUID": "facd700e-1c92-4e79-88b5-219d81726f02", "CreationDate": "2021-08-22T19:27:06.063", "UserId": "10546945", "Text": "Writing it from mobile, so didnt try thoroughly.\r\n\r\nCan you please try ?\r\n\r\n```\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it has labels\r\n    Then it must contain label1\r\n```\r\n\r\nAs you see the fix is adding a \u201cthen\u201d after \u201cwhen\u201d because all \u201cWhen\u201d directives are for filtering while \u201cThen\u201d directives drills down the resource data.\r\n\r\nHope it fixes :)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "252430465", "PostHistoryTypeId": "5", "PostId": "68884518", "RevisionGUID": "74090bc2-c988-43d8-8029-3b60a5a9c954", "CreationDate": "2021-08-22T19:35:21.443", "UserId": "10546945", "Comment": "added 6 characters in body", "Text": "Writing it from mobile, so didnt try thoroughly.\r\n\r\nCan you please try ?\r\n\r\n```\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it must have labels\r\n    Then it must contain label1\r\n```\r\n\r\nAs you see the fix is adding a \u201cthen\u201d after \u201cwhen\u201d because all \u201cWhen\u201d directives are for filtering while \u201cThen\u201d directives drills down the resource data.\r\n\r\nHope it fixes :)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "252430661", "PostHistoryTypeId": "5", "PostId": "68884518", "RevisionGUID": "499bd655-6465-481c-a01d-f150c1af3342", "CreationDate": "2021-08-22T19:42:11.133", "UserId": "10546945", "Comment": "added 561 characters in body", "Text": "Writing it from mobile, so didnt try thoroughly.\r\n\r\nCan you please try ?\r\n\r\n```\r\nScenario: My scenario\r\n    Given I have any resource defined\r\n    When it has labels\r\n    Then it must have labels\r\n    Then it must contain label1\r\n```\r\n\r\nAs you see the fix is adding a \u201cthen\u201d after \u201cwhen\u201d because all \u201cWhen\u201d directives are for filtering while \u201cThen\u201d directives drills down the resource data.\r\n\r\nHope it fixes :)\r\n\r\n//Edit:\r\nHere is the output I got ;\r\n\r\n```\r\n Running tests. \r\n\r\nFeature: test  \r\n\r\n    Scenario: My scenario\r\n        Given I have any resource defined\r\n        When it has labels\r\n        Then it must have labels\r\n  Failure: google_bigquery_dataset.dataset2 (any resource) does not have label1 property.\r\n  Failure: google_bigquery_dataset.dataset3 (any resource) does not have label1 property.\r\n        Then it must have label1\r\n          Failure:\r\n\r\n1 features (0 passed, 1 failed)\r\n1 scenarios (0 passed, 1 failed)\r\n4 steps (3 passed, 1 failed)\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Running tests. ", "keywords": ["test"]}, {"source": "Text", "text": "Feature: test Scenario: My scenario Given I have any resource defined When it has labels Then it must have labels Failure: google_bigquery_dataset.dataset2 (any resource) does not have label1 property. ", "keywords": ["feature", "test"]}]}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I have just discovered terraform compliance and am testing it out against my terraform code that deploys resources to GCP. ", "keywords": ["test"]}, {"source": "Body", "text": "GCP labels enable fine-grained cost analysis and every labels attribute is a map (bigquery_dataset#labels) so I would like to verify that every resource that has a labels argument includes a certain key that we use for analysing costs. ", "keywords": ["cost"]}, {"source": "Body", "text": "here is my feature file, test.feature: I then issue : which produces this output: terraform-compliance v1.3.24 initiated . ", "keywords": ["feature", "test"]}, {"source": "Body", "text": "Features : /tmp/tctest/ Plan File : /tmp/tctest/plan.out.json Running tests. ", "keywords": ["test"]}, {"source": "Body", "text": "Feature: Terraform Compliance # /tmp/terraformcompliancetest/test.feature 1 features (0 passed, 1 failed) 1 scenarios (0 passed, 1 failed) 3 steps (2 passed, 1 failed) ", "keywords": ["feature", "test"]}, {"source": "Body", "text": "I've pored over the docs but can't figure out what I'm supposed to be putting in my feature file. ", "keywords": ["feature"]}]}