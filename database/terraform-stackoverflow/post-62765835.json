{"Id": "62765835", "PostTypeId": "1", "CreationDate": "2020-07-06T23:17:07.243", "Score": "0", "ViewCount": "434", "Body": "<h2>TLDR</h2>\n<p>I'm just trying to start up a simple vm and it terraform tells me I don't have sufficient permissions. Keep in mind I have a Trial account (and like $290 left of sweet sweet free money).</p>\n<h2>Details</h2>\n<p>provider.tf</p>\n<pre><code>provider &quot;google&quot; {\n  project     = &quot;My First Project&quot;\n  region      = &quot;us-east1&quot;\n}\n\n</code></pre>\n<p>resource.tf</p>\n<pre><code>resource &quot;google_compute_instance&quot; &quot;vm_instance&quot; {\n  name         = &quot;terraform-instance&quot;\n  machine_type = &quot;f1-micro&quot;\n  zone      = &quot;us-east1-c&quot;\n\n  boot_disk {\n    initialize_params {\n      image = &quot;debian-cloud/debian-9&quot;\n    }\n  }\n\n  network_interface {\n    # A default network is created for all GCP projects\n    network       = &quot;default&quot;\n    access_config {\n    }\n  }\n}\n</code></pre>\n<p>Error</p>\n<pre><code>Error: Error loading zone 'us-east1-c': googleapi: Error 403: Permission denied on resource project My First Project., forbidden\n</code></pre>\n<h2>My Trouble Shooting</h2>\n<ul>\n<li>I tried switching us-east1-c for other zones and tried us-central1 with different zones. Always got the same error.</li>\n<li>I'm passing the credentials with<code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable and I know I'm passing it in correctly cause when I change the filename it breaks and says something like &quot;that filename doesn't exist&quot;</li>\n<li>I've tried different server types (n1-standard-1, n1-highcpu-16)</li>\n<li><strong>I've tried so many different IAM permissions</strong> of particular note I tried Compute Admin, Compute Admin with Service Account User, and Compute Instance Admin and Service Account Admin.</li>\n</ul>\n<p>Concerning the last point. I used</p>\n<pre><code>gcloud projects get-iam-policy &lt;PROJECT NAME&gt; \\\n--flatten=&quot;bindings[].members&quot; \\\n--format='table(bindings.role)' \\\n--filter=&quot;bindings.members:&lt;KEY NAME&gt;&quot;\n</code></pre>\n<p>And got this output</p>\n<pre><code>ROLE\nroles/compute.admin\nroles/compute.instanceAdmin\nroles/compute.instanceAdmin.v1\nroles/compute.instanceAdmin.v1\nroles/iam.serviceAccountUser\n</code></pre>\n<h3>But wait there's more</h3>\n<p>I went through <a href=\"https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform\" rel=\"nofollow noreferrer\">this link</a> and added all the permissions they suggested using the aforementioned key (except for all the ones that have to do with billing cause the organization is my school). When I checked the roles again I saw that it had added <code>roles/storage.admin</code>. Produced the same error though.</p>\n<h3>Update</h3>\n<p>A billing account is linked to my account and now the roles are this. AND IT STILL doesn't work</p>\n<pre><code>roles/billing.projectManager\nroles/compute.admin\nroles/compute.instanceAdmin\nroles/compute.instanceAdmin.v1\nroles/compute.instanceAdmin.v1\nroles/iam.serviceAccountUser\nroles/storage.admin\n</code></pre>\n", "OwnerUserId": "5055126", "LastEditorUserId": "5055126", "LastEditDate": "2020-07-07T13:26:35.987", "LastActivityDate": "2020-07-07T13:26:35.987", "Title": "Can't start google compute instance with terraform", "Tags": "<google-cloud-platform><terraform>", "AnswerCount": "0", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "110996131", "PostId": "62765835", "Score": "0", "Text": "Just make sure billing is enabled. https://cloud.google.com/billing/docs/how-to/modify-project#confirm_billing_is_enabled_on_a_project", "CreationDate": "2020-07-07T01:27:12.307", "UserId": "1932092", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Just make sure billing is enabled. ", "keywords": ["bill"]}, {"source": "Text", "text": "https://cloud.google.com/billing/docs/how-to/modify-project#confirm_billing_is_enabled_on_a_project", "keywords": ["bill"]}]}, {"Id": "110998611", "PostId": "62765835", "Score": "2", "Text": "Your troubleshooting only confirmed that it is finding the credentials file, not that the credentials within that file are correct or have sufficient privileges to deploy a VM. I recommend taking a careful look at the credentials that you are using there", "CreationDate": "2020-07-07T04:40:48.123", "UserId": "1198321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "111011870", "PostId": "62765835", "Score": "0", "Text": "I was fairly certain the credentials were the problem. I'm asking what the problem is with them. Also I have billing enabled on the project as a whole.", "CreationDate": "2020-07-07T12:48:51.617", "UserId": "5055126", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Also I have billing enabled on the project as a whole.", "keywords": ["bill"]}]}], "history": [{"Id": "226027774", "PostHistoryTypeId": "2", "PostId": "62765835", "RevisionGUID": "d85aebd8-7caa-48ff-83ef-b83e1799304b", "CreationDate": "2020-07-06T23:17:07.243", "UserId": "5055126", "Text": "## TLDR\r\nI'm just trying to start up a simple vm and it terraform tells me I don't have sufficient permissions. Keep in mind I have a Trial account (and like $290 left of sweet sweet free money).\r\n\r\n## Details\r\nprovider.tf\r\n```\r\nprovider \"google\" {\r\n  project     = \"My First Project\"\r\n  region      = \"us-east1\"\r\n}\r\n\r\n```\r\n\r\nresource.tf\r\n```\r\nresource \"google_compute_instance\" \"vm_instance\" {\r\n  name         = \"terraform-instance\"\r\n  machine_type = \"f1-micro\"\r\n  zone      = \"us-east1-c\"\r\n\r\n  boot_disk {\r\n    initialize_params {\r\n      image = \"debian-cloud/debian-9\"\r\n    }\r\n  }\r\n\r\n  network_interface {\r\n    # A default network is created for all GCP projects\r\n    network       = \"default\"\r\n    access_config {\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nError\r\n```\r\nError: Error loading zone 'us-east1-c': googleapi: Error 403: Permission denied on resource project My First Project., forbidden\r\n```\r\n## My Trouble Shooting\r\n- I tried switching us-east1-c for other zones and tried us-central1 with different zones. Always got the same error.\r\n- I'm passing the credentials with`GOOGLE_APPLICATION_CREDENTIALS` environment variable and I know I'm passing it in correctly cause when I change the filename it breaks and says something like \"that filename doesn't exist\"\r\n- I've tried different server types (n1-standard-1, n1-highcpu-16)\r\n- **I've tried so many different IAM permissions** of particular note I tried Compute Admin, Compute Admin with Service Account User, and Compute Instance Admin and Service Account Admin.\r\n\r\nConcerning the last point. I used \r\n```\r\ngcloud projects get-iam-policy <PROJECT NAME> \\\r\n--flatten=\"bindings[].members\" \\\r\n--format='table(bindings.role)' \\\r\n--filter=\"bindings.members:<KEY NAME>\"\r\n```\r\nAnd got this output\r\n```\r\nROLE\r\nroles/compute.admin\r\nroles/compute.instanceAdmin\r\nroles/compute.instanceAdmin.v1\r\nroles/compute.instanceAdmin.v1\r\nroles/iam.serviceAccountUser\r\n```\r\n\r\n### But wait there's more\r\nI went through [this link](https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform) and added all the permissions they suggested using the aforementioned key (except for all the ones that have to do with billing cause the organization is my school). When I checked the roles again I saw that it had added `roles/storage.admin`. Produced the same error though.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Keep in mind I have a Trial account (and like $290 left of sweet sweet free money). ## Details provider.tf ``` provider \"google\" { project = \"My First Project\" region = \"us-east1\" } ``` resource.tf ``` resource \"google_compute_instance\" \"vm_instance\" { name = \"terraform-instance\" machine_type = \"f1-micro\" zone = \"us-east1-c\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } network_interface { # A default network is created for all GCP projects network = \"default\" access_config { } } } ``` Error ``` Error: Error loading zone 'us-east1-c': googleapi: Error 403: Permission denied on resource project My First Project., forbidden ``` ## My Trouble Shooting - I tried switching us-east1-c for other zones and tried us-central1 with different zones. ", "keywords": ["instance", "provider"]}, {"source": "Text", "text": "Always got the same error. - I'm passing the credentials with`GOOGLE_APPLICATION_CREDENTIALS` environment variable and I know I'm passing it in correctly cause when I change the filename it breaks and says something like \"that filename doesn't exist\" - I've tried different server types (n1-standard-1, n1-highcpu-16) - **I've tried so many different IAM permissions** of particular note I tried Compute Admin, Compute Admin with Service Account User, and Compute Instance Admin and Service Account Admin. ", "keywords": ["instance", "change"]}, {"source": "Text", "text": "I used ``` gcloud projects get-iam-policy \\ --flatten=\"bindings[].members\" \\ --format='table(bindings.role)' \\ --filter=\"bindings.members:\" ``` And got this output ``` ROLE roles/compute.admin roles/compute.instanceAdmin roles/compute.instanceAdmin.v1 roles/compute.instanceAdmin.v1 roles/iam.serviceAccountUser ``` ### But wait there's more I went through [this link](https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform) and added all the permissions they suggested using the aforementioned key (except for all the ones that have to do with billing cause the organization is my school). ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "When I checked the roles again I saw that it had added `roles/storage.admin`. ", "keywords": ["storage"]}]}, {"Id": "226027775", "PostHistoryTypeId": "1", "PostId": "62765835", "RevisionGUID": "d85aebd8-7caa-48ff-83ef-b83e1799304b", "CreationDate": "2020-07-06T23:17:07.243", "UserId": "5055126", "Text": "Can't start google compute instance with terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Can't start google compute instance with terraform", "keywords": ["instance"]}]}, {"Id": "226027776", "PostHistoryTypeId": "3", "PostId": "62765835", "RevisionGUID": "d85aebd8-7caa-48ff-83ef-b83e1799304b", "CreationDate": "2020-07-06T23:17:07.243", "UserId": "5055126", "Text": "<google-cloud-platform><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "226072383", "PostHistoryTypeId": "5", "PostId": "62765835", "RevisionGUID": "9c48fdc3-a5ca-4237-a192-beb6725022f3", "CreationDate": "2020-07-07T13:26:35.987", "UserId": "5055126", "Comment": "added 316 characters in body", "Text": "## TLDR\r\nI'm just trying to start up a simple vm and it terraform tells me I don't have sufficient permissions. Keep in mind I have a Trial account (and like $290 left of sweet sweet free money).\r\n\r\n## Details\r\nprovider.tf\r\n```\r\nprovider \"google\" {\r\n  project     = \"My First Project\"\r\n  region      = \"us-east1\"\r\n}\r\n\r\n```\r\n\r\nresource.tf\r\n```\r\nresource \"google_compute_instance\" \"vm_instance\" {\r\n  name         = \"terraform-instance\"\r\n  machine_type = \"f1-micro\"\r\n  zone      = \"us-east1-c\"\r\n\r\n  boot_disk {\r\n    initialize_params {\r\n      image = \"debian-cloud/debian-9\"\r\n    }\r\n  }\r\n\r\n  network_interface {\r\n    # A default network is created for all GCP projects\r\n    network       = \"default\"\r\n    access_config {\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nError\r\n```\r\nError: Error loading zone 'us-east1-c': googleapi: Error 403: Permission denied on resource project My First Project., forbidden\r\n```\r\n## My Trouble Shooting\r\n- I tried switching us-east1-c for other zones and tried us-central1 with different zones. Always got the same error.\r\n- I'm passing the credentials with`GOOGLE_APPLICATION_CREDENTIALS` environment variable and I know I'm passing it in correctly cause when I change the filename it breaks and says something like \"that filename doesn't exist\"\r\n- I've tried different server types (n1-standard-1, n1-highcpu-16)\r\n- **I've tried so many different IAM permissions** of particular note I tried Compute Admin, Compute Admin with Service Account User, and Compute Instance Admin and Service Account Admin.\r\n\r\nConcerning the last point. I used \r\n```\r\ngcloud projects get-iam-policy <PROJECT NAME> \\\r\n--flatten=\"bindings[].members\" \\\r\n--format='table(bindings.role)' \\\r\n--filter=\"bindings.members:<KEY NAME>\"\r\n```\r\nAnd got this output\r\n```\r\nROLE\r\nroles/compute.admin\r\nroles/compute.instanceAdmin\r\nroles/compute.instanceAdmin.v1\r\nroles/compute.instanceAdmin.v1\r\nroles/iam.serviceAccountUser\r\n```\r\n\r\n### But wait there's more\r\nI went through [this link](https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform) and added all the permissions they suggested using the aforementioned key (except for all the ones that have to do with billing cause the organization is my school). When I checked the roles again I saw that it had added `roles/storage.admin`. Produced the same error though.\r\n\r\n### Update\r\nA billing account is linked to my account and now the roles are this. AND IT STILL doesn't work\r\n```\r\nroles/billing.projectManager\r\nroles/compute.admin\r\nroles/compute.instanceAdmin\r\nroles/compute.instanceAdmin.v1\r\nroles/compute.instanceAdmin.v1\r\nroles/iam.serviceAccountUser\r\nroles/storage.admin\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Keep in mind I have a Trial account (and like $290 left of sweet sweet free money). ## Details provider.tf ``` provider \"google\" { project = \"My First Project\" region = \"us-east1\" } ``` resource.tf ``` resource \"google_compute_instance\" \"vm_instance\" { name = \"terraform-instance\" machine_type = \"f1-micro\" zone = \"us-east1-c\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } network_interface { # A default network is created for all GCP projects network = \"default\" access_config { } } } ``` Error ``` Error: Error loading zone 'us-east1-c': googleapi: Error 403: Permission denied on resource project My First Project., forbidden ``` ## My Trouble Shooting - I tried switching us-east1-c for other zones and tried us-central1 with different zones. ", "keywords": ["instance", "provider"]}, {"source": "Text", "text": "Always got the same error. - I'm passing the credentials with`GOOGLE_APPLICATION_CREDENTIALS` environment variable and I know I'm passing it in correctly cause when I change the filename it breaks and says something like \"that filename doesn't exist\" - I've tried different server types (n1-standard-1, n1-highcpu-16) - **I've tried so many different IAM permissions** of particular note I tried Compute Admin, Compute Admin with Service Account User, and Compute Instance Admin and Service Account Admin. ", "keywords": ["instance", "change"]}, {"source": "Text", "text": "I used ``` gcloud projects get-iam-policy \\ --flatten=\"bindings[].members\" \\ --format='table(bindings.role)' \\ --filter=\"bindings.members:\" ``` And got this output ``` ROLE roles/compute.admin roles/compute.instanceAdmin roles/compute.instanceAdmin.v1 roles/compute.instanceAdmin.v1 roles/iam.serviceAccountUser ``` ### But wait there's more I went through [this link](https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform) and added all the permissions they suggested using the aforementioned key (except for all the ones that have to do with billing cause the organization is my school). ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "When I checked the roles again I saw that it had added `roles/storage.admin`. ", "keywords": ["storage"]}, {"source": "Text", "text": "A billing account is linked to my account and now the roles are this. ", "keywords": ["bill"]}, {"source": "Text", "text": "roles/billing.projectManager roles/compute.admin roles/compute.instanceAdmin roles/compute.instanceAdmin.v1 roles/compute.instanceAdmin.v1 roles/iam.serviceAccountUser roles/storage.admin ```", "keywords": ["bill", "storage"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "Can't start google compute instance with terraform", "keywords": ["instance"]}, {"source": "Body", "text": "Details provider.tf resource.tf Error My Trouble Shooting I tried switching us-east1-c for other zones and tried us-central1 with different zones. ", "keywords": ["provider"]}, {"source": "Body", "text": "I'm passing the credentials withGOOGLE_APPLICATION_CREDENTIALS environment variable and I know I'm passing it in correctly cause when I change the filename it breaks and says something like \"that filename doesn't exist\" I've tried different server types (n1-standard-1, n1-highcpu-16) I've tried so many different IAM permissions of particular note I tried Compute Admin, Compute Admin with Service Account User, and Compute Instance Admin and Service Account Admin. ", "keywords": ["instance", "change"]}, {"source": "Body", "text": "But wait there's more I went through this link and added all the permissions they suggested using the aforementioned key (except for all the ones that have to do with billing cause the organization is my school). ", "keywords": ["bill"]}, {"source": "Body", "text": "When I checked the roles again I saw that it had added roles/storage.admin. ", "keywords": ["storage"]}, {"source": "Body", "text": "Update A billing account is linked to my account and now the roles are this. ", "keywords": ["bill"]}]}