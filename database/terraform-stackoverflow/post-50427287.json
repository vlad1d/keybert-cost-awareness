{"Id": "50427287", "PostTypeId": "1", "CreationDate": "2018-05-19T16:23:40.417", "Score": "2", "ViewCount": "938", "Body": "<p>If Terraform applies let say 6 EC2 instances as the target capacity as shown in this <a href=\"https://www.terraform.io/docs/providers/aws/r/spot_fleet_request.html\" rel=\"nofollow noreferrer\">example</a>:</p>\n\n<pre><code># Request a Spot fleet\nresource \"aws_spot_fleet_request\" \"cheap_compute\" {\n  iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price          = \"0.03\"\n  allocation_strategy = \"diversified\"\n  target_capacity     = 6\n  valid_until         = \"2019-11-04T20:44:20Z\"\n\n  launch_specification {\n    instance_type             = \"m4.10xlarge\"\n    ami                       = \"ami-1234\"\n    spot_price                = \"2.793\"\n    placement_tenancy         = \"dedicated\"\n    iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\n  }\n\n  launch_specification {\n    instance_type             = \"m4.4xlarge\"\n    ami                       = \"ami-5678\"\n    key_name                  = \"my-key\"\n    spot_price                = \"1.117\"\n    iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\n    availability_zone         = \"us-west-1a\"\n    subnet_id                 = \"subnet-1234\"\n    weighted_capacity         = 35\n\n    root_block_device {\n      volume_size = \"300\"\n      volume_type = \"gp2\"\n    }\n\n    tags {\n      Name = \"spot-fleet-example\"\n    }\n  }\n}\n</code></pre>\n\n<p>The only available attributes are 'id' and 'spot_request_state'.</p>\n\n<p>How can I output the private IP addresses of the launched instances?</p>\n\n<p>Is this possible or do I need to utilize another tool like Boto3?</p>\n", "OwnerUserId": "4133463", "LastActivityDate": "2018-05-23T10:53:15.450", "Title": "When terraform applies aws_spot_fleet_request, how can I retrieve the private ip addresses?", "Tags": "<python><amazon-web-services><aws-sdk><boto3><terraform>", "AnswerCount": "2", "CommentCount": "3", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "87869264", "PostId": "50427287", "Score": "0", "Text": "idk about terraform, but you can request further info via a [describe-spot-fleet-instances request with that 'id'](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-fleet-requests.html#manage-spot-fleet)", "CreationDate": "2018-05-19T16:29:17.257", "UserId": "995891", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "87869955", "PostId": "50427287", "Score": "0", "Text": "That only describes \"InstanceId\", \"InstanceType\", \"SpotInstanceRequestId\",\"InstanceHealth\".", "CreationDate": "2018-05-19T17:06:46.127", "UserId": "4133463", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "87890391", "PostId": "50427287", "Score": "0", "Text": "true but it's easy from there via a describe-instances request using the instance ids", "CreationDate": "2018-05-20T18:45:36.450", "UserId": "995891", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "true but it's easy from there via a describe-instances request using the instance ids", "keywords": ["instance"]}]}], "history": [{"Id": "173777828", "PostHistoryTypeId": "2", "PostId": "50427287", "RevisionGUID": "65666411-7635-44f1-8516-c250cc4a4f87", "CreationDate": "2018-05-19T16:23:40.417", "UserId": "4133463", "Text": "If Terraform applies let say 6 EC2 instances as the target capacity as shown in this [example][1]:\r\n\r\n    # Request a Spot fleet\r\n    resource \"aws_spot_fleet_request\" \"cheap_compute\" {\r\n      iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\r\n      spot_price          = \"0.03\"\r\n      allocation_strategy = \"diversified\"\r\n      target_capacity     = 6\r\n      valid_until         = \"2019-11-04T20:44:20Z\"\r\n    \r\n      launch_specification {\r\n        instance_type             = \"m4.10xlarge\"\r\n        ami                       = \"ami-1234\"\r\n        spot_price                = \"2.793\"\r\n        placement_tenancy         = \"dedicated\"\r\n        iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\r\n      }\r\n    \r\n      launch_specification {\r\n        instance_type             = \"m4.4xlarge\"\r\n        ami                       = \"ami-5678\"\r\n        key_name                  = \"my-key\"\r\n        spot_price                = \"1.117\"\r\n        iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\r\n        availability_zone         = \"us-west-1a\"\r\n        subnet_id                 = \"subnet-1234\"\r\n        weighted_capacity         = 35\r\n    \r\n        root_block_device {\r\n          volume_size = \"300\"\r\n          volume_type = \"gp2\"\r\n        }\r\n    \r\n        tags {\r\n          Name = \"spot-fleet-example\"\r\n        }\r\n      }\r\n    }\r\n\r\nThe only available attributes are 'id' and 'spot_request_state'.\r\n\r\nHow can I output the private IP addresses of the launched instances?\r\n\r\nIs this possible or do I need to utilize another tool like Boto3?\r\n\r\n  \r\n\r\n\r\n  [1]: https://www.terraform.io/docs/providers/aws/r/spot_fleet_request.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If Terraform applies let say 6 EC2 instances as the target capacity as shown in this [example][1]: # Request a Spot fleet resource \"aws_spot_fleet_request\" \"cheap_compute\" { iam_fleet_role = \"arn:aws:iam::12345678:role/spot-fleet\" spot_price = \"0.03\" allocation_strategy = \"diversified\" target_capacity = 6 valid_until = \"2019-11-04T20:44:20Z\" launch_specification { instance_type = \"m4.10xlarge\" ami = \"ami-1234\" spot_price = \"2.793\" placement_tenancy = \"dedicated\" iam_instance_profile_arn = \"${aws_iam_instance_profile.example.arn}\" } launch_specification { instance_type = \"m4.4xlarge\" ami = \"ami-5678\" key_name = \"my-key\" spot_price = \"1.117\" iam_instance_profile_arn = \"${aws_iam_instance_profile.example.arn}\" availability_zone = \"us-west-1a\" subnet_id = \"subnet-1234\" weighted_capacity = 35 root_block_device { volume_size = \"300\" volume_type = \"gp2\" ", "keywords": ["cheap"]}]}, {"Id": "173777829", "PostHistoryTypeId": "1", "PostId": "50427287", "RevisionGUID": "65666411-7635-44f1-8516-c250cc4a4f87", "CreationDate": "2018-05-19T16:23:40.417", "UserId": "4133463", "Text": "When terraform applies aws_spot_fleet_request, how can I retrieve the private ip addresses?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "173777830", "PostHistoryTypeId": "3", "PostId": "50427287", "RevisionGUID": "65666411-7635-44f1-8516-c250cc4a4f87", "CreationDate": "2018-05-19T16:23:40.417", "UserId": "4133463", "Text": "<python><amazon-web-services><aws-sdk><boto3><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "50486544", "PostTypeId": "2", "ParentId": "50427287", "CreationDate": "2018-05-23T10:53:15.450", "Score": "0", "Body": "<p>It is not possible atm in terraform to obtain the instances of a Spot fleet.</p>\n\n<p>You would require writing codes in AWS SDK / boto3 to find the instances created using Spot fleet. It is the same case for EC2 AutoScaling Groups &amp; EMR Clusters.</p>\n\n<p>Thanks.</p>\n", "OwnerUserId": "3125943", "LastActivityDate": "2018-05-23T10:53:15.450", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "174023096", "PostHistoryTypeId": "2", "PostId": "50486544", "RevisionGUID": "812d1252-321b-4fbf-ae0f-13786fbf6c4a", "CreationDate": "2018-05-23T10:53:15.450", "UserId": "3125943", "Text": "It is not possible atm in terraform to obtain the instances of a Spot fleet.\r\n\r\nYou would require writing codes in AWS SDK / boto3 to find the instances created using Spot fleet. It is the same case for EC2 AutoScaling Groups & EMR Clusters.\r\n\r\nThanks.\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "50431248", "PostTypeId": "2", "ParentId": "50427287", "CreationDate": "2018-05-20T02:51:44.810", "Score": "2", "Body": "<p>You can utilise <code>Data Sources</code> in Terraform. These allow you to essentially perform API calls to retrieve data from AWS. Once you've created your resource you can use the following Terraform - </p>\n\n<pre><code>data \"aws_instances\" \"spot-fleet-ips\" {\n  instance_tags {\n    Name = \"spot-fleet-example\"\n  }\n}\n</code></pre>\n\n<p>To get the IPs then you can do the following - </p>\n\n<pre><code>\"${data.aws_instances.spot-fleet-ips.private_ips}\"\n</code></pre>\n\n<p>The documentation for the above data source is <a href=\"https://www.terraform.io/docs/providers/aws/d/instances.html#private_ips\" rel=\"nofollow noreferrer\">here.</a></p>\n", "OwnerUserId": "1218285", "LastActivityDate": "2018-05-20T02:51:44.810", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "87877725", "PostId": "50431248", "Score": "0", "Text": "I think you mean like this added  in the tf file? but I get the error \"data.aws_instances.spot-fleet-ips: Your query returned no results\".\n\ndata \"aws_instances\" \"spot-fleet-ips\" {\n  instance_tags {\n    Name = \"spot-fleet-example\"\n  }\n}\n\noutput \"sfleet requested private ips\" {\n    value = \"${data.aws_instances.spot-fleet-ips.private_ips}\"\n}", "CreationDate": "2018-05-20T04:40:01.497", "UserId": "4133463", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "87877788", "PostId": "50431248", "Score": "0", "Text": "I think you mean like this added  in the tf file? but I get the error \"data.aws_instances.spot-fleet-ips: Your query returned no results\".\n'code'\ndata \"aws_instances\" \"spot-fleet-ips\" {\n  instance_tags {\n    Name = \"spot-fleet-example\"\n  }\n}\n\noutput \"sfleet requested private ips\" {\n    value = \"${data.aws_instances.spot-fleet-ips.private_ips}\"\n}\n'code'", "CreationDate": "2018-05-20T04:47:03.117", "UserId": "4133463", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "87877899", "PostId": "50431248", "Score": "0", "Text": "Have the instances been created at the time you are running using the data source? As the instances need to have been created and have a private ip associated to them, otherwise, you need to run the data source when they are created.", "CreationDate": "2018-05-20T04:57:53.120", "UserId": "1218285", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "173794661", "PostHistoryTypeId": "2", "PostId": "50431248", "RevisionGUID": "cfc6dc7c-a287-4a11-946c-8a3afbd316a6", "CreationDate": "2018-05-20T02:51:44.810", "UserId": "1218285", "Text": "You can utilise `Data Sources` in Terraform. These allow you to essentially perform API calls to retrieve data from AWS. Once you've created your resource you can use the following Terraform - \r\n\r\n\r\n    data \"aws_instances\" \"spot-fleet-ips\" {\r\n      instance_tags {\r\n        Name = \"spot-fleet-example\"\r\n      }\r\n    }\r\n\r\nTo get the IPs then you can do the following - \r\n\r\n    \"${data.aws_instances.spot-fleet-ips.private_ips}\"\r\n\r\nThe documentation for the above data source is [here.][1]\r\n\r\n\r\n  [1]: https://www.terraform.io/docs/providers/aws/d/instances.html#private_ips", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}