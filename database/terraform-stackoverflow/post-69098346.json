{"Id": "69098346", "PostTypeId": "1", "CreationDate": "2021-09-08T06:59:53.580", "Score": "0", "ViewCount": "1294", "Body": "<p>I want to create EKS cluster using reserved instances. I have tried the following solution for <a href=\"https://github.com/codeaprendiz/devops-essentials/tree/main/terraform/aws/task-031-creating-eks-spot\" rel=\"nofollow noreferrer\">EKS</a> by replacing the lifecycle policy to <code>reserved</code> instead of <code>on-demand</code> over <a href=\"https://github.com/codeaprendiz/devops-essentials/blob/7eb17a99e15008ee85d7c507c2848caf2cabf8e3/terraform/aws/task-031-creating-eks-spot/eks-cluster.tf#L25\" rel=\"nofollow noreferrer\">here</a></p>\n<p>However when I spin up the cluster it still says on demand and reserved instances are not used.</p>\n<p>Note: We have reserved instances already and have like 10 of them.</p>\n", "OwnerUserId": "5761011", "LastEditorUserId": "5761011", "LastEditDate": "2021-09-08T11:16:01.183", "LastActivityDate": "2021-09-10T14:10:22.663", "Title": "Create EKS using reserved instances using terraform", "Tags": "<terraform><amazon-eks>", "AnswerCount": "1", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "122127059", "PostId": "69098346", "Score": "1", "Text": "Can you share your Terraform code please? In particular it's not clear what you mean by saying you changed the lifecycle policy to `reserved` as this isn't a valid option. It might also be useful to share whatever is showing the unused RIs and also sharing the types of the instances used by the cluster.", "CreationDate": "2021-09-08T08:45:54.943", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "In particular it's not clear what you mean by saying you changed the lifecycle policy to `reserved` as this isn't a valid option. ", "keywords": ["policy", "change"]}, {"source": "Text", "text": "It might also be useful to share whatever is showing the unused RIs and also sharing the types of the instances used by the cluster.", "keywords": ["cluster"]}]}, {"Id": "122130769", "PostId": "69098346", "Score": "0", "Text": "@ydaetskcoR, thank you for your reply. I have shared the link in the question as well. You can click [here](https://github.com/codeaprendiz/devops-essentials/tree/main/terraform/aws/task-031-creating-eks-spot) to access the same. I have also modified the question for better understanding.", "CreationDate": "2021-09-08T11:14:43.090", "UserId": "5761011", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "122132796", "PostId": "69098346", "Score": "1", "Text": "Where are you setting `reserved` there? The `spot` mention there is just the label that is on the node which is for the benefit of the Kubernetes API and scheduler. I would expect the result of what you linked there to be that you get on demand nodes (or reserved if you have applicable RI reservations) but are labelled incorrectly as being spot instances to the Kubernetes API which might influence some scheduling decisions. Can you share how you are seeing the unused RIs and also the instances that are created that you think should map to those RIs please?", "CreationDate": "2021-09-08T12:28:34.940", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "253352251", "PostHistoryTypeId": "2", "PostId": "69098346", "RevisionGUID": "e7eb5c1f-8e3d-425f-85fd-669912695ad9", "CreationDate": "2021-09-08T06:59:53.580", "UserId": "5761011", "Text": "I want to create EKS cluster using reserved instances. I have tried the following solution fo [EKS](https://github.com/codeaprendiz/devops-essentials/tree/main/terraform/aws/task-031-creating-eks-spot) by replacing the lifecycle policy to `reserved` instead of `on-demand`. \r\n\r\nHowever when I spin up the cluster it still says on demand and reserved instances are not used.\r\n\r\nNote: We have reserved instances already and have like 10 of them.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I want to create EKS cluster using reserved instances. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I have tried the following solution fo [EKS](https://github.com/codeaprendiz/devops-essentials/tree/main/terraform/aws/task-031-creating-eks-spot) by replacing the lifecycle policy to `reserved` instead of `on-demand`. ", "keywords": ["policy"]}, {"source": "Text", "text": "However when I spin up the cluster it still says on demand and reserved instances are not used. ", "keywords": ["cluster"]}]}, {"Id": "253352252", "PostHistoryTypeId": "1", "PostId": "69098346", "RevisionGUID": "e7eb5c1f-8e3d-425f-85fd-669912695ad9", "CreationDate": "2021-09-08T06:59:53.580", "UserId": "5761011", "Text": "Create EKS using reserved instances using terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "253352253", "PostHistoryTypeId": "3", "PostId": "69098346", "RevisionGUID": "e7eb5c1f-8e3d-425f-85fd-669912695ad9", "CreationDate": "2021-09-08T06:59:53.580", "UserId": "5761011", "Text": "<terraform><amazon-eks>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "253367374", "PostHistoryTypeId": "5", "PostId": "69098346", "RevisionGUID": "d42f2b18-9d38-4f93-9042-c3ed9bedda26", "CreationDate": "2021-09-08T11:16:01.183", "UserId": "5761011", "Comment": "added 167 characters in body", "Text": "I want to create EKS cluster using reserved instances. I have tried the following solution for [EKS](https://github.com/codeaprendiz/devops-essentials/tree/main/terraform/aws/task-031-creating-eks-spot) by replacing the lifecycle policy to `reserved` instead of `on-demand` over [here](https://github.com/codeaprendiz/devops-essentials/blob/7eb17a99e15008ee85d7c507c2848caf2cabf8e3/terraform/aws/task-031-creating-eks-spot/eks-cluster.tf#L25)\r\n\r\nHowever when I spin up the cluster it still says on demand and reserved instances are not used.\r\n\r\nNote: We have reserved instances already and have like 10 of them.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I want to create EKS cluster using reserved instances. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I have tried the following solution for [EKS](https://github.com/codeaprendiz/devops-essentials/tree/main/terraform/aws/task-031-creating-eks-spot) by replacing the lifecycle policy to `reserved` instead of `on-demand` over [here](https://github.com/codeaprendiz/devops-essentials/blob/7eb17a99e15008ee85d7c507c2848caf2cabf8e3/terraform/aws/task-031-creating-eks-spot/eks-cluster.tf#L25) However when I spin up the cluster it still says on demand and reserved instances are not used", "keywords": ["policy", "cluster"]}]}], "answers": [{"Id": "69133499", "PostTypeId": "2", "ParentId": "69098346", "CreationDate": "2021-09-10T14:10:22.663", "Score": "0", "Body": "<p>The <a href=\"https://github.com/codeaprendiz/devops-essentials/tree/7eb17a99e15008ee85d7c507c2848caf2cabf8e3/terraform/aws/task-030-creating-eks\" rel=\"nofollow noreferrer\">link</a> to the solution.</p>\n<p>As @ydaetskcoR pointed out, if you have RIs already reserved then you can just spin up the cluster with on-demand instances. At the billing page you would be able to see actually that the new instances are using the reserved instance hours.</p>\n", "OwnerUserId": "5761011", "LastActivityDate": "2021-09-10T14:10:22.663", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "253500540", "PostHistoryTypeId": "2", "PostId": "69133499", "RevisionGUID": "827e5eaa-5c4c-44a2-93f0-b61e76868768", "CreationDate": "2021-09-10T14:10:22.663", "UserId": "5761011", "Text": "The [link](https://github.com/codeaprendiz/devops-essentials/tree/7eb17a99e15008ee85d7c507c2848caf2cabf8e3/terraform/aws/task-030-creating-eks) to the solution.\r\n\r\nAs @ydaetskcoR pointed out, if you have RIs already reserved then you can just spin up the cluster with on-demand instances. At the billing page you would be able to see actually that the new instances are using the reserved instance hours. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "As @ydaetskcoR pointed out, if you have RIs already reserved then you can just spin up the cluster with on-demand instances. ", "keywords": ["cluster"]}, {"source": "Text", "text": "At the billing page you would be able to see actually that the new instances are using the reserved instance hours.", "keywords": ["bill", "instance"]}]}], "filtered-sentences": [{"source": "Body", "text": "As @ydaetskcoR pointed out, if you have RIs already reserved then you can just spin up the cluster with on-demand instances. ", "keywords": ["cluster"]}, {"source": "Body", "text": "At the billing page you would be able to see actually that the new instances are using the reserved instance hours.", "keywords": ["bill", "instance"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I want to create EKS cluster using reserved instances. ", "keywords": ["cluster"]}, {"source": "Body", "text": "I have tried the following solution for EKS by replacing the lifecycle policy to reserved instead of on-demand over here However when I spin up the cluster it still says on demand and reserved instances are not used. ", "keywords": ["policy", "cluster"]}]}