{"Id": "68492146", "PostTypeId": "1", "CreationDate": "2021-07-22T22:29:00.980", "Score": "0", "ViewCount": "280", "Body": "<p>I have my current TF code setup like this.\n<div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>../../modules/cp_project\nresource \"google_storage_bucket_iam_binding\" \"bucket_permission\" {\n  bucket = google_container_registry.registry.id\n  role   = \"roles/storage.objectViewer\"\n  members = var.members\n}\n\nqat01.tf\nmodule \"qat01_project\" {\n  source = \"../../../../modules/cp_project\"\n members = [\n    \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\",\n  ]\n  }\n  \ndev01.tf\nmodule \"dev01_project\" {\n  source = \"../../../../modules/cp_project\"\n  members= [\n    \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\",\n  ]\n  }</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>The service accounts varies for project to project as you see in the code. Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. I do have multiple files like prod.tf and preprod.tf which uses the same module with the different email addresses in members. I want to put all the these project specific members in modules/cp_project and then the respective projects can call the respective members list from cp_project itself. Is there a way? Thank You</p>\n<p><a href=\"https://i.stack.imgur.com/CuNbX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CuNbX.png\" alt=\"File structure\" /></a></p>\n<p>As you see from the file structure, I want to list the service account members in module/vars.tf and call the variables from qat01 or dev01.\nSo i want the module/vars.tf look like the following. And the variables can be called by dev01.tf and qat01.tf in &quot;members&quot; variable. Example of how module/vars.tf looks as follows</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code> module/vars.tf\n\nvariable \"qat01_members\" {\n    type= list(any)\n    default = [\n    \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\",\n  ] \n}\n\nvariable \"dev01_members\" {\n    type= list(any)\n    default = [\n    \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\",\n    \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\",\n    ]  \n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n", "OwnerUserId": "5909283", "LastEditorUserId": "5909283", "LastEditDate": "2021-07-24T15:57:50.310", "LastActivityDate": "2021-07-24T15:57:50.310", "Title": "modules for muliple service account in different projects in terraform", "Tags": "<terraform><terraform-provider-gcp><terraform-modules>", "AnswerCount": "0", "CommentCount": "6", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "121046543", "PostId": "68492146", "Score": "1", "Text": "I'm not sure what you're asking. Are you asking if there's a way to *create* the service account inside the `cp_project` module?", "CreationDate": "2021-07-22T22:31:04.017", "UserId": "612580", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121046765", "PostId": "68492146", "Score": "0", "Text": "yes. but service account list varies for project too. as you see in qat01.tf and dev01.tf", "CreationDate": "2021-07-22T22:51:51.837", "UserId": "5909283", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121050933", "PostId": "68492146", "Score": "0", "Text": "You can create a map with keys as dev,qat,prod with values as service account list.", "CreationDate": "2021-07-23T06:16:53.420", "UserId": "10159806", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121051881", "PostId": "68492146", "Score": "0", "Text": "How Can i refer them in the dev01.tf or qat01.tf though?", "CreationDate": "2021-07-23T07:10:31.937", "UserId": "5909283", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121064535", "PostId": "68492146", "Score": "0", "Text": "Still not quite following. Maybe you can show some pseudocode that demonstrates what you *want* to be able to do, and we can show you how to achieve it.", "CreationDate": "2021-07-23T16:43:33.433", "UserId": "612580", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "134641145", "PostId": "68492146", "Score": "0", "Text": "It seems that you are asking about writing reusable modules, for example as in https://blog.gruntwork.io/how-to-create-reusable-infrastructure-with-terraform-modules-25526d65f73d", "CreationDate": "2023-05-29T01:31:09.703", "UserId": "4950769", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "250721874", "PostHistoryTypeId": "2", "PostId": "68492146", "RevisionGUID": "18ed5d48-4c25-4332-bf91-a9cf5a376958", "CreationDate": "2021-07-22T22:29:00.980", "UserId": "5909283", "Text": "\r\nI have my current TF code setup like this.\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    ../../modules/cp_project\r\n    resource \"google_storage_bucket_iam_binding\" \"bucket_permission\" {\r\n      bucket = google_container_registry.registry.id\r\n      role   = \"roles/storage.objectViewer\"\r\n      members = var.members\r\n    }\r\n\r\n    qat01.tf\r\n    module \"qat01_project\" {\r\n      source = \"../../../../modules/cp_project\"\r\n     members = [\r\n        \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\",\r\n      ]\r\n      }\r\n      \r\n    dev01.tf\r\n    module \"dev01_project\" {\r\n      source = \"../../../../modules/cp_project\"\r\n      members= [\r\n        \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\",\r\n      ]\r\n      }\r\n\r\n<!-- end snippet -->\r\n\r\nThe service accounts varies for project to project as you see in the code. Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have my current TF code setup like this. ../../modules/cp_project resource \"google_storage_bucket_iam_binding\" \"bucket_permission\" { bucket = google_container_registry.registry.id role = \"roles/storage.objectViewer\" members = var.members } qat01.tf module \"qat01_project\" { source = \"../../../../modules/cp_project\" members = [ \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\", ] } dev01.tf module \"dev01_project\" { source = \"../../../../modules/cp_project\" members= [ \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\", ] } The service accounts varies for project to project as you see in the code", "keywords": ["storage"]}, {"source": "Text", "text": "Is there any efficient(logical) way I add the service accounts in modules/cp_project itself.", "keywords": ["efficient"]}]}, {"Id": "250721875", "PostHistoryTypeId": "1", "PostId": "68492146", "RevisionGUID": "18ed5d48-4c25-4332-bf91-a9cf5a376958", "CreationDate": "2021-07-22T22:29:00.980", "UserId": "5909283", "Text": "modules for muliple service account in different projects in terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "250721876", "PostHistoryTypeId": "3", "PostId": "68492146", "RevisionGUID": "18ed5d48-4c25-4332-bf91-a9cf5a376958", "CreationDate": "2021-07-22T22:29:00.980", "UserId": "5909283", "Text": "<terraform><terraform-provider-gcp><terraform-modules>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "250729327", "PostHistoryTypeId": "5", "PostId": "68492146", "RevisionGUID": "65c780d0-4729-46b5-902d-3003416c2c51", "CreationDate": "2021-07-23T03:40:38.303", "UserId": "5909283", "Comment": "added 321 characters in body", "Text": "\r\nI have my current TF code setup like this.\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    ../../modules/cp_project\r\n    resource \"google_storage_bucket_iam_binding\" \"bucket_permission\" {\r\n      bucket = google_container_registry.registry.id\r\n      role   = \"roles/storage.objectViewer\"\r\n      members = var.members\r\n    }\r\n\r\n    qat01.tf\r\n    module \"qat01_project\" {\r\n      source = \"../../../../modules/cp_project\"\r\n     members = [\r\n        \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\",\r\n      ]\r\n      }\r\n      \r\n    dev01.tf\r\n    module \"dev01_project\" {\r\n      source = \"../../../../modules/cp_project\"\r\n      members= [\r\n        \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\",\r\n      ]\r\n      }\r\n\r\n<!-- end snippet -->\r\n\r\nThe service accounts varies for project to project as you see in the code. Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. I do have multiple files like prod.tf and preprod.tf which uses the same module with the different email addresses in members. I want to put all the these project specific members in modules/cp_project and then the respective projects can call the respective members list from cp_project itself. Is there a way? Thank You", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have my current TF code setup like this. ../../modules/cp_project resource \"google_storage_bucket_iam_binding\" \"bucket_permission\" { bucket = google_container_registry.registry.id role = \"roles/storage.objectViewer\" members = var.members } qat01.tf module \"qat01_project\" { source = \"../../../../modules/cp_project\" members = [ \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\", ] } dev01.tf module \"dev01_project\" { source = \"../../../../modules/cp_project\" members= [ \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\", ] } ", "keywords": ["storage"]}, {"source": "Text", "text": "Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. ", "keywords": ["efficient"]}]}, {"Id": "250819263", "PostHistoryTypeId": "5", "PostId": "68492146", "RevisionGUID": "9dbb0766-5df4-4646-9519-924758a6bbfa", "CreationDate": "2021-07-24T15:57:50.310", "UserId": "5909283", "Comment": "added 1558 characters in body", "Text": "I have my current TF code setup like this.\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    ../../modules/cp_project\r\n    resource \"google_storage_bucket_iam_binding\" \"bucket_permission\" {\r\n      bucket = google_container_registry.registry.id\r\n      role   = \"roles/storage.objectViewer\"\r\n      members = var.members\r\n    }\r\n\r\n    qat01.tf\r\n    module \"qat01_project\" {\r\n      source = \"../../../../modules/cp_project\"\r\n     members = [\r\n        \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\",\r\n      ]\r\n      }\r\n      \r\n    dev01.tf\r\n    module \"dev01_project\" {\r\n      source = \"../../../../modules/cp_project\"\r\n      members= [\r\n        \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\",\r\n      ]\r\n      }\r\n\r\n<!-- end snippet -->\r\n\r\nThe service accounts varies for project to project as you see in the code. Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. I do have multiple files like prod.tf and preprod.tf which uses the same module with the different email addresses in members. I want to put all the these project specific members in modules/cp_project and then the respective projects can call the respective members list from cp_project itself. Is there a way? Thank You\r\n\r\n[![File structure][1]][1]\r\n\r\nAs you see from the file structure, I want to list the service account members in module/vars.tf and call the variables from qat01 or dev01.\r\nSo i want the module/vars.tf look like the following. And the variables can be called by dev01.tf and qat01.tf in \"members\" variable. Example of how module/vars.tf looks as follows\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n module/vars.tf\r\n\r\n    variable \"qat01_members\" {\r\n        type= list(any)\r\n        default = [\r\n        \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\",\r\n      ] \r\n    }\r\n\r\n    variable \"dev01_members\" {\r\n        type= list(any)\r\n        default = [\r\n        \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\",\r\n        \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\",\r\n        ]  \r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/CuNbX.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have my current TF code setup like this. ../../modules/cp_project resource \"google_storage_bucket_iam_binding\" \"bucket_permission\" { bucket = google_container_registry.registry.id role = \"roles/storage.objectViewer\" members = var.members } qat01.tf module \"qat01_project\" { source = \"../../../../modules/cp_project\" members = [ \"serviceAccount:k8s-default-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-default-c002@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c002@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infra-c001@qat01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infras-c002@qat01.iam.gserviceaccount.com\", ] } dev01.tf module \"dev01_project\" { source = \"../../../../modules/cp_project\" members= [ \"serviceAccount:k8s-default-c001@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-default-c002@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c003@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-ecp-c004@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infra-c003@dev01.iam.gserviceaccount.com\", \"serviceAccount:k8s-infras-c004@dev01.iam.gserviceaccount.com\", ] } ", "keywords": ["storage"]}, {"source": "Text", "text": "Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. ", "keywords": ["efficient"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "Is there any efficient(logical) way I add the service accounts in modules/cp_project itself. ", "keywords": ["efficient"]}]}