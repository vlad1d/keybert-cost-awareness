{"Id": "61277763", "PostTypeId": "1", "CreationDate": "2020-04-17T17:56:36.523", "Score": "0", "ViewCount": "684", "Body": "<p>I have been testing automation with IaC with terraform and am wanting to take these steps from this tutorial <a href=\"https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform\" rel=\"nofollow noreferrer\">Manageing GCP Projects with Terraform</a> and automate them using version control. </p>\n\n<p>But I come across an error thrown </p>\n\n<pre><code>err: failed pre-requisites: missing permission on \"billingAccounts/billingaccountid\": billing.resourceAssociations.create\n</code></pre>\n\n<p>IAM TF config </p>\n\n<pre><code>resource \"google_organization_iam_binding\" \"tfadmin\" {\n\n\n org_id = var.org_id\n  role    = \"roles/billing.resourceAssociations.create\"\n\n  members = [\n    \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\",\n  ]\n}\n\nresource \"google_billing_account_iam_member\" \"binding\" {\n  billing_account_id = var.billing_account\n  role               = \"roles/billing.user\"\n\n  member            =  \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\"\n\n\n\n }\n\nresource \"google_service_account\" \"tfadmin\" {\n  project      = google_project.project.project_id\n  account_id   = \"tfadmin\"\n  display_name = \"tfadmin\"\n\n}\nresource \"google_project_iam_binding\" \"project_name\" {\n  project = google_project.project.project_id\n  role    = \"roles/bill.user\"\n\n  members = [\n   \"serviceAccount:${google_service_account.tfadmin.email}\",  \n    \"user:var.billing_account_user\",\n  ]\n}\n\nresource \"google_project_iam_policy\" \"project_id\" {\n  project     = google_project.project.project_id\n  policy_data = data.google_iam_policy.tfadmin.policy_data\n}\n\ndata \"google_iam_policy\" \"tfadmin\" {\n  binding {\n    role = \"roles/resourcemanager.projectCreator\"\n\n    members = [\n      \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\",\n    ]\n  }\n}\n</code></pre>\n\n<p>I'm looking to add the service account to create another GCP project with other gcp services (cloudsql, compute engine, app engine) </p>\n\n<p>Is there something I'm missing are have not found? </p>\n", "OwnerUserId": "10015397", "LastActivityDate": "2020-04-19T18:45:05.877", "Title": "Creating automation with Terraform and Cloubuild on GCP", "Tags": "<google-cloud-platform><terraform><google-cloud-build>", "AnswerCount": "1", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "108417503", "PostId": "61277763", "Score": "0", "Text": "Do you trigger your Terraform with Cloud Build?", "CreationDate": "2020-04-18T07:04:36.980", "UserId": "11372593", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "108458220", "PostId": "61277763", "Score": "0", "Text": "yes this is correlating to the other post I created. I want to be able to replicate the tutorial as automation without having to supply keys and other confidential info in the ci/cd pipeline.", "CreationDate": "2020-04-19T17:20:14.103", "UserId": "10015397", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "118949566", "PostId": "61277763", "Score": "0", "Text": "I was facing same issue and resolved mine as I described in here:\nhttps://stackoverflow.com/questions/61053649/missing-permission-on-billingaccounts-xxxxxxxxxxxxxxxxxxxxxxxx-billing-resour/67295858#67295858", "CreationDate": "2021-04-28T07:44:26.447", "UserId": "5727268", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I was facing same issue and resolved mine as I described in here: https://stackoverflow.com/questions/61053649/missing-permission-on-billingaccounts-xxxxxxxxxxxxxxxxxxxxxxxx-billing-resour/67295858#67295858", "keywords": ["bill"]}]}], "links": [{"Id": "1886063274", "CreationDate": "2021-04-28T07:44:26.447", "PostId": "61277763", "RelatedPostId": "61053649", "LinkTypeId": "1"}], "history": [{"Id": "219462556", "PostHistoryTypeId": "2", "PostId": "61277763", "RevisionGUID": "0c6b36d9-bf66-465d-addd-730e64f507d3", "CreationDate": "2020-04-17T17:56:36.523", "UserId": "10015397", "Text": "I have been testing automation with IaC with terraform and am wanting to take these steps from this tutorial [Manageing GCP Projects with Terraform][1] and automate them using version control. \r\n\r\n  [1]: https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform\r\nBut I come across an error thrown \r\n\r\n    err: failed pre-requisites: missing permission on \"billingAccounts/billingaccountid\": billing.resourceAssociations.create\r\n\r\n IAM TF config \r\n\r\n    resource \"google_organization_iam_binding\" \"tfadmin\" {\r\n \r\n\r\n     org_id = var.org_id\r\n      role    = \"roles/billing.resourceAssociations.create\"\r\n    \r\n      members = [\r\n        \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\",\r\n      ]\r\n    }\r\n    \r\n    resource \"google_billing_account_iam_member\" \"binding\" {\r\n      billing_account_id = var.billing_account\r\n      role               = \"roles/billing.user\"\r\n    \r\n      member            =  \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\"\r\n      \r\n   \r\n\r\n     }\r\n    \r\n    resource \"google_service_account\" \"tfadmin\" {\r\n      project      = google_project.project.project_id\r\n      account_id   = \"tfadmin\"\r\n      display_name = \"tfadmin\"\r\n    \r\n    }\r\n    resource \"google_project_iam_binding\" \"project_name\" {\r\n      project = google_project.project.project_id\r\n      role    = \"roles/bill.user\"\r\n    \r\n      members = [\r\n       \"serviceAccount:${google_service_account.tfadmin.email}\",  \r\n        \"user:var.billing_account_user\",\r\n      ]\r\n    }\r\n    \r\n    resource \"google_project_iam_policy\" \"project_id\" {\r\n      project     = google_project.project.project_id\r\n      policy_data = data.google_iam_policy.tfadmin.policy_data\r\n    }\r\n    \r\n    data \"google_iam_policy\" \"tfadmin\" {\r\n      binding {\r\n        role = \"roles/resourcemanager.projectCreator\"\r\n    \r\n        members = [\r\n          \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\",\r\n        ]\r\n      }\r\n    }\r\n\r\nI'm looking to add the service account to create another GCP project with other gcp services (cloudsql, compute engine, app engine) \r\n\r\nIs there something I'm missing are have not found? ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have been testing automation with IaC with terraform and am wanting to take these steps from this tutorial [Manageing GCP Projects with Terraform][1] and automate them using version control. [1]: https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform But I come across an error thrown err: failed pre-requisites: missing permission on \"billingAccounts/billingaccountid\": billing.resourceAssociations.create IAM TF config resource \"google_organization_iam_binding\" \"tfadmin\" { org_id = var.org_id role = \"roles/billing.resourceAssociations.create\" members = [ \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\", ] } resource \"google_billing_account_iam_member\" \"binding\" { billing_account_id = var.billing_account role = \"roles/billing.user\" member = \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\" } resource \"google_service_account\" \"tfadmin\" { project = google_project.project.project_id account_id = \"tfadmin\" display_name = \"tfadmin\" } resource \"google_project_iam_binding\" \"project_name\" { project = google_project.project.project_id role = \"roles/bill.user\" members = [ \"serviceAccount:${google_service_account.tfadmin.email}\", \"user:var.billing_account_user\", ] } resource \"google_project_iam_policy\" \"project_id\" { project = google_project.project.project_id policy_data = data.google_iam_policy.tfadmin.policy_data } data \"google_iam_policy\" \"tfadmin\" { binding { role = \"roles/resourcemanager.projectCreator\" members = [ \"serviceAccount:tfadmin@project_id.iam.gserviceaccount.com\", ] } } ", "keywords": ["bill", "test"]}]}, {"Id": "219462557", "PostHistoryTypeId": "1", "PostId": "61277763", "RevisionGUID": "0c6b36d9-bf66-465d-addd-730e64f507d3", "CreationDate": "2020-04-17T17:56:36.523", "UserId": "10015397", "Text": "Creating automation with Terraform and Cloubuild on GCP", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "219462558", "PostHistoryTypeId": "3", "PostId": "61277763", "RevisionGUID": "0c6b36d9-bf66-465d-addd-730e64f507d3", "CreationDate": "2020-04-17T17:56:36.523", "UserId": "10015397", "Text": "<google-cloud-platform><terraform><google-cloud-build>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "61309755", "PostTypeId": "2", "ParentId": "61277763", "CreationDate": "2020-04-19T18:45:05.877", "Score": "1", "Body": "<p>Cloud Build use, for now, only the default Cloud Build service account <code>&lt;PROJECT_NUMBER&gt;@cloudbuild.gserviceaccount.com</code>. </p>\n\n<p>When you run terraform on Cloud Build, you can forgive to specify an account key. </p>\n\n<pre><code>provider \"google\" {\n//  Useless with Cloud Build\n//  credentials = file(\"${var.CREDENTIAL_FILE}}\")\n  project = var.PROJECT_ID\n  region = \"europe-west1\"\n}\n</code></pre>\n\n<p>Like this, the service account of the environment is used. Here it's Cloud Build, thus the Cloud Build default service account.</p>\n\n<p>Grant the correct role on the Cloud Build default service account and it should work.</p>\n", "OwnerUserId": "11372593", "LastActivityDate": "2020-04-19T18:45:05.877", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "219606766", "PostHistoryTypeId": "2", "PostId": "61309755", "RevisionGUID": "2e32deed-33cd-44dd-b29f-f2b55894a7d6", "CreationDate": "2020-04-19T18:45:05.877", "UserId": "11372593", "Text": "Cloud Build use, for now, only the default Cloud Build service account `<PROJECT_NUMBER>@cloudbuild.gserviceaccount.com`. \r\n\r\nWhen you run terraform on Cloud Build, you can forgive to specify an account key. \r\n```\r\nprovider \"google\" {\r\n//  Useless with Cloud Build\r\n//  credentials = file(\"${var.CREDENTIAL_FILE}}\")\r\n  project = var.PROJECT_ID\r\n  region = \"europe-west1\"\r\n}\r\n```\r\n\r\nLike this, the service account of the environment is used. Here it's Cloud Build, thus the Cloud Build default service account.\r\n\r\nGrant the correct role on the Cloud Build default service account and it should work.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "``` provider \"google\" { // Useless with Cloud Build // credentials = file(\"${var.CREDENTIAL_FILE}}\") project = var.PROJECT_ID region = \"europe-west1\" } ``` ", "keywords": ["provider"]}]}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I have been testing automation with IaC with terraform and am wanting to take these steps from this tutorial Manageing GCP Projects with Terraform and automate them using version control. ", "keywords": ["test"]}]}