{"Id": "54611268", "PostTypeId": "1", "AcceptedAnswerId": "54631955", "CreationDate": "2019-02-09T22:08:59.037", "Score": "3", "ViewCount": "5919", "Body": "<p>Google recommends deleting and creating your own VPC for prod</p>\n\n<p>This resource manages the default VPC: <a href=\"https://www.terraform.io/docs/providers/aws/r/default_vpc.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/providers/aws/r/default_vpc.html</a></p>\n\n<p>But I want to set a different VPC to be the default and delete the auto created one.</p>\n\n<p>How is this possible?</p>\n", "OwnerUserId": "1028270", "LastActivityDate": "2020-03-31T05:53:59.283", "Title": "How do I delete and replace the default GCP vpc with terraform?", "Tags": "<google-cloud-platform><terraform><vpc><terraform-provider-gcp>", "AnswerCount": "4", "CommentCount": "5", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "96018242", "PostId": "54611268", "Score": "0", "Text": "Terraform can't handle deletions of the default VPC and can only manage the existing default VPC by using that resource. You'll need to use the AWS CLI or otherwise to delete the default VPC instead.", "CreationDate": "2019-02-09T23:51:13.533", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "96018567", "PostId": "54611268", "Score": "0", "Text": "gcp im talking about gcp", "CreationDate": "2019-02-10T00:22:33.590", "UserId": "1028270", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "96021522", "PostId": "54611268", "Score": "0", "Text": "I don't believe this is possible with Terraform.", "CreationDate": "2019-02-10T06:32:56.887", "UserId": "8016720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "96024530", "PostId": "54611268", "Score": "0", "Text": "You cannot delete default vpc , you only can create new one and replace it .", "CreationDate": "2019-02-10T11:05:12.383", "UserId": "2450936", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "96026935", "PostId": "54611268", "Score": "0", "Text": "yes i know, im asking specifically about how to do this with terrafrom", "CreationDate": "2019-02-10T13:50:41.037", "UserId": "1028270", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "191312148", "PostHistoryTypeId": "2", "PostId": "54611268", "RevisionGUID": "c4afd7c6-f307-4f51-b7e2-c8aa7c8d082b", "CreationDate": "2019-02-09T22:08:59.037", "UserId": "1028270", "Text": "Google recommends deleting and creating your own VPC for prod\r\n\r\nThis resource manages the default VPC: https://www.terraform.io/docs/providers/aws/r/default_vpc.html\r\n\r\nBut I want to set a different VPC to be the default and delete the auto created one.\r\n\r\nHow is this possible?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "191312149", "PostHistoryTypeId": "1", "PostId": "54611268", "RevisionGUID": "c4afd7c6-f307-4f51-b7e2-c8aa7c8d082b", "CreationDate": "2019-02-09T22:08:59.037", "UserId": "1028270", "Text": "How do I delete and replace the default GCP vpc with terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "191312150", "PostHistoryTypeId": "3", "PostId": "54611268", "RevisionGUID": "c4afd7c6-f307-4f51-b7e2-c8aa7c8d082b", "CreationDate": "2019-02-09T22:08:59.037", "UserId": "1028270", "Text": "<google-cloud-platform><terraform><vpc><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "54631955", "PostTypeId": "2", "ParentId": "54611268", "CreationDate": "2019-02-11T13:46:15.157", "Score": "4", "Body": "<p>The <code>default</code> network does not have any specific configuration that makes it be the default network. It is just the one network that is always created together with a new project, and whenever a network is not specified (for instance, when deploying a GAE flex application), the network used will be the one with the name <code>default</code>. When you create a project with Terraform, you can specify <code>auto_network_creation = \"false\"</code>.</p>\n\n<p>However, this will not prevent the creation of the default network, it will just delete it before the project is fully created. This means that, during the Terraform creation, it is not possible to create another network called <code>default</code>. That must be done after the original default network is created, hence, after the project creation.</p>\n\n<p>You can try creating projects with Terraform using <a href=\"https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform\" rel=\"nofollow noreferrer\">this tutorial</a>.\nThe next snippet is part of the tutorial, in which I included the line to delete the default network on project creation.</p>\n\n<pre class=\"lang-tf prettyprint-override\"><code>variable \"project_name\" {}\nvariable \"billing_account\" {}\nvariable \"org_id\" {}\nvariable \"region\" {}\n\nprovider \"google\" {\n region = \"${var.region}\"\n}\n\nresource \"random_id\" \"id\" {\n byte_length = 4\n prefix      = \"${var.project_name}-\"\n}\n\nresource \"google_project\" \"project\" {\n name            = \"${var.project_name}\"\n project_id      = \"${random_id.id.hex}\"\n billing_account = \"${var.billing_account}\"\n org_id          = \"${var.org_id}\"\n auto_create_network = \"false\" //This is supposed to delete default network on project creation\n}\n\nresource \"google_project_services\" \"project\" {\n project = \"${google_project.project.project_id}\"\n services = [\n   \"compute.googleapis.com\"\n ]\n}\n\noutput \"project_id\" {\n value = \"${google_project.project.project_id}\"\n}\n</code></pre>\n\n<p>Nonetheless, I have tried it myself and the default network was still there. </p>\n", "OwnerUserId": "9745709", "LastActivityDate": "2019-02-11T13:46:15.157", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "96057390", "PostId": "54631955", "Score": "0", "Text": "The default network is used if you do not explicitly specify a network. How do I set a new network as the default?", "CreationDate": "2019-02-11T14:20:08.907", "UserId": "1028270", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "96062225", "PostId": "54631955", "Score": "1", "Text": "As mentioned above, the network under the name default will be used as such. That is, if you delete the original default network and create your own, if you give it the name default, it will be the pone used whenever no network is specified.", "CreationDate": "2019-02-11T16:33:31.973", "UserId": "9745709", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "191398202", "PostHistoryTypeId": "2", "PostId": "54631955", "RevisionGUID": "0e55521c-eb8e-493a-ab24-8e2a05335f78", "CreationDate": "2019-02-11T13:46:15.157", "UserId": "9745709", "Text": "The `default` network does not have any specific configuration that makes it be the default network. It is just the one network that is always created together with a new project, and whenever a network is not specified (for instance, when deploying a GAE flex application), the network used will be the one with the name `default`. When you create a project with Terraform, you can specify `auto_network_creation = \"false\"`.\r\n\r\nHowever, this will not prevent the creation of the default network, it will just delete it before the project is fully created. This means that, during the Terraform creation, it is not possible to create another network called `default`. That must be done after the original default network is created, hence, after the project creation.\r\n\r\nYou can try creating projects with Terraform using [this tutorial][1].\r\nThe next snippet is part of the tutorial, in which I included the line to delete the default network on project creation.\r\n\r\n<!-- begin snippet: terraform hide: false console: false babel: false -->\r\n\r\n<!-- language: lang-tf -->\r\n\r\n    variable \"project_name\" {}\r\n    variable \"billing_account\" {}\r\n    variable \"org_id\" {}\r\n    variable \"region\" {}\r\n\r\n    provider \"google\" {\r\n     region = \"${var.region}\"\r\n    }\r\n\r\n    resource \"random_id\" \"id\" {\r\n     byte_length = 4\r\n     prefix      = \"${var.project_name}-\"\r\n    }\r\n\r\n    resource \"google_project\" \"project\" {\r\n     name            = \"${var.project_name}\"\r\n     project_id      = \"${random_id.id.hex}\"\r\n     billing_account = \"${var.billing_account}\"\r\n     org_id          = \"${var.org_id}\"\r\n     auto_create_network = \"false\" //This is supposed to delete default network on project creation\r\n    }\r\n\r\n    resource \"google_project_services\" \"project\" {\r\n     project = \"${google_project.project.project_id}\"\r\n     services = [\r\n       \"compute.googleapis.com\"\r\n     ]\r\n    }\r\n\r\n    output \"project_id\" {\r\n     value = \"${google_project.project.project_id}\"\r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\nNonetheless, I have tried it myself and the default network was still there. \r\n\r\n  [1]: https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It is just the one network that is always created together with a new project, and whenever a network is not specified (for instance, when deploying a GAE flex application), the network used will be the one with the name `default`. ", "keywords": ["instance"]}, {"source": "Text", "text": "variable \"project_name\" {} variable \"billing_account\" {} variable \"org_id\" {} variable \"region\" {} provider \"google\" { region = \"${var.region}\" } resource \"random_id\" \"id\" { byte_length = 4 prefix = \"${var.project_name}-\" } resource \"google_project\" \"project\" { name = \"${var.project_name}\" project_id = \"${random_id.id.hex}\" billing_account = \"${var.billing_account}\" org_id = \"${var.org_id}\" auto_create_network = \"false\" //This is supposed to delete default network on project creation } resource \"google_project_services\" \"project\" { project = \"${google_project.project.project_id}\" services = [ \"compute.googleapis.com\" ] } output \"project_id\" { value = \"${google_project.project.project_id}\" ", "keywords": ["bill", "provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "It is just the one network that is always created together with a new project, and whenever a network is not specified (for instance, when deploying a GAE flex application), the network used will be the one with the name default. ", "keywords": ["instance"]}]}, {"Id": "54629625", "PostTypeId": "2", "ParentId": "54611268", "CreationDate": "2019-02-11T11:30:19.397", "Score": "1", "Body": "<p>As in Terraform you describe desired state of your configuration it is not possible to implicit send &quot;destroy request&quot; to a resource that is not managed by Terraform.</p>\n<p>However you could try <a href=\"https://www.terraform.io/docs/import/usage.html\" rel=\"nofollow noreferrer\">importing</a> it firstly then it will be managed by Terraform and as you do not include it in your *.tf files the default subnet should be deleted during <code>terraform apply</code> step.</p>\n", "OwnerUserId": "9606513", "LastEditorUserId": "-1", "LastEditDate": "2020-06-20T09:12:55.060", "LastActivityDate": "2019-02-11T11:44:19.347", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "191388817", "PostHistoryTypeId": "2", "PostId": "54629625", "RevisionGUID": "c6256777-8a50-4bf1-abbc-57068a07819a", "CreationDate": "2019-02-11T11:30:19.397", "UserId": "9606513", "Text": "You could try [importing][1] it firstly then it will be managed by Terraform and as you do not include it in your *.tf files the default subnet should be deleted during `terraform apply` step.\r\n  [1]: https://www.terraform.io/docs/import/usage.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "191389794", "PostHistoryTypeId": "5", "PostId": "54629625", "RevisionGUID": "60ea1122-5403-49c9-9a17-aa59220a2a0b", "CreationDate": "2019-02-11T11:44:19.347", "UserId": "9606513", "Comment": "added 178 characters in body", "Text": "As in Terraform you describe desired state of your configuration it is not possible to implicit send \"destroy request\" to a resource that is not managed by Terraform.\r\n\r\nHowever you could try [importing][1] it firstly then it will be managed by Terraform and as you do not include it in your *.tf files the default subnet should be deleted during `terraform apply` step.\r\n  [1]: https://www.terraform.io/docs/import/usage.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "224833097", "PostHistoryTypeId": "5", "PostId": "54629625", "RevisionGUID": "d99a32b7-e1b3-4354-8860-2dfd30d1ae05", "CreationDate": "2020-06-20T09:12:55.060", "UserId": "-1", "Comment": "Commonmark migration", "Text": "As in Terraform you describe desired state of your configuration it is not possible to implicit send \"destroy request\" to a resource that is not managed by Terraform.\n\nHowever you could try [importing][1] it firstly then it will be managed by Terraform and as you do not include it in your *.tf files the default subnet should be deleted during `terraform apply` step.\n\n  [1]: https://www.terraform.io/docs/import/usage.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "58900002", "PostTypeId": "2", "ParentId": "54611268", "CreationDate": "2019-11-17T11:30:16.073", "Score": "7", "Body": "<p>You can avoid/skip the default network creation by setting an <strong>Organization Policy Constraint</strong>.</p>\n\n<pre><code>gcloud  resource-manager org-policies enable-enforce \\\n   constraints/compute.skipDefaultNetworkCreation \\\n   --organization ORGANIZATION_ID\n</code></pre>\n\n<p>more details in <a href=\"https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints\" rel=\"noreferrer\">Organization Policy Constraints</a> and <a href=\"https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints#boolean-constraint\" rel=\"noreferrer\">Using boolean constraints in organization policy</a></p>\n", "OwnerDisplayName": "user8908370", "LastEditorDisplayName": "user8908370", "LastEditDate": "2019-11-17T11:37:57.630", "LastActivityDate": "2019-11-17T11:37:57.630", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "209381327", "PostHistoryTypeId": "2", "PostId": "58900002", "RevisionGUID": "124525de-ce14-4bbf-97fc-2f3be1096644", "CreationDate": "2019-11-17T11:30:16.073", "UserDisplayName": "user8908370", "Text": "You can avoid/skip the default network creation by setting an **Organization Policy Constraint**.\r\n\r\nmore details in [Organization Policy Constraints][1] and [Using boolean constraints in organization policy][2]\r\n\r\n\r\n  [1]: https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints\r\n  [2]: https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints#boolean-constraint", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can avoid/skip the default network creation by setting an **Organization Policy Constraint**. ", "keywords": ["policy"]}, {"source": "Text", "text": "more details in [Organization Policy Constraints][1] and [Using boolean constraints in organization policy][2] [1]: https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints [2]: https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints#boolean-constraint", "keywords": ["policy"]}]}, {"Id": "209381532", "PostHistoryTypeId": "5", "PostId": "58900002", "RevisionGUID": "6d12fe58-2fb5-44e9-8f3f-2d5ac396007e", "CreationDate": "2019-11-17T11:37:57.630", "UserDisplayName": "user8908370", "Comment": "added 160 characters in body", "Text": "You can avoid/skip the default network creation by setting an **Organization Policy Constraint**.\r\n\r\n    gcloud  resource-manager org-policies enable-enforce \\\r\n       constraints/compute.skipDefaultNetworkCreation \\\r\n       --organization ORGANIZATION_ID\r\n\r\n\r\nmore details in [Organization Policy Constraints][1] and [Using boolean constraints in organization policy][2]\r\n\r\n\r\n  [1]: https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints\r\n  [2]: https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints#boolean-constraint", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can avoid/skip the default network creation by setting an **Organization Policy Constraint**. gcloud resource-manager org-policies enable-enforce \\ constraints/compute.skipDefaultNetworkCreation \\ --organization ORGANIZATION_ID more details in [Organization Policy Constraints][1] and [Using boolean constraints in organization policy][2] [1]: https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints [2]: https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints#boolean-constraint", "keywords": ["policy"]}]}], "filtered-sentences": [{"source": "Body", "text": "You can avoid/skip the default network creation by setting an Organization Policy Constraint. ", "keywords": ["policy"]}, {"source": "Body", "text": "more details in Organization Policy Constraints and Using boolean constraints in organization policy", "keywords": ["policy"]}]}, {"Id": "60943996", "PostTypeId": "2", "ParentId": "54611268", "CreationDate": "2020-03-31T05:30:03.723", "Score": "1", "Body": "<p>Setting property auto_create_network = \"false\" and mentioning a billing account ID, while creating a GCP project as in the below code snippet, ensures that default network gets deleted. </p>\n\n<pre><code>resource \"google_project\" \"project\" {\n    name            = \"test\"\n    project_id      = \"test-523\"\n    billing_account = \"xxxxx\"\n    auto_create_network = \"false\"\n}\n</code></pre>\n", "OwnerUserId": "13090457", "LastEditorUserId": "13090457", "LastEditDate": "2020-03-31T05:53:59.283", "LastActivityDate": "2020-03-31T05:53:59.283", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "218059889", "PostHistoryTypeId": "2", "PostId": "60943996", "RevisionGUID": "60923c3d-bbf4-4aca-bdc7-6f5263f2bccd", "CreationDate": "2020-03-31T05:30:03.723", "UserId": "13090457", "Text": "If a project is under an organization, we could go for organization policy constraints for skipping default network creation. But for projects with no organization, we can't use that method. \r\n\r\nIf setting property auto_create_network = \"false\", and not mentioning any billing account ID, while creating a GCP project, [it throws this error.][1] This is because, Compute Engine API for deleting default network is not enabled.\r\n\r\nWhere as, if we associate a billing account with the project, we could see that Compute Engine API gets enabled by its own and the default network too gets created. However, the deletion doesn't occur. If Terraform doesn't have the feature to delete the network, why do we get the error mentioned above, if billing account is not associated. Any thoughts on this?\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/BoaWl.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If a project is under an organization, we could go for organization policy constraints for skipping default network creation. ", "keywords": ["policy"]}, {"source": "Text", "text": "If setting property auto_create_network = \"false\", and not mentioning any billing account ID, while creating a GCP project, [it throws this error.][1] ", "keywords": ["bill"]}, {"source": "Text", "text": "Where as, if we associate a billing account with the project, we could see that Compute Engine API gets enabled by its own and the default network too gets created. ", "keywords": ["bill"]}, {"source": "Text", "text": "If Terraform doesn't have the feature to delete the network, why do we get the error mentioned above, if billing account is not associated. ", "keywords": ["bill", "feature"]}]}, {"Id": "218060701", "PostHistoryTypeId": "12", "PostId": "60943996", "RevisionGUID": "04287567-752d-4a92-85ac-3f709f0f4fb7", "CreationDate": "2020-03-31T05:52:11.720", "UserId": "13090457", "Comment": "via Vote", "Text": "{\"Voters\":[{\"Id\":13090457,\"DisplayName\":\"Gayathri K S\"}]}", "filtered-sentences": []}, {"Id": "218060718", "PostHistoryTypeId": "13", "PostId": "60943996", "RevisionGUID": "5a15bab0-f889-4f5c-916c-7051084e0b5b", "CreationDate": "2020-03-31T05:52:26.103", "UserId": "13090457", "Text": "{\"Voters\":[{\"Id\":13090457,\"DisplayName\":\"Gayathri K S\"}]}", "filtered-sentences": []}, {"Id": "218060771", "PostHistoryTypeId": "5", "PostId": "60943996", "RevisionGUID": "cb0bc520-79e0-4042-ac1f-3318a6f71a78", "CreationDate": "2020-03-31T05:53:59.283", "UserId": "13090457", "Comment": "deleted 725 characters in body; added 270 characters in body", "Text": "Setting property auto_create_network = \"false\" and mentioning a billing account ID, while creating a GCP project as in the below code snippet, ensures that default network gets deleted. \r\n\r\n    resource \"google_project\" \"project\" {\r\n        name            = \"test\"\r\n        project_id      = \"test-523\"\r\n        billing_account = \"xxxxx\"\r\n        auto_create_network = \"false\"\r\n    }", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Setting property auto_create_network = \"false\" and mentioning a billing account ID, while creating a GCP project as in the below code snippet, ensures that default network gets deleted. resource \"google_project\" \"project\" { name = \"test\" project_id = \"test-523\" billing_account = \"xxxxx\" auto_create_network = \"false\" }", "keywords": ["bill", "test"]}]}], "filtered-sentences": [{"source": "Body", "text": "Setting property auto_create_network = \"false\" and mentioning a billing account ID, while creating a GCP project as in the below code snippet, ensures that default network gets deleted.", "keywords": ["bill"]}]}], "contains-topic": true, "filtered-sentences": []}