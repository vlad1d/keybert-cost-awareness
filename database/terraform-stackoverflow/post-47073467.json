{"Id": "47073467", "PostTypeId": "1", "CreationDate": "2017-11-02T10:50:44.353", "Score": "7", "ViewCount": "2346", "Body": "<p>I have terraform templates created for non-China AWS and now would like to adapt them for the China (cn-north-1) region. Simply changing the region to cn-north-1 isn't hitting the correct AWS APIs in the China region. </p>\n\n<p>How do I configure terraform to use the China region? The APIs are also older in China compared to the non-China AWS APIs; how compatible is terraform with the AWS APIs in China?</p>\n\n<p>Thanks for any help!</p>\n", "OwnerUserId": "8874079", "LastActivityDate": "2017-11-06T04:19:24.203", "Title": "How to Configure Terraform for AWS China cn-north-1", "Tags": "<amazon-web-services><terraform>", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "159696566", "PostHistoryTypeId": "2", "PostId": "47073467", "RevisionGUID": "a1d6ba3d-c753-47ee-b945-ac9522b8e8d6", "CreationDate": "2017-11-02T10:50:44.353", "UserId": "8874079", "Text": "I have terraform templates created for non-China AWS and now would like to adapt them for the China (cn-north-1) region. Simply changing the region to cn-north-1 isn't hitting the correct AWS APIs in the China region. \r\n\r\nHow do I configure terraform to use the China region? The APIs are also older in China compared to the non-China AWS APIs; how compatible is terraform with the AWS APIs in China?\r\n\r\nThanks for any help!", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Simply changing the region to cn-north-1 isn't hitting the correct AWS APIs in the China region. ", "keywords": ["change"]}]}, {"Id": "159696567", "PostHistoryTypeId": "1", "PostId": "47073467", "RevisionGUID": "a1d6ba3d-c753-47ee-b945-ac9522b8e8d6", "CreationDate": "2017-11-02T10:50:44.353", "UserId": "8874079", "Text": "How to Configure Terraform for AWS China cn-north-1", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "159696568", "PostHistoryTypeId": "3", "PostId": "47073467", "RevisionGUID": "a1d6ba3d-c753-47ee-b945-ac9522b8e8d6", "CreationDate": "2017-11-02T10:50:44.353", "UserId": "8874079", "Text": "<amazon-web-services><terraform>", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "answers": [{"Id": "47129680", "PostTypeId": "2", "ParentId": "47073467", "CreationDate": "2017-11-06T04:19:24.203", "Score": "0", "Body": "<p>have you set <code>aws_region</code> in your TF file? <a href=\"https://www.terraform.io/docs/providers/aws/d/region.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/providers/aws/d/region.html</a></p>\n", "OwnerUserId": "8079754", "LastActivityDate": "2017-11-06T04:19:24.203", "CommentCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "159936540", "PostHistoryTypeId": "2", "PostId": "47129680", "RevisionGUID": "a5b56906-6ba8-4769-be7f-b93c41c99101", "CreationDate": "2017-11-06T04:19:24.203", "UserId": "8079754", "Text": "have you set `aws_region` in your TF file? https://www.terraform.io/docs/providers/aws/d/region.html", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "47115948", "PostTypeId": "2", "ParentId": "47073467", "CreationDate": "2017-11-04T21:47:26.297", "Score": "5", "Body": "<p>One thing that is easy to miss when porting configuration to <code>cn-north-1</code> is the correct <a href=\"http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#genref-arns\" rel=\"noreferrer\">AWS partition</a> in resource ARN, that is, all your ARN must begin with <code>arn:aws-cn:...</code> instead of <code>arn:aws:...</code>. You may find this <a href=\"https://www.terraform.io/docs/providers/aws/d/partition.html\" rel=\"noreferrer\">data source</a> helpful if you want to write manifests applicable to both CN and non-CN regions.</p>\n\n<p>Another thing to pay attention to is specifying the correct service endpoints, e.g. in IAM trust policies. See the full list <a href=\"http://docs.amazonaws.cn/en_us/general/latest/gr/rande.html#cnnorth_region\" rel=\"noreferrer\">here</a>.</p>\n\n<p>This is probably it, as far as terraform is concerned, although one more subtlety that's useful to keep in mind is the <a href=\"https://github.com/s3tools/s3cmd/wiki/Common-known-issues-and-their-solutions#7-problem-s3cmd-not-working-with-a-bucket-in-the-cn-north-1-region\" rel=\"noreferrer\">s3cmd configuration</a>, should you require it.</p>\n", "OwnerUserId": "1869360", "LastActivityDate": "2017-11-04T21:47:26.297", "CommentCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "159878726", "PostHistoryTypeId": "2", "PostId": "47115948", "RevisionGUID": "230cfa88-9400-406e-b1ba-b211a180e228", "CreationDate": "2017-11-04T21:47:26.297", "UserId": "1869360", "Text": "One thing that is easy to miss when porting configuration to `cn-north-1` is the correct [AWS partition][1] in resource ARN, that is, all your ARN must begin with `arn:aws-cn:...` instead of `arn:aws:...`. You may find this [data source][2] helpful if you want to write manifests applicable to both CN and non-CN regions.\r\n\r\nAnother thing to pay attention to is specifying the correct service endpoints, e.g. in IAM trust policies. See the full list [here][3].\r\n\r\nThis is probably it, as far as terraform is concerned, although one more subtlety that's useful to keep in mind is the [s3cmd configuration][4], should you require it.\r\n\r\n\r\n  [1]: http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#genref-arns\r\n  [2]: https://www.terraform.io/docs/providers/aws/d/partition.html\r\n  [3]: http://docs.amazonaws.cn/en_us/general/latest/gr/rande.html#cnnorth_region\r\n  [4]: https://github.com/s3tools/s3cmd/wiki/Common-known-issues-and-their-solutions#7-problem-s3cmd-not-working-with-a-bucket-in-the-cn-north-1-region", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Another thing to pay attention to is specifying the correct service endpoints, e.g. in IAM trust policies. ", "keywords": ["pay"]}]}], "filtered-sentences": [{"source": "Body", "text": "Another thing to pay attention to is specifying the correct service endpoints, e.g. in IAM trust policies. ", "keywords": ["pay"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "Simply changing the region to cn-north-1 isn't hitting the correct AWS APIs in the China region. ", "keywords": ["change"]}]}