{"Id": "75785936", "PostTypeId": "1", "AcceptedAnswerId": "75813726", "CreationDate": "2023-03-20T01:29:34.073", "Score": "0", "ViewCount": "372", "Body": "<p>I need to get access to a Function App staging slot in Terraform.</p>\n<p>I can get it for its production slot:</p>\n<pre><code>data &quot;azurerm_linux_function_app&quot; &quot;my_application&quot; {\n  name                = &lt;app_name&gt;\n  resource_group_name = &lt;resource_group_name&gt;\n}\n\nresource &quot;azurerm_role_assignment&quot; &quot;role_assignment&quot; {\n  scope               = &lt;scope&gt;\n  role_definition_name = &lt;role_name&gt;\n  principal_id        = data.azurerm_linux_function_app.my_application.identity.0.principal_id\n}\n</code></pre>\n<p>For the staging slot, I would have expected to be able to do something similar:</p>\n<pre><code>data &quot;azurerm_linux_function_app_slot&quot; &quot;my_app_staging&quot; {\n  name                = &lt;app_name&gt;\n  resource_group_name = &lt;resource_group_name&gt;\n  slot_name           = &quot;staging&quot;\n}\n\n\nresource &quot;azurerm_role_assignment&quot; &quot;staging_role_assignment&quot; {\n  scope               = &lt;scope&gt;\n  role_definition_name = &lt;role_name&gt;\n  principal_id        = data.azurerm_linux_function_app_slot.my_app_staging.identity.0.principal_id\n}\n</code></pre>\n<p>However I get the following error:</p>\n<blockquote>\n<p>The provider hashicorp/azurerm does not support data source\n&quot;azurerm_linux_function_app_slot&quot;.</p>\n</blockquote>\n<p><strong>Question</strong></p>\n<p>How to get the <code>principal_id</code> of a Function App's Staging slot in Terraform?</p>\n", "OwnerUserId": "4256749", "LastEditorUserId": "248823", "LastEditDate": "2023-03-20T01:34:15.140", "LastActivityDate": "2023-03-22T14:43:20.797", "Title": "How to get the principal_id of a Function App staging slot in Terraform?", "Tags": "<azure><terraform><terraform-provider-azure>", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "290009131", "PostHistoryTypeId": "2", "PostId": "75785936", "RevisionGUID": "d21e3932-049e-4546-b44c-9bb20b7c8999", "CreationDate": "2023-03-20T01:29:34.073", "UserId": "4256749", "Text": "I need to get access to a Function App staging slot in Terraform.\r\n\r\nI can get it for its production slot:\r\n\r\n    data \"azurerm_linux_function_app\" \"my_application\" {\r\n      name                = <app_name>\r\n      resource_group_name = <resource_group_name>\r\n    }\r\n    \r\n    resource \"azurerm_role_assignment\" \"role_assignment\" {\r\n      scope               = <scope>\r\n      role_definition_name = <role_name>\r\n      principal_id        = data.azurerm_linux_function_app.my_application.identity.0.principal_id\r\n    }\r\n\r\nFor the staging slot, I would have expected to be able to do something similar:\r\n\r\n    data \"azurerm_linux_function_app_slot\" \"my_app_staging\" {\r\n      name                = <app_name>\r\n      resource_group_name = <resource_group_name>\r\n      slot_name           = \"staging\"\r\n    }\r\n    \r\n    \r\n    resource \"azurerm_role_assignment\" \"staging_role_assignment\" {\r\n      scope               = <scope>\r\n      role_definition_name = <role_name>\r\n      principal_id        = data.azurerm_linux_function_app_slot.my_app_staging.identity.0.principal_id\r\n    }\r\n\r\nHowever I get the following error:\r\n\r\n> The provider hashicorp/azurerm does not support data source\r\n> \"azurerm_linux_function_app_slot\".\r\n\r\n**Question**\r\n\r\nHow to get the `principal_id` of a Function App's Staging slot in Terraform?\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I can get it for its production slot: data \"azurerm_linux_function_app\" \"my_application\" { name = resource_group_name = } resource \"azurerm_role_assignment\" \"role_assignment\" { scope = role_definition_name = principal_id = data.azurerm_linux_function_app.my_application.identity.0.principal_id } For the staging slot, I would have expected to be able to do something similar: data \"azurerm_linux_function_app_slot\" \"my_app_staging\" { name = resource_group_name = slot_name = \"staging\" } resource \"azurerm_role_assignment\" \"staging_role_assignment\" { scope = role_definition_name = principal_id = data.azurerm_linux_function_app_slot.my_app_staging.identity.0.principal_id } However I get the following error: > The provider hashicorp/azurerm does not support data source > \"azurerm_linux_function_app_slot\"", "keywords": ["provider"]}]}, {"Id": "290009133", "PostHistoryTypeId": "1", "PostId": "75785936", "RevisionGUID": "d21e3932-049e-4546-b44c-9bb20b7c8999", "CreationDate": "2023-03-20T01:29:34.073", "UserId": "4256749", "Text": "How to get the principal_id of a Function App staging slot in Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "290009134", "PostHistoryTypeId": "3", "PostId": "75785936", "RevisionGUID": "d21e3932-049e-4546-b44c-9bb20b7c8999", "CreationDate": "2023-03-20T01:29:34.073", "UserId": "4256749", "Text": "<terraform><terraform-provider-azure>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "290009252", "PostHistoryTypeId": "6", "PostId": "75785936", "RevisionGUID": "6ccdbdf9-1e62-4067-8be0-b1276f38e53a", "CreationDate": "2023-03-20T01:34:15.140", "UserId": "248823", "Comment": "edited tags", "Text": "<azure><terraform><terraform-provider-azure>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "75801249", "PostTypeId": "2", "ParentId": "75785936", "CreationDate": "2023-03-21T12:31:15.557", "Score": "1", "Body": "<p>There is no Support data source for &quot;azurerm_linux_function_app_slot&quot;.</p>\n<p>these are the available data sources</p>\n<p><a href=\"https://i.stack.imgur.com/2bU4J.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2bU4J.png\" alt=\"enter image description here\" /></a></p>\n<p>You can try to import the Function Apps Deployment Slots using the <code>resource id</code>, e.g</p>\n<pre><code>terraform import azurerm_linux_function_app_slot.example &quot;/subscriptions/12345678-1234-9876-4563-123456789012/resourceGroups/resGroup1/providers/Microsoft.Web/sites/site1/slots/slot1&quot; \n</code></pre>\n<p>Source: <a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app_slot\" rel=\"nofollow noreferrer\">https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app_slot</a></p>\n<p>Hope this helps!</p>\n", "OwnerUserId": "2620025", "LastActivityDate": "2023-03-21T12:31:15.557", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "290096454", "PostHistoryTypeId": "2", "PostId": "75801249", "RevisionGUID": "45d5152c-b27b-4a41-a179-3117591a5221", "CreationDate": "2023-03-21T12:31:15.557", "UserId": "2620025", "Text": "There is no Support data source for \"azurerm_linux_function_app_slot\". \r\n\r\nthese are the available data sources \r\n\r\n[![enter image description here][1]][1]\r\n\r\nYou can try to import the Function Apps Deployment Slots using the `resource id`, e.g\r\n\r\n    terraform import azurerm_linux_function_app_slot.example \"/subscriptions/12345678-1234-9876-4563-123456789012/resourceGroups/resGroup1/providers/Microsoft.Web/sites/site1/slots/slot1\" \r\n\r\nSource: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app_slot\r\n\r\nHope this helps!\r\n\r\n  [1]: https://i.stack.imgur.com/2bU4J.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "75813726", "PostTypeId": "2", "ParentId": "75785936", "CreationDate": "2023-03-22T14:43:20.797", "Score": "1", "Body": "<p>That data source is not implemented in the provider as of 3.48.0.</p>\n<p>Alternatively, you could use User Assigned identity and use the data source for User Assigned Identity.</p>\n<p><a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/user_assigned_identity\" rel=\"nofollow noreferrer\">https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/user_assigned_identity</a></p>\n", "OwnerUserId": "5104117", "LastActivityDate": "2023-03-22T14:43:20.797", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133781429", "PostId": "75813726", "Score": "1", "Text": "I believe this is the most appropriate answer. User-Assigned identity is a perfectly good solution. However I ended up using App Registration instead because I had plans to run the services in Docker + AKS and App Registration gave me more flexibility (at the expense of managing the secrets).", "CreationDate": "2023-03-25T18:23:43.023", "UserId": "4256749", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "However I ended up using App Registration instead because I had plans to run the services in Docker + AKS and App Registration gave me more flexibility (at the expense of managing the secrets).", "keywords": ["expense"]}]}, {"Id": "133784821", "PostId": "75813726", "Score": "0", "Text": "Thanks. Glad you found a solution. Any reason why you couldn't use Managed ID with AKS and opted for SP? Genuinely curious.", "CreationDate": "2023-03-26T03:45:18.740", "UserId": "5104117", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "133790542", "PostId": "75813726", "Score": "1", "Text": "I understand that Managed ID can be tied to the resource itself (System Assigned) or to Azure as a Host (User Assigned). For instance, we have encountered a situation where Terraform had to recreate our resources (the migration of their Function App resource for .net7) thus recreating the system assigned ID which caused problems in our deployments regarding the permissions. App Registration seems to give us the flexibility to run the app potentially anywhere (in AKS but elsewhere as well)...", "CreationDate": "2023-03-26T16:50:00.020", "UserId": "4256749", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For instance, we have encountered a situation where Terraform had to recreate our resources (the migration of their Function App resource for .net7) thus recreating the system assigned ID which caused problems in our deployments regarding the permissions. ", "keywords": ["instance"]}]}], "history": [{"Id": "290166576", "PostHistoryTypeId": "2", "PostId": "75813726", "RevisionGUID": "d8f4e6ea-fb79-4a23-8acb-cf0079a32c02", "CreationDate": "2023-03-22T14:43:20.797", "UserId": "5104117", "Text": "That data source is not implemented in the provider as of 3.48.0.\r\n\r\nAlternatively, you could use User Assigned identity and use the data source for User Assigned Identity.\r\n\r\nhttps://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/user_assigned_identity\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "That data source is not implemented in the provider as of 3.48.0. ", "keywords": ["provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "That data source is not implemented in the provider as of 3.48.0. ", "keywords": ["provider"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I can get it for its production slot: For the staging slot, I would have expected to be able to do something similar: However I get the following error: The provider hashicorp/azurerm does not support data source \"azurerm_linux_function_app_slot\". ", "keywords": ["provider"]}]}