{"Id": "74350184", "PostTypeId": "1", "CreationDate": "2022-11-07T16:57:44.007", "Score": "1", "ViewCount": "203", "Body": "<p>I have a project in GCP and billing account connected to it. I want to create budget and set some alarms for obvious reasons. I want to manage it with Terraform. Unfortunately, I got errors telling me, that I cannot perform certain actions, even though GCP docs for roles and permissions tell me that I should be able to.</p>\n<p>I created ServiceAccount to manage my Terraform. Here is the code:</p>\n<pre><code>variable &quot;billing_account&quot; {\n  type        = string\n}\n\nresource &quot;google_project&quot; &quot;A&quot; {\n  name            = &quot;A&quot;\n  project_id      = local.project\n  billing_account = var.billing_account\n  lifecycle {\n    prevent_destroy = true\n  }\n}\n\n\nresource &quot;google_project_service&quot; &quot;A-service&quot; {\n  project                    = google_project.A.project_id\n  disable_dependent_services = true\n  for_each                   = toset([&quot;cloudresourcemanager.googleapis.com&quot;, &quot;iam.googleapis.com&quot;, &quot;serviceusage.googleapis.com&quot;, &quot;cloudbilling.googleapis.com&quot;])\n  service                    = each.value\n}\n\nresource &quot;google_project_iam_member&quot; &quot;A-editor-member&quot; {\n  project = google_project.A.project_id\n  role    = &quot;roles/editor&quot;\n  member  = &quot;serviceAccount:${google_service_account.A-service.email}&quot;\n}\n\nresource &quot;google_project_iam_member&quot; &quot;A-sa-member&quot; {\n  project    = google_project.A.project_id\n  for_each   = toset([&quot;roles/iam.securityAdmin&quot;, &quot;roles/container.admin&quot;, &quot;roles/storage.admin&quot;])\n  role       = each.value\n  member     = &quot;serviceAccount:${google_service_account.A-service.email}&quot;\n}\n\n</code></pre>\n<p>So far, everything worked fine. The problem occurred, when I want to add <code>roles/billing.admin</code> as another role to my ServiceAccount</p>\n<pre><code>resource &quot;google_billing_account_iam_member&quot; &quot;A-billing-manager&quot; {\n  billing_account_id = var.billing_account\n  role               = &quot;roles/billing.admin&quot;\n  member             = &quot;serviceAccount:${google_service_account.A-service.email}&quot;\n}\n\n</code></pre>\n<p>After applying this code I get: <code>Error: Error retrieving IAM policy for billing account &quot;XYZ&quot;: googleapi: Error 403: The caller does not have permission, forbidden</code>. Caller should have permission, because it is <code>BillingAccountAdministrator</code> (also I checked with all other roles given in the same moment eg.<code>BillingAccountViewer</code>)</p>\n<p>Anyway, I decided to abandon creating it with ServiceAccount for now and do it with my UserAccount.</p>\n<pre><code>resource &quot;google_billing_budget&quot; &quot;budget&quot; {\n  billing_account = var.billing_account\n  display_name = &quot;A-budget&quot;\n\n  amount {\n    specified_amount {\n      currency_code = &quot;USD&quot;\n      units = 50\n    }\n  }\n\n  for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER))\n\n  threshold_rules {\n    threshold_percent = each.value\n  }\n}\n</code></pre>\n<p>After applying it, I got: <code>Error: Error creating Budget: googleapi: Error 403: The caller does not have permission</code></p>\n<p>The caller of <code>terraform apply</code> is my UserAccount, which is both owner of the project and billing account administrator (and more...).</p>\n<p>Can you please tell what can be wrong with my UserAccount? The problem must be on my site since its basic functionality and it cannot be bugged</p>\n<p>Thank you in advance!</p>\n", "OwnerUserId": "20441864", "LastEditorUserId": "20441864", "LastEditDate": "2022-11-07T19:19:08.103", "LastActivityDate": "2022-11-07T19:19:08.103", "Title": "GCP Billing Account Administrator cannot perform actions it is supposed to - using Terraform", "Tags": "<google-cloud-platform><terraform><google-cloud-iam>", "AnswerCount": "0", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "281710620", "PostHistoryTypeId": "2", "PostId": "74350184", "RevisionGUID": "70231ca8-6678-49d0-8248-e020730c45a6", "CreationDate": "2022-11-07T16:57:44.007", "UserId": "20441864", "Text": "I have a project in GCP and billing account connected to it. I want to create budget and set some alarms for obvious reasons. I want to manage it with Terraform. Unfortunately, I got errors telling me I cannot perform certain actions, even though GCP docs for roles and permissions tell me that I should be able.\r\n\r\nI created ServiceAccount to manage my terraform. Here is the code:\r\n\r\n```\r\nvariable \"billing_account\" {\r\n  type        = string\r\n}\r\n\r\nresource \"google_project\" \"A\" {\r\n  name            = \"A\"\r\n  project_id      = local.project\r\n  billing_account = var.billing_account\r\n  lifecycle {\r\n    prevent_destroy = true\r\n  }\r\n}\r\n\r\n\r\nresource \"google_project_service\" \"A-service\" {\r\n  project                    = google_project.A.project_id\r\n  disable_dependent_services = true\r\n  for_each                   = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"])\r\n  service                    = each.value\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-editor-member\" {\r\n  project = google_project.A.project_id\r\n  role    = \"roles/editor\"\r\n  member  = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-sa-member\" {\r\n  project    = google_project.A.project_id\r\n  for_each   = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"])\r\n  role       = each.value\r\n  member     = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nSo far, everything worked fine. The problem occured when I want to add `roles/billing.admin` as another role to my ServiceAccount\r\n\r\n```\r\nresource \"google_billing_account_iam_member\" \"A-billing-manager\" {\r\n  billing_account_id = var.billing_account\r\n  role               = \"roles/billing.admin\" # \"roles/billing.admin\", \"roles/billing.costsManager\"\r\n  member             = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nafter executing this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. Of course caller should have permission because it is `BillingAccountAdministrator` (also I checked with all other roles given in the same moment eg.`BillingAccountViewer`)\r\n\r\n\r\nAnyway, I decided to abandon creating it with ServiceAccount for now and do it with my UserAccount.\r\n\r\n```\r\nresource \"google_billing_budget\" \"budget\" {\r\n  billing_account = var.billing_account\r\n  display_name = \"A-budget\"\r\n\r\n  amount {\r\n    specified_amount {\r\n      currency_code = \"USD\"\r\n      units = 50\r\n    }\r\n  }\r\n\r\n  for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER))\r\n\r\n  threshold_rules {\r\n    threshold_percent = each.value\r\n  }\r\n}\r\n```\r\n\r\nAfter applying it I got: `Error: Error creating Budget: googleapi: Error 403: The caller does not have permission`\r\n\r\nThe caller of `terraform apply` is my UserAccount which is both owner of the project and billing account administrator.\r\n\r\nCan you please tell what can be wrong? The problem must be on my site since its basic functionality and it cannot be bugged\r\n\r\nThank you in advance!\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have a project in GCP and billing account connected to it. ", "keywords": ["bill"]}, {"source": "Text", "text": "Here is the code: ``` variable \"billing_account\" { type = string } resource \"google_project\" \"A\" { name = \"A\" project_id = local.project billing_account = var.billing_account lifecycle { prevent_destroy = true } } resource \"google_project_service\" \"A-service\" { project = google_project.A.project_id disable_dependent_services = true for_each = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"]) service = each.value } resource \"google_project_iam_member\" \"A-editor-member\" { project = google_project.A.project_id role = \"roles/editor\" member = \"serviceAccount:${google_service_account.A-service.email}\" } resource \"google_project_iam_member\" \"A-sa-member\" { project = google_project.A.project_id for_each = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"]) role = each.value member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` ", "keywords": ["bill", "storage"]}, {"source": "Text", "text": "The problem occured when I want to add `roles/billing.admin` as another role to my ServiceAccount ``` resource \"google_billing_account_iam_member\" \"A-billing-manager\" { billing_account_id = var.billing_account role = \"roles/billing.admin\" # \"roles/billing.admin\", \"roles/billing.costsManager\" member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` after executing this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "``` resource \"google_billing_budget\" \"budget\" { billing_account = var.billing_account display_name = \"A-budget\" amount { specified_amount { currency_code = \"USD\" units = 50 } } for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER)) threshold_rules { threshold_percent = each.value } } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "The caller of `terraform apply` is my UserAccount which is both owner of the project and billing account administrator. ", "keywords": ["bill"]}]}, {"Id": "281710622", "PostHistoryTypeId": "1", "PostId": "74350184", "RevisionGUID": "70231ca8-6678-49d0-8248-e020730c45a6", "CreationDate": "2022-11-07T16:57:44.007", "UserId": "20441864", "Text": "GCP Billing Account Administrator cannot perform some actions it is suppsed to. Using Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "281710623", "PostHistoryTypeId": "3", "PostId": "74350184", "RevisionGUID": "70231ca8-6678-49d0-8248-e020730c45a6", "CreationDate": "2022-11-07T16:57:44.007", "UserId": "20441864", "Text": "<google-cloud-platform><terraform><google-cloud-iam>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "281710624", "PostHistoryTypeId": "66", "PostId": "74350184", "RevisionGUID": "70231ca8-6678-49d0-8248-e020730c45a6", "CreationDate": "2022-11-07T16:57:44.007", "UserId": "20441864", "filtered-sentences": []}, {"Id": "281711267", "PostHistoryTypeId": "4", "PostId": "74350184", "RevisionGUID": "75748b65-94ce-401a-86f7-9312d63c512c", "CreationDate": "2022-11-07T17:05:56.517", "UserId": "20441864", "Comment": "edited title", "Text": "GCP Billing Account Administrator cannot perform some actions it is supposed to - using Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "281711379", "PostHistoryTypeId": "5", "PostId": "74350184", "RevisionGUID": "d2a0ecfb-9fc3-4ff4-824a-4b9398837493", "CreationDate": "2022-11-07T17:07:18.253", "UserId": "20441864", "Comment": "deleted 54 characters in body", "Text": "I have a project in GCP and billing account connected to it. I want to create budget and set some alarms for obvious reasons. I want to manage it with Terraform. Unfortunately, I got errors telling me I cannot perform certain actions, even though GCP docs for roles and permissions tell me that I should be able.\r\n\r\nI created ServiceAccount to manage my terraform. Here is the code:\r\n\r\n```\r\nvariable \"billing_account\" {\r\n  type        = string\r\n}\r\n\r\nresource \"google_project\" \"A\" {\r\n  name            = \"A\"\r\n  project_id      = local.project\r\n  billing_account = var.billing_account\r\n  lifecycle {\r\n    prevent_destroy = true\r\n  }\r\n}\r\n\r\n\r\nresource \"google_project_service\" \"A-service\" {\r\n  project                    = google_project.A.project_id\r\n  disable_dependent_services = true\r\n  for_each                   = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"])\r\n  service                    = each.value\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-editor-member\" {\r\n  project = google_project.A.project_id\r\n  role    = \"roles/editor\"\r\n  member  = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-sa-member\" {\r\n  project    = google_project.A.project_id\r\n  for_each   = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"])\r\n  role       = each.value\r\n  member     = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nSo far, everything worked fine. The problem occured when I want to add `roles/billing.admin` as another role to my ServiceAccount\r\n\r\n```\r\nresource \"google_billing_account_iam_member\" \"A-billing-manager\" {\r\n  billing_account_id = var.billing_account\r\n  role               = \"roles/billing.admin\"\r\n  member             = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nafter executing this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. Of course caller should have permission because it is `BillingAccountAdministrator` (also I checked with all other roles given in the same moment eg.`BillingAccountViewer`)\r\n\r\n\r\nAnyway, I decided to abandon creating it with ServiceAccount for now and do it with my UserAccount.\r\n\r\n```\r\nresource \"google_billing_budget\" \"budget\" {\r\n  billing_account = var.billing_account\r\n  display_name = \"A-budget\"\r\n\r\n  amount {\r\n    specified_amount {\r\n      currency_code = \"USD\"\r\n      units = 50\r\n    }\r\n  }\r\n\r\n  for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER))\r\n\r\n  threshold_rules {\r\n    threshold_percent = each.value\r\n  }\r\n}\r\n```\r\n\r\nAfter applying it I got: `Error: Error creating Budget: googleapi: Error 403: The caller does not have permission`\r\n\r\nThe caller of `terraform apply` is my UserAccount which is both owner of the project and billing account administrator.\r\n\r\nCan you please tell what can be wrong? The problem must be on my site since its basic functionality and it cannot be bugged\r\n\r\nThank you in advance!\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have a project in GCP and billing account connected to it. ", "keywords": ["bill"]}, {"source": "Text", "text": "Here is the code: ``` variable \"billing_account\" { type = string } resource \"google_project\" \"A\" { name = \"A\" project_id = local.project billing_account = var.billing_account lifecycle { prevent_destroy = true } } resource \"google_project_service\" \"A-service\" { project = google_project.A.project_id disable_dependent_services = true for_each = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"]) service = each.value } resource \"google_project_iam_member\" \"A-editor-member\" { project = google_project.A.project_id role = \"roles/editor\" member = \"serviceAccount:${google_service_account.A-service.email}\" } resource \"google_project_iam_member\" \"A-sa-member\" { project = google_project.A.project_id for_each = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"]) role = each.value member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` ", "keywords": ["bill", "storage"]}, {"source": "Text", "text": "The problem occured when I want to add `roles/billing.admin` as another role to my ServiceAccount ``` resource \"google_billing_account_iam_member\" \"A-billing-manager\" { billing_account_id = var.billing_account role = \"roles/billing.admin\" member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` after executing this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "``` resource \"google_billing_budget\" \"budget\" { billing_account = var.billing_account display_name = \"A-budget\" amount { specified_amount { currency_code = \"USD\" units = 50 } } for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER)) threshold_rules { threshold_percent = each.value } } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "The caller of `terraform apply` is my UserAccount which is both owner of the project and billing account administrator. ", "keywords": ["bill"]}]}, {"Id": "281711762", "PostHistoryTypeId": "5", "PostId": "74350184", "RevisionGUID": "79a4fe32-a3c2-4ac8-bab5-fb8154d481e8", "CreationDate": "2022-11-07T17:13:07.063", "UserId": "20441864", "Comment": "deleted 1 character in body", "Text": "I have a project in GCP and billing account connected to it. I want to create budget and set some alarms for obvious reasons. I want to manage it with Terraform. Unfortunately, I got errors telling me I cannot perform certain actions, even though GCP docs for roles and permissions tell me that I should be able.\r\n\r\nI created ServiceAccount to manage my terraform. Here is the code:\r\n\r\n```\r\nvariable \"billing_account\" {\r\n  type        = string\r\n}\r\n\r\nresource \"google_project\" \"A\" {\r\n  name            = \"A\"\r\n  project_id      = local.project\r\n  billing_account = var.billing_account\r\n  lifecycle {\r\n    prevent_destroy = true\r\n  }\r\n}\r\n\r\n\r\nresource \"google_project_service\" \"A-service\" {\r\n  project                    = google_project.A.project_id\r\n  disable_dependent_services = true\r\n  for_each                   = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"])\r\n  service                    = each.value\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-editor-member\" {\r\n  project = google_project.A.project_id\r\n  role    = \"roles/editor\"\r\n  member  = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-sa-member\" {\r\n  project    = google_project.A.project_id\r\n  for_each   = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"])\r\n  role       = each.value\r\n  member     = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nSo far, everything worked fine. The problem occured when I want to add `roles/billing.admin` as another role to my ServiceAccount\r\n\r\n```\r\nresource \"google_billing_account_iam_member\" \"A-billing-manager\" {\r\n  billing_account_id = var.billing_account\r\n  role               = \"roles/billing.admin\"\r\n  member             = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nAfter applying this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. Of course caller should have permission because it is `BillingAccountAdministrator` (also I checked with all other roles given in the same moment eg.`BillingAccountViewer`)\r\n\r\n\r\nAnyway, I decided to abandon creating it with ServiceAccount for now and do it with my UserAccount.\r\n\r\n```\r\nresource \"google_billing_budget\" \"budget\" {\r\n  billing_account = var.billing_account\r\n  display_name = \"A-budget\"\r\n\r\n  amount {\r\n    specified_amount {\r\n      currency_code = \"USD\"\r\n      units = 50\r\n    }\r\n  }\r\n\r\n  for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER))\r\n\r\n  threshold_rules {\r\n    threshold_percent = each.value\r\n  }\r\n}\r\n```\r\n\r\nAfter applying it I got: `Error: Error creating Budget: googleapi: Error 403: The caller does not have permission`\r\n\r\nThe caller of `terraform apply` is my UserAccount which is both owner of the project and billing account administrator.\r\n\r\nCan you please tell what can be wrong? The problem must be on my site since its basic functionality and it cannot be bugged\r\n\r\nThank you in advance!\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have a project in GCP and billing account connected to it. ", "keywords": ["bill"]}, {"source": "Text", "text": "Here is the code: ``` variable \"billing_account\" { type = string } resource \"google_project\" \"A\" { name = \"A\" project_id = local.project billing_account = var.billing_account lifecycle { prevent_destroy = true } } resource \"google_project_service\" \"A-service\" { project = google_project.A.project_id disable_dependent_services = true for_each = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"]) service = each.value } resource \"google_project_iam_member\" \"A-editor-member\" { project = google_project.A.project_id role = \"roles/editor\" member = \"serviceAccount:${google_service_account.A-service.email}\" } resource \"google_project_iam_member\" \"A-sa-member\" { project = google_project.A.project_id for_each = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"]) role = each.value member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` ", "keywords": ["bill", "storage"]}, {"source": "Text", "text": "The problem occured when I want to add `roles/billing.admin` as another role to my ServiceAccount ``` resource \"google_billing_account_iam_member\" \"A-billing-manager\" { billing_account_id = var.billing_account role = \"roles/billing.admin\" member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "After applying this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "``` resource \"google_billing_budget\" \"budget\" { billing_account = var.billing_account display_name = \"A-budget\" amount { specified_amount { currency_code = \"USD\" units = 50 } } for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER)) threshold_rules { threshold_percent = each.value } } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "The caller of `terraform apply` is my UserAccount which is both owner of the project and billing account administrator. ", "keywords": ["bill"]}]}, {"Id": "281718867", "PostHistoryTypeId": "5", "PostId": "74350184", "RevisionGUID": "8e1fcd10-c4c0-492b-8a81-e92cc09b57a5", "CreationDate": "2022-11-07T19:05:03.350", "UserId": "20441864", "Comment": "added 18 characters in body", "Text": "I have a project in GCP and billing account connected to it. I want to create budget and set some alarms for obvious reasons. I want to manage it with Terraform. Unfortunately, I got errors telling me, that I cannot perform certain actions, even though GCP docs for roles and permissions tell me that I should be able to.\r\n\r\nI created ServiceAccount to manage my Terraform. Here is the code:\r\n\r\n```\r\nvariable \"billing_account\" {\r\n  type        = string\r\n}\r\n\r\nresource \"google_project\" \"A\" {\r\n  name            = \"A\"\r\n  project_id      = local.project\r\n  billing_account = var.billing_account\r\n  lifecycle {\r\n    prevent_destroy = true\r\n  }\r\n}\r\n\r\n\r\nresource \"google_project_service\" \"A-service\" {\r\n  project                    = google_project.A.project_id\r\n  disable_dependent_services = true\r\n  for_each                   = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"])\r\n  service                    = each.value\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-editor-member\" {\r\n  project = google_project.A.project_id\r\n  role    = \"roles/editor\"\r\n  member  = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-sa-member\" {\r\n  project    = google_project.A.project_id\r\n  for_each   = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"])\r\n  role       = each.value\r\n  member     = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nSo far, everything worked fine. The problem occurred, when I want to add `roles/billing.admin` as another role to my ServiceAccount\r\n\r\n```\r\nresource \"google_billing_account_iam_member\" \"A-billing-manager\" {\r\n  billing_account_id = var.billing_account\r\n  role               = \"roles/billing.admin\"\r\n  member             = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nAfter applying this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. Caller should have permission, because it is `BillingAccountAdministrator` (also I checked with all other roles given in the same moment eg.`BillingAccountViewer`)\r\n\r\n\r\nAnyway, I decided to abandon creating it with ServiceAccount for now and do it with my UserAccount.\r\n\r\n```\r\nresource \"google_billing_budget\" \"budget\" {\r\n  billing_account = var.billing_account\r\n  display_name = \"A-budget\"\r\n\r\n  amount {\r\n    specified_amount {\r\n      currency_code = \"USD\"\r\n      units = 50\r\n    }\r\n  }\r\n\r\n  for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER))\r\n\r\n  threshold_rules {\r\n    threshold_percent = each.value\r\n  }\r\n}\r\n```\r\n\r\nAfter applying it, I got: `Error: Error creating Budget: googleapi: Error 403: The caller does not have permission`\r\n\r\nThe caller of `terraform apply` is my UserAccount, which is both owner of the project and billing account administrator (and more...).\r\n\r\nCan you please tell what can be wrong? The problem must be on my site since its basic functionality and it cannot be bugged\r\n\r\nThank you in advance!\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have a project in GCP and billing account connected to it. ", "keywords": ["bill"]}, {"source": "Text", "text": "Here is the code: ``` variable \"billing_account\" { type = string } resource \"google_project\" \"A\" { name = \"A\" project_id = local.project billing_account = var.billing_account lifecycle { prevent_destroy = true } } resource \"google_project_service\" \"A-service\" { project = google_project.A.project_id disable_dependent_services = true for_each = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"]) service = each.value } resource \"google_project_iam_member\" \"A-editor-member\" { project = google_project.A.project_id role = \"roles/editor\" member = \"serviceAccount:${google_service_account.A-service.email}\" } resource \"google_project_iam_member\" \"A-sa-member\" { project = google_project.A.project_id for_each = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"]) role = each.value member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` So far, everything worked fine. ", "keywords": ["bill", "storage"]}, {"source": "Text", "text": "The problem occurred, when I want to add `roles/billing.admin` as another role to my ServiceAccount ``` resource \"google_billing_account_iam_member\" \"A-billing-manager\" { billing_account_id = var.billing_account role = \"roles/billing.admin\" member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "After applying this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "``` resource \"google_billing_budget\" \"budget\" { billing_account = var.billing_account display_name = \"A-budget\" amount { specified_amount { currency_code = \"USD\" units = 50 } } for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER)) threshold_rules { threshold_percent = each.value } } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "The caller of `terraform apply` is my UserAccount, which is both owner of the project and billing account administrator (and more...). ", "keywords": ["bill"]}]}, {"Id": "281718913", "PostHistoryTypeId": "4", "PostId": "74350184", "RevisionGUID": "63e13988-ee17-47f5-b67a-8b5f458d44cf", "CreationDate": "2022-11-07T19:05:55.883", "UserId": "20441864", "Comment": "edited title", "Text": "GCP Billing Account Administrator cannot perform actions it is supposed to - using Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "281719772", "PostHistoryTypeId": "5", "PostId": "74350184", "RevisionGUID": "66bc0fb3-f03a-455f-bb61-ef777b1121de", "CreationDate": "2022-11-07T19:19:08.103", "UserId": "20441864", "Comment": "added 20 characters in body", "Text": "I have a project in GCP and billing account connected to it. I want to create budget and set some alarms for obvious reasons. I want to manage it with Terraform. Unfortunately, I got errors telling me, that I cannot perform certain actions, even though GCP docs for roles and permissions tell me that I should be able to.\r\n\r\nI created ServiceAccount to manage my Terraform. Here is the code:\r\n\r\n```\r\nvariable \"billing_account\" {\r\n  type        = string\r\n}\r\n\r\nresource \"google_project\" \"A\" {\r\n  name            = \"A\"\r\n  project_id      = local.project\r\n  billing_account = var.billing_account\r\n  lifecycle {\r\n    prevent_destroy = true\r\n  }\r\n}\r\n\r\n\r\nresource \"google_project_service\" \"A-service\" {\r\n  project                    = google_project.A.project_id\r\n  disable_dependent_services = true\r\n  for_each                   = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"])\r\n  service                    = each.value\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-editor-member\" {\r\n  project = google_project.A.project_id\r\n  role    = \"roles/editor\"\r\n  member  = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\nresource \"google_project_iam_member\" \"A-sa-member\" {\r\n  project    = google_project.A.project_id\r\n  for_each   = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"])\r\n  role       = each.value\r\n  member     = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nSo far, everything worked fine. The problem occurred, when I want to add `roles/billing.admin` as another role to my ServiceAccount\r\n\r\n```\r\nresource \"google_billing_account_iam_member\" \"A-billing-manager\" {\r\n  billing_account_id = var.billing_account\r\n  role               = \"roles/billing.admin\"\r\n  member             = \"serviceAccount:${google_service_account.A-service.email}\"\r\n}\r\n\r\n```\r\n\r\nAfter applying this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. Caller should have permission, because it is `BillingAccountAdministrator` (also I checked with all other roles given in the same moment eg.`BillingAccountViewer`)\r\n\r\n\r\nAnyway, I decided to abandon creating it with ServiceAccount for now and do it with my UserAccount.\r\n\r\n```\r\nresource \"google_billing_budget\" \"budget\" {\r\n  billing_account = var.billing_account\r\n  display_name = \"A-budget\"\r\n\r\n  amount {\r\n    specified_amount {\r\n      currency_code = \"USD\"\r\n      units = 50\r\n    }\r\n  }\r\n\r\n  for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER))\r\n\r\n  threshold_rules {\r\n    threshold_percent = each.value\r\n  }\r\n}\r\n```\r\n\r\nAfter applying it, I got: `Error: Error creating Budget: googleapi: Error 403: The caller does not have permission`\r\n\r\nThe caller of `terraform apply` is my UserAccount, which is both owner of the project and billing account administrator (and more...).\r\n\r\nCan you please tell what can be wrong with my UserAccount? The problem must be on my site since its basic functionality and it cannot be bugged\r\n\r\nThank you in advance!\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have a project in GCP and billing account connected to it. ", "keywords": ["bill"]}, {"source": "Text", "text": "Here is the code: ``` variable \"billing_account\" { type = string } resource \"google_project\" \"A\" { name = \"A\" project_id = local.project billing_account = var.billing_account lifecycle { prevent_destroy = true } } resource \"google_project_service\" \"A-service\" { project = google_project.A.project_id disable_dependent_services = true for_each = toset([\"cloudresourcemanager.googleapis.com\", \"iam.googleapis.com\", \"serviceusage.googleapis.com\", \"cloudbilling.googleapis.com\"]) service = each.value } resource \"google_project_iam_member\" \"A-editor-member\" { project = google_project.A.project_id role = \"roles/editor\" member = \"serviceAccount:${google_service_account.A-service.email}\" } resource \"google_project_iam_member\" \"A-sa-member\" { project = google_project.A.project_id for_each = toset([\"roles/iam.securityAdmin\", \"roles/container.admin\", \"roles/storage.admin\"]) role = each.value member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` So far, everything worked fine. ", "keywords": ["bill", "storage"]}, {"source": "Text", "text": "The problem occurred, when I want to add `roles/billing.admin` as another role to my ServiceAccount ``` resource \"google_billing_account_iam_member\" \"A-billing-manager\" { billing_account_id = var.billing_account role = \"roles/billing.admin\" member = \"serviceAccount:${google_service_account.A-service.email}\" } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "After applying this code I get: `Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: The caller does not have permission, forbidden`. ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "``` resource \"google_billing_budget\" \"budget\" { billing_account = var.billing_account display_name = \"A-budget\" amount { specified_amount { currency_code = \"USD\" units = 50 } } for_each = toset([for v in var.threshholds : tostring(v)]) # terraform does not support for_each(list(NUMBER)) threshold_rules { threshold_percent = each.value } } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "The caller of `terraform apply` is my UserAccount, which is both owner of the project and billing account administrator (and more...). ", "keywords": ["bill"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I have a project in GCP and billing account connected to it. ", "keywords": ["bill"]}, {"source": "Body", "text": "The problem occurred, when I want to add roles/billing.admin as another role to my ServiceAccount After applying this code I get: Error: Error retrieving IAM policy for billing account \"XYZ\": googleapi: Error 403: ", "keywords": ["bill", "policy"]}, {"source": "Body", "text": "The caller of terraform apply is my UserAccount, which is both owner of the project and billing account administrator (and more...). ", "keywords": ["bill"]}]}