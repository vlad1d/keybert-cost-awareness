{"Id": "57686497", "PostTypeId": "1", "AcceptedAnswerId": "57687335", "CreationDate": "2019-08-28T06:50:48.287", "Score": "1", "ViewCount": "316", "Body": "<p>I have a few <code>aws_iam_policy_document</code> like these</p>\n\n<p><strong>Policy1</strong></p>\n\n<pre><code>data \"aws_iam_policy_document\" \"policy1\" {\n  statement {\n    actions = [\n      \"rds:DescribeDBSnapshots\"\n    ]\n    resources = [\n      \"arn:aws:rds:${var.region}:${local.account_id}:db:*\n    ]\n  }\n  statement {\n    actions = [\n      \"rds:RestoreDBInstanceFromDBSnapshot\"\n    ]\n    resources = [\n      \"arn:aws:rds:${var.region}:${local.account_id}:db:*s\",\n      \"arn:aws:rds:${var.region}:${local.account_id}:snapshot:*\"\n\n    ]\n  }\n}\n</code></pre>\n\n<p><strong>Policy2</strong></p>\n\n<pre><code>data \"aws_iam_policy_document\" \"policy2\" {\n  statement {\n    actions = [\n      \"rds:DescribeDBInstances\",\n      \"rds:ModifyDBInstance\"\n    ]\n    resources = [\n      \"arn:aws:rds:${var.region}:${local.account_id}:db:*\",\n      \"arn:aws:rds:${var.region}:${local.account_id}:db:*\"\n    ]\n  }\n\n}\n</code></pre>\n\n<p>And I have a few more policies which all have some variations.</p>\n\n<p>Now I want to be able insert an identical block of <code>statement</code> to all of these policies.</p>\n\n<p>It is not tested yet but the statement will look like this:</p>\n\n<pre><code>statement {\n\n    action = [\n        \"ssm:GetParameter\" \n\n    ]\n    resources = [\n\n\"arn:aws:ssm:${var.region}:${local.account_id}:parameter/lambda/*\"\n    ]\n\n}\n</code></pre>\n\n<p>What is the most efficient way to do it? I want to avoid copy and paste the same block of statement to  all policies.</p>\n", "OwnerUserId": "58129", "LastActivityDate": "2019-08-28T07:44:53.250", "Title": "How to create a reusable block of statement for aws_iam_policy_document?", "Tags": "<terraform0.12+>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "204299010", "PostHistoryTypeId": "2", "PostId": "57686497", "RevisionGUID": "b720aafc-eb02-4462-9d18-6fbfeae4ca08", "CreationDate": "2019-08-28T06:50:48.287", "UserId": "58129", "Text": "I have a few `aws_iam_policy_document` like these\r\n\r\n**Policy1**\r\n\r\n    data \"aws_iam_policy_document\" \"policy1\" {\r\n      statement {\r\n        actions = [\r\n          \"rds:DescribeDBSnapshots\"\r\n        ]\r\n        resources = [\r\n          \"arn:aws:rds:${var.region}:${local.account_id}:db:*\r\n        ]\r\n      }\r\n      statement {\r\n        actions = [\r\n          \"rds:RestoreDBInstanceFromDBSnapshot\"\r\n        ]\r\n        resources = [\r\n          \"arn:aws:rds:${var.region}:${local.account_id}:db:*s\",\r\n          \"arn:aws:rds:${var.region}:${local.account_id}:snapshot:*\"\r\n         \r\n        ]\r\n      }\r\n    }\r\n\r\n**Policy2**\r\n\r\n    data \"aws_iam_policy_document\" \"policy2\" {\r\n      statement {\r\n        actions = [\r\n          \"rds:DescribeDBInstances\",\r\n          \"rds:ModifyDBInstance\"\r\n        ]\r\n        resources = [\r\n          \"arn:aws:rds:${var.region}:${local.account_id}:db:*\",\r\n          \"arn:aws:rds:${var.region}:${local.account_id}:db:*\"\r\n        ]\r\n      }\r\n    \r\n    }\r\n\r\nAnd I have a few more policies which all have some variations.\r\n\r\nNow I want to be able insert an identical block of `statement` to all of these policies.\r\n\r\nIt is not tested yet but the statement will look like this:\r\n\r\n\r\n    statement {\r\n    \r\n        action = [\r\n            \"ssm:GetParameter\" \r\n        \r\n        ]\r\n        resources = [\r\n         \r\n    \"arn:aws:ssm:${var.region}:${local.account_id}:parameter/lambda/*\"\r\n        ]\r\n    \r\n    }\r\n\r\nWhat is the most efficient way to do it? I want to avoid copy and paste the same block of statement to  all policies.\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It is not tested yet but the statement will look like this: statement { action = [ \"ssm:GetParameter\" ] resources = [ \"arn:aws:ssm:${var.region}:${local.account_id}:parameter/lambda/*\" ] } What is the most efficient way to do it", "keywords": ["efficient", "test"]}]}, {"Id": "204299011", "PostHistoryTypeId": "1", "PostId": "57686497", "RevisionGUID": "b720aafc-eb02-4462-9d18-6fbfeae4ca08", "CreationDate": "2019-08-28T06:50:48.287", "UserId": "58129", "Text": "How to create a reusable block of statement for aws_iam_policy_document?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "204299012", "PostHistoryTypeId": "3", "PostId": "57686497", "RevisionGUID": "b720aafc-eb02-4462-9d18-6fbfeae4ca08", "CreationDate": "2019-08-28T06:50:48.287", "UserId": "58129", "Text": "<terraform0.12+>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "57687335", "PostTypeId": "2", "ParentId": "57686497", "CreationDate": "2019-08-28T07:44:53.250", "Score": "0", "Body": "<p>I can use the <code>source_json</code> keyword.</p>\n\n<p>Here is an example:</p>\n\n<p>First of all, define the common policy in new policy document</p>\n\n<pre><code>  data \"aws_iam_policy_document\" \"common\" {\n    statement {\n\n        action = [\n            \"ssm:GetParameter\" \n\n        ]\n        resources = [\n\n    \"arn:aws:ssm:${var.region}:${local.account_id}:parameter/lambda/*\"\n        ]\n\n    }\n  }\n</code></pre>\n\n<p>Then in the existing policy document, use  <code>source_json</code></p>\n\n<pre><code>data \"aws_iam_policy_document\" \"policy1\" {\n  source_json = \"${data.aws_iam_policy_document.common.json}\"\n  statement {\n     ....\n  }\n}\n</code></pre>\n", "OwnerUserId": "58129", "LastActivityDate": "2019-08-28T07:44:53.250", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "204302371", "PostHistoryTypeId": "2", "PostId": "57687335", "RevisionGUID": "1a10bc6c-1f38-4597-a8a3-59ac047e73ca", "CreationDate": "2019-08-28T07:44:53.250", "UserId": "58129", "Text": "I can use the `source_json` keyword.\r\n\r\nHere is an example:\r\n\r\nFirst of all, define the common policy in new policy document\r\n\r\n      data \"aws_iam_policy_document\" \"common\" {\r\n        statement {\r\n        \r\n            action = [\r\n                \"ssm:GetParameter\" \r\n        \r\n            ]\r\n            resources = [\r\n        \r\n        \"arn:aws:ssm:${var.region}:${local.account_id}:parameter/lambda/*\"\r\n            ]\r\n        \r\n        }\r\n      }\r\n\r\n\r\nThen in the existing policy document, use  `source_json`\r\n\r\n    data \"aws_iam_policy_document\" \"policy1\" {\r\n      source_json = \"${data.aws_iam_policy_document.common.json}\"\r\n      statement {\r\n         ....\r\n      }\r\n    }\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Here is an example: First of all, define the common policy in new policy document data \"aws_iam_policy_document\" \"common\" { statement { action = [ \"ssm:GetParameter\" ] resources = [ \"arn:aws:ssm:${var.region}:${local.account_id}:parameter/lambda/*\" ] } } Then in the existing policy document, use `source_json` data \"aws_iam_policy_document\" \"policy1\" { source_json = \"${data.aws_iam_policy_document.common.json}\" statement { .... } }", "keywords": ["policy"]}]}], "filtered-sentences": [{"source": "Body", "text": "Here is an example: First of all, define the common policy in new policy document ", "keywords": ["policy"]}, {"source": "Body", "text": "Then in the existing policy document, use source_json", "keywords": ["policy"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "It is not tested yet but the statement will look like this: What is the most efficient way to do it? ", "keywords": ["efficient", "test"]}]}