{"Id": "75878268", "PostTypeId": "1", "AcceptedAnswerId": "75879595", "CreationDate": "2023-03-29T14:01:45.410", "Score": "1", "ViewCount": "49", "Body": "<p>I'm following the <a href=\"https://docs.gitlab.com/ee/user/infrastructure/clusters/connect/new_gke_cluster.html#create-a-google-gke-cluster\" rel=\"nofollow noreferrer\">Gitlab GKE Tutorial</a>, which uses the <a href=\"https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke.git\" rel=\"nofollow noreferrer\">gitlab-terraform-gke project</a></p>\n<p>I'm reaching the <a href=\"https://docs.gitlab.com/ee/user/infrastructure/clusters/connect/new_gke_cluster.html#provision-your-cluster\" rel=\"nofollow noreferrer\">deployment stage</a> where the deployment fails with the error</p>\n<pre><code>\n\n\u2502 Error: error creating NodePool: googleapi: Error 403: \nInsufficient project quota to satisfy request: \nresource &quot;CPUS_ALL_REGIONS&quot;: request requires '36.0' and is short '4.0'. \nproject has a quota of '32.0' with '32.0' available.\n</code></pre>\n<p>I'm not able to find configuration how to reduce the 36 to 32.\nDo you have information how to do that?</p>\n", "OwnerUserId": "5011027", "LastActivityDate": "2023-03-29T16:07:35.287", "Title": "Gitlab GKE Tutorial with free GCP fails: \"CPUS_ALL_REGIONS\": request requires '36.0' and is short '4.0' / How to config?", "Tags": "<google-cloud-platform><terraform><gitlab-ci><google-kubernetes-engine>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "290552846", "PostHistoryTypeId": "2", "PostId": "75878268", "RevisionGUID": "9d3faefe-eadf-4375-a1a9-9269ee612839", "CreationDate": "2023-03-29T14:01:45.410", "UserId": "5011027", "Text": "I'm following the [Gitlab GKE Tutorial](https://docs.gitlab.com/ee/user/infrastructure/clusters/connect/new_gke_cluster.html#create-a-google-gke-cluster), which uses the [gitlab-terraform-gke project](https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke.git)\r\n\r\nI'm reaching the [deployment stage](https://docs.gitlab.com/ee/user/infrastructure/clusters/connect/new_gke_cluster.html#provision-your-cluster) where the deployment fails with the error\r\n\r\n```google_container_node_pool.primary_nodes: Creating...\r\n\r\n\r\n\u2502 Error: error creating NodePool: googleapi: Error 403: \r\nInsufficient project quota to satisfy request: \r\nresource \"CPUS_ALL_REGIONS\": request requires '36.0' and is short '4.0'. \r\nproject has a quota of '32.0' with '32.0' available.\r\n```\r\n\r\nI'm not able to find configuration how to reduce the 36 to 32.\r\nDo you have information how to do that?\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I'm following the [Gitlab GKE Tutorial](https://docs.gitlab.com/ee/user/infrastructure/clusters/connect/new_gke_cluster.html#create-a-google-gke-cluster), which uses the [gitlab-terraform-gke project](https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke.git) I'm reaching the [deployment stage](https://docs.gitlab.com/ee/user/infrastructure/clusters/connect/new_gke_cluster.html#provision-your-cluster) where the deployment fails with the error ```google_container_node_pool.primary_nodes: Creating... \u2502 Error: error creating NodePool: googleapi: Error 403: Insufficient project quota to satisfy request: resource \"CPUS_ALL_REGIONS\": request requires '36.0' and is short '4.0'. project has a quota of '32.0' with '32.0' available. ", "keywords": ["cluster"]}]}, {"Id": "290552848", "PostHistoryTypeId": "1", "PostId": "75878268", "RevisionGUID": "9d3faefe-eadf-4375-a1a9-9269ee612839", "CreationDate": "2023-03-29T14:01:45.410", "UserId": "5011027", "Text": "Gitlab GKE Tutorial with free GCP fails: \"CPUS_ALL_REGIONS\": request requires '36.0' and is short '4.0' / How to config?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "290552849", "PostHistoryTypeId": "3", "PostId": "75878268", "RevisionGUID": "9d3faefe-eadf-4375-a1a9-9269ee612839", "CreationDate": "2023-03-29T14:01:45.410", "UserId": "5011027", "Text": "<google-cloud-platform><terraform><gitlab-ci><google-kubernetes-engine>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "75879595", "PostTypeId": "2", "ParentId": "75878268", "CreationDate": "2023-03-29T16:02:22.377", "Score": "3", "Body": "<p>You are deploying a regional cluster and the way <a href=\"https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke/-/blob/master/variables.tf\" rel=\"nofollow noreferrer\"><code>node_count</code></a> works is that specifies how many nodes to deploy <strong>PER ZONE</strong>. And because us-central1 has 3 zones, you're deploying a cluster with 9 nodes.  The node <code>machine_type</code> is <code>n1-standard-4</code>, which is a 4vCPU node, so 9 x 4vCPUs = 36 and that exceeds your quota.</p>\n<p>There are a couple of things you can do:</p>\n<ol>\n<li>reduce the <code>node_count</code> and/or <code>machine_type</code>.  I don't know what the demo runs or if you even need that many nodes, but from a cost optimization perspective, if you don't need that many resources, don't deploy that many resources</li>\n</ol>\n<p>(i.e. <code>node_count=2</code>, <code>machine_type=n1-standard-2</code> would mean you're now deploying 6 nodes total of 2vCPUs each for a total of 12vCPUs)</p>\n<ol start=\"2\">\n<li>if you do need that many resources, contact GCP support and up your quota</li>\n</ol>\n<p>EDIT: just wanted to mention that I maintain my own repo of Terraform deployment code for a cheap GKE cluster and I explain how it all works.  You can check it out <a href=\"https://github.com/Neutrollized/free-tier-gke\" rel=\"nofollow noreferrer\">here</a> if it interests you.</p>\n", "OwnerUserId": "17675150", "LastEditorUserId": "17675150", "LastEditDate": "2023-03-29T16:07:35.287", "LastActivityDate": "2023-03-29T16:07:35.287", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133853021", "PostId": "75879595", "Score": "0", "Text": "was reading through your repo - very helpful, thanks for your work!", "CreationDate": "2023-03-30T09:00:20.580", "UserId": "5011027", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "290560436", "PostHistoryTypeId": "2", "PostId": "75879595", "RevisionGUID": "b828985c-fcee-47a1-bc8b-cb2e8e7a3b8c", "CreationDate": "2023-03-29T16:02:22.377", "UserId": "17675150", "Text": "You are deploying a regional cluster and the way [`node_count`](https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke/-/blob/master/variables.tf) works is that specifies how many nodes to deploy **PER ZONE**. And because us-central1 has 3 zones, you're deploying a cluster with 9 nodes.  The node `machine_type` is `n1-standard-4`, which is a 4vCPU node, so 9 x 4vCPUs = 36 and that exceeds your quota.\r\n\r\nThere are a couple of things you can do:\r\n\r\n1) reduce the `node_count` and/or `machine_type`.  I don't know what the demo runs or if you even need that many nodes, but from a cost optimization perspective, if you don't need that many resources, don't deploy that many resources\r\n\r\n2) if you do need that many resources, contact GCP support and up your quota\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You are deploying a regional cluster and the way [`node_count`](https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke/-/blob/master/variables.tf) works is that specifies how many nodes to deploy **PER ZONE**. ", "keywords": ["cluster"]}, {"source": "Text", "text": "And because us-central1 has 3 zones, you're deploying a cluster with 9 nodes. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I don't know what the demo runs or if you even need that many nodes, but from a cost optimization perspective, if you don't need that many resources, don't deploy that many resources 2) if you do need that many resources, contact GCP support and up your quota", "keywords": ["cost"]}]}, {"Id": "290560438", "PostHistoryTypeId": "33", "PostId": "75879595", "RevisionGUID": "6dd15902-4d23-4618-ac1b-55d7031ca6c6", "CreationDate": "2023-03-29T16:02:22.377", "UserId": "-1002", "Comment": "311564", "filtered-sentences": []}, {"Id": "290560780", "PostHistoryTypeId": "5", "PostId": "75879595", "RevisionGUID": "96ad5fb8-6662-4bae-a670-c71f7c29f42c", "CreationDate": "2023-03-29T16:07:35.287", "UserId": "17675150", "Comment": "added 383 characters in body", "Text": "You are deploying a regional cluster and the way [`node_count`](https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke/-/blob/master/variables.tf) works is that specifies how many nodes to deploy **PER ZONE**. And because us-central1 has 3 zones, you're deploying a cluster with 9 nodes.  The node `machine_type` is `n1-standard-4`, which is a 4vCPU node, so 9 x 4vCPUs = 36 and that exceeds your quota.\r\n\r\nThere are a couple of things you can do:\r\n\r\n1) reduce the `node_count` and/or `machine_type`.  I don't know what the demo runs or if you even need that many nodes, but from a cost optimization perspective, if you don't need that many resources, don't deploy that many resources\r\n\r\n(i.e. `node_count=2`, `machine_type=n1-standard-2` would mean you're now deploying 6 nodes total of 2vCPUs each for a total of 12vCPUs)\r\n\r\n2) if you do need that many resources, contact GCP support and up your quota\r\n\r\n\r\n\r\nEDIT: just wanted to mention that I maintain my own repo of Terraform deployment code for a cheap GKE cluster and I explain how it all works.  You can check it out [here](https://github.com/Neutrollized/free-tier-gke) if it interests you.\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You are deploying a regional cluster and the way [`node_count`](https://gitlab.com/gitlab-org/configure/examples/gitlab-terraform-gke/-/blob/master/variables.tf) works is that specifies how many nodes to deploy **PER ZONE**. ", "keywords": ["cluster"]}, {"source": "Text", "text": "And because us-central1 has 3 zones, you're deploying a cluster with 9 nodes. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I don't know what the demo runs or if you even need that many nodes, but from a cost optimization perspective, if you don't need that many resources, don't deploy that many resources (i.e. `node_count=2`, `machine_type=n1-standard-2` would mean you're now deploying 6 nodes total of 2vCPUs each for a total of 12vCPUs) 2) if you do need that many resources, contact GCP support and up your quota EDIT: just wanted to mention that I maintain my own repo of Terraform deployment code for a cheap GKE cluster and I explain how it all works. ", "keywords": ["cheap", "cost", "cluster"]}]}, {"Id": "290560781", "PostHistoryTypeId": "33", "PostId": "75879595", "RevisionGUID": "e058d554-ae4c-463c-93df-d0c65d4314fc", "CreationDate": "2023-03-29T16:07:35.287", "UserId": "-1002", "Comment": "311565", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "You are deploying a regional cluster and the way node_count works is that specifies how many nodes to deploy PER ZONE. ", "keywords": ["cluster"]}, {"source": "Body", "text": "And because us-central1 has 3 zones, you're deploying a cluster with 9 nodes. ", "keywords": ["cluster"]}, {"source": "Body", "text": "I don't know what the demo runs or if you even need that many nodes, but from a cost optimization perspective, if you don't need that many resources, don't deploy that many resources (i.e. node_count=2, machine_type=n1-standard-2 would mean you're now deploying 6 nodes total of 2vCPUs each for a total of 12vCPUs) if you do need that many resources, contact GCP support and up your quota EDIT: just wanted to mention that I maintain my own repo of Terraform deployment code for a cheap GKE cluster and I explain how it all works. ", "keywords": ["cheap", "cost", "cluster"]}]}], "contains-topic": true, "filtered-sentences": []}