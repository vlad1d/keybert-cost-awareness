{"Id": "65506279", "PostTypeId": "1", "AcceptedAnswerId": "65507266", "CreationDate": "2020-12-30T11:32:23.770", "Score": "1", "ViewCount": "10563", "Body": "<p>Main Two Question with terraform code.</p>\n<ol>\n<li>Alb for Ecs fargate is for routing to another avaliablity zones? or routing to containers</li>\n<li>If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply?</li>\n</ol>\n<p>I'm trying to build infra like under image\n<a href=\"https://i.stack.imgur.com/1xCSH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1xCSH.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>resource &quot;aws_vpc&quot; &quot;cluster_vpc&quot; {\n  tags = {\n    Name = &quot;ecs-vpc&quot;\n  }\n  cidr_block = &quot;10.30.0.0/16&quot;\n}\n\ndata &quot;aws_availability_zones&quot; &quot;available&quot; {\n\n}\n\nresource &quot;aws_subnet&quot; &quot;cluster&quot; {\n  vpc_id            = aws_vpc.cluster_vpc.id\n  count             = length(data.aws_availability_zones.available.names)\n  cidr_block        = &quot;10.30.${10 + count.index}.0/24&quot;\n  availability_zone = data.aws_availability_zones.available.names[count.index]\n  tags = {\n    Name = &quot;ecs-subnet&quot;\n  }\n}\n\n\nresource &quot;aws_internet_gateway&quot; &quot;cluster_igw&quot; {\n  vpc_id = aws_vpc.cluster_vpc.id\n\n  tags = {\n    Name = &quot;ecs-igw&quot;\n  }\n}\n\nresource &quot;aws_route_table&quot; &quot;public_route&quot; {\n  vpc_id = aws_vpc.cluster_vpc.id\n  route {\n    cidr_block = &quot;0.0.0.0/0&quot;\n    gateway_id = aws_internet_gateway.cluster_igw.id\n  }\n\n  tags = {\n    Name = &quot;ecs-route-table&quot;\n  }\n}\n\nresource &quot;aws_route_table_association&quot; &quot;to-public&quot; {\n  count          = length(aws_subnet.cluster)\n  subnet_id      = aws_subnet.cluster[count.index].id\n  route_table_id = aws_route_table.public_route.id\n}\nresource &quot;aws_ecs_cluster&quot; &quot;staging&quot; {\n  name = &quot;service-ecs-cluster&quot;\n}\n\nresource &quot;aws_ecs_service&quot; &quot;staging&quot; {\n  name            = &quot;staging&quot;\n  cluster         = aws_ecs_cluster.staging.id\n  task_definition = aws_ecs_task_definition.service.arn\n  desired_count   = 1\n  launch_type     = &quot;FARGATE&quot;\n\n  network_configuration {\n    security_groups  = [aws_security_group.ecs_tasks.id]\n    subnets          = aws_subnet.cluster[*].id\n    assign_public_ip = true\n  }\n\n  load_balancer {\n    target_group_arn = aws_lb_target_group.staging.arn\n    container_name   = var.app_name\n    container_port   = var.container_port\n  }\n\nresource &quot;aws_lb&quot; &quot;staging&quot; {\n  name               = &quot;alb&quot;\n  subnets            = aws_subnet.cluster[*].id\n  load_balancer_type = &quot;application&quot;\n  security_groups    = [aws_security_group.lb.id]\n\n  access_logs {\n    bucket  = aws_s3_bucket.log_storage.id\n    prefix  = &quot;frontend-alb&quot;\n    enabled = true\n  }\n\n  tags = {\n    Environment = &quot;staging&quot;\n    Application = var.app_name\n  }\n}\n\n... omit like lb_target, or specific components\n\n</code></pre>\n", "OwnerUserId": "5113276", "LastEditorUserId": "5113276", "LastEditDate": "2020-12-30T11:41:32.590", "LastActivityDate": "2020-12-30T12:57:49.623", "Title": "How Aws ecs fargate availablity zone works?", "Tags": "<amazon-web-services><terraform><amazon-ecs><aws-fargate>", "AnswerCount": "1", "CommentCount": "6", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "115812763", "PostId": "65506279", "Score": "1", "Text": "Is there any problem with your code, or you are just looking answers to the two questions of yours?", "CreationDate": "2020-12-30T11:52:06.417", "UserId": "248823", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115813059", "PostId": "65506279", "Score": "0", "Text": "both :)\n\ncode works well, but i'm not confident of my code even though it works.", "CreationDate": "2020-12-30T12:06:52.273", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115813188", "PostId": "65506279", "Score": "0", "Text": "@Marcin\nmy intent is to build infra which has three availablity zone and also deploy aws fargate  on three availablity zone.\nbut i think my code is just creating three availablity zone and don't use them", "CreationDate": "2020-12-30T12:13:07.530", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115813279", "PostId": "65506279", "Score": "0", "Text": "If the ALB and ECS cluster are using the same subnets (and it seems they are from the Terraform code), then it should create everything as shown in the diagram.", "CreationDate": "2020-12-30T12:17:29.607", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If the ALB and ECS cluster are using the same subnets (and it seems they are from the Terraform code), then it should create everything as shown in the diagram.", "keywords": ["cluster"]}]}, {"Id": "115813817", "PostId": "65506279", "Score": "0", "Text": "@MarkoE thank you for your reply :)\n\n\n\n1. if us-east-2a down, us-east-2b activate automatically and alb will route requests to us-east-2b?                                  \n   \n2.Is this going to cause a fare increase?\n\n3. aws fargate can route traffic itself? (if alb used to route availblity zone, how does aws target route requests?)", "CreationDate": "2020-12-30T12:41:29.063", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "131109073", "PostId": "65506279", "Score": "0", "Text": "I would like to elaborate on this topic. What if we have two services on ECS? Is there any control to deploy then on same az? As from cost report I observe significant inter az traffic costs, even all services have desired_count=1, but communicate to each other.", "CreationDate": "2022-10-31T10:39:30.403", "UserId": "4494515", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "As from cost report I observe significant inter az traffic costs, even all services have desired_count=1, but communicate to each other.", "keywords": ["cost"]}]}], "history": [{"Id": "237824666", "PostHistoryTypeId": "2", "PostId": "65506279", "RevisionGUID": "683fa69b-73c7-431b-ba15-5b4d72f0dea2", "CreationDate": "2020-12-30T11:32:23.770", "UserId": "5113276", "Text": "Main Two Question with terraform code.\r\n\r\n1. Alb for Ecs fargate is for routing to another avaliablity zones? or routing to containers \r\n2. If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, or number 3) and map it to an ecs cluster with alb, does the availability zone apply?\r\n\r\nI'm trying to build infra like under image\r\n[![enter image description here][1]][1]\r\n\r\nbut i've got some question about availablity zone.\r\n\r\nIf I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, or number 3) and map it to an es cluster with alb, does the availability zone apply?\r\n\r\ni've attached my terraform code\r\n```\r\nresource \"aws_vpc\" \"cluster_vpc\" {\r\n  tags = {\r\n    Name = \"ecs-vpc\"\r\n  }\r\n  cidr_block = \"10.30.0.0/16\"\r\n}\r\n\r\ndata \"aws_availability_zones\" \"available\" {\r\n\r\n}\r\n\r\nresource \"aws_subnet\" \"cluster\" {\r\n  vpc_id            = aws_vpc.cluster_vpc.id\r\n  count             = length(data.aws_availability_zones.available.names)\r\n  cidr_block        = \"10.30.${10 + count.index}.0/24\"\r\n  availability_zone = data.aws_availability_zones.available.names[count.index]\r\n  tags = {\r\n    Name = \"ecs-subnet\"\r\n  }\r\n}\r\n\r\n\r\nresource \"aws_internet_gateway\" \"cluster_igw\" {\r\n  vpc_id = aws_vpc.cluster_vpc.id\r\n\r\n  tags = {\r\n    Name = \"ecs-igw\"\r\n  }\r\n}\r\n\r\nresource \"aws_route_table\" \"public_route\" {\r\n  vpc_id = aws_vpc.cluster_vpc.id\r\n  route {\r\n    cidr_block = \"0.0.0.0/0\"\r\n    gateway_id = aws_internet_gateway.cluster_igw.id\r\n  }\r\n\r\n  tags = {\r\n    Name = \"ecs-route-table\"\r\n  }\r\n}\r\n\r\nresource \"aws_route_table_association\" \"to-public\" {\r\n  count          = length(aws_subnet.cluster)\r\n  subnet_id      = aws_subnet.cluster[count.index].id\r\n  route_table_id = aws_route_table.public_route.id\r\n}\r\nresource \"aws_ecs_cluster\" \"staging\" {\r\n  name = \"service-ecs-cluster\"\r\n}\r\n\r\nresource \"aws_ecs_service\" \"staging\" {\r\n  name            = \"staging\"\r\n  cluster         = aws_ecs_cluster.staging.id\r\n  task_definition = aws_ecs_task_definition.service.arn\r\n  desired_count   = 1\r\n  launch_type     = \"FARGATE\"\r\n\r\n  network_configuration {\r\n    security_groups  = [aws_security_group.ecs_tasks.id]\r\n    subnets          = aws_subnet.cluster[*].id\r\n    assign_public_ip = true\r\n  }\r\n\r\n  load_balancer {\r\n    target_group_arn = aws_lb_target_group.staging.arn\r\n    container_name   = var.app_name\r\n    container_port   = var.container_port\r\n  }\r\n\r\nresource \"aws_lb\" \"staging\" {\r\n  name               = \"alb\"\r\n  subnets            = aws_subnet.cluster[*].id\r\n  load_balancer_type = \"application\"\r\n  security_groups    = [aws_security_group.lb.id]\r\n\r\n  access_logs {\r\n    bucket  = aws_s3_bucket.log_storage.id\r\n    prefix  = \"frontend-alb\"\r\n    enabled = true\r\n  }\r\n\r\n  tags = {\r\n    Environment = \"staging\"\r\n    Application = var.app_name\r\n  }\r\n}\r\n\r\n... omit like lb_target, or specific components\r\n\r\n```\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/1xCSH.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, or number 3) and map it to an ecs cluster with alb, does the availability zone apply? ", "keywords": ["cluster"]}, {"source": "Text", "text": "If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, or number 3) and map it to an es cluster with alb, does the availability zone apply? i've attached my terraform code ``` resource \"aws_vpc\" \"cluster_vpc\" { tags = { Name = \"ecs-vpc\" } cidr_block = \"10.30.0.0/16\" } data \"aws_availability_zones\" \"available\" { } resource \"aws_subnet\" \"cluster\" { vpc_id = aws_vpc.cluster_vpc.id count = length(data.aws_availability_zones.available.names) cidr_block = \"10.30.${10 + count.index}.0/24\" availability_zone = data.aws_availability_zones.available.names[count.index] tags = { Name = \"ecs-subnet\" } } resource \"aws_internet_gateway\" \"cluster_igw\" { vpc_id = aws_vpc.cluster_vpc.id tags = { Name = \"ecs-igw\" } } resource \"aws_route_table\" \"public_route\" { vpc_id = aws_vpc.cluster_vpc.id route { cidr_block = \"0.0.0.0/0\" gateway_id = aws_internet_gateway.cluster_igw.id } tags = { Name = \"ecs-route-table\" } } resource \"aws_route_table_association\" \"to-public\" { count = length(aws_subnet.cluster) subnet_id = aws_subnet.cluster[count.index].id route_table_id = aws_route_table.public_route.id } resource \"aws_ecs_cluster\" \"staging\" { name = \"service-ecs-cluster\" } resource \"aws_ecs_service\" \"staging\" { name = \"staging\" cluster = aws_ecs_cluster.staging.id task_definition = aws_ecs_task_definition.service.arn desired_count = 1 launch_type = \"FARGATE\" network_configuration { security_groups = [aws_security_group.ecs_tasks.id] subnets = aws_subnet.cluster[*].id assign_public_ip = true } load_balancer { target_group_arn = aws_lb_target_group.staging.arn container_name = var.app_name container_port = var.container_port } resource \"aws_lb\" \"staging\" { name = \"alb\" subnets = aws_subnet.cluster[*].id load_balancer_type = \"application\" security_groups = [aws_security_group.lb.id] access_logs { bucket = aws_s3_bucket.log_storage.id prefix = \"frontend-alb\" enabled = true } tags = { Environment = \"staging\" Application = var.app_name } ", "keywords": ["cluster"]}]}, {"Id": "237824667", "PostHistoryTypeId": "1", "PostId": "65506279", "RevisionGUID": "683fa69b-73c7-431b-ba15-5b4d72f0dea2", "CreationDate": "2020-12-30T11:32:23.770", "UserId": "5113276", "Text": "How Aws ecs fargate availablity zone works?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "237824668", "PostHistoryTypeId": "3", "PostId": "65506279", "RevisionGUID": "683fa69b-73c7-431b-ba15-5b4d72f0dea2", "CreationDate": "2020-12-30T11:32:23.770", "UserId": "5113276", "Text": "<amazon-web-services><terraform><amazon-ecs><aws-fargate>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "237825124", "PostHistoryTypeId": "5", "PostId": "65506279", "RevisionGUID": "8272535c-7558-4e8a-a1f9-1ddcd66f414d", "CreationDate": "2020-12-30T11:41:32.590", "UserId": "5113276", "Comment": "added 24 characters in body", "Text": "Main Two Question with terraform code.\r\n\r\n1. Alb for Ecs fargate is for routing to another avaliablity zones? or routing to containers \r\n2. If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply?\r\n\r\nI'm trying to build infra like under image\r\n[![enter image description here][1]][1]\r\n\r\n\r\n```\r\nresource \"aws_vpc\" \"cluster_vpc\" {\r\n  tags = {\r\n    Name = \"ecs-vpc\"\r\n  }\r\n  cidr_block = \"10.30.0.0/16\"\r\n}\r\n\r\ndata \"aws_availability_zones\" \"available\" {\r\n\r\n}\r\n\r\nresource \"aws_subnet\" \"cluster\" {\r\n  vpc_id            = aws_vpc.cluster_vpc.id\r\n  count             = length(data.aws_availability_zones.available.names)\r\n  cidr_block        = \"10.30.${10 + count.index}.0/24\"\r\n  availability_zone = data.aws_availability_zones.available.names[count.index]\r\n  tags = {\r\n    Name = \"ecs-subnet\"\r\n  }\r\n}\r\n\r\n\r\nresource \"aws_internet_gateway\" \"cluster_igw\" {\r\n  vpc_id = aws_vpc.cluster_vpc.id\r\n\r\n  tags = {\r\n    Name = \"ecs-igw\"\r\n  }\r\n}\r\n\r\nresource \"aws_route_table\" \"public_route\" {\r\n  vpc_id = aws_vpc.cluster_vpc.id\r\n  route {\r\n    cidr_block = \"0.0.0.0/0\"\r\n    gateway_id = aws_internet_gateway.cluster_igw.id\r\n  }\r\n\r\n  tags = {\r\n    Name = \"ecs-route-table\"\r\n  }\r\n}\r\n\r\nresource \"aws_route_table_association\" \"to-public\" {\r\n  count          = length(aws_subnet.cluster)\r\n  subnet_id      = aws_subnet.cluster[count.index].id\r\n  route_table_id = aws_route_table.public_route.id\r\n}\r\nresource \"aws_ecs_cluster\" \"staging\" {\r\n  name = \"service-ecs-cluster\"\r\n}\r\n\r\nresource \"aws_ecs_service\" \"staging\" {\r\n  name            = \"staging\"\r\n  cluster         = aws_ecs_cluster.staging.id\r\n  task_definition = aws_ecs_task_definition.service.arn\r\n  desired_count   = 1\r\n  launch_type     = \"FARGATE\"\r\n\r\n  network_configuration {\r\n    security_groups  = [aws_security_group.ecs_tasks.id]\r\n    subnets          = aws_subnet.cluster[*].id\r\n    assign_public_ip = true\r\n  }\r\n\r\n  load_balancer {\r\n    target_group_arn = aws_lb_target_group.staging.arn\r\n    container_name   = var.app_name\r\n    container_port   = var.container_port\r\n  }\r\n\r\nresource \"aws_lb\" \"staging\" {\r\n  name               = \"alb\"\r\n  subnets            = aws_subnet.cluster[*].id\r\n  load_balancer_type = \"application\"\r\n  security_groups    = [aws_security_group.lb.id]\r\n\r\n  access_logs {\r\n    bucket  = aws_s3_bucket.log_storage.id\r\n    prefix  = \"frontend-alb\"\r\n    enabled = true\r\n  }\r\n\r\n  tags = {\r\n    Environment = \"staging\"\r\n    Application = var.app_name\r\n  }\r\n}\r\n\r\n... omit like lb_target, or specific components\r\n\r\n```\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/1xCSH.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply? ", "keywords": ["cluster"]}, {"source": "Text", "text": "I'm trying to build infra like under image [![enter image description here][1]][1] ``` resource \"aws_vpc\" \"cluster_vpc\" { tags = { Name = \"ecs-vpc\" } cidr_block = \"10.30.0.0/16\" } data \"aws_availability_zones\" \"available\" { } resource \"aws_subnet\" \"cluster\" { vpc_id = aws_vpc.cluster_vpc.id count = length(data.aws_availability_zones.available.names) cidr_block = \"10.30.${10 + count.index}.0/24\" availability_zone = data.aws_availability_zones.available.names[count.index] tags = { Name = \"ecs-subnet\" } } resource \"aws_internet_gateway\" \"cluster_igw\" { vpc_id = aws_vpc.cluster_vpc.id tags = { Name = \"ecs-igw\" } } resource \"aws_route_table\" \"public_route\" { vpc_id = aws_vpc.cluster_vpc.id route { cidr_block = \"0.0.0.0/0\" gateway_id = aws_internet_gateway.cluster_igw.id } tags = { Name = \"ecs-route-table\" } } resource \"aws_route_table_association\" \"to-public\" { count = length(aws_subnet.cluster) subnet_id = aws_subnet.cluster[count.index].id route_table_id = aws_route_table.public_route.id } resource \"aws_ecs_cluster\" \"staging\" { name = \"service-ecs-cluster\" } resource \"aws_ecs_service\" \"staging\" { name = \"staging\" cluster = aws_ecs_cluster.staging.id task_definition = aws_ecs_task_definition.service.arn desired_count = 1 launch_type = \"FARGATE\" network_configuration { security_groups = [aws_security_group.ecs_tasks.id] subnets = aws_subnet.cluster[*].id assign_public_ip = true } load_balancer { target_group_arn = aws_lb_target_group.staging.arn container_name = var.app_name container_port = var.container_port } resource \"aws_lb\" \"staging\" { name = \"alb\" subnets = aws_subnet.cluster[*].id load_balancer_type = \"application\" security_groups = [aws_security_group.lb.id] access_logs { bucket = aws_s3_bucket.log_storage.id prefix = \"frontend-alb\" enabled = true } tags = { Environment = \"staging\" Application = var.app_name } ", "keywords": ["cluster"]}]}], "answers": [{"Id": "65507266", "PostTypeId": "2", "ParentId": "65506279", "CreationDate": "2020-12-30T12:50:59.453", "Score": "5", "Body": "<blockquote>\n<p>Alb for Ecs fargate is for routing to another avaliablity zones? or routing to containers</p>\n</blockquote>\n<p>Not really. It is to provide a single, fixed endpoint (url) to your ECS service. The ALB will automatically distribute incoming connection from the internet across your ECS services. They can be in one or multiple AZs. In your case it is <strong>only 1 AZ</strong> since you are using <code>desired_count   = 1</code>. This means that you will have only 1 ECS service in a single AZ.</p>\n<blockquote>\n<p>If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply?</p>\n</blockquote>\n<p>Yes, because your ALB is enabled for the same subnets as your ECS service through <code>aws_subnet.cluster[*].id</code>. But as explained in the first question, you will have only 1 service in one AZ.</p>\n<blockquote>\n<p>my intent is to build infra which has three availability zone and also deploy aws fargate on three availablity zone.</p>\n</blockquote>\n<p>As explained before, your <code>desired_count   = 1</code> so you will not have ECS services across 3 AZs.</p>\n<p>Also you are creating only <strong>public subnets</strong>, while your schematic diagram shows that ECS services should be in private ones.</p>\n", "OwnerUserId": "248823", "LastEditorUserId": "248823", "LastEditDate": "2020-12-30T12:57:49.623", "LastActivityDate": "2020-12-30T12:57:49.623", "CommentCount": "8", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "115814176", "PostId": "65507266", "Score": "0", "Text": "great! if i increase desired_count as 3 or apply auto scale, AZ works?", "CreationDate": "2020-12-30T12:58:36.307", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115814225", "PostId": "65507266", "Score": "0", "Text": "and .Is this going to cause a fare increase?  i'm little bit confused that if AZ works, aws fargate service should activate each AZ. it means if i have two AZ (us-east-2a, us-east-2b), also i have two ecs fargate, right?", "CreationDate": "2020-12-30T13:00:49.813", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115814235", "PostId": "65507266", "Score": "0", "Text": "@KIM Yes, the 3 ecs services will be distributed across multiple AZs. You can change `desired_count` to 3 , and the check your tasks' details in your ECS service. You can confirm which subnets they aware placed into.", "CreationDate": "2020-12-30T13:01:08.683", "UserId": "248823", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can change `desired_count` to 3 , and the check your tasks' details in your ECS service. ", "keywords": ["change"]}]}, {"Id": "115814275", "PostId": "65507266", "Score": "0", "Text": "@KIM I'm not sure what do you mean in your second comment? You can have as many ECS fargate services as you want. You can place them all in one AZ, or across multiple AZs. You can have more services then there are AZs.", "CreationDate": "2020-12-30T13:02:49.580", "UserId": "248823", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115814323", "PostId": "65507266", "Score": "0", "Text": "multiple AZ can share one ecs fargate?", "CreationDate": "2020-12-30T13:04:51.397", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115814367", "PostId": "65507266", "Score": "0", "Text": "i understand if some AZ has broken, another AZ works, and it can be done by ALB (because alb can route it to another availiable zone) and each AZ has duplicated AWS ECS Fargate.", "CreationDate": "2020-12-30T13:07:14.517", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115814396", "PostId": "65507266", "Score": "0", "Text": "@KIM In terms of ALB, if you enable ALB for all AZs, then yes, they can all direct traffic across all AZs into one ECS service because ALB uses cross-zone load balancing by default.", "CreationDate": "2020-12-30T13:08:42.030", "UserId": "248823", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115814461", "PostId": "65507266", "Score": "0", "Text": "Let us [continue this discussion in chat](https://chat.stackoverflow.com/rooms/226604/discussion-between-kim-and-marcin).", "CreationDate": "2020-12-30T13:10:56.653", "UserId": "5113276", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "237828680", "PostHistoryTypeId": "2", "PostId": "65507266", "RevisionGUID": "e5b507b1-3417-4867-9e93-164b4c6c95fd", "CreationDate": "2020-12-30T12:50:59.453", "UserId": "248823", "Text": "> Alb for Ecs fargate is for routing to another avaliablity zones? or routing to containers\r\n\r\nNot really. It is to provide a single, fixed endpoint (url) to your ECS service. The ALB will automatically distribute incoming connection from the internet across your ECS services. They can be in one or multiple AZs. In your case it is **only 1 AZ** since you are using `desired_count   = 1`. This means that you will have only 1 ECS service in a single AZ. \r\n\r\n> If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply?\r\n\r\nYes, because your ALB is enabled for the same subnets as your ECS service through `aws_subnet.cluster[*].id`. But as explained in the first question, you will have only 1 service in one AZ.\r\n\r\n> my intent is to build infra which has three availability zone and also deploy aws fargate on three availablity zone.\r\n\r\nAs explained before, your `desired_count   = 1` so you will not services across 3 AZs. \r\n\r\nAlso you are creating only **public subnets**, while your schematic diagram shows that ECS services should be in private ones. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "> If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply? ", "keywords": ["cluster"]}, {"source": "Text", "text": "Yes, because your ALB is enabled for the same subnets as your ECS service through `aws_subnet.cluster[*].id`. ", "keywords": ["cluster"]}]}, {"Id": "237829037", "PostHistoryTypeId": "5", "PostId": "65507266", "RevisionGUID": "db04f3b2-d448-4daf-a1c7-994339f54199", "CreationDate": "2020-12-30T12:57:49.623", "UserId": "248823", "Comment": "added 9 characters in body", "Text": "> Alb for Ecs fargate is for routing to another avaliablity zones? or routing to containers\r\n\r\nNot really. It is to provide a single, fixed endpoint (url) to your ECS service. The ALB will automatically distribute incoming connection from the internet across your ECS services. They can be in one or multiple AZs. In your case it is **only 1 AZ** since you are using `desired_count   = 1`. This means that you will have only 1 ECS service in a single AZ. \r\n\r\n> If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply?\r\n\r\nYes, because your ALB is enabled for the same subnets as your ECS service through `aws_subnet.cluster[*].id`. But as explained in the first question, you will have only 1 service in one AZ.\r\n\r\n> my intent is to build infra which has three availability zone and also deploy aws fargate on three availablity zone.\r\n\r\nAs explained before, your `desired_count   = 1` so you will not have ECS services across 3 AZs. \r\n\r\nAlso you are creating only **public subnets**, while your schematic diagram shows that ECS services should be in private ones. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "> If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply? ", "keywords": ["cluster"]}, {"source": "Text", "text": "Yes, because your ALB is enabled for the same subnets as your ECS service through `aws_subnet.cluster[*].id`. ", "keywords": ["cluster"]}]}], "filtered-sentences": [{"source": "Body", "text": "If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply? ", "keywords": ["cluster"]}, {"source": "Body", "text": "Yes, because your ALB is enabled for the same subnets as your ECS service through aws_subnet.cluster[*].id. ", "keywords": ["cluster"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "If I create a subnet based on the availability zone number (us-east-2a, 2b, 2c, so number is 3 and create 3 subnets) and map it to an ecs cluster with alb, does the availability zone apply? ", "keywords": ["cluster"]}]}