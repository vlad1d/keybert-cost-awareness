{"Id": "74494380", "PostTypeId": "1", "AcceptedAnswerId": "74498502", "CreationDate": "2022-11-18T19:16:35.280", "Score": "0", "ViewCount": "273", "Body": "<p>My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the &quot;attribute value typ&quot;</p>\n<p>My Terraform code:</p>\n<pre><code>resource &quot;azurerm_network_security_group&quot; &quot;example&quot; {\n  name                = &quot;01-tf-SG&quot;\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n\n  security_rule {\n    name                       = &quot;test123&quot;\n    priority                   = 100\n    direction                  = &quot;Inbound&quot;\n    access                     = &quot;Allow&quot;\n    protocol                   = **[&quot;Icmp&quot;, &quot;Tcp&quot;]**  ---&gt; iT FAILS!!! \n    source_port_range          = &quot;*&quot;\n    destination_port_range     = &quot;*&quot;\n    source_address_prefix      = &quot;172.16.25.10/32&quot;\n    destination_address_prefix = &quot;10.0.1.10/32&quot;\n  }\n</code></pre>\n<p>I didn't find any example in terraform repo: <a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule\" rel=\"nofollow noreferrer\">https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule</a></p>\n<p>Be able to use multiple protocols on the same security rule protocol field.</p>\n", "OwnerUserId": "20432287", "LastEditorUserId": "13302", "LastEditDate": "2022-11-18T19:27:56.260", "LastActivityDate": "2022-11-19T21:19:26.967", "Title": "How do I create a security rules with multiple protocols using Terraform in Azure?", "Tags": "<azure><terraform>", "AnswerCount": "3", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "282529530", "PostHistoryTypeId": "2", "PostId": "74494380", "RevisionGUID": "d6014f13-1fd3-44c0-bbc8-6550a80ea337", "CreationDate": "2022-11-18T19:16:35.280", "UserId": "20432287", "Text": "My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the \"attribute value typ\" \r\n\r\nMy Terraform code:\r\n\r\n`\r\n```\r\nresource \"azurerm_network_security_group\" \"example\" {\r\n  name                = \"abb-tf-SG\"\r\n  location            = azurerm_resource_group.main.location\r\n  resource_group_name = azurerm_resource_group.main.name\r\n\r\n  security_rule {\r\n    name                       = \"test123\"\r\n    priority                   = 100\r\n    direction                  = \"Inbound\"\r\n    access                     = \"Allow\"\r\n    protocol                   = **[\"Icmp\", \"Tcp\"]**  ---> iT FAILS!!! \r\n    source_port_range          = \"*\"\r\n    destination_port_range     = \"*\"\r\n    source_address_prefix      = \"172.16.25.10/32\"\r\n    destination_address_prefix = \"10.0.1.10/32\"\r\n  }\r\n```\r\n`\r\nI didn't find any example in terraform repo: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule\r\n\r\nBe able to use multiple protocols on the same security rule protocol field.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the \"attribute value typ\" My Terraform code: ` ``` resource \"azurerm_network_security_group\" \"example\" { name = \"abb-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name security_rule { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = **[\"Icmp\", \"Tcp\"]** ---> iT FAILS!!! source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" ", "keywords": ["test"]}]}, {"Id": "282529532", "PostHistoryTypeId": "1", "PostId": "74494380", "RevisionGUID": "d6014f13-1fd3-44c0-bbc8-6550a80ea337", "CreationDate": "2022-11-18T19:16:35.280", "UserId": "20432287", "Text": "How do I create a Security rules wiht multiple Protocols using Terraform in Azure?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "282529533", "PostHistoryTypeId": "3", "PostId": "74494380", "RevisionGUID": "d6014f13-1fd3-44c0-bbc8-6550a80ea337", "CreationDate": "2022-11-18T19:16:35.280", "UserId": "20432287", "Text": "<azure><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "282529534", "PostHistoryTypeId": "66", "PostId": "74494380", "RevisionGUID": "d6014f13-1fd3-44c0-bbc8-6550a80ea337", "CreationDate": "2022-11-18T19:16:35.280", "UserId": "20432287", "filtered-sentences": []}, {"Id": "282529581", "PostHistoryTypeId": "5", "PostId": "74494380", "RevisionGUID": "6398bfb5-c699-4200-807d-2332dbac5a92", "CreationDate": "2022-11-18T19:17:17.217", "UserId": "20432287", "Comment": "deleted 1 character in body", "Text": "My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the \"attribute value typ\" \r\n\r\nMy Terraform code:\r\n\r\n`\r\n```\r\nresource \"azurerm_network_security_group\" \"example\" {\r\n  name                = \"01-tf-SG\"\r\n  location            = azurerm_resource_group.main.location\r\n  resource_group_name = azurerm_resource_group.main.name\r\n\r\n  security_rule {\r\n    name                       = \"test123\"\r\n    priority                   = 100\r\n    direction                  = \"Inbound\"\r\n    access                     = \"Allow\"\r\n    protocol                   = **[\"Icmp\", \"Tcp\"]**  ---> iT FAILS!!! \r\n    source_port_range          = \"*\"\r\n    destination_port_range     = \"*\"\r\n    source_address_prefix      = \"172.16.25.10/32\"\r\n    destination_address_prefix = \"10.0.1.10/32\"\r\n  }\r\n```\r\n`\r\nI didn't find any example in terraform repo: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule\r\n\r\nBe able to use multiple protocols on the same security rule protocol field.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the \"attribute value typ\" My Terraform code: ` ``` resource \"azurerm_network_security_group\" \"example\" { name = \"01-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name security_rule { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = **[\"Icmp\", \"Tcp\"]** ---> iT FAILS!!! source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" ", "keywords": ["test"]}]}, {"Id": "282530068", "PostHistoryTypeId": "5", "PostId": "74494380", "RevisionGUID": "0643b140-3033-4afa-9477-d3537d81b227", "CreationDate": "2022-11-18T19:27:56.260", "UserId": "13302", "Comment": "deleted 4 characters in body; edited title", "Text": "My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the \"attribute value typ\" \r\n\r\nMy Terraform code:\r\n\r\n```\r\nresource \"azurerm_network_security_group\" \"example\" {\r\n  name                = \"01-tf-SG\"\r\n  location            = azurerm_resource_group.main.location\r\n  resource_group_name = azurerm_resource_group.main.name\r\n\r\n  security_rule {\r\n    name                       = \"test123\"\r\n    priority                   = 100\r\n    direction                  = \"Inbound\"\r\n    access                     = \"Allow\"\r\n    protocol                   = **[\"Icmp\", \"Tcp\"]**  ---> iT FAILS!!! \r\n    source_port_range          = \"*\"\r\n    destination_port_range     = \"*\"\r\n    source_address_prefix      = \"172.16.25.10/32\"\r\n    destination_address_prefix = \"10.0.1.10/32\"\r\n  }\r\n```\r\n\r\nI didn't find any example in terraform repo: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule\r\n\r\nBe able to use multiple protocols on the same security rule protocol field.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "My plan is to allow the protocols ICMP and TCP on the same security rule but I'm having problems related the \"attribute value typ\" My Terraform code: ``` resource \"azurerm_network_security_group\" \"example\" { name = \"01-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name security_rule { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = **[\"Icmp\", \"Tcp\"]** ---> iT FAILS!!! source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" ", "keywords": ["test"]}]}, {"Id": "282530069", "PostHistoryTypeId": "4", "PostId": "74494380", "RevisionGUID": "0643b140-3033-4afa-9477-d3537d81b227", "CreationDate": "2022-11-18T19:27:56.260", "UserId": "13302", "Comment": "deleted 4 characters in body; edited title", "Text": "How do I create a security rules with multiple protocols using Terraform in Azure?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "74494753", "PostTypeId": "2", "ParentId": "74494380", "CreationDate": "2022-11-18T19:58:35.527", "Score": "0", "Body": "<p>The protocol attribute <a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_group\" rel=\"nofollow noreferrer\">doesn't accept a list</a>. You would either need to create two security rules, or use <code>*</code> for the protocol.</p>\n", "OwnerUserId": "13070", "LastActivityDate": "2022-11-18T19:58:35.527", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "282531631", "PostHistoryTypeId": "2", "PostId": "74494753", "RevisionGUID": "b5841e7d-020a-4005-a53f-3ccd1adda1f8", "CreationDate": "2022-11-18T19:58:35.527", "UserId": "13070", "Text": "The protocol attribute [doesn't accept a list][1]. You would either need to create two security rules, or use `*` for the protocol.\r\n\r\n\r\n  [1]: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_group", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "74498502", "PostTypeId": "2", "ParentId": "74494380", "CreationDate": "2022-11-19T08:21:04.553", "Score": "1", "Body": "<p>As <code>Mark B</code> listed in his answer, you cannot provide a list for <code>protocol</code>. However you could use a <a href=\"https://developer.hashicorp.com/terraform/language/expressions/dynamic-blocks\" rel=\"nofollow noreferrer\">dynamic block</a> so it would create the two rules without having to define them both individually duplicating the code</p>\n<pre><code>resource &quot;azurerm_network_security_group&quot; &quot;example&quot; {\n  name                = &quot;01-tf-SG&quot;\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n\n  dynamic &quot;security_rule&quot; {\n    for_each = toset([&quot;Icmp&quot;, &quot;Tcp&quot;])\n    content {\n      name                       = &quot;test123&quot;\n      priority                   = 100\n      direction                  = &quot;Inbound&quot;\n      access                     = &quot;Allow&quot;\n      protocol                   = security_rule.value\n      source_port_range          = &quot;*&quot;\n      destination_port_range     = &quot;*&quot;\n      source_address_prefix      = &quot;172.16.25.10/32&quot;\n      destination_address_prefix = &quot;10.0.1.10/32&quot;\n    }\n  }\n}\n</code></pre>\n", "OwnerUserId": "1212401", "LastEditorUserId": "1212401", "LastEditDate": "2022-11-19T21:19:26.967", "LastActivityDate": "2022-11-19T21:19:26.967", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "282563016", "PostHistoryTypeId": "2", "PostId": "74498502", "RevisionGUID": "9ad1714a-bb64-4c54-b4d5-f21ecd9abd2f", "CreationDate": "2022-11-19T08:21:04.553", "UserId": "1212401", "Text": "As `Mark B` listed in his answer, you cannot provide a list for `protocol`. However you could use a [dynamic block][1] so it would create the two rules without having to define them both individually duplicating the code\r\n\r\n```hcl\r\nresource \"azurerm_network_security_group\" \"example\" {\r\n  name                = \"01-tf-SG\"\r\n  location            = azurerm_resource_group.main.location\r\n  resource_group_name = azurerm_resource_group.main.name\r\n\r\n  dynamic \"security_rule\" {\r\n    for_each = toset(\"Icmp\", \"Tcp\")\r\n    content {\r\n      name                       = \"test123\"\r\n      priority                   = 100\r\n      direction                  = \"Inbound\"\r\n      access                     = \"Allow\"\r\n      protocol                   = security_rule.value\r\n      source_port_range          = \"*\"\r\n      destination_port_range     = \"*\"\r\n      source_address_prefix      = \"172.16.25.10/32\"\r\n      destination_address_prefix = \"10.0.1.10/32\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n\r\n  [1]: https://developer.hashicorp.com/terraform/language/expressions/dynamic-blocks", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "However you could use a [dynamic block][1] so it would create the two rules without having to define them both individually duplicating the code ```hcl resource \"azurerm_network_security_group\" \"example\" { name = \"01-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name dynamic \"security_rule\" { for_each = toset(\"Icmp\", \"Tcp\") content { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = security_rule.value source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" ", "keywords": ["test"]}]}, {"Id": "282593588", "PostHistoryTypeId": "5", "PostId": "74498502", "RevisionGUID": "0f9bc324-b4da-47e3-897f-b0decfad1170", "CreationDate": "2022-11-19T21:19:26.967", "UserId": "1212401", "Comment": "Updated syntax", "Text": "As `Mark B` listed in his answer, you cannot provide a list for `protocol`. However you could use a [dynamic block][1] so it would create the two rules without having to define them both individually duplicating the code\r\n\r\n```hcl\r\nresource \"azurerm_network_security_group\" \"example\" {\r\n  name                = \"01-tf-SG\"\r\n  location            = azurerm_resource_group.main.location\r\n  resource_group_name = azurerm_resource_group.main.name\r\n\r\n  dynamic \"security_rule\" {\r\n    for_each = toset([\"Icmp\", \"Tcp\"])\r\n    content {\r\n      name                       = \"test123\"\r\n      priority                   = 100\r\n      direction                  = \"Inbound\"\r\n      access                     = \"Allow\"\r\n      protocol                   = security_rule.value\r\n      source_port_range          = \"*\"\r\n      destination_port_range     = \"*\"\r\n      source_address_prefix      = \"172.16.25.10/32\"\r\n      destination_address_prefix = \"10.0.1.10/32\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n\r\n  [1]: https://developer.hashicorp.com/terraform/language/expressions/dynamic-blocks", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "However you could use a [dynamic block][1] so it would create the two rules without having to define them both individually duplicating the code ```hcl resource \"azurerm_network_security_group\" \"example\" { name = \"01-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name dynamic \"security_rule\" { for_each = toset([\"Icmp\", \"Tcp\"]) content { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = security_rule.value source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" ", "keywords": ["test"]}]}], "filtered-sentences": []}, {"Id": "74499189", "PostTypeId": "2", "ParentId": "74494380", "CreationDate": "2022-11-19T10:22:52.743", "Score": "1", "Body": "<p>Thanks @chris Doyle. Your solution is the most efficient.</p>\n<p>Just note that you forgot the <strong>[ ]</strong> into toset function. So the final code would be:</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>resource \"azurerm_network_security_group\" \"example\" {\n  name                = \"01-tf-SG\"\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n\n  dynamic \"security_rule\" {\n    for_each = toset([\"Icmp\", \"Tcp\"])\n    content {\n      name                       = \"test123\"\n      priority                   = 100\n      direction                  = \"Inbound\"\n      access                     = \"Allow\"\n      protocol                   = security_rule.value\n      source_port_range          = \"*\"\n      destination_port_range     = \"*\"\n      source_address_prefix      = \"172.16.25.10/32\"\n      destination_address_prefix = \"10.0.1.10/32\"\n    }\n  }\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>Result:</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code># azurerm_network_security_group.example will be created\n  + resource \"azurerm_network_security_group\" \"example\" {\n      + id                  = (known after apply)\n      + location            = \"westeurope\"\n      + name                = \"01-tf-SG\"\n      + resource_group_name = \"RG_AZ_Terraform\"\n      + security_rule       = [\n          + {\n              + access                                     = \"Allow\"\n              + description                                = \"\"\n              + destination_address_prefix                 = \"10.0.1.10/32\"\n              + destination_address_prefixes               = []\n              + destination_application_security_group_ids = []\n              + destination_port_range                     = \"*\"\n              + destination_port_ranges                    = []\n              + direction                                  = \"Inbound\"\n              + name                                       = \"test123\"\n              + priority                                   = 100\n              + protocol                                   = \"Icmp\"\n              + source_address_prefix                      = \"172.16.25.10/32\"\n              + source_address_prefixes                    = []\n              + source_application_security_group_ids      = []\n              + source_port_range                          = \"*\"\n              + source_port_ranges                         = []\n            },\n          + {\n              + access                                     = \"Allow\"\n              + description                                = \"\"\n              + destination_address_prefix                 = \"10.0.1.10/32\"\n              + destination_address_prefixes               = []\n              + destination_application_security_group_ids = []\n              + destination_port_range                     = \"*\"\n              + destination_port_ranges                    = []\n              + direction                                  = \"Inbound\"\n              + name                                       = \"test123\"\n              + priority                                   = 100\n              + protocol                                   = \"Tcp\"\n              + source_address_prefix                      = \"172.16.25.10/32\"\n              + source_address_prefixes                    = []\n              + source_application_security_group_ids      = []\n              + source_port_range                          = \"*\"\n              + source_port_ranges                         = []\n            },\n        ]\n    }</code></pre>\r\n</div>\r\n</div>\r\n</p>\n", "OwnerUserId": "20432287", "LastEditorUserId": "20432287", "LastEditDate": "2022-11-19T10:23:42.593", "LastActivityDate": "2022-11-19T10:23:42.593", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "131518206", "PostId": "74499189", "Score": "0", "Text": "Ah yeah sorry. I didn't test this just wrote it by hand. Will update the answer.", "CreationDate": "2022-11-19T21:19:01.470", "UserId": "1212401", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I didn't test this just wrote it by hand. ", "keywords": ["test"]}]}], "history": [{"Id": "282566801", "PostHistoryTypeId": "2", "PostId": "74499189", "RevisionGUID": "8f192b2d-78c1-4762-bf7c-e664569c46ec", "CreationDate": "2022-11-19T10:22:52.743", "UserId": "20432287", "Text": "Thanks @chris Doyle. Your solution is the most efficient.\r\n\r\nJust note that you forgot the **[ ]** into toset function. So the final code would be:\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n\r\n    resource \"azurerm_network_security_group\" \"example\" {\r\n      name                = \"01-tf-SG\"\r\n      location            = azurerm_resource_group.main.location\r\n      resource_group_name = azurerm_resource_group.main.name\r\n\r\n      dynamic \"security_rule\" {\r\n        for_each = toset([\"Icmp\", \"Tcp\"])\r\n        content {\r\n          name                       = \"test123\"\r\n          priority                   = 100\r\n          direction                  = \"Inbound\"\r\n          access                     = \"Allow\"\r\n          protocol                   = security_rule.value\r\n          source_port_range          = \"*\"\r\n          destination_port_range     = \"*\"\r\n          source_address_prefix      = \"172.16.25.10/32\"\r\n          destination_address_prefix = \"10.0.1.10/32\"\r\n        }\r\n      }\r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\n\r\nResult:\r\n \r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    # azurerm_network_security_group.example will be created\r\n      + resource \"azurerm_network_security_group\" \"example\" {\r\n          + id                  = (known after apply)\r\n          + location            = \"westeurope\"\r\n          + name                = \"01-tf-SG\"\r\n          + resource_group_name = \"RG_ABB_Terraform\"\r\n          + security_rule       = [\r\n              + {\r\n                  + access                                     = \"Allow\"\r\n                  + description                                = \"\"\r\n                  + destination_address_prefix                 = \"10.0.1.10/32\"\r\n                  + destination_address_prefixes               = []\r\n                  + destination_application_security_group_ids = []\r\n                  + destination_port_range                     = \"*\"\r\n                  + destination_port_ranges                    = []\r\n                  + direction                                  = \"Inbound\"\r\n                  + name                                       = \"test123\"\r\n                  + priority                                   = 100\r\n                  + protocol                                   = \"Icmp\"\r\n                  + source_address_prefix                      = \"172.16.25.10/32\"\r\n                  + source_address_prefixes                    = []\r\n                  + source_application_security_group_ids      = []\r\n                  + source_port_range                          = \"*\"\r\n                  + source_port_ranges                         = []\r\n                },\r\n              + {\r\n                  + access                                     = \"Allow\"\r\n                  + description                                = \"\"\r\n                  + destination_address_prefix                 = \"10.0.1.10/32\"\r\n                  + destination_address_prefixes               = []\r\n                  + destination_application_security_group_ids = []\r\n                  + destination_port_range                     = \"*\"\r\n                  + destination_port_ranges                    = []\r\n                  + direction                                  = \"Inbound\"\r\n                  + name                                       = \"test123\"\r\n                  + priority                                   = 100\r\n                  + protocol                                   = \"Tcp\"\r\n                  + source_address_prefix                      = \"172.16.25.10/32\"\r\n                  + source_address_prefixes                    = []\r\n                  + source_application_security_group_ids      = []\r\n                  + source_port_range                          = \"*\"\r\n                  + source_port_ranges                         = []\r\n                },\r\n            ]\r\n        }\r\n\r\n\r\n<!-- end snippet -->\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Your solution is the most efficient. ", "keywords": ["efficient"]}, {"source": "Text", "text": "So the final code would be: resource \"azurerm_network_security_group\" \"example\" { name = \"01-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name dynamic \"security_rule\" { for_each = toset([\"Icmp\", \"Tcp\"]) content { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = security_rule.value source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" } } } Result: # azurerm_network_security_group.example will be created + resource \"azurerm_network_security_group\" \"example\" { + id = (known after apply) + location = \"westeurope\" + name = \"01-tf-SG\" + resource_group_name = \"RG_ABB_Terraform\" + security_rule = [ + { + access = \"Allow\" + description = \"\" + destination_address_prefix = \"10.0.1.10/32\" + destination_address_prefixes = [] + destination_application_security_group_ids = [] + destination_port_range = \"*\" + destination_port_ranges = [] + direction = \"Inbound\" + name = \"test123\" + priority = 100 + protocol = \"Icmp\" + source_address_prefix = \"172.16.25.10/32\" + source_address_prefixes = [] + source_application_security_group_ids = [] + source_port_range = \"*\" + source_port_ranges = [] }, + { + access = \"Allow\" + description = \"\" + destination_address_prefix = \"10.0.1.10/32\" + destination_address_prefixes = [] + destination_application_security_group_ids = [] + destination_port_range = \"*\" + destination_port_ranges = [] + direction = \"Inbound\" + name = \"test123\" + priority = 100 + protocol = \"Tcp\" + source_address_prefix = \"172.16.25.10/32\" + source_address_prefixes = [] + source_application_security_group_ids = [] + source_port_range = \"*\" + source_port_ranges = [] }, ] }", "keywords": ["test"]}]}, {"Id": "282566817", "PostHistoryTypeId": "5", "PostId": "74499189", "RevisionGUID": "2e1c4d0a-9b78-4e9c-a572-d2830053b40b", "CreationDate": "2022-11-19T10:23:42.593", "UserId": "20432287", "Comment": "deleted 1 character in body", "Text": "Thanks @chris Doyle. Your solution is the most efficient.\r\n\r\nJust note that you forgot the **[ ]** into toset function. So the final code would be:\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n\r\n    resource \"azurerm_network_security_group\" \"example\" {\r\n      name                = \"01-tf-SG\"\r\n      location            = azurerm_resource_group.main.location\r\n      resource_group_name = azurerm_resource_group.main.name\r\n\r\n      dynamic \"security_rule\" {\r\n        for_each = toset([\"Icmp\", \"Tcp\"])\r\n        content {\r\n          name                       = \"test123\"\r\n          priority                   = 100\r\n          direction                  = \"Inbound\"\r\n          access                     = \"Allow\"\r\n          protocol                   = security_rule.value\r\n          source_port_range          = \"*\"\r\n          destination_port_range     = \"*\"\r\n          source_address_prefix      = \"172.16.25.10/32\"\r\n          destination_address_prefix = \"10.0.1.10/32\"\r\n        }\r\n      }\r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\n\r\nResult:\r\n \r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    # azurerm_network_security_group.example will be created\r\n      + resource \"azurerm_network_security_group\" \"example\" {\r\n          + id                  = (known after apply)\r\n          + location            = \"westeurope\"\r\n          + name                = \"01-tf-SG\"\r\n          + resource_group_name = \"RG_AZ_Terraform\"\r\n          + security_rule       = [\r\n              + {\r\n                  + access                                     = \"Allow\"\r\n                  + description                                = \"\"\r\n                  + destination_address_prefix                 = \"10.0.1.10/32\"\r\n                  + destination_address_prefixes               = []\r\n                  + destination_application_security_group_ids = []\r\n                  + destination_port_range                     = \"*\"\r\n                  + destination_port_ranges                    = []\r\n                  + direction                                  = \"Inbound\"\r\n                  + name                                       = \"test123\"\r\n                  + priority                                   = 100\r\n                  + protocol                                   = \"Icmp\"\r\n                  + source_address_prefix                      = \"172.16.25.10/32\"\r\n                  + source_address_prefixes                    = []\r\n                  + source_application_security_group_ids      = []\r\n                  + source_port_range                          = \"*\"\r\n                  + source_port_ranges                         = []\r\n                },\r\n              + {\r\n                  + access                                     = \"Allow\"\r\n                  + description                                = \"\"\r\n                  + destination_address_prefix                 = \"10.0.1.10/32\"\r\n                  + destination_address_prefixes               = []\r\n                  + destination_application_security_group_ids = []\r\n                  + destination_port_range                     = \"*\"\r\n                  + destination_port_ranges                    = []\r\n                  + direction                                  = \"Inbound\"\r\n                  + name                                       = \"test123\"\r\n                  + priority                                   = 100\r\n                  + protocol                                   = \"Tcp\"\r\n                  + source_address_prefix                      = \"172.16.25.10/32\"\r\n                  + source_address_prefixes                    = []\r\n                  + source_application_security_group_ids      = []\r\n                  + source_port_range                          = \"*\"\r\n                  + source_port_ranges                         = []\r\n                },\r\n            ]\r\n        }\r\n\r\n\r\n<!-- end snippet -->\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Your solution is the most efficient. ", "keywords": ["efficient"]}, {"source": "Text", "text": "So the final code would be: resource \"azurerm_network_security_group\" \"example\" { name = \"01-tf-SG\" location = azurerm_resource_group.main.location resource_group_name = azurerm_resource_group.main.name dynamic \"security_rule\" { for_each = toset([\"Icmp\", \"Tcp\"]) content { name = \"test123\" priority = 100 direction = \"Inbound\" access = \"Allow\" protocol = security_rule.value source_port_range = \"*\" destination_port_range = \"*\" source_address_prefix = \"172.16.25.10/32\" destination_address_prefix = \"10.0.1.10/32\" } } } Result: # azurerm_network_security_group.example will be created + resource \"azurerm_network_security_group\" \"example\" { + id = (known after apply) + location = \"westeurope\" + name = \"01-tf-SG\" + resource_group_name = \"RG_AZ_Terraform\" + security_rule = [ + { + access = \"Allow\" + description = \"\" + destination_address_prefix = \"10.0.1.10/32\" + destination_address_prefixes = [] + destination_application_security_group_ids = [] + destination_port_range = \"*\" + destination_port_ranges = [] + direction = \"Inbound\" + name = \"test123\" + priority = 100 + protocol = \"Icmp\" + source_address_prefix = \"172.16.25.10/32\" + source_address_prefixes = [] + source_application_security_group_ids = [] + source_port_range = \"*\" + source_port_ranges = [] }, + { + access = \"Allow\" + description = \"\" + destination_address_prefix = \"10.0.1.10/32\" + destination_address_prefixes = [] + destination_application_security_group_ids = [] + destination_port_range = \"*\" + destination_port_ranges = [] + direction = \"Inbound\" + name = \"test123\" + priority = 100 + protocol = \"Tcp\" + source_address_prefix = \"172.16.25.10/32\" + source_address_prefixes = [] + source_application_security_group_ids = [] + source_port_range = \"*\" + source_port_ranges = [] }, ] }", "keywords": ["test"]}]}], "filtered-sentences": [{"source": "Body", "text": "Your solution is the most efficient. ", "keywords": ["efficient"]}]}], "contains-topic": true, "filtered-sentences": []}