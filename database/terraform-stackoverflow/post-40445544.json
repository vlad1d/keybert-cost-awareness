{"Id": "40445544", "PostTypeId": "1", "CreationDate": "2016-11-06T02:52:35.550", "Score": "2", "ViewCount": "2940", "Body": "<p>I'm using Terraform to spin-up my infrastructure on AWS and keep state in the .tfstate file. In my application I have to VPN into other networks where the admin of the other network has defined parameters on the IPSec ESP connection that the VPN connection on my end has to adhere to.</p>\n\n<p>Using Terraform I create a VPN Gateway and a Customer Gateway with the remote network's parameters to the extent that's possible. Then I create a VPN connection and the appropriate route. Here's my VPN code in Terraform:</p>\n\n<pre><code>resource \"aws_vpn_gateway\" \"vpn_gw\" {\n    vpc_id = \"${aws_vpc.default.id}\"\n\n    tags {\n        Name = \"default\"\n        Terraform = true\n    }\n}\n\nresource \"aws_customer_gateway\" \"customer_gw\" {\n    bgp_asn = 65000\n    ip_address = \"172.0.0.1\"\n    type = \"ipsec.1\"\n}\n\nresource \"aws_vpn_connection\" \"default\" {\n    vpn_gateway_id = \"${aws_vpn_gateway.vpn_gw.id}\"\n    customer_gateway_id = \"${aws_customer_gateway.customer_gw.id}\"\n    type = \"ipsec.1\"\n    static_routes_only = true\n}\n\nresource \"aws_vpn_connection_route\" \"office\" {\n    destination_cidr_block = \"192.168.10.0/24\"\n    vpn_connection_id = \"${aws_vpn_connection.default.id}\"\n}\n</code></pre>\n\n<p>I have to be able to set the following parameters on my VPN tunnel for phase 1 and phase 2 of the connection:</p>\n\n<p>Phase 1</p>\n\n<ul>\n<li><strong>Authentication Method</strong> e.g. Pre-shared Secret</li>\n<li><strong>Encryption Scheme</strong> e.g. IKE</li>\n<li><strong>Diffie-Hellman Group</strong> e.g. Group 2</li>\n<li><strong>Encryption Algorithm</strong> e.g. AES-256</li>\n<li><strong>Hashing Algorithm</strong> e.g. SHA-1</li>\n<li><strong>Main or Aggressive Mode</strong> e.g. Main Mode</li>\n<li><strong>Lifetime (for renegotiation)</strong> e.g. 86400</li>\n</ul>\n\n<p>Phase 2</p>\n\n<ul>\n<li><strong>Encapsulation (ESP or AH)</strong> e.g. ESP</li>\n<li><strong>Encryption Algorithm</strong> e.g. AES-256</li>\n<li><strong>Authentication Algorithm</strong> e.g. SHA-1</li>\n<li><strong>Perfect Forward Secrecy</strong> e.g. NO-PFS</li>\n<li><strong>Lifetime (for renegotiation)</strong> e.g. 3600</li>\n</ul>\n\n<p>The docs on the VPN Customer Gateway show that you can't set that many parameters yourself: <a href=\"https://www.terraform.io/docs/providers/aws/r/customer_gateway.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/providers/aws/r/customer_gateway.html</a>\nThe Boto API also doesn't allow any additional parameters to be set.</p>\n\n<p>Is there any way of setting these parameters (programmatically)?</p>\n", "OwnerUserId": "3678551", "LastActivityDate": "2017-04-16T17:45:01.403", "Title": "Terraform (AWS) create VPN IPSec connection with non-default parameters", "Tags": "<amazon-web-services><vpn><terraform>", "AnswerCount": "1", "CommentCount": "1", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "129858030", "PostId": "40445544", "Score": "0", "Text": "2022 update: looks like most of these settings are now available here: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpn_connection", "CreationDate": "2022-08-30T02:28:42.407", "UserId": "2056394", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "130916915", "PostHistoryTypeId": "2", "PostId": "40445544", "RevisionGUID": "d33d4d53-2975-44f3-953a-a3ebc80fcb17", "CreationDate": "2016-11-06T02:52:35.550", "UserId": "3678551", "Text": "I'm using Terraform to spin-up my infrastructure on AWS and keep state in the .tfstate file. In my application I have to VPN into other networks where the admin of the other network has defined parameters on the IPSec ESP connection that the VPN connection on my end has to adhere to.\r\n\r\nUsing Terraform I create a VPN Gateway and a Customer Gateway with the remote network's parameters to the extent that's possible. Then I create a VPN connection and the appropriate route. Here's my VPN code in Terraform:\r\n\r\n    resource \"aws_vpn_gateway\" \"vpn_gw\" {\r\n     vpc_id = \"${aws_vpc.default.id}\"\r\n    \r\n     tags {\r\n      Name = \"default\"\r\n      Terraform = true\r\n     }\r\n    }\r\n    \r\n    resource \"aws_customer_gateway\" \"customer_gw\" {\r\n     bgp_asn = 65000\r\n     ip_address = \"172.0.0.1\"\r\n     type = \"ipsec.1\"\r\n    }\r\n    \r\n    resource \"aws_vpn_connection\" \"default\" {\r\n     vpn_gateway_id = \"${aws_vpn_gateway.vpn_gw.id}\"\r\n     customer_gateway_id = \"${aws_customer_gateway.customer_gw.id}\"\r\n     type = \"ipsec.1\"\r\n     static_routes_only = true\r\n    }\r\n    \r\n    resource \"aws_vpn_connection_route\" \"office\" {\r\n     destination_cidr_block = \"192.168.10.0/24\"\r\n     vpn_connection_id = \"${aws_vpn_connection.default.id}\"\r\n    }\r\n\r\n\r\nI have to be able to set the following parameters on my VPN tunnel for phase 1 and phase 2 of the connection:\r\n\r\nPhase 1\r\n\r\n - **Authentication Method** e.g. Pre-shared Secret\r\n - **Encryption Scheme** e.g. IKE\r\n - **Diffie-Hellman Group** e.g. Group 2\r\n - **Encryption Algorithm** e.g. AES-256\r\n - **Hashing Algorithm** e.g. SHA-1\r\n - **Main or Aggressive Mode** e.g. Main Mode\r\n - **Lifetime (for renegotiation)** e.g. 86400\r\n\r\nPhase 2\r\n\r\n - **Encapsulation (ESP or AH)** e.g. ESP\r\n - **Encryption Algorithm** e.g. AES-256\r\n - **Authentication Algorithm** e.g. SHA-1\r\n - **Perfect Forward Secrecy** e.g. NO-PFS\r\n - **Lifetime (for renegotiation)** e.g. 3600\r\n\r\n\r\nThe docs on the VPN Customer Gateway show that you can't set that many parameters yourself: https://www.terraform.io/docs/providers/aws/r/customer_gateway.html\r\nThe Boto API also doesn't allow any additional parameters to be set.\r\n\r\nIs there any way of setting these parameters (programmatically)?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "In my application I have to VPN into other networks where the admin of the other network has defined parameters on the IPSec ESP connection that the VPN connection on my end has to adhere to. ", "keywords": ["vpn"]}, {"source": "Text", "text": "I create a VPN Gateway and a Customer Gateway with the remote network's parameters to the extent that's possible. ", "keywords": ["vpn"]}, {"source": "Text", "text": "Then I create a VPN connection and the appropriate route. ", "keywords": ["vpn"]}, {"source": "Text", "text": "Here's my VPN code in Terraform: resource \"aws_vpn_gateway\" \"vpn_gw\" { vpc_id = \"${aws_vpc.default.id}\" tags { Name = \"default\" Terraform = true } } resource \"aws_customer_gateway\" \"customer_gw\" { bgp_asn = 65000 ip_address = \"172.0.0.1\" type = \"ipsec.1\" } resource \"aws_vpn_connection\" \"default\" { vpn_gateway_id = \"${aws_vpn_gateway.vpn_gw.id}\" customer_gateway_id = \"${aws_customer_gateway.customer_gw.id}\" type = \"ipsec.1\" static_routes_only = true } resource \"aws_vpn_connection_route\" \"office\" { destination_cidr_block = \"192.168.10.0/24\" vpn_connection_id = \"${aws_vpn_connection.default.id}\" } I have to be able to set the following parameters on my VPN tunnel for phase 1 and phase 2 of the connection: Phase 1 - **Authentication Method** e.g. Pre-shared Secret - **Encryption Scheme** e.g. IKE - **Diffie-Hellman Group** e.g. Group 2 - **Encryption Algorithm** e.g. AES-256 - **Hashing Algorithm** e.g. SHA-1 - **Main or Aggressive Mode** e.g. Main Mode - **Lifetime (for renegotiation)** e.g. 86400 Phase 2 - **Encapsulation (ESP or AH)** e.g. ESP - **Encryption Algorithm** e.g. AES-256 - **Authentication Algorithm** e.g. SHA-1 - **Perfect Forward Secrecy** e.g. NO-PFS - **Lifetime (for renegotiation)** e.g. 3600 The docs on the VPN Customer Gateway show that you can't set that many parameters yourself: https://www", "keywords": ["vpn", "billing mode"]}]}, {"Id": "130916916", "PostHistoryTypeId": "1", "PostId": "40445544", "RevisionGUID": "d33d4d53-2975-44f3-953a-a3ebc80fcb17", "CreationDate": "2016-11-06T02:52:35.550", "UserId": "3678551", "Text": "Terraform (AWS) create VPN IPSec connection with non-default parameters", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Terraform (AWS) create VPN IPSec connection with non-default parameters", "keywords": ["vpn"]}]}, {"Id": "130916917", "PostHistoryTypeId": "3", "PostId": "40445544", "RevisionGUID": "d33d4d53-2975-44f3-953a-a3ebc80fcb17", "CreationDate": "2016-11-06T02:52:35.550", "UserId": "3678551", "Text": "<amazon-web-services><vpn><terraform>", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "answers": [{"Id": "43439113", "PostTypeId": "2", "ParentId": "40445544", "CreationDate": "2017-04-16T16:02:11.520", "Score": "1", "Body": "<p>Unfortunately, the answer to your question is no. This isn't a Terraform issue, as such, this is a limitation of the service provided by AWS. You don't get that level of configuration with AWS's basic solution.</p>\n\n<p>To achieve what you are looking for, you'll need to spin up an EC2 instance and either</p>\n\n<ul>\n<li>Roll your own using OpenSwan, VyOS, etc., e.g., <a href=\"https://aws.amazon.com/marketplace/pp/B00JK5UPF6\" rel=\"nofollow noreferrer\">https://aws.amazon.com/marketplace/pp/B00JK5UPF6</a> (just the AWS costs)</li>\n<li>Use a VPN appliance from the AWS marketplace, e.g., <a href=\"https://aws.amazon.com/marketplace/pp/B00OCG4OAA\" rel=\"nofollow noreferrer\">https://aws.amazon.com/marketplace/pp/B00OCG4OAA</a> (you'll need to pay a licensing fee to the vendor, as well as your AWS costs)</li>\n</ul>\n", "OwnerUserId": "712921", "LastEditorUserId": "268847", "LastEditDate": "2017-04-16T17:45:01.403", "LastActivityDate": "2017-04-16T17:45:01.403", "CommentCount": "1", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "73935175", "PostId": "43439113", "Score": "0", "Text": "For completeness, these are the 4 options AWS suggest: http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpn-connections.html", "CreationDate": "2017-04-16T16:02:46.873", "UserId": "712921", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "For completeness, these are the 4 options AWS suggest: http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpn-connections.html", "keywords": ["vpn"]}]}], "history": [{"Id": "143255221", "PostHistoryTypeId": "2", "PostId": "43439113", "RevisionGUID": "e12702cb-35ae-401e-946e-ec28d7a98cf5", "CreationDate": "2017-04-16T16:02:11.520", "UserId": "712921", "Text": "Unfortunately, the answer to your question is no.  This isn't an Terraform issue, as such, this is a limitation of the service provided by AWS.  You don't get that level of configuration with AWS's basic solution\r\n\r\nTo acheive what you are looking for, you'll need to spin up an EC2 instance and run either:\r\n\r\n - Roll your own using OpenSwan , VyOS, etc., e.g. https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs)\r\n - A VPN appliance from the AWS marketplace, e.g. https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor as well as your AWS costs)", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "You don't get that level of configuration with AWS's basic solution To acheive what you are looking for, you'll need to spin up an EC2 instance and run either: - Roll your own using OpenSwan , VyOS, etc., e.g. https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs) - A VPN appliance from the AWS marketplace, e.g. https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor as well as your AWS costs)", "keywords": ["pay", "vpn", "instance"]}]}, {"Id": "143259415", "PostHistoryTypeId": "5", "PostId": "43439113", "RevisionGUID": "3f0304bd-5383-4d5f-adcb-7e9955cf44a7", "CreationDate": "2017-04-16T17:45:01.403", "UserId": "3079302", "Comment": "correct typos", "Text": "Unfortunately, the answer to your question is no. This isn't a Terraform issue, as such, this is a limitation of the service provided by AWS. You don't get that level of configuration with AWS's basic solution.\r\n\r\nTo achieve what you are looking for, you'll need to spin up an EC2 instance and run either:\r\n\r\n - Roll your own using OpenSwan, VyOS, etc., e.g., https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs)\r\n - A VPN appliance from the AWS marketplace, e.g., https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor, as well as your AWS costs)\r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "To achieve what you are looking for, you'll need to spin up an EC2 instance and run either: - Roll your own using OpenSwan, VyOS, etc., e.g., https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs) - A VPN appliance from the AWS marketplace, e.g., https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor, as well as your AWS costs)", "keywords": ["pay", "vpn", "instance"]}]}, {"Id": "143259416", "PostHistoryTypeId": "24", "PostId": "43439113", "RevisionGUID": "3f0304bd-5383-4d5f-adcb-7e9955cf44a7", "CreationDate": "2017-04-16T17:45:01.403", "Comment": "Proposed by 3079302 approved by -1 edit id of 3065559", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "143259417", "PostHistoryTypeId": "5", "PostId": "43439113", "RevisionGUID": "89efa878-79c3-4b37-b3ad-32461e04fd62", "CreationDate": "2017-04-16T17:45:01.403", "UserId": "268847", "Comment": "correct typos", "Text": "Unfortunately, the answer to your question is no. This isn't a Terraform issue, as such, this is a limitation of the service provided by AWS. You don't get that level of configuration with AWS's basic solution.\r\n\r\nTo achieve what you are looking for, you'll need to spin up an EC2 instance and either\r\n\r\n - Roll your own using OpenSwan, VyOS, etc., e.g., https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs)\r\n - Use a VPN appliance from the AWS marketplace, e.g., https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor, as well as your AWS costs)\r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "To achieve what you are looking for, you'll need to spin up an EC2 instance and either - Roll your own using OpenSwan, VyOS, etc., e.g., https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs) - Use a VPN appliance from the AWS marketplace, e.g., https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor, as well as your AWS costs)", "keywords": ["pay", "vpn", "instance"]}]}], "filtered-sentences": [{"source": "Body", "text": "To achieve what you are looking for, you'll need to spin up an EC2 instance and either Roll your own using OpenSwan, VyOS, etc., e.g., https://aws.amazon.com/marketplace/pp/B00JK5UPF6 (just the AWS costs) ", "keywords": ["instance"]}, {"source": "Body", "text": "Use a VPN appliance from the AWS marketplace, e.g., https://aws.amazon.com/marketplace/pp/B00OCG4OAA (you'll need to pay a licensing fee to the vendor, as well as your AWS costs)", "keywords": ["pay", "vpn"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "Terraform (AWS) create VPN IPSec connection with non-default parameters", "keywords": ["vpn"]}, {"source": "Body", "text": "In my application I have to VPN into other networks where the admin of the other network has defined parameters on the IPSec ESP connection that the VPN connection on my end has to adhere to. ", "keywords": ["vpn"]}, {"source": "Body", "text": "Using Terraform I create a VPN Gateway and a Customer Gateway with the remote network's parameters to the extent that's possible. ", "keywords": ["vpn"]}, {"source": "Body", "text": "Then I create a VPN connection and the appropriate route. ", "keywords": ["vpn"]}, {"source": "Body", "text": "Here's my VPN code in Terraform: I have to be able to set the following parameters on my VPN tunnel for phase 1 and phase 2 of the connection: Phase 1 Authentication Method e.g. Pre-shared Secret Encryption Scheme e.g. IKE Diffie-Hellman Group e.g. Group 2 Encryption Algorithm e.g. AES-256 Hashing Algorithm e.g. SHA-1 Main or Aggressive Mode e.g. Main Mode Lifetime (for renegotiation) e.g. 86400 Phase 2 Encapsulation (ESP or AH) e.g. ESP Encryption Algorithm e.g. AES-256 Authentication Algorithm e.g. SHA-1 Perfect Forward Secrecy e.g. NO-PFS Lifetime (for renegotiation) e.g. 3600 ", "keywords": ["vpn", "billing mode"]}, {"source": "Body", "text": "The docs on the VPN Customer Gateway show that you can't set that many parameters yourself: https://www.terraform.io/docs/providers/aws/r/customer_gateway.html ", "keywords": ["vpn"]}]}