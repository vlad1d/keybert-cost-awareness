{"Id": "72730522", "PostTypeId": "1", "CreationDate": "2022-06-23T12:54:31.717", "Score": "0", "ViewCount": "597", "Body": "<p>I have a java application to be deployed as a Cloud Function.\nThe application is packaged into a jar file.\nThe deployment needs to be done via Terraform.</p>\n<p>According to the <a href=\"https://cloud.google.com/functions/docs/concepts/java-deploy\" rel=\"nofollow noreferrer\">documentation</a>, the function can be deployed directly from the jar file using the <code>--source</code> parameter:</p>\n<pre><code>gcloud functions deploy jar-example \\\n    --entry-point=Example \\\n    --runtime=java11 \\\n    --trigger-http \\\n    --source=target/deployment\n</code></pre>\n<p>However, the Terraform <a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloudfunctions_function\" rel=\"nofollow noreferrer\">cloudfunctions_function</a> doesn't seem to support it and requires a bucket to copy the jar there.</p>\n<p>Is it possible to deploy Cloud Function via Terraform <strong>without</strong> the bucket?</p>\n", "OwnerUserId": "7511171", "LastActivityDate": "2022-06-23T14:49:21.223", "Title": "How to deploy the Google Cloud Function via Terraform without using a bucket?", "Tags": "<java><google-cloud-platform><google-cloud-functions><terraform>", "AnswerCount": "1", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "128471687", "PostId": "72730522", "Score": "0", "Text": "Switch to Cloud Run!! An article is cooking....", "CreationDate": "2022-06-23T16:48:35.617", "UserId": "11372593", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "links": [{"Id": "1980099725", "CreationDate": "2022-06-23T14:49:21.223", "PostId": "72730522", "RelatedPostId": "68488277", "LinkTypeId": "1"}], "history": [{"Id": "272836303", "PostHistoryTypeId": "2", "PostId": "72730522", "RevisionGUID": "03ac6494-ae4f-4ca9-abf4-33516eaa24d6", "CreationDate": "2022-06-23T12:54:31.717", "UserId": "7511171", "Text": "I have a java application to be deployed as a Cloud Function.\r\nThe application is packaged into a jar file.\r\nThe deployment needs to be done via Terraform.\r\n\r\nAccording to the [documentation](https://cloud.google.com/functions/docs/concepts/java-deploy), the function can be deployed directly from the jar file using the `--source` parameter:\r\n\r\n```\r\ngcloud functions deploy jar-example \\\r\n    --entry-point=Example \\\r\n    --runtime=java11 \\\r\n    --trigger-http \\\r\n    --source=target/deployment\r\n```\r\n\r\nHowever, the Terraform [cloudfunctions_function](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloudfunctions_function) doesn't seem to support it and requires a bucket to copy the jar there.\r\n\r\nIs it possible to deploy Cloud Function via Terraform **without** the bucket? ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "272836305", "PostHistoryTypeId": "1", "PostId": "72730522", "RevisionGUID": "03ac6494-ae4f-4ca9-abf4-33516eaa24d6", "CreationDate": "2022-06-23T12:54:31.717", "UserId": "7511171", "Text": "How to deploy the Google Cloud Function via Terraform without using a bucket?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "272836306", "PostHistoryTypeId": "3", "PostId": "72730522", "RevisionGUID": "03ac6494-ae4f-4ca9-abf4-33516eaa24d6", "CreationDate": "2022-06-23T12:54:31.717", "UserId": "7511171", "Text": "<java><google-cloud-platform><google-cloud-functions><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "72732220", "PostTypeId": "2", "ParentId": "72730522", "CreationDate": "2022-06-23T14:49:21.223", "Score": "1", "Body": "<p>I think it is possible to deploy without a bucket, but the source code is to be located in a Cloud Repository: <a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloudfunctions_function#nested_source_repository\" rel=\"nofollow noreferrer\">Terraform - source repository block</a> Personally I think that the main reason for that - a necessity to keep the source code (of the deployed function) inside the cloud (to handle exceptions, errors, debugging, etc.). Thus - either a bucket or a git repository.</p>\n<p>Are you sure you don't want to use some bucket? It may be a very clean and an efficient way. You might not need a bucket in the same project where you deploy the function to (if that is important for you). An example was described here some time ago: <a href=\"https://stackoverflow.com/questions/68488277/how-can-i-deploy-google-cloud-functions-in-ci-cd-without-re-deploying-unchanged/68488770#68488770\">How can I deploy Google Cloud Functions in CI/CD without re-deploying unchanged Cloud Functions</a> In addition, I think there were some recent Medium articles about such deployment as well (for similar examples)...</p>\n", "OwnerUserId": "6073141", "LastActivityDate": "2022-06-23T14:49:21.223", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "128481820", "PostId": "72732220", "Score": "0", "Text": "The build process is handled outside of GCP, so the Cloud Repository for building the application doesn't quite fit here. We could use the bucket if it cannot be avoided but I hopped Terraform would support the option natively supported by `gcloud`", "CreationDate": "2022-06-24T06:30:05.463", "UserId": "7511171", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "272845474", "PostHistoryTypeId": "2", "PostId": "72732220", "RevisionGUID": "6d90eccf-4ac3-4445-9f91-694281b0a214", "CreationDate": "2022-06-23T14:49:21.223", "UserId": "6073141", "Text": "I think it is possible to deploy without a bucket, but the source code is to be located in a Cloud Repository: [Terraform - source repository block][1] Personally I think that the main reason for that - a necessity to keep the source code (of the deployed function) inside the cloud (to handle exceptions, errors, debugging, etc.). Thus - either a bucket or a git repository.\r\n\r\nAre you sure you don't want to use some bucket? It may be a very clean and an efficient way. You might not need a bucket in the same project where you deploy the function to (if that is important for you). An example was described here some time ago: [How can I deploy Google Cloud Functions in CI/CD without re-deploying unchanged Cloud Functions][2] In addition, I think there were some recent Medium articles about such deployment as well (for similar examples)... \r\n\r\n\r\n  [1]: https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloudfunctions_function#nested_source_repository\r\n  [2]: https://stackoverflow.com/questions/68488277/how-can-i-deploy-google-cloud-functions-in-ci-cd-without-re-deploying-unchanged/68488770#68488770", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It may be a very clean and an efficient way. ", "keywords": ["efficient"]}]}], "filtered-sentences": [{"source": "Body", "text": "It may be a very clean and an efficient way. ", "keywords": ["efficient"]}]}], "contains-topic": false, "filtered-sentences": []}