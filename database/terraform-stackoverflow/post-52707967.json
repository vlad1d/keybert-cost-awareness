{"Id": "52707967", "PostTypeId": "1", "CreationDate": "2018-10-08T18:15:54.497", "Score": "0", "ViewCount": "327", "Body": "<p>Currently I'm writing a terraform script in which I wanted to set a subnet <code>CIDR-BLOCK</code> dynamically. I know the better approach is to use <code>module</code> instead of <code>resources</code> but this is the limitation at our end to only use resources.</p>\n\n<p><strong>CURRENT PROBLEM</strong></p>\n\n<p>I'had created only VPC in one configuration file. I have another configuration file in which I'm trying to provisioning VPC's configs (subnets,routing) etc.</p>\n\n<p>Now I wanted to know the count of the existing subnets in the current VPC. For this I'm using the <code>datasource</code> to get the count. But while executing my plan I'm getting the following exception.</p>\n\n<pre><code>data.aws_subnet_ids.available-subnets: data.aws_subnet_ids.available-subnets:\nno matching subnet found for vpc with id vpc-***************\n</code></pre>\n\n<p>This is how I'm getting the subnets </p>\n\n<pre><code>data \"aws_subnet_ids\" \"available-subnets\" {\n  vpc_id = \"${data.aws_vpc.vpcobject.id}\"\n}\n</code></pre>\n\n<p>Do i need to add a depends-on attribute in it? if yes then what will be the condition or test for it? If this is not the case then what would be alternatives?</p>\n\n<p>Thanks</p>\n", "OwnerUserId": "2613639", "LastEditorUserId": "2947502", "LastEditDate": "2018-10-08T18:18:00.450", "LastActivityDate": "2018-10-09T13:37:29.500", "Title": "How to get the count of total subnets in current VPC", "Tags": "<amazon-web-services><aws-cloudformation><terraform>", "AnswerCount": "0", "CommentCount": "13", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "92342199", "PostId": "52707967", "Score": "0", "Text": "What does it have to do with Ansible?", "CreationDate": "2018-10-08T18:16:54.383", "UserId": "2947502", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92342216", "PostId": "52707967", "Score": "0", "Text": "I'm running through it ansible playbook :x ...", "CreationDate": "2018-10-08T18:17:35.400", "UserId": "2613639", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92342225", "PostId": "52707967", "Score": "0", "Text": "Please do not spam with tags.", "CreationDate": "2018-10-08T18:17:55.473", "UserId": "2947502", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92359390", "PostId": "52707967", "Score": "0", "Text": "What's the output of `aws ec2 describe-subnets --filters Name=vpc-id,Values=$VPC_ID`? (Where $VPC_ID is your VPC ID)", "CreationDate": "2018-10-09T08:52:45.210", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92359495", "PostId": "52707967", "Score": "0", "Text": "@ydaetskcoR currently there is no subnet exist but terraform should return null or empty {} instead of throwing exception in plan execution", "CreationDate": "2018-10-09T08:56:02.047", "UserId": "2613639", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92360169", "PostId": "52707967", "Score": "0", "Text": "@ydaetskcoR + I have created one subnet and added its dependency on datasourse so that I could get the total count of subnets before creating another subnet. I wanted this count+1 to pass as a cidrblock of another. But seems like terraform doesn\u2019t giving the expecting count", "CreationDate": "2018-10-09T09:14:50.777", "UserId": "2613639", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92360827", "PostId": "52707967", "Score": "0", "Text": "That's not how data sources work. If it can't find anything then it errors. On non plural data sources (such as `aws_subnet` vs `aws_subnet_ids`) if it returns multiple results then it errors. I'm curious to know what you're trying to achieve that you want to look up subnet IDs when they don't yet exist. It might be best to edit your question to explain what you're trying to achieve and how instead of focusing on this error which is not going to be possible to work around.", "CreationDate": "2018-10-09T09:31:24.337", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92360893", "PostId": "52707967", "Score": "0", "Text": "@ydaetskcoR okay sure, I will edit my question soon", "CreationDate": "2018-10-09T09:32:51.820", "UserId": "2613639", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92360904", "PostId": "52707967", "Score": "0", "Text": "If it's just that you want to create the subnet CIDR blocks dynamically then you can do that with the `cidrsubnet` function, passing in the VPC CIDR block.", "CreationDate": "2018-10-09T09:33:01.800", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92361887", "PostId": "52707967", "Score": "0", "Text": "@ydaetskcoR I wanted to run the same script for different environments. Let\u2019s say I have a VPC in east-1 which currently consist of two 2 environments dev and qa later maybe added prod. Now if I hardcoded the netnum param of cirdrsubnet function it will execute fine for one environment (dev) only but if I try to run it again it will give subnet conflicts error. So I wanted to pass netnum param dynamically depends on existing subnets count.", "CreationDate": "2018-10-09T09:59:43.460", "UserId": "2613639", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92363355", "PostId": "52707967", "Score": "0", "Text": "Why do you want to use the same VPC? That sounds like a bad idea to me and it shouldn't really cost you anything (NAT gateways are pretty cheap but probably the only cost that comes to mind here) to use another VPC for splitting your environments.", "CreationDate": "2018-10-09T10:39:40.757", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "That sounds like a bad idea to me and it shouldn't really cost you anything (NAT gateways are pretty cheap but probably the only cost that comes to mind here) to use another VPC for splitting your environments.", "keywords": ["cheap", "cost", "nat"]}]}, {"Id": "92363726", "PostId": "52707967", "Score": "0", "Text": "@ydaetskcoR I agreed with you but the design they provided me that\u2019s working as above. I think we need to change this architect and follow the separate VPC approach. Maybe they are saving the cost of other services manages in same VPC(s) for different environment(s).", "CreationDate": "2018-10-09T10:49:55.563", "UserId": "2613639", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I think we need to change this architect and follow the separate VPC approach. ", "keywords": ["change"]}, {"source": "Text", "text": "Maybe they are saving the cost of other services manages in same VPC(s) for different environment(s).", "keywords": ["cost"]}]}, {"Id": "92391440", "PostId": "52707967", "Score": "0", "Text": "Are you creating and reading from the vpcs in the same region? I've never seen that error \"lie\" before. It would also be helpful to include all the code you've used to create the vpc you're trying to reference", "CreationDate": "2018-10-10T05:44:17.427", "UserId": "1127683", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "183335073", "PostHistoryTypeId": "2", "PostId": "52707967", "RevisionGUID": "7b72034f-c0d6-4349-93c0-4abddc5f1031", "CreationDate": "2018-10-08T18:15:54.497", "UserId": "2613639", "Text": "Currently I'm writing a terraform script in which I wanted to set a subnet `CIDR-BLOCK` dynamically. I know the better approach is to use `module` instead of `resources` but this is the limitation at our end to only use resources.\r\n\r\n**CURRENT PROBLEM**\r\n\r\nI'had created only VPC in one configuration file. I have another configuration file in which I'm trying to provisioning VPC's configs (subnets,routing) etc.\r\n\r\nNow I wanted to know the count of the existing subnets in the current VPC. For this I'm using the `datasource` to get the count. But while executing my plan I'm getting the following exception.\r\n\r\n    data.aws_subnet_ids.available-subnets: data.aws_subnet_ids.available-subnets:\r\n    no matching subnet found for vpc with id vpc-***************\r\n\r\nThis is how I'm getting the subnets \r\n\r\n    data \"aws_subnet_ids\" \"available-subnets\" {\r\n      vpc_id = \"${data.aws_vpc.vpcobject.id}\"\r\n    }\r\n\r\nDo i need to add a depends-on attribute in it? if yes then what will be the condition or test for it? If this is not the case then what would be alternatives?\r\n\r\nThanks\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Do i need to add a depends-on attribute in it? if yes then what will be the condition or test for it? ", "keywords": ["test"]}]}, {"Id": "183335074", "PostHistoryTypeId": "1", "PostId": "52707967", "RevisionGUID": "7b72034f-c0d6-4349-93c0-4abddc5f1031", "CreationDate": "2018-10-08T18:15:54.497", "UserId": "2613639", "Text": "How to get the count of total subnets in current VPC", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183335075", "PostHistoryTypeId": "3", "PostId": "52707967", "RevisionGUID": "7b72034f-c0d6-4349-93c0-4abddc5f1031", "CreationDate": "2018-10-08T18:15:54.497", "UserId": "2613639", "Text": "<amazon-web-services><ansible><aws-cloudformation><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183335175", "PostHistoryTypeId": "6", "PostId": "52707967", "RevisionGUID": "c8dbbe58-c940-4e86-a2d7-68b1a79c9a5d", "CreationDate": "2018-10-08T18:18:00.450", "UserId": "2947502", "Comment": "edited tags", "Text": "<amazon-web-services><aws-cloudformation><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "if yes then what will be the condition or test for it? ", "keywords": ["test"]}]}