{"Id": "76053984", "PostTypeId": "1", "AcceptedAnswerId": "76054619", "CreationDate": "2023-04-19T11:30:58.513", "Score": "0", "ViewCount": "139", "Body": "<p>I've defined the dynamodb table in terraform here:</p>\n<pre><code>name                   = &quot;component_table&quot;\n  partition_key          = &quot;name&quot;\n  partition_key_type     = &quot;S&quot;\n  sort_key               = &quot;version&quot;\n  billing_mode           = &quot;PAY_PER_REQUEST&quot;\n  environment            = &quot;testing&quot;\n  aws_region             = &quot;eu-west-1&quot;\n  restore_to_latest_time = true\n  point_in_time_recovery = true\n  extra_attributes = [\n    {\n      name = &quot;version&quot;\n      type = &quot;S&quot;\n    },\n    {\n      name = &quot;team&quot;\n      type = &quot;S&quot;\n    }\n]\nlocal_secondary_index = [\n{\n  name            = &quot;TeamSecondaryIndex&quot;\n  projection_type = &quot;ALL&quot;\n  range_key       = &quot;team&quot;\n}\n]\n</code></pre>\n<p>I've queried it with aws operator <strong>GetItem</strong>, I've defined name to be <strong>abc</strong> for testing purposes but can't seem to query a GetItem function as it says</p>\n<pre><code>The provided key element does not match the schema error\n</code></pre>\n<p>The function I ran is this:</p>\n<pre><code>func (m *Manager) ComponentGetByName(ctx context.Context, name string) (componentModel.Component, error) {\n\ngetItemInput := &amp;awsDDB.GetItemInput{\n            TableName: &amp;m.cfg.tableName,\n            Key: map[string]types.AttributeValue{\n                &quot;name&quot;: &amp;types.AttributeValueMemberS{\n                    Value: name,\n                },\n            },\n        }\n        getItemOutput, err := m.Client.GetItem(ctx, getItemInput)\nreturn getItemOutput\n}\n</code></pre>\n<p>I've left some details out such as converting getItemOutput into a component model for secrecy. I'm wondering why this happens and how can I resolve it? Open for a discussion. Thanks!</p>\n", "OwnerUserId": "13076142", "LastActivityDate": "2023-04-19T12:38:47.317", "Title": "DynamoDB \"The provided key element does not match the schema error\"", "Tags": "<amazon-web-services><go><terraform><amazon-dynamodb>", "AnswerCount": "1", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "134132651", "PostId": "76053984", "Score": "0", "Text": "Your table definition doesn't seem to match the current specification for Terraform's [dynamodb_table](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table), specifically in how pk/sk are indicated.", "CreationDate": "2023-04-19T13:01:21.607", "UserId": "271415", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "134134925", "PostId": "76053984", "Score": "0", "Text": "@jarmod I've just renamed them to specify that it is a pk/sk in terraform. It's neater that way imo, but it still is the pk/sk definition.", "CreationDate": "2023-04-19T15:06:52.883", "UserId": "13076142", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "291604061", "PostHistoryTypeId": "2", "PostId": "76053984", "RevisionGUID": "6eaec3be-c9ba-4a84-a786-f57b5193f8c7", "CreationDate": "2023-04-19T11:30:58.513", "UserId": "13076142", "Text": "I've defined the dynamodb table in terraform here:\r\n\r\n    name                   = \"component_table\"\r\n      partition_key          = \"name\"\r\n      partition_key_type     = \"S\"\r\n      sort_key               = \"version\"\r\n      billing_mode           = \"PAY_PER_REQUEST\"\r\n      environment            = \"testing\"\r\n      aws_region             = \"eu-west-1\"\r\n      restore_to_latest_time = true\r\n      point_in_time_recovery = true\r\n      extra_attributes = [\r\n        {\r\n          name = \"version\"\r\n          type = \"S\"\r\n        },\r\n        {\r\n          name = \"team\"\r\n          type = \"S\"\r\n        }\r\n    ]\r\n    local_secondary_index = [\r\n    {\r\n      name            = \"TeamSecondaryIndex\"\r\n      projection_type = \"ALL\"\r\n      range_key       = \"team\"\r\n    }\r\n    ]\r\n    \r\nI've queried it with aws operator **GetItem**, I've defined name to be **abc** for testing purposes but can't seem to query a GetItem function as it says \r\n\r\n    The provided key element does not match the schema error\r\n\r\nThe function I ran is this:\r\n\r\n    func (m *Manager) ComponentGetByName(ctx context.Context, name string) (componentModel.Component, error) {\r\n    \r\n    getItemInput := &awsDDB.GetItemInput{\r\n          TableName: &m.cfg.tableName,\r\n          Key: map[string]types.AttributeValue{\r\n           \"name\": &types.AttributeValueMemberS{\r\n            Value: name,\r\n           },\r\n          },\r\n         }\r\n         getItemOutput, err := m.Client.GetItem(ctx, getItemInput)\r\n    return getItemOutput\r\n    }\r\n\r\nI've left some details out such as converting getItemOutput into a component model for secrecy. I'm wondering why this happens and how can I resolve it? Open for a discussion. Thanks!\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I've defined the dynamodb table in terraform here: name = \"component_table\" partition_key = \"name\" partition_key_type = \"S\" sort_key = \"version\" billing_mode = \"PAY_PER_REQUEST\" environment = \"testing\" aws_region = \"eu-west-1\" restore_to_latest_time = true point_in_time_recovery = true extra_attributes = [ { name = \"version\" type = \"S\" }, { name = \"team\" type = \"S\" } ] local_secondary_index = [ { name = \"TeamSecondaryIndex\" projection_type = \"ALL\" range_key = \"team\" } ] I've queried it with aws operator **GetItem**, I've defined name to be **abc** for testing purposes but can't seem to query a GetItem function as it says ", "keywords": ["bill", "test"]}]}, {"Id": "291604063", "PostHistoryTypeId": "1", "PostId": "76053984", "RevisionGUID": "6eaec3be-c9ba-4a84-a786-f57b5193f8c7", "CreationDate": "2023-04-19T11:30:58.513", "UserId": "13076142", "Text": "DynamoDB \"The provided key element does not match the schema error\"", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "291604064", "PostHistoryTypeId": "3", "PostId": "76053984", "RevisionGUID": "6eaec3be-c9ba-4a84-a786-f57b5193f8c7", "CreationDate": "2023-04-19T11:30:58.513", "UserId": "13076142", "Text": "<amazon-web-services><go><terraform><amazon-dynamodb>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "76054619", "PostTypeId": "2", "ParentId": "76053984", "CreationDate": "2023-04-19T12:38:47.317", "Score": "2", "Body": "<p>The issue is you are trying to do a GetItem using only the partition key value. To do a GetItem you must provide the full primary key which is Partition and sort key values. In your case <code>name</code> and <code>version</code> are required.</p>\n<p>If you only know the Partition key, they you must perform <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Query.html\" rel=\"nofollow noreferrer\">Query</a> operation.</p>\n<p>You must provide the name of the partition key attribute and a single value for that attribute. Query returns all items with that partition key value</p>\n", "OwnerUserId": "7909676", "LastActivityDate": "2023-04-19T12:38:47.317", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "134134946", "PostId": "76054619", "Score": "0", "Text": "That's why. Error logs from AWS can't really specify it so the confusion turns into panic. Cheers mate, I've scraped the sort key and have gone with GSI instead.", "CreationDate": "2023-04-19T15:08:02.540", "UserId": "13076142", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "291607615", "PostHistoryTypeId": "2", "PostId": "76054619", "RevisionGUID": "e9890f37-67a7-455b-a241-264865be5d53", "CreationDate": "2023-04-19T12:38:47.317", "UserId": "7909676", "Text": "The issue is you are trying to do a GetItem using only the partition key value. To do a GetItem you must provide the full primary key which is Partition and sort key values. In your case `name` and `version` are required.\r\n\r\nIf you only know the Partition key, they you must perform [Query](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Query.html) operation. \r\n\r\nYou must provide the name of the partition key attribute and a single value for that attribute. Query returns all items with that partition key value", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I've defined the dynamodb table in terraform here: I've queried it with aws operator GetItem, I've defined name to be abc for testing purposes but can't seem to query a GetItem function as it says ", "keywords": ["test"]}]}