{"Id": "70008141", "PostTypeId": "1", "AcceptedAnswerId": "70012444", "CreationDate": "2021-11-17T16:29:01.337", "Score": "6", "ViewCount": "2058", "Body": "<p>Every time a new item arrives in my dynamo table, I want to run a lambda function <code>trigger_lambda_function</code>. This is how I define my table and trigger. However, the trigger does not work as expected.</p>\n<pre><code>resource &quot;aws_dynamodb_table&quot; &quot;filenames&quot; {\n  name           = local.dynamodb_table_filenames\n  billing_mode   = &quot;PROVISIONED&quot;\n  read_capacity  = 1000\n  write_capacity = 1000\n  hash_key       = &quot;filename&quot;\n\n  #range_key      = &quot;&quot;\n\n  attribute {\n    name = &quot;filename&quot;\n    type = &quot;S&quot;\n  }\n\n  tags = var.tags\n}\n\n\nresource &quot;aws_lambda_event_source_mapping&quot; &quot;allow_dynamodb_table_to_trigger_lambda&quot; {\n  event_source_arn  = aws_dynamodb_table.filenames.stream_arn\n  function_name     = aws_lambda_function.trigger_stepfunction_lambda.arn\n  starting_position = &quot;LATEST&quot;\n}\n</code></pre>\n<p>Upon <code>terraform apply</code>, I get an error that:</p>\n<pre><code>\u2502 Error: error creating Lambda Event Source Mapping (): InvalidParameterValueException: Unrecognized event source.\n\u2502 {\n\u2502   RespMetadata: {\n\u2502     StatusCode: 400,\n\u2502     RequestID: &quot;5ae68da6-3f6d-4adb-b104-72ae584dbca7&quot;\n\u2502   },\n\u2502   Message_: &quot;Unrecognized event source.&quot;,\n\u2502   Type: &quot;User&quot;\n\u2502 }\n\u2502 \n\u2502   with module.ingest_system[&quot;alpegatm&quot;].aws_lambda_event_source_mapping.allow_dynamodb_table_to_trigger_lambda,\n\u2502   on ../../modules/ingest_system/dynamo.tf line 39, in resource &quot;aws_lambda_event_source_mapping&quot; &quot;allow_dynamodb_table_to_trigger_lambda&quot;:\n\u2502   39: resource &quot;aws_lambda_event_source_mapping&quot; &quot;allow_dynamodb_table_to_trigger_lambda&quot; {\n</code></pre>\n<p>I also tried <code>.arn</code> instead of <code>stream_arn</code>but that threw an error too. What else could I try?</p>\n<p>I followed the documentation for the trigger:\n<a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_event_source_mapping\" rel=\"noreferrer\">https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_event_source_mapping</a></p>\n", "OwnerUserId": "12304000", "LastActivityDate": "2021-11-17T22:35:20.093", "Title": "trigger lambda function from DynamoDB", "Tags": "<amazon-web-services><aws-lambda><amazon-dynamodb><terraform><terraform-provider-aws>", "AnswerCount": "1", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "123761773", "PostId": "70008141", "Score": "0", "Text": "A random guess - despite the error message text, could it be lack of IAM permissions for your Lambda to call `dynamodb:*`?", "CreationDate": "2021-11-17T21:35:10.833", "UserId": "118587", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "123762027", "PostId": "70008141", "Score": "0", "Text": "the role assigned has ```\"dynamodb:GetItem\",\"dynamodb:PutItem\",  \"dynamodb:UpdateItem\", \"dynamodb:Query\"```but I doubt that's the problem@GrzegorzOledzki", "CreationDate": "2021-11-17T21:46:42.893", "UserId": "12304000", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "258193345", "PostHistoryTypeId": "2", "PostId": "70008141", "RevisionGUID": "d1b27a8b-0c9f-47a9-896c-f492191135c0", "CreationDate": "2021-11-17T16:29:01.337", "UserId": "12304000", "Text": "Every time a new item arrives in my dynamo table, I want to run a lambda function ```trigger_lambda_function```. This is how I define my table and trigger. However, the trigger does not work as expected.\r\n```\r\nresource \"aws_dynamodb_table\" \"filenames\" {\r\n  name           = local.dynamodb_table_filenames\r\n  billing_mode   = \"PROVISIONED\"\r\n  read_capacity  = 1000\r\n  write_capacity = 1000\r\n  hash_key       = \"filename\"\r\n\r\n  #range_key      = \"\"\r\n\r\n  attribute {\r\n    name = \"filename\"\r\n    type = \"S\"\r\n  }\r\n\r\n  tags = var.tags\r\n}\r\n\r\n\r\nresource \"aws_lambda_event_source_mapping\" \"allow_dynamodb_table_to_trigger_lambda\" {\r\n  event_source_arn  = aws_dynamodb_table.filenames.stream_arn\r\n  function_name     = aws_lambda_function.trigger_stepfunction_lambda.arn\r\n  starting_position = \"LATEST\"\r\n}\r\n```\r\n\r\nUpon ```terraform apply```, I get an error that:\r\n```\r\n\u2502 Error: error creating Lambda Event Source Mapping (): InvalidParameterValueException: Unrecognized event source.\r\n\u2502 {\r\n\u2502   RespMetadata: {\r\n\u2502     StatusCode: 400,\r\n\u2502     RequestID: \"5ae68da6-3f6d-4adb-b104-72ae584dbca7\"\r\n\u2502   },\r\n\u2502   Message_: \"Unrecognized event source.\",\r\n\u2502   Type: \"User\"\r\n\u2502 }\r\n\u2502 \r\n\u2502   with module.ingest_system[\"alpegatm\"].aws_lambda_event_source_mapping.allow_dynamodb_table_to_trigger_lambda,\r\n\u2502   on ../../modules/ingest_system/dynamo.tf line 39, in resource \"aws_lambda_event_source_mapping\" \"allow_dynamodb_table_to_trigger_lambda\":\r\n\u2502   39: resource \"aws_lambda_event_source_mapping\" \"allow_dynamodb_table_to_trigger_lambda\" {\r\n```\r\nI also tried ```.arn``` instead of ```stream_arn```but that threw an error too. What else could I try?\r\n\r\nI followed the documentation for the trigger:\r\n https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_event_source_mapping", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "``` resource \"aws_dynamodb_table\" \"filenames\" { name = local.dynamodb_table_filenames billing_mode = \"PROVISIONED\" read_capacity = 1000 write_capacity = 1000 hash_key = \"filename\" #range_key = \"\" attribute { name = \"filename\" type = \"S\" } tags = var.tags } resource \"aws_lambda_event_source_mapping\" \"allow_dynamodb_table_to_trigger_lambda\" { event_source_arn = aws_dynamodb_table.filenames.stream_arn function_name = aws_lambda_function.trigger_stepfunction_lambda.arn starting_position = \"LATEST\" } ``` Upon ```terraform apply```, I get an error that: ``` \u2502 Error: error creating Lambda Event Source Mapping (): InvalidParameterValueException: Unrecognized event source. \u2502 { \u2502 RespMetadata: { \u2502 StatusCode: 400, \u2502 RequestID: \"5ae68da6-3f6d-4adb-b104-72ae584dbca7\" \u2502 }, \u2502 Message_: \"Unrecognized event source.\", \u2502 Type: \"User\" \u2502 } \u2502 \u2502 with module.ingest_system[\"alpegatm\"].aws_lambda_event_source_mapping.allow_dynamodb_table_to_trigger_lambda, \u2502 on ../../modules/ingest_system/dynamo.tf line 39, in resource \"aws_lambda_event_source_mapping\" \"allow_dynamodb_table_to_trigger_lambda\": \u2502 39: resource \"aws_lambda_event_source_mapping\" \"allow_dynamodb_table_to_trigger_lambda\" { ``` I also tried ```", "keywords": ["bill"]}]}, {"Id": "258193347", "PostHistoryTypeId": "1", "PostId": "70008141", "RevisionGUID": "d1b27a8b-0c9f-47a9-896c-f492191135c0", "CreationDate": "2021-11-17T16:29:01.337", "UserId": "12304000", "Text": "trigger lambda function from DynamoDB", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "258193348", "PostHistoryTypeId": "3", "PostId": "70008141", "RevisionGUID": "d1b27a8b-0c9f-47a9-896c-f492191135c0", "CreationDate": "2021-11-17T16:29:01.337", "UserId": "12304000", "Text": "<amazon-web-services><aws-lambda><amazon-dynamodb><terraform><terraform-provider-aws>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "70012444", "PostTypeId": "2", "ParentId": "70008141", "CreationDate": "2021-11-17T22:35:20.093", "Score": "2", "Body": "<p>From the <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#stream_enabled\" rel=\"nofollow noreferrer\"><code>aws_dynamodb_table</code></a> docs, <code>stream_arn</code> is only available if <code>stream_enabled</code> is set to <code>true</code>. You might want to add <code>stream_enabled = true</code> to your DynamoDB table definition.</p>\n<p>By default <code>stream_enabled</code> is set to <code>false</code>. You can see all the default values <a href=\"https://registry.terraform.io/modules/terraform-aws-modules/dynamodb-table/aws/latest\" rel=\"nofollow noreferrer\">here</a> for <code>aws_dynamodb_table</code>.</p>\n", "OwnerUserId": "7661119", "LastActivityDate": "2021-11-17T22:35:20.093", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "123763070", "PostId": "70012444", "Score": "0", "Text": "then it would also require me to give a stream_view_type. what would that be? \"NEW_AND_OLD_IMAGES\"?", "CreationDate": "2021-11-17T22:41:11.617", "UserId": "12304000", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "123763214", "PostId": "70012444", "Score": "0", "Text": "It depends what you want your stream to contain: https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_StreamSpecification.html. `NEW_AND_OLD_IMAGES` will have both versions of an item if is modified.", "CreationDate": "2021-11-17T22:51:44.870", "UserId": "7661119", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "258215596", "PostHistoryTypeId": "2", "PostId": "70012444", "RevisionGUID": "d4725d55-1194-4b67-a14f-ca583abf95de", "CreationDate": "2021-11-17T22:35:20.093", "UserId": "7661119", "Text": "From the [`aws_dynamodb_table`](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#stream_enabled) docs, `stream_arn` is only available if `stream_enabled` is set to `true`. You might want to add `stream_enabled = true` to your DynamoDB table definition.\r\n\r\nBy default `stream_enabled` is set to `false`. You can see all the default values [here](https://registry.terraform.io/modules/terraform-aws-modules/dynamodb-table/aws/latest) for `aws_dynamodb_table`.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}