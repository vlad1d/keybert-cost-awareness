{"Id": "66888505", "PostTypeId": "1", "CreationDate": "2021-03-31T13:06:56.300", "Score": "0", "ViewCount": "31", "Body": "<p>I have this terraform code that is generating me this JSON.</p>\n<pre><code>{\n     host = {\n          path = &quot;/xxxx/yyyy&quot;\n     }\n     name = &quot;NAME&quot;\n}\n</code></pre>\n<p>Currently it's working, but I have 3 loops, consider it not efficient, wondering if I can reduce it to 2 or probably 1 loop? Or this isn't possible.</p>\n<p>My first loop validates that container_mounts isn't empty. Don't want to generate it, if that comes empty. The second and the third is specific for getting the information as container_mounts is a map of strings.</p>\n<pre><code>variable &quot;container_mounts&quot; {\n  type = map(string)\n   default = { &quot;app/data&quot; = &quot;/xxxx/yyyyy&quot; }\n}\n\n  json = jsonencode(\n    [\n      for i in range(length(var.container_mounts)) :\n      {\n        name = [for sourceVolume in keys(var.container_mounts) :\n        replace(substr(sourceVolume, 1, length(sourceVolume)), &quot;/&quot;, &quot;-&quot;)][0]\n        host = {\n          sourcePath = [for key, value in var.container_mounts : value][0]\n        }\n      }\n    ]\n  )\n</code></pre>\n<p>Is there a way to improve it? I assume that yes, but running into different scenarios were it's not working.</p>\n", "OwnerUserId": "1876345", "LastEditorUserId": "1876345", "LastEditDate": "2021-03-31T14:23:54.897", "LastActivityDate": "2021-04-01T13:43:17.443", "Title": "Terraform reduce the amount of loops at the moment of generating a JSON", "Tags": "<terraform>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "243767722", "PostHistoryTypeId": "2", "PostId": "66888505", "RevisionGUID": "b6c85f22-fb85-4f40-a9fc-8909e2e07690", "CreationDate": "2021-03-31T13:06:56.300", "UserId": "1876345", "Text": "I have this terraform code that is generating me this JSON.\r\n\r\n```\r\n{\r\n     host = {\r\n          path = \"/xxxx/yyyy\"\r\n     }\r\n     name = \"NAME\"\r\n}\r\n```\r\n\r\nCurrently it's working, but I have 3 loops, consider it not efficient, wondering if I can reduce it to 2 or probably 1 loop? Or this isn't possible. \r\n\r\nMy first loop validates that container_mounts isn't empty. Don't want to generate it, if that comes empty. The second and the third is specific for getting the information as container_mounts is a map of strings. \r\n\r\n```\r\nvariable \"container_mounts\" {\r\n  type = map(string)\r\n   default = \"name=/var/xxx\"\r\n}\r\n\r\n  json = jsonencode(\r\n    [\r\n      for i in range(length(var.container_mounts)) :\r\n      {\r\n        name = [for sourceVolume in keys(var.container_mounts) :\r\n        replace(substr(sourceVolume, 1, length(sourceVolume)), \"/\", \"-\")][0]\r\n        host = {\r\n          sourcePath = [for key, value in var.container_mounts : value][0]\r\n        }\r\n      }\r\n    ]\r\n  )\r\n```\r\n\r\nIs there a way to improve it? I assume that yes, but running into different scenarios were it's not working.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Currently it's working, but I have 3 loops, consider it not efficient, wondering if I can reduce it to 2 or probably 1 loop? ", "keywords": ["efficient"]}]}, {"Id": "243767723", "PostHistoryTypeId": "1", "PostId": "66888505", "RevisionGUID": "b6c85f22-fb85-4f40-a9fc-8909e2e07690", "CreationDate": "2021-03-31T13:06:56.300", "UserId": "1876345", "Text": "Terraform reduce the amount of loops at the moment of generating a JSON", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "243767724", "PostHistoryTypeId": "3", "PostId": "66888505", "RevisionGUID": "b6c85f22-fb85-4f40-a9fc-8909e2e07690", "CreationDate": "2021-03-31T13:06:56.300", "UserId": "1876345", "Text": "<terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "243772897", "PostHistoryTypeId": "5", "PostId": "66888505", "RevisionGUID": "ba5b795d-c1b8-4ec5-8bc0-ab189ace8928", "CreationDate": "2021-03-31T14:23:54.897", "UserId": "1876345", "Comment": "added 15 characters in body", "Text": "I have this terraform code that is generating me this JSON.\r\n\r\n```\r\n{\r\n     host = {\r\n          path = \"/xxxx/yyyy\"\r\n     }\r\n     name = \"NAME\"\r\n}\r\n```\r\n\r\nCurrently it's working, but I have 3 loops, consider it not efficient, wondering if I can reduce it to 2 or probably 1 loop? Or this isn't possible. \r\n\r\nMy first loop validates that container_mounts isn't empty. Don't want to generate it, if that comes empty. The second and the third is specific for getting the information as container_mounts is a map of strings. \r\n\r\n```\r\nvariable \"container_mounts\" {\r\n  type = map(string)\r\n   default = { \"app/data\" = \"/xxxx/yyyyy\" }\r\n}\r\n\r\n  json = jsonencode(\r\n    [\r\n      for i in range(length(var.container_mounts)) :\r\n      {\r\n        name = [for sourceVolume in keys(var.container_mounts) :\r\n        replace(substr(sourceVolume, 1, length(sourceVolume)), \"/\", \"-\")][0]\r\n        host = {\r\n          sourcePath = [for key, value in var.container_mounts : value][0]\r\n        }\r\n      }\r\n    ]\r\n  )\r\n```\r\n\r\nIs there a way to improve it? I assume that yes, but running into different scenarios were it's not working.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Currently it's working, but I have 3 loops, consider it not efficient, wondering if I can reduce it to 2 or probably 1 loop? ", "keywords": ["efficient"]}]}], "answers": [{"Id": "66905654", "PostTypeId": "2", "ParentId": "66888505", "CreationDate": "2021-04-01T13:43:17.443", "Score": "0", "Body": "<p>So after talking with a friend, looks I complicated my life doing what I did.</p>\n<pre><code>json = jsonencode(\n    [\n      for key, value in var.container_mounts :{\n        host = { &quot;sourcePath&quot; = value }\n        name = replace(substr(key, 1, length(key)), &quot;/&quot;, &quot;-&quot;)\n      }\n    ]\n  )\n</code></pre>\n<p>It can be done only with one loop.</p>\n", "OwnerUserId": "1876345", "LastActivityDate": "2021-04-01T13:43:17.443", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "243838617", "PostHistoryTypeId": "2", "PostId": "66905654", "RevisionGUID": "06ff80a2-f713-4d7f-a34f-2a0e75de60ff", "CreationDate": "2021-04-01T13:43:17.443", "UserId": "1876345", "Text": "So after talking with a friend, looks I complicated my life doing what I did.\r\n\r\n```\r\njson = jsonencode(\r\n    [\r\n      for key, value in var.container_mounts :{\r\n        host = { \"sourcePath\" = value }\r\n        name = replace(substr(key, 1, length(key)), \"/\", \"-\")\r\n      }\r\n    ]\r\n  )\r\n```\r\n\r\nIt can be done only with one loop.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "Currently it's working, but I have 3 loops, consider it not efficient, wondering if I can reduce it to 2 or probably 1 loop? ", "keywords": ["efficient"]}]}