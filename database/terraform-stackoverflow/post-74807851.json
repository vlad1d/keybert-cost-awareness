{"Id": "74807851", "PostTypeId": "1", "CreationDate": "2022-12-15T07:03:10.447", "Score": "0", "ViewCount": "93", "Body": "<p>I created WAFV2 firewall rules to restrict few IP address to hit API gateways. it is working as expected.</p>\n<pre><code># ipsets\nresource &quot;aws_wafv2_ip_set&quot; &quot;example-ip-sets&quot; {\n  name               = &quot;ipsetsexample&quot;\n  description        = &quot;Example IP set&quot;\n  scope              = &quot;REGIONAL&quot;\n  ip_address_version = &quot;IPV4&quot;\n  addresses          = [&quot;137.137.43.154/32&quot;, &quot;40.121.120.150/32&quot;]\n\n  tags = {\n    Tag1 = &quot;Value1&quot;\n    Tag2 = &quot;Value2&quot;\n  }\n}\n\nresource &quot;aws_wafv2_web_acl&quot; &quot;firewall&quot; {\n  name = &quot;firewall&quot;\n  scope = &quot;REGIONAL&quot;\n  default_action {\n    block {}\n  }\n  rule {\n    name     = &quot;ip-blacklist&quot;\n    priority = 1\n    action {\n      allow {}\n    }\n    statement {\n      ip_set_reference_statement {\n        arn = aws_wafv2_ip_set.example-ip-sets.arn\n      }\n    }\n\n    visibility_config {\n      cloudwatch_metrics_enabled = true\n      metric_name                = &quot;BlacklistedIP&quot;\n      sampled_requests_enabled   = true\n    }\n  }\n\n  visibility_config {\n    cloudwatch_metrics_enabled = true\n    metric_name                = &quot;Allowed&quot;\n    sampled_requests_enabled   = true\n  }\n}\n\nresource &quot;aws_wafv2_web_acl_association&quot; &quot;this&quot; {\n  resource_arn = aws_api_gateway_stage.api_stage.arn\n  web_acl_arn  = aws_wafv2_web_acl.firewall.arn\n}\n\n</code></pre>\n<p>but now new scenario came in to picture like, block some domain names instead of IP's <code>(abcde.com, us1a.bcde.com)</code> to invoke the API gateways. I have searched many terraform docs but didn't find any related.\nis there any docs or source to restrict domain names to hit the API gateway ?</p>\n", "OwnerUserId": "16250966", "LastEditorUserId": "135549", "LastEditDate": "2022-12-15T15:55:33.363", "LastActivityDate": "2022-12-15T15:55:33.363", "Title": "wafv2 firewall rules to restrict domain names", "Tags": "<amazon-web-services><terraform><web-application-firewall>", "AnswerCount": "0", "CommentCount": "5", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "132023397", "PostId": "74807851", "Score": "0", "Text": "Well, domain names map to IP addresses, don't they? :)", "CreationDate": "2022-12-15T07:19:35.023", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Well, domain names map to IP addresses, don't they? :)", "keywords": ["domain"]}]}, {"Id": "132023905", "PostId": "74807851", "Score": "0", "Text": "but IP's are not static, so we are planning for domain names", "CreationDate": "2022-12-15T07:54:10.567", "UserId": "16250966", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "but IP's are not static, so we are planning for domain names", "keywords": ["domain"]}]}, {"Id": "132024447", "PostId": "74807851", "Score": "0", "Text": "How come DNS names are not mapped to static IPs? They will be changing frequently?", "CreationDate": "2022-12-15T08:28:28.017", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "They will be changing frequently?", "keywords": ["change"]}]}, {"Id": "132028369", "PostId": "74807851", "Score": "0", "Text": "Are you trying to block browser-based requests (ie via a website front end)? If that's the case, CORS controls might be an easier and cheaper alternative. If you need to use WAF, you can set a rule to check the ```origin``` header.", "CreationDate": "2022-12-15T11:45:12.963", "UserId": "10354667", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If that's the case, CORS controls might be an easier and cheaper alternative. ", "keywords": ["cheap"]}]}, {"Id": "132029626", "PostId": "74807851", "Score": "0", "Text": "Hi @chamal, do you have any terraform reference documents to achieve this through WAF..i have not find any references", "CreationDate": "2022-12-15T12:41:41.810", "UserId": "16250966", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "284326761", "PostHistoryTypeId": "2", "PostId": "74807851", "RevisionGUID": "1409274e-19fc-49e8-8d0f-eda44d989fa1", "CreationDate": "2022-12-15T07:03:10.447", "UserId": "16250966", "Text": "I created WAFV2 firewall rules to restrict few IP address to hit API gateways. it is working as expected. \r\n```\r\n# ipsets\r\nresource \"aws_wafv2_ip_set\" \"example-ip-sets\" {\r\n  name               = \"ipsetsexample\"\r\n  description        = \"Example IP set\"\r\n  scope              = \"REGIONAL\"\r\n  ip_address_version = \"IPV4\"\r\n  addresses          = [\"137.137.43.154/32\", \"40.121.120.150/32\"]\r\n\r\n  tags = {\r\n    Tag1 = \"Value1\"\r\n    Tag2 = \"Value2\"\r\n  }\r\n}\r\n\r\nresource \"aws_wafv2_web_acl\" \"firewall\" {\r\n  name = \"firewall\"\r\n  scope = \"REGIONAL\"\r\n  default_action {\r\n    block {}\r\n  }\r\n  rule {\r\n    name     = \"ip-blacklist\"\r\n    priority = 1\r\n    action {\r\n      allow {}\r\n    }\r\n    statement {\r\n      ip_set_reference_statement {\r\n        arn = aws_wafv2_ip_set.example-ip-sets.arn\r\n      }\r\n    }\r\n\r\n    visibility_config {\r\n      cloudwatch_metrics_enabled = true\r\n      metric_name                = \"BlacklistedIP\"\r\n      sampled_requests_enabled   = true\r\n    }\r\n  }\r\n\r\n  visibility_config {\r\n    cloudwatch_metrics_enabled = true\r\n    metric_name                = \"Allowed\"\r\n    sampled_requests_enabled   = true\r\n  }\r\n}\r\n\r\nresource \"aws_wafv2_web_acl_association\" \"this\" {\r\n  resource_arn = aws_api_gateway_stage.api_stage.arn\r\n  web_acl_arn  = aws_wafv2_web_acl.firewall.arn\r\n}\r\n\r\n```\r\n\r\nbut now new scenario came in to picture like, block some domain names instead of IP's ```(abcde.com, us1a.bcde.com)``` to invoke the API gateways. I have searched many terraform docs but didn't find any related. \r\nis there any docs or source to restrict domain names to hit the API gateway ?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "``` # ipsets resource \"aws_wafv2_ip_set\" \"example-ip-sets\" { name = \"ipsetsexample\" description = \"Example IP set\" scope = \"REGIONAL\" ip_address_version = \"IPV4\" addresses = [\"137.137.43.154/32\", \"40.121.120.150/32\"] tags = { Tag1 = \"Value1\" Tag2 = \"Value2\" } } resource \"aws_wafv2_web_acl\" \"firewall\" { name = \"firewall\" scope = \"REGIONAL\" default_action { block {} } rule { name = \"ip-blacklist\" priority = 1 action { allow {} } statement { ip_set_reference_statement { arn = aws_wafv2_ip_set.example-ip-sets.arn } } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"BlacklistedIP\" sampled_requests_enabled = true } } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"Allowed\" sampled_requests_enabled = true } } resource \"aws_wafv2_web_acl_association\" \"this\" { resource_arn = aws_api_gateway_stage.api_stage.arn web_acl_arn = aws_wafv2_web_acl.firewall.arn } ``` but now new scenario came in to picture like, block some domain names instead of IP's ```(abcde.com, us1a.bcde.com)``` to invoke the API gateways. ", "keywords": ["domain"]}, {"source": "Text", "text": ". is there any docs or source to restrict domain names to hit the API gateway ?", "keywords": ["domain"]}]}, {"Id": "284326763", "PostHistoryTypeId": "1", "PostId": "74807851", "RevisionGUID": "1409274e-19fc-49e8-8d0f-eda44d989fa1", "CreationDate": "2022-12-15T07:03:10.447", "UserId": "16250966", "Text": "wafv2 firewall rules to restrict domain names", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "wafv2 firewall rules to restrict domain names", "keywords": ["domain"]}]}, {"Id": "284326764", "PostHistoryTypeId": "3", "PostId": "74807851", "RevisionGUID": "1409274e-19fc-49e8-8d0f-eda44d989fa1", "CreationDate": "2022-12-15T07:03:10.447", "UserId": "16250966", "Text": "<amazon-web-services><terraform><waf>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "284363167", "PostHistoryTypeId": "6", "PostId": "74807851", "RevisionGUID": "41c7da5c-f115-4065-8002-44342bca20f9", "CreationDate": "2022-12-15T15:55:33.363", "UserId": "135549", "Comment": "edited tags", "Text": "<amazon-web-services><terraform><web-application-firewall>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "wafv2 firewall rules to restrict domain names", "keywords": ["domain"]}, {"source": "Body", "text": "but now new scenario came in to picture like, block some domain names instead of IP's (abcde.com, us1a.bcde.com) to invoke the API gateways. ", "keywords": ["domain"]}, {"source": "Body", "text": "is there any docs or source to restrict domain names to hit the API gateway ?", "keywords": ["domain"]}]}