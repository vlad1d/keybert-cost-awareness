{"Id": "74814241", "PostTypeId": "1", "CreationDate": "2022-12-15T15:53:10.253", "Score": "1", "ViewCount": "135", "Body": "<p>I have created a module that creates a subscription and other resources via terraform.</p>\n<p>As you can see it iterates over this two times. One time where env is &quot;dev&quot; and one time where env is &quot;prod&quot;.</p>\n<p>the problem is: It creates the subscription &quot;-prod&quot;, but it will not create &quot;-dev&quot;. The pipeline says &quot;Error: context deadline exceeded&quot; after 30 minutes.</p>\n<p>In terraform plan it says that it is all good and it will add the subscription, but it will not do it.</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>module \"wmind_subscription\" {\n  source = \"./subscription\"\n\n  for_each            = toset([\"dev\", \"prod\"])\n  env                 = each.key\n  name                = \"wmind-it\"\n  management_group_id = module.wmind_management_group.management_group_id\n\n  repo_name = module.wmind_github.repo_name\n\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>The terraform resource thats creates the subscription:</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>resource \"azurerm_subscription\" \"this\" {\n  subscription_name = \"${var.name}-${var.env}\"\n  billing_scope_id  = data.azurerm_billing_mca_account_scope.this.id\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>full error message:</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>\u2577\n\u2502 Error: creating new Subscription (Alias \"***\"): subscription.AliasClient#Create: Failure sending request: StatusCode=0 -- Original Error: context deadline exceeded\n\u2502 \n\u2502   with module.wmind_subscription[\"dev\"].azurerm_subscription.this,\n\u2502   on subscription/subscription.tf line 10, in resource \"azurerm_subscription\" \"this\":\n\u2502   10: resource \"azurerm_subscription\" \"this\" {\n\u2502 \n\u2575</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>hope someone can help me, thank you</p>\n", "OwnerUserId": "15423804", "LastEditorUserId": "868321", "LastEditDate": "2022-12-15T16:03:06.463", "LastActivityDate": "2022-12-15T16:03:06.463", "Title": "Create multiple subscriptions with for_each in terraform returns context deadline exceeded", "Tags": "<terraform><terraform-provider-azure><azure-rm>", "AnswerCount": "0", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "284362942", "PostHistoryTypeId": "2", "PostId": "74814241", "RevisionGUID": "a850d13c-e97d-4d88-a1d6-0efe92bb0498", "CreationDate": "2022-12-15T15:53:10.253", "UserId": "15423804", "Text": "I have created a module that creates a subscription and other resources via terraform.\r\n\r\nAs you can see it iterates over this two times. One time where env is \"dev\" and one time where env is \"prod\".\r\n\r\nthe problem is: It creates the subscription \"-prod\", but it will not create \"-dev\". The pipeline says \"Error: context deadline exceeded\" after 30 minutes.\r\n\r\nIn terraform plan it says that it is all good and it will add the subscription, but it will not do it.\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    module \"wmind_subscription\" {\r\n      source = \"./subscription\"\r\n\r\n      for_each            = toset([\"dev\", \"prod\"])\r\n      env                 = each.key\r\n      name                = \"wmind-it\"\r\n      management_group_id = module.wmind_management_group.management_group_id\r\n\r\n      repo_name = module.wmind_github.repo_name\r\n\r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\nThe terraform resource thats creates the subscription:\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    resource \"azurerm_subscription\" \"this\" {\r\n      subscription_name = \"${var.name}-${var.env}\"\r\n      billing_scope_id  = data.azurerm_billing_mca_account_scope.this.id\r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\nfull error message: \r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    \u2577\r\n    \u2502 Error: creating new Subscription (Alias \"***\"): subscription.AliasClient#Create: Failure sending request: StatusCode=0 -- Original Error: context deadline exceeded\r\n    \u2502 \r\n    \u2502   with module.wmind_subscription[\"dev\"].azurerm_subscription.this,\r\n    \u2502   on subscription/subscription.tf line 10, in resource \"azurerm_subscription\" \"this\":\r\n    \u2502   10: resource \"azurerm_subscription\" \"this\" {\r\n    \u2502 \r\n    \u2575\r\n\r\n<!-- end snippet -->\r\n\r\nhope someone can help me, thank you\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "In terraform plan it says that it is all good and it will add the subscription, but it will not do it. module \"wmind_subscription\" { source = \"./subscription\" for_each = toset([\"dev\", \"prod\"]) env = each.key name = \"wmind-it\" management_group_id = module.wmind_management_group.management_group_id repo_name = module.wmind_github.repo_name } The terraform resource thats creates the subscription: resource \"azurerm_subscription\" \"this\" { subscription_name = \"${var.name}-${var.env}\" billing_scope_id = data.azurerm_billing_mca_account_scope.this.id } full error message: \u2577 \u2502 Error: creating new Subscription (Alias \"***\"): subscription.AliasClient#Create: Failure sending request: StatusCode=0 -- Original Error: context deadline exceeded \u2502 \u2502 with module.wmind_subscription[\"dev\"].azurerm_subscription.this, \u2502 on subscription/subscription.tf line 10, in resource \"azurerm_subscription\" \"this\": \u2502 10: resource \"azurerm_subscription\" \"this\" { \u2502 \u2575 hope someone can help me, thank you", "keywords": ["bill"]}]}, {"Id": "284362944", "PostHistoryTypeId": "1", "PostId": "74814241", "RevisionGUID": "a850d13c-e97d-4d88-a1d6-0efe92bb0498", "CreationDate": "2022-12-15T15:53:10.253", "UserId": "15423804", "Text": "Create multiple subscriptions with for_each in terraform returns context deadline exceeded", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "284362945", "PostHistoryTypeId": "3", "PostId": "74814241", "RevisionGUID": "a850d13c-e97d-4d88-a1d6-0efe92bb0498", "CreationDate": "2022-12-15T15:53:10.253", "UserId": "15423804", "Text": "<github><terraform><github-actions><terraform-provider-azure><azure-rm>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "284363703", "PostHistoryTypeId": "6", "PostId": "74814241", "RevisionGUID": "1fbe56ab-246e-4902-95cc-412d0ded0e9b", "CreationDate": "2022-12-15T16:03:06.463", "UserId": "868321", "Comment": "Removed unrelated tags", "Text": "<terraform><terraform-provider-azure><azure-rm>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}