{"Id": "75721558", "PostTypeId": "1", "CreationDate": "2023-03-13T11:55:31.513", "Score": "0", "ViewCount": "282", "Body": "<p>I am using the following terraform based on this module<a href=\"https://github.com/terraform-google-modules/terraform-google-project-factory\" rel=\"nofollow noreferrer\">https://github.com/terraform-google-modules/terraform-google-project-factory</a>:</p>\n<pre><code>module &quot;project&quot; {\n  source  = &quot;terraform-google-modules/project-factory/google&quot;\n  version = &quot;~&gt; 14.1&quot;\n\n  name                        = &quot;project&quot;\n  random_project_id           = true\n  org_id                      = var.organization_id\n  billing_account             = var.billing_account\n  default_service_account     = &quot;deprivilege&quot;\n  budget_amount               = var.budget_amount\n  budget_alert_spent_percents = var.budget_alert_spent_percents\n  activate_apis = [\n    &quot;compute.googleapis.com&quot;,\n    &quot;dns.googleapis.com&quot;,\n    &quot;domains.googleapis.com&quot;,\n    &quot;cloudresourcemanager.googleapis.com&quot;,\n    &quot;billingbudgets.googleapis.com&quot;,\n    &quot;serviceusage.googleapis.com&quot;,\n  ]\n}\n</code></pre>\n<p>I am not sure how to add the required billing permissions using this module, and keep getting the following error:</p>\n<pre><code>Error: Error creating Budget: googleapi: Error 403: The caller does not have permission\nwith module.project.module.budget.google_billing_budget.budget[0]\non .terraform/modules/project/modules/budget/main.tf line 41, in resource &quot;google_billing_budget&quot; &quot;budget&quot;:\nresource &quot;google_billing_budget&quot; &quot;budget&quot; {\n</code></pre>\n<p>No examples related to billing show anything additional that needs to be done apart from activating APIs. Before I manually add permissions, I would like to know how to do this with the module, or what permissions are required to add manually. Help would be greatly appreciated.</p>\n<p>I have opened an issue about this here which references some permissions I think may be needed:\n<a href=\"https://github.com/terraform-google-modules/terraform-google-project-factory/issues/789\" rel=\"nofollow noreferrer\">https://github.com/terraform-google-modules/terraform-google-project-factory/issues/789</a></p>\n", "OwnerUserId": "6718354", "LastActivityDate": "2023-03-14T07:40:13.637", "Title": "How to Add Required Billing Permissions using Google Cloud Project Factory?", "Tags": "<google-cloud-platform><terraform-provider-gcp><google-cloud-billing>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "289633005", "PostHistoryTypeId": "2", "PostId": "75721558", "RevisionGUID": "5be0722d-ffd1-4ea4-bfb4-465f453aa0e3", "CreationDate": "2023-03-13T11:55:31.513", "UserId": "6718354", "Text": "I am using the following terraform based on this module<https://github.com/terraform-google-modules/terraform-google-project-factory>:\r\n\r\n```\r\nmodule \"project\" {\r\n  source  = \"terraform-google-modules/project-factory/google\"\r\n  version = \"~> 14.1\"\r\n\r\n  name                        = \"project\"\r\n  random_project_id           = true\r\n  org_id                      = var.organization_id\r\n  billing_account             = var.billing_account\r\n  default_service_account     = \"deprivilege\"\r\n  budget_amount               = var.budget_amount\r\n  budget_alert_spent_percents = var.budget_alert_spent_percents\r\n  activate_apis = [\r\n    \"compute.googleapis.com\",\r\n    \"dns.googleapis.com\",\r\n    \"domains.googleapis.com\",\r\n    \"cloudresourcemanager.googleapis.com\",\r\n    \"billingbudgets.googleapis.com\",\r\n    \"serviceusage.googleapis.com\",\r\n  ]\r\n}\r\n```\r\nI am not sure how to add the required billing permissions using this module, and keep getting the following error:\r\n\r\n```\r\nError: Error creating Budget: googleapi: Error 403: The caller does not have permission\r\nwith module.project.module.budget.google_billing_budget.budget[0]\r\non .terraform/modules/project/modules/budget/main.tf line 41, in resource \"google_billing_budget\" \"budget\":\r\nresource \"google_billing_budget\" \"budget\" {\r\n```\r\n\r\nNo examples related to billing show anything additional that needs to be done apart from activating APIs. Before I manually add permissions, I would like to know how to do this with the module, or what permissions are required to add manually. Help would be greatly appreciated. \r\n\r\nI have opened an issue about this here which references some permissions I think may be needed: \r\n<https://github.com/terraform-google-modules/terraform-google-project-factory/issues/789>\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I am using the following terraform based on this module: ``` module \"project\" { source = \"terraform-google-modules/project-factory/google\" version = \"~> 14.1\" name = \"project\" random_project_id = true org_id = var.organization_id billing_account = var.billing_account default_service_account = \"deprivilege\" budget_amount = var.budget_amount budget_alert_spent_percents = var.budget_alert_spent_percents activate_apis = [ \"compute.googleapis.com\", \"dns.googleapis.com\", \"domains.googleapis.com\", \"cloudresourcemanager.googleapis.com\", \"billingbudgets.googleapis.com\", \"serviceusage.googleapis.com\", ] } ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "I am not sure how to add the required billing permissions using this module, and keep getting the following error: ``` ", "keywords": ["bill"]}, {"source": "Text", "text": "No examples related to billing show anything additional that needs to be done apart from activating APIs. ", "keywords": ["bill"]}]}, {"Id": "289633007", "PostHistoryTypeId": "1", "PostId": "75721558", "RevisionGUID": "5be0722d-ffd1-4ea4-bfb4-465f453aa0e3", "CreationDate": "2023-03-13T11:55:31.513", "UserId": "6718354", "Text": "How to Add Required Billing Permissions using Google Cloud Project Factory?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "289633008", "PostHistoryTypeId": "3", "PostId": "75721558", "RevisionGUID": "5be0722d-ffd1-4ea4-bfb4-465f453aa0e3", "CreationDate": "2023-03-13T11:55:31.513", "UserId": "6718354", "Text": "<google-cloud-platform><terraform-provider-gcp><google-cloud-billing>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "75730209", "PostTypeId": "2", "ParentId": "75721558", "CreationDate": "2023-03-14T07:40:13.637", "Score": "2", "Body": "<p>Only the users can create and manage Cloud budgets with a Billing Account Administrator role or a custom role with appropriate budget management permissions. This means that project owners without the Billing Account Admin role cannot create budgets for their respective projects.</p>\n<p>It looks like there is a permissions issue. You need a role that includes the following <a href=\"https://cloud.google.com/billing/docs/how-to/budgets#permissions_required_for_this_task\" rel=\"nofollow noreferrer\">permissions</a> on the Terraform Service Account:</p>\n<ol>\n<li><p>billing.budgets.create to create a new budget.</p>\n</li>\n<li><p>billing.budgets.get and billing.budgets.list to view all budgets for the\nCloud Billing account.</p>\n</li>\n</ol>\n<p>To gain these permissions, ask your administrator to grant you one of the following <a href=\"https://cloud.google.com/billing/docs/how-to/billing-access\" rel=\"nofollow noreferrer\">Cloud Billing IAM</a> roles on your Terraform Service Account:</p>\n<ul>\n<li><p>Billing Account Administrator</p>\n</li>\n<li><p>Billing Account Costs Manager</p>\n</li>\n</ul>\n", "OwnerUserId": "21302428", "LastActivityDate": "2023-03-14T07:40:13.637", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133614508", "PostId": "75730209", "Score": "0", "Text": "Thank you very much for the great answer. I am aware of these permissions, they are mentioned in the issue I created. Where I am unsure is how to make sure the service account created with this module when a new project is defined has these permissions.", "CreationDate": "2023-03-15T08:15:12.690", "UserId": "6718354", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "289682514", "PostHistoryTypeId": "2", "PostId": "75730209", "RevisionGUID": "7ede5bfe-0ed3-48dd-be8b-002a5e0e46b7", "CreationDate": "2023-03-14T07:40:13.637", "UserId": "21302428", "Text": "Only the users can create and manage Cloud budgets with a Billing Account Administrator role or a custom role with appropriate budget management permissions. This means that project owners without the Billing Account Admin role cannot create budgets for their respective projects.\r\n\r\nIt looks like there is a permissions issue. You need a role that includes the following [permissions][1] on the Terraform Service Account:\r\n\r\n 1. billing.budgets.create to create a new budget. \r\n    \r\n 2. billing.budgets.get and billing.budgets.list to view all budgets for the \r\n    Cloud Billing account.\r\n\r\nTo gain these permissions, ask your administrator to grant you one of the following [Cloud Billing IAM][2] roles on your Terraform Service Account:\r\n\r\n  \r\n\r\n - Billing Account Administrator \r\n   \r\n - Billing Account Costs Manager\r\n\r\n\r\n  [1]: https://cloud.google.com/billing/docs/how-to/budgets#permissions_required_for_this_task\r\n  [2]: https://cloud.google.com/billing/docs/how-to/billing-access", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You need a role that includes the following [permissions][1] on the Terraform Service Account: 1. billing.budgets.create to create a new budget. ", "keywords": ["bill"]}, {"source": "Text", "text": "2. billing.budgets.get and billing.budgets.list to view all budgets for the Cloud Billing account. ", "keywords": ["bill"]}, {"source": "Text", "text": "To gain these permissions, ask your administrator to grant you one of the following [Cloud Billing IAM][2] roles on your Terraform Service Account: - Billing Account Administrator - Billing Account Costs Manager [1]: https://cloud.google.com/billing/docs/how-to/budgets#permissions_required_for_this_task [2]: https://cloud.google.com/billing/docs/how-to/billing-access", "keywords": ["bill"]}]}, {"Id": "289696728", "PostHistoryTypeId": "12", "PostId": "75730209", "RevisionGUID": "3158911e-bafa-44cf-aabb-5e7c1ef21722", "CreationDate": "2023-03-14T11:50:18.157", "UserId": "100297", "Comment": "via Vote", "Text": "{\"Voters\":[{\"Id\":100297,\"DisplayName\":\"Martijn Pieters\"}],\"DeleteType\":1}", "filtered-sentences": []}, {"Id": "289697178", "PostHistoryTypeId": "13", "PostId": "75730209", "RevisionGUID": "7d577a4b-6b33-490c-a460-9593edbfd618", "CreationDate": "2023-03-14T11:58:20.740", "UserId": "100297", "Text": "{\"Voters\":[{\"Id\":100297,\"DisplayName\":\"Martijn Pieters\"}]}", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "You need a role that includes the following permissions on the Terraform Service Account: billing.budgets.create to create a new budget. ", "keywords": ["bill"]}, {"source": "Body", "text": "billing.budgets.get and billing.budgets.list to view all budgets for the Cloud Billing account. ", "keywords": ["bill"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I am using the following terraform based on this modulehttps://github.com/terraform-google-modules/terraform-google-project-factory: I am not sure how to add the required billing permissions using this module, and keep getting the following error: ", "keywords": ["bill"]}, {"source": "Body", "text": "No examples related to billing show anything additional that needs to be done apart from activating APIs. ", "keywords": ["bill"]}]}