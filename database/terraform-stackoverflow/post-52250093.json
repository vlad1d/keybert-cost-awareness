{"Id": "52250093", "PostTypeId": "1", "CreationDate": "2018-09-10T01:52:46.277", "Score": "0", "ViewCount": "86", "Body": "<p>Unfortunately terraform aws spotfleet resource configuration does not support the count meta parameter which means I can't use the count index value like it does here for aws_instance.</p>\n\n<pre><code>resource \"aws_instance\" \"example\" {\n  count = 15\n  ami = \"ami-2d39803a\"\n  instance_type = \"t2.micro\"\n\n  tags {\n    Name = \"example-${count.index}\"\n  }\n}\n</code></pre>\n\n<p>Is it possible to configure resource similar above(and NOT create the resource) and only use it so I can use the count index from spotfleet resource?</p>\n\n<pre><code># Request a Spot fleet\nresource \"aws_spot_fleet_request\" \"cheap_compute\" {\n  iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price          = \"0.03\"\n  allocation_strategy = \"diversified\"\n  target_capacity     = 6\n  valid_until         = \"2019-11-04T20:44:20Z\"\n\n  launch_specification {\n    instance_type             = \"m4.10xlarge\"\n    ami                       = \"ami-1234\"\n    spot_price                = \"2.793\"\n\n    tags {\n      Name = \"example-${aws_instance.example.count.index}\"\n    }\n  }\n}\n</code></pre>\n\n<p>I'm not sure in this is a good idea because terraform resource probably has a good reason why the count is not supported for spotfleet. However, I need to give unique tag value to each instance in the fleet.</p>\n", "OwnerUserId": "9969619", "LastActivityDate": "2018-09-10T01:52:46.277", "Title": "terraform create phantom aws resource configuration to only use the meta parameter value", "Tags": "<amazon-web-services><amazon-ec2><terraform>", "AnswerCount": "0", "CommentCount": "5", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "91450001", "PostId": "52250093", "Score": "0", "Text": "Are you really sure that `aws_spot_fleet_request` does not support `count`?", "CreationDate": "2018-09-10T04:47:21.947", "UserId": "400222", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "91483217", "PostId": "52250093", "Score": "0", "Text": "@StephenKing, yes I'm positive. See here [link](https://www.terraform.io/docs/providers/aws/r/spot_fleet_request.html) It supports target_capacity which has no count index.", "CreationDate": "2018-09-11T02:20:30.973", "UserId": "9969619", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "91484309", "PostId": "52250093", "Score": "0", "Text": "I don't understand what your goal is. You can't access `count.index`, if you didn't specify a count for a resource. Do you want multiple spot fleet requests?", "CreationDate": "2018-09-11T03:52:08.630", "UserId": "400222", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "91506554", "PostId": "52250093", "Score": "0", "Text": "@StephenKing, my goal is that I want to create a phantom resource that supports count.index I will not be using so that I can refer to it from the spotfleet request resource and use that index value for the tag values. I want each ec2 instances to have unique tag value that ends with a value that increments by count.index value.", "CreationDate": "2018-09-11T15:23:43.967", "UserId": "9969619", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "91506589", "PostId": "52250093", "Score": "0", "Text": "Ah, would say that's not possible from AWS side even..", "CreationDate": "2018-09-11T15:24:37.590", "UserId": "400222", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "181437798", "PostHistoryTypeId": "2", "PostId": "52250093", "RevisionGUID": "f4703bdf-5fc3-4027-a4a9-4ec4dce815df", "CreationDate": "2018-09-10T01:52:46.277", "UserId": "9969619", "Text": "Unfortunately terraform aws spotfleet resource configuration does not support the count meta parameter which means I can't use the count index value like it does here for aws_instance.\r\n\r\n    resource \"aws_instance\" \"example\" {\r\n      count = 15\r\n      ami = \"ami-2d39803a\"\r\n      instance_type = \"t2.micro\"\r\n      \r\n      tags {\r\n        Name = \"example-${count.index}\"\r\n      }\r\n    }\r\n\r\nIs it possible to configure resource similar above(and NOT create the resource) and only use it so I can use the count index from spotfleet resource?\r\n\r\n    # Request a Spot fleet\r\n    resource \"aws_spot_fleet_request\" \"cheap_compute\" {\r\n      iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\r\n      spot_price          = \"0.03\"\r\n      allocation_strategy = \"diversified\"\r\n      target_capacity     = 6\r\n      valid_until         = \"2019-11-04T20:44:20Z\"\r\n    \r\n      launch_specification {\r\n        instance_type             = \"m4.10xlarge\"\r\n        ami                       = \"ami-1234\"\r\n        spot_price                = \"2.793\"\r\n    \r\n        tags {\r\n          Name = \"example-${aws_instance.example.count.index}\"\r\n        }\r\n      }\r\n    }\r\n\r\nI'm not sure in this is a good idea because terraform resource probably has a good reason why the count is not supported for spotfleet. However, I need to give unique tag value to each instance in the fleet.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Is it possible to configure resource similar above(and NOT create the resource) and only use it so I can use the count index from spotfleet resource? # Request a Spot fleet resource \"aws_spot_fleet_request\" \"cheap_compute\" { iam_fleet_role = \"arn:aws:iam::12345678:role/spot-fleet\" spot_price = \"0.03\" allocation_strategy = \"diversified\" target_capacity = 6 valid_until = \"2019-11-04T20:44:20Z\" launch_specification { instance_type = \"m4.10xlarge\" ami = \"ami-1234\" spot_price = \"2.793\" tags { Name = \"example-${aws_instance.example.count.index}\" } } } I'm not sure in this is a good idea because terraform resource probably has a good reason why the count is not supported for spotfleet", "keywords": ["cheap"]}, {"source": "Text", "text": "However, I need to give unique tag value to each instance in the fleet", "keywords": ["instance"]}]}, {"Id": "181437799", "PostHistoryTypeId": "1", "PostId": "52250093", "RevisionGUID": "f4703bdf-5fc3-4027-a4a9-4ec4dce815df", "CreationDate": "2018-09-10T01:52:46.277", "UserId": "9969619", "Text": "terraform create phantom aws resource configuration to only use the meta parameter value", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "181437800", "PostHistoryTypeId": "3", "PostId": "52250093", "RevisionGUID": "f4703bdf-5fc3-4027-a4a9-4ec4dce815df", "CreationDate": "2018-09-10T01:52:46.277", "UserId": "9969619", "Text": "<amazon-web-services><amazon-ec2><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "However, I need to give unique tag value to each instance in the fleet.", "keywords": ["instance"]}]}