{"Id": "75796183", "PostTypeId": "1", "AcceptedAnswerId": "75796192", "CreationDate": "2023-03-20T23:28:17.987", "Score": "1", "ViewCount": "303", "Body": "<p>I am unable to make user groups in GCP using terraform: <a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloud_identity_group\" rel=\"nofollow noreferrer\">https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloud_identity_group</a></p>\n<p>There is a warning about using the application default credentials:</p>\n<blockquote>\n<p>If you are using User ADCs (Application Default Credentials) with this resource, you must specify a billing_project and set user_project_override to true in the provider configuration. Otherwise the Cloud Identity API will return a 403 error. Your account must have the serviceusage.services.use permission on the billing_project you defined.</p>\n</blockquote>\n<p>I am using the Application Default Credentials.</p>\n<p>Here is the error I get when I try to terraform apply my code:</p>\n<pre><code>Error: Error creating Group: googleapi: Error 403: Your application has authenticated using end user credentials from the Google Cloud SDK or Google Cloud Shell which are not supported by the cloudidentity.googleapis.com. We recommend configuring the billing/quota_project setting in gcloud or using a service account through the auth/impersonate_service_account setting. For more information about service accounts and how to use them in your application, see https://cloud.google.com/docs/authentication/. If you are getting this error with curl or similar tools, you may need to specify 'X-Goog-User-Project' HTTP header for quota and billing purposes. For more information regarding 'X-Goog-User-Project' header, please check \nhttps://cloud.google.com/apis/docs/system-parameters.\n\u2502 Details:\n\u2502 [\n\u2502   {\n\u2502     &quot;@type&quot;: &quot;type.googleapis.com/google.rpc.ErrorInfo&quot;,\n\u2502     &quot;domain&quot;: &quot;googleapis.com&quot;,\n\u2502     &quot;metadata&quot;: {\n\u2502       &quot;consumer&quot;: &quot;projects/764086051850&quot;,\n\u2502       &quot;service&quot;: &quot;cloudidentity.googleapis.com&quot;\n\u2502     },\n\u2502     &quot;reason&quot;: &quot;SERVICE_DISABLED&quot;\n\u2502   }\n\u2502 ]\n\u2502\n\u2502   with google_cloud_identity_group.group,\n\u2502   on groups.tf line 10, in resource &quot;google_cloud_identity_group&quot; &quot;group&quot;:\n\u2502   10: resource &quot;google_cloud_identity_group&quot; &quot;group&quot; {\n\u2502\n</code></pre>\n<p>As you can see, it is a 403 error, just like in the warning. I had also already tried enabling the api by following these instructions: <a href=\"https://cloud.google.com/identity/docs/how-to/setup\" rel=\"nofollow noreferrer\">https://cloud.google.com/identity/docs/how-to/setup</a>\nSo I'm fairly certain the enabling of the API is not the actual issue, I believe the issue is what the terraform documentation warned about.</p>\n<p>The warning says to specify <code>billing_project</code> and set <code>user_project_override</code> to true, but I don't know where to do that. As a guess I tried putting them as arguments to my terraform script but it didn't work (kind of expected because they weren't listed as arguments in the terraform documentation)</p>\n<pre><code>$ terraform apply\n\u2577\n\u2502 Error: Unsupported argument\n\u2502 \n\u2502   on groups.tf line 14, in resource &quot;google_cloud_identity_group&quot; &quot;group&quot;:\n\u2502   14:   billing_project = var.project_id\n\u2502 \n\u2502 An argument named &quot;billing_project&quot; is not expected here.\n\u2575\n\u2577\n\u2502 Error: Unsupported argument\n\u2502 \n\u2502   on groups.tf line 15, in resource &quot;google_cloud_identity_group&quot; &quot;group&quot;:\n\u2502   15:   user_project_override = true\n\u2502 \n\u2502 An argument named &quot;user_project_override&quot; is not expected here.\n</code></pre>\n<p>My code:</p>\n<pre><code>variable &quot;domain_name&quot;{\n    type = string\n    default = &quot;martiantower.com&quot;\n}\nvariable &quot;customer_id&quot;{\n    type = string\n    default = &quot;C00yc5oid&quot; # See: https://apps.google.com/supportwidget/articlehome?hl=en&amp;article_url=https%3A%2F%2Fsupport.google.com%2Fa%2Fanswer%2F10070793%3Fhl%3Den&amp;assistant_id=generic-unu&amp;product_context=10070793&amp;product_name=UnuFlow&amp;trigger_context=a\n}\n\nresource &quot;google_cloud_identity_group&quot; &quot;group&quot; {\n  display_name = &quot;my-identity-group&quot;\n\n  parent = &quot;customers/${var.customer_id}&quot;\n  # billing_project = var.project_id # Not an actual argument\n  # user_project_override = true # Not an actual argument\n\n  group_key {\n    id = &quot;my-identity-group@${var.domain_name}&quot;\n  }\n\n  labels = {\n    &quot;cloudidentity.googleapis.com/groups.discussion_forum&quot; = &quot;&quot;\n  }\n}\n</code></pre>\n<p>I assume I'm supposed to set the <code>billing_project</code> and <code>user_project_override</code> via the <code>gcloud</code> cli commands, but I don't know the commands for it.</p>\n<p>Any idea how to set the <code>billing_project</code> and <code>user_project_override</code>?</p>\n", "OwnerUserId": "20833958", "LastActivityDate": "2023-06-09T14:39:42.523", "Title": "How to add a `billing_project` to a group in GCP Terraform?", "Tags": "<google-cloud-platform><terraform><gcloud><terraform-provider-gcp>", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "290068067", "PostHistoryTypeId": "2", "PostId": "75796183", "RevisionGUID": "2bc4cccb-4abb-44b9-9e9e-001979d26ac5", "CreationDate": "2023-03-20T23:28:17.987", "UserId": "20833958", "Text": "I am unable to make user groups in GCP using terraform: https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/cloud_identity_group\r\n\r\nThere is a warning about using the application default credentials:\r\n\r\n> If you are using User ADCs (Application Default Credentials) with this resource, you must specify a billing_project and set user_project_override to true in the provider configuration. Otherwise the Cloud Identity API will return a 403 error. Your account must have the serviceusage.services.use permission on the billing_project you defined.\r\n\r\nI am using the Application Default Credentials.\r\n\r\nHere is the error I get when I try to terraform apply my code:\r\n\r\n```\r\nError: Error creating Group: googleapi: Error 403: Your application has authenticated using end user credentials from the Google Cloud SDK or Google Cloud Shell which are not supported by the cloudidentity.googleapis.com. We recommend configuring the billing/quota_project setting in gcloud or using a service account through the auth/impersonate_service_account setting. For more information about service accounts and how to use them in your application, see https://cloud.google.com/docs/authentication/. If you are getting this error with curl or similar tools, you may need to specify 'X-Goog-User-Project' HTTP header for quota and billing purposes. For more information regarding 'X-Goog-User-Project' header, please check \r\nhttps://cloud.google.com/apis/docs/system-parameters.\r\n\u2502 Details:\r\n\u2502 [\r\n\u2502   {\r\n\u2502     \"@type\": \"type.googleapis.com/google.rpc.ErrorInfo\",\r\n\u2502     \"domain\": \"googleapis.com\",\r\n\u2502     \"metadata\": {\r\n\u2502       \"consumer\": \"projects/764086051850\",\r\n\u2502       \"service\": \"cloudidentity.googleapis.com\"\r\n\u2502     },\r\n\u2502     \"reason\": \"SERVICE_DISABLED\"\r\n\u2502   }\r\n\u2502 ]\r\n\u2502\r\n\u2502   with google_cloud_identity_group.group,\r\n\u2502   on groups.tf line 10, in resource \"google_cloud_identity_group\" \"group\":\r\n\u2502   10: resource \"google_cloud_identity_group\" \"group\" {\r\n\u2502\r\n```\r\nAs you can see, it is a 403 error, just like in the warning. I had also already tried enabling the api by following these instructions: https://cloud.google.com/identity/docs/how-to/setup\r\nSo I'm fairly certain the enabling of the API is not the actual issue, I believe the issue is what the terraform documentation warned about.\r\n\r\nThe warning says to specify `billing_project` and set `user_project_override` to true, but I don't know where to do that. As a guess I tried putting them as arguments to my terraform script but it didn't work (kind of expected because they weren't listed as arguments in the terraform documentation)\r\n\r\n\r\n```\r\n$ terraform apply\r\n\u2577\r\n\u2502 Error: Unsupported argument\r\n\u2502 \r\n\u2502   on groups.tf line 14, in resource \"google_cloud_identity_group\" \"group\":\r\n\u2502   14:   billing_project = var.project_id\r\n\u2502 \r\n\u2502 An argument named \"billing_project\" is not expected here.\r\n\u2575\r\n\u2577\r\n\u2502 Error: Unsupported argument\r\n\u2502 \r\n\u2502   on groups.tf line 15, in resource \"google_cloud_identity_group\" \"group\":\r\n\u2502   15:   user_project_override = true\r\n\u2502 \r\n\u2502 An argument named \"user_project_override\" is not expected here.\r\n```\r\n\r\nMy code:\r\n\r\n```\r\nvariable \"domain_name\"{\r\n    type = string\r\n    default = \"martiantower.com\"\r\n}\r\nvariable \"customer_id\"{\r\n    type = string\r\n    default = \"C00yc5oid\" # See: https://apps.google.com/supportwidget/articlehome?hl=en&article_url=https%3A%2F%2Fsupport.google.com%2Fa%2Fanswer%2F10070793%3Fhl%3Den&assistant_id=generic-unu&product_context=10070793&product_name=UnuFlow&trigger_context=a\r\n}\r\n\r\nresource \"google_cloud_identity_group\" \"group\" {\r\n  display_name = \"my-identity-group\"\r\n\r\n  parent = \"customers/${var.customer_id}\"\r\n  # billing_project = var.project_id # Not an actual argument\r\n  # user_project_override = true # Not an actual argument\r\n\r\n  group_key {\r\n    id = \"my-identity-group@${var.domain_name}\"\r\n  }\r\n\r\n  labels = {\r\n    \"cloudidentity.googleapis.com/groups.discussion_forum\" = \"\"\r\n  }\r\n}\r\n```\r\n\r\nI assume I'm supposed to set the `billing_project` and `user_project_override` via the `gcloud` cli commands, but I don't know the commands for it.\r\n\r\nAny idea how to set the `billing_project` and `user_project_override`?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "There is a warning about using the application default credentials: > If you are using User ADCs (Application Default Credentials) with this resource, you must specify a billing_project and set user_project_override to true in the provider configuration. ", "keywords": ["bill", "provider"]}, {"source": "Text", "text": "Your account must have the serviceusage.services.use permission on the billing_project you defined. ", "keywords": ["bill"]}, {"source": "Text", "text": "We recommend configuring the billing/quota_project setting in gcloud or using a service account through the auth/impersonate_service_account setting. ", "keywords": ["bill"]}, {"source": "Text", "text": "If you are getting this error with curl or similar tools, you may need to specify 'X-Goog-User-Project' HTTP header for quota and billing purposes. ", "keywords": ["bill"]}, {"source": "Text", "text": "\u2502 Details: \u2502 [ \u2502 { \u2502 \"@type\": \"type.googleapis.com/google.rpc.ErrorInfo\", \u2502 \"domain\": \"googleapis.com\", \u2502 \"metadata\": { \u2502 \"consumer\": \"projects/764086051850\", \u2502 \"service\": \"cloudidentity.googleapis.com\" \u2502 }, \u2502 \"reason\": \"SERVICE_DISABLED\" \u2502 } \u2502 ] \u2502 \u2502 with google_cloud_identity_group.group, \u2502 on groups.tf line 10, in resource \"google_cloud_identity_group\" \"group\": \u2502 10: resource \"google_cloud_identity_group\" \"group\" { \u2502 ``` ", "keywords": ["domain"]}, {"source": "Text", "text": "The warning says to specify `billing_project` and set `user_project_override` to true, but I don't know where to do that. ", "keywords": ["bill"]}, {"source": "Text", "text": "As a guess I tried putting them as arguments to my terraform script but it didn't work (kind of expected because they weren't listed as arguments in the terraform documentation) ``` $ terraform apply \u2577 \u2502 Error: Unsupported argument \u2502 \u2502 on groups.tf line 14, in resource \"google_cloud_identity_group\" \"group\": \u2502 14: billing_project = var.project_id \u2502 \u2502 An argument named \"billing_project\" is not expected here. \u2575 \u2577 \u2502 Error: Unsupported argument \u2502 \u2502 on groups.tf line 15, in resource \"google_cloud_identity_group\" \"group\": \u2502 15: user_project_override = true \u2502 \u2502 An argument named \"user_project_override\" is not expected here. ", "keywords": ["bill"]}, {"source": "Text", "text": "``` My code: ``` variable \"domain_name\"{ type = string default = \"martiantower.com\" } variable \"customer_id\"{ type = string default = \"C00yc5oid\" # See: https://apps.google.com/supportwidget/articlehome?hl=en&article_url=https%3A%2F%2Fsupport.google.com%2Fa%2Fanswer%2F10070793%3Fhl%3Den&assistant_id=generic-unu&product_context=10070793&product_name=UnuFlow&trigger_context=a } resource \"google_cloud_identity_group\" \"group\" { display_name = \"my-identity-group\" parent = \"customers/${var.customer_id}\" # billing_project = var.project_id # Not an actual argument # user_project_override = true # Not an actual argument group_key { id = \"my-identity-group@${var.domain_name}\" } labels = { \"cloudidentity.googleapis.com/groups.discussion_forum\" = \"\" } } ``` I assume I'm supposed to set the `billing_project` and `user_project_override` via the `gcloud` cli commands, but I don't know the commands for it", "keywords": ["bill"]}, {"source": "Text", "text": "Any idea how to set the `billing_project` and `user_project_override`", "keywords": ["bill"]}]}, {"Id": "290068069", "PostHistoryTypeId": "1", "PostId": "75796183", "RevisionGUID": "2bc4cccb-4abb-44b9-9e9e-001979d26ac5", "CreationDate": "2023-03-20T23:28:17.987", "UserId": "20833958", "Text": "How to add a `billing_project` to a group in GCP Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "How to add a `billing_project` ", "keywords": ["bill"]}]}, {"Id": "290068070", "PostHistoryTypeId": "3", "PostId": "75796183", "RevisionGUID": "2bc4cccb-4abb-44b9-9e9e-001979d26ac5", "CreationDate": "2023-03-20T23:28:17.987", "UserId": "20833958", "Text": "<google-cloud-platform><terraform><gcloud><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "290068071", "PostHistoryTypeId": "66", "PostId": "75796183", "RevisionGUID": "2bc4cccb-4abb-44b9-9e9e-001979d26ac5", "CreationDate": "2023-03-20T23:28:17.987", "UserId": "20833958", "filtered-sentences": []}], "answers": [{"Id": "76441288", "PostTypeId": "2", "ParentId": "75796183", "CreationDate": "2023-06-09T14:39:42.523", "Score": "0", "Body": "<p>To add clarity to the accepted answer, include the following in the <code>provider</code> block:</p>\n<pre><code>provider &quot;google&quot; {\n  project               = var.project_id\n  billing_project       = var.project_id\n  user_project_override = true\n}\n</code></pre>\n", "OwnerUserId": "1154847", "LastActivityDate": "2023-06-09T14:39:42.523", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "293951062", "PostHistoryTypeId": "2", "PostId": "76441288", "RevisionGUID": "861b5294-ed26-46c7-a9f8-b67f8b2192f9", "CreationDate": "2023-06-09T14:39:42.523", "UserId": "1154847", "Text": "To add clarity to the accepted answer, include the following in the `provider` block:\r\n\r\n```HCL\r\nprovider \"google\" {\r\n  project               = var.project_id\r\n  billing_project       = var.project_id\r\n  user_project_override = true\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "To add clarity to the accepted answer, include the following in the `provider` ", "keywords": ["provider"]}, {"source": "Text", "text": "block: ```HCL provider \"google\" { project = var.project_id billing_project = var.project_id user_project_override = true } ```", "keywords": ["bill", "provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "To add clarity to the accepted answer, include the following in the provider block:", "keywords": ["provider"]}]}, {"Id": "75796192", "PostTypeId": "2", "ParentId": "75796183", "CreationDate": "2023-03-20T23:31:20.653", "Score": "1", "Body": "<p>You have to set those values in <a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference\" rel=\"nofollow noreferrer\">Google Provider Configuration</a>, not in <code>google_cloud_identity_group</code>.</p>\n", "OwnerUserId": "248823", "LastActivityDate": "2023-03-20T23:31:20.653", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "290068123", "PostHistoryTypeId": "2", "PostId": "75796192", "RevisionGUID": "89dc40e2-0f7c-4e33-bb38-90273cb30a83", "CreationDate": "2023-03-20T23:31:20.653", "UserId": "248823", "Text": "You have to set those values in [Google Provider Configuration](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference), not in `google_cloud_identity_group`.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You have to set those values in [Google Provider Configuration](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference), not in `google_cloud_identity_group`.", "keywords": ["provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "You have to set those values in Google Provider Configuration, not in google_cloud_identity_group.", "keywords": ["provider"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "How to add a `billing_project` ", "keywords": ["bill"]}, {"source": "Body", "text": "If you are using User ADCs (Application Default Credentials) with this resource, you must specify a billing_project and set user_project_override to true in the provider configuration. ", "keywords": ["bill", "provider"]}, {"source": "Body", "text": "Your account must have the serviceusage.services.use permission on the billing_project you defined. ", "keywords": ["bill"]}, {"source": "Body", "text": "The warning says to specify billing_project and set user_project_override to true, but I don't know where to do that. ", "keywords": ["bill"]}, {"source": "Body", "text": "My code: I assume I'm supposed to set the billing_project and user_project_override via the gcloud cli commands, but I don't know the commands for it. ", "keywords": ["bill"]}, {"source": "Body", "text": "Any idea how to set the billing_project and user_project_override?", "keywords": ["bill"]}]}