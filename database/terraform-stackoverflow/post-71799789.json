{"Id": "71799789", "PostTypeId": "1", "CreationDate": "2022-04-08T15:39:58.157", "Score": "-3", "ViewCount": "2052", "Body": "<p>I have created a VPC in AWS manually and I would like to create in this existing VPC an EKS via terraform.</p>\n<p>I provide you part of the vpc.tf file:</p>\n<pre><code>module &quot;vpc&quot; {\n  source  = &quot;terraform-aws-modules/vpc/aws&quot;\n  version = &quot;3.2.0&quot;\n\n  cidr                 = &quot;10.11.0.0/16&quot;\n  azs                  = data.aws_availability_zones.available.names\n  private_subnets      = [&quot;10.11.1.0/24&quot;, &quot;10.11.2.0/24&quot;, &quot;10.11.3.0/24&quot;]\n  public_subnets       = [&quot;10.11.4.0/24&quot;, &quot;10.11.5.0/24&quot;, &quot;10.11.6.0/24&quot;]\n  enable_nat_gateway   = true\n  single_nat_gateway   = true\n  enable_dns_hostnames = true\n\n  tags = {\n    &quot;Name&quot; = &quot;10.11.0.0/16 - &lt; name of existing VPC &gt;&quot;  --&gt; **if i provide here this tag EKS will be created under the existing VPC ?**\n    &quot;kubernetes.io/cluster/${local.cluster_name}&quot; = &quot;shared&quot;\n  }\n\n  public_subnet_tags = {\n    &quot;kubernetes.io/cluster/${local.cluster_name}&quot; = &quot;shared&quot;\n    &quot;kubernetes.io/role/elb&quot;                      = &quot;1&quot;\n  }\n\n  private_subnet_tags = {\n    &quot;kubernetes.io/cluster/${local.cluster_name}&quot; = &quot;shared&quot;\n    &quot;kubernetes.io/role/internal-elb&quot;             = &quot;1&quot;\n  }\n}\n</code></pre>\n<p>tags = {\n&quot;Name&quot; = &quot;10.11.0.0/16 - &lt; name of existing VPC &gt;&quot;  --&gt; <strong>if i provide here this tag EKS will be created under the existing VPC ?</strong></p>\n<p>is this tag will make the job ?</p>\n", "OwnerUserId": "10167748", "LastEditorUserId": "10167748", "LastEditDate": "2022-04-09T17:34:45.217", "LastActivityDate": "2022-09-19T17:07:20.213", "Title": "Creation of AWS-EKS with Terraform in an existing VPC", "Tags": "<kubernetes><terraform><terraform-provider-aws><amazon-eks>", "AnswerCount": "2", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "126882846", "PostId": "71799789", "Score": "2", "Text": "What problem are you asking about? What have you tried?", "CreationDate": "2022-04-08T16:12:10.680", "UserId": "213269", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "126899981", "PostId": "71799789", "Score": "0", "Text": "@Jonas i would like to create an EKS in a VPC that i have created manually.\n\ntags = {\n    \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\"  --> **if i provide here this tag EKS will be created under the existing VPC ?*\n\nWould this tag will create the EKS in the VPC that i have created manually ?", "CreationDate": "2022-04-09T17:30:45.597", "UserId": "10167748", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "267771373", "PostHistoryTypeId": "2", "PostId": "71799789", "RevisionGUID": "16454cbc-0626-46ea-bf19-936629fef2f8", "CreationDate": "2022-04-08T15:39:58.157", "UserId": "10167748", "Text": "I have created a VPC in AWS manually and i would like to create in this existing VPC an EKS via terraform.\r\n\r\nI provide you part of the vpc.tf file:\r\n\r\n    module \"vpc\" {\r\n      source  = \"terraform-aws-modules/vpc/aws\"\r\n      version = \"3.2.0\"\r\n    \r\n      cidr                 = \"10.11.0.0/16\"\r\n      azs                  = data.aws_availability_zones.available.names\r\n      private_subnets      = [\"10.11.1.0/24\", \"10.11.2.0/24\", \"10.11.3.0/24\"]\r\n      public_subnets       = [\"10.11.4.0/24\", \"10.11.5.0/24\", \"10.11.6.0/24\"]\r\n      enable_nat_gateway   = true\r\n      single_nat_gateway   = true\r\n      enable_dns_hostnames = true\r\n    \r\n      tags = {\r\n        \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\"  --> **if i provide here this tag EKS will be created under the existing VPC ?**\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n      }\r\n    \r\n      public_subnet_tags = {\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n        \"kubernetes.io/role/elb\"                      = \"1\"\r\n      }\r\n    \r\n      private_subnet_tags = {\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n        \"kubernetes.io/role/internal-elb\"             = \"1\"\r\n      }\r\n    }", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I provide you part of the vpc.tf file: module \"vpc\" { source = \"terraform-aws-modules/vpc/aws\" version = \"3.2.0\" cidr = \"10.11.0.0/16\" azs = data.aws_availability_zones.available.names private_subnets = [\"10.11.1.0/24\", \"10.11.2.0/24\", \"10.11.3.0/24\"] public_subnets = [\"10.11.4.0/24\", \"10.11.5.0/24\", \"10.11.6.0/24\"] enable_nat_gateway = true single_nat_gateway = true enable_dns_hostnames = true tags = { \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\" --> **if i provide here this tag EKS will be created under the existing VPC ?** \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" } public_subnet_tags = { \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" \"kubernetes.io/role/elb\" = \"1\" ", "keywords": ["cluster"]}, {"source": "Text", "text": "} private_subnet_tags = { \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" \"kubernetes.io/role/internal-elb\" = \"1\" ", "keywords": ["cluster"]}]}, {"Id": "267771375", "PostHistoryTypeId": "1", "PostId": "71799789", "RevisionGUID": "16454cbc-0626-46ea-bf19-936629fef2f8", "CreationDate": "2022-04-08T15:39:58.157", "UserId": "10167748", "Text": "Creation of AWS-EKS with terraform in an existed VPC", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267771376", "PostHistoryTypeId": "3", "PostId": "71799789", "RevisionGUID": "16454cbc-0626-46ea-bf19-936629fef2f8", "CreationDate": "2022-04-08T15:39:58.157", "UserId": "10167748", "Text": "<kubernetes><terraform><terraform-provider-aws><amazon-eks>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267806651", "PostHistoryTypeId": "5", "PostId": "71799789", "RevisionGUID": "f616c77c-bcf8-4c9a-99fa-9e746a6d8f5e", "CreationDate": "2022-04-09T01:29:53.193", "UserId": "16922044", "Comment": "Grammar and Spelling corrections.", "Text": "I have created a VPC in AWS manually and I would like to create in this existing VPC an EKS via terraform.\r\n\r\nI provide you part of the vpc.tf file:\r\n\r\n    module \"vpc\" {\r\n      source  = \"terraform-aws-modules/vpc/aws\"\r\n      version = \"3.2.0\"\r\n    \r\n      cidr                 = \"10.11.0.0/16\"\r\n      azs                  = data.aws_availability_zones.available.names\r\n      private_subnets      = [\"10.11.1.0/24\", \"10.11.2.0/24\", \"10.11.3.0/24\"]\r\n      public_subnets       = [\"10.11.4.0/24\", \"10.11.5.0/24\", \"10.11.6.0/24\"]\r\n      enable_nat_gateway   = true\r\n      single_nat_gateway   = true\r\n      enable_dns_hostnames = true\r\n    \r\n      tags = {\r\n        \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\"  --> **if i provide here this tag EKS will be created under the existing VPC ?**\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n      }\r\n    \r\n      public_subnet_tags = {\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n        \"kubernetes.io/role/elb\"                      = \"1\"\r\n      }\r\n    \r\n      private_subnet_tags = {\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n        \"kubernetes.io/role/internal-elb\"             = \"1\"\r\n      }\r\n    }", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I provide you part of the vpc.tf file: module \"vpc\" { source = \"terraform-aws-modules/vpc/aws\" version = \"3.2.0\" cidr = \"10.11.0.0/16\" azs = data.aws_availability_zones.available.names private_subnets = [\"10.11.1.0/24\", \"10.11.2.0/24\", \"10.11.3.0/24\"] public_subnets = [\"10.11.4.0/24\", \"10.11.5.0/24\", \"10.11.6.0/24\"] enable_nat_gateway = true single_nat_gateway = true enable_dns_hostnames = true tags = { \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\" --> **if i provide here this tag EKS will be created under the existing VPC ?** \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" } public_subnet_tags = { \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" \"kubernetes.io/role/elb\" = \"1\" ", "keywords": ["cluster"]}, {"source": "Text", "text": "} private_subnet_tags = { \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" \"kubernetes.io/role/internal-elb\" = \"1\" ", "keywords": ["cluster"]}]}, {"Id": "267806652", "PostHistoryTypeId": "4", "PostId": "71799789", "RevisionGUID": "f616c77c-bcf8-4c9a-99fa-9e746a6d8f5e", "CreationDate": "2022-04-09T01:29:53.193", "UserId": "16922044", "Comment": "Grammar and Spelling corrections.", "Text": "Creation of AWS-EKS with Terraform in an existing VPC", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267806653", "PostHistoryTypeId": "24", "PostId": "71799789", "RevisionGUID": "f616c77c-bcf8-4c9a-99fa-9e746a6d8f5e", "CreationDate": "2022-04-09T01:29:53.193", "Comment": "Proposed by 16922044 approved by 208273 edit id of 5351472", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267837951", "PostHistoryTypeId": "5", "PostId": "71799789", "RevisionGUID": "3c4339ff-d9d5-45bd-b442-6e0543eeb4fd", "CreationDate": "2022-04-09T17:34:45.217", "UserId": "10167748", "Comment": "added 195 characters in body", "Text": "I have created a VPC in AWS manually and I would like to create in this existing VPC an EKS via terraform.\r\n\r\nI provide you part of the vpc.tf file:\r\n\r\n    module \"vpc\" {\r\n      source  = \"terraform-aws-modules/vpc/aws\"\r\n      version = \"3.2.0\"\r\n    \r\n      cidr                 = \"10.11.0.0/16\"\r\n      azs                  = data.aws_availability_zones.available.names\r\n      private_subnets      = [\"10.11.1.0/24\", \"10.11.2.0/24\", \"10.11.3.0/24\"]\r\n      public_subnets       = [\"10.11.4.0/24\", \"10.11.5.0/24\", \"10.11.6.0/24\"]\r\n      enable_nat_gateway   = true\r\n      single_nat_gateway   = true\r\n      enable_dns_hostnames = true\r\n    \r\n      tags = {\r\n        \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\"  --> **if i provide here this tag EKS will be created under the existing VPC ?**\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n      }\r\n    \r\n      public_subnet_tags = {\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n        \"kubernetes.io/role/elb\"                      = \"1\"\r\n      }\r\n    \r\n      private_subnet_tags = {\r\n        \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\"\r\n        \"kubernetes.io/role/internal-elb\"             = \"1\"\r\n      }\r\n    }\r\n\r\ntags = {\r\n        \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\"  --> **if i provide here this tag EKS will be created under the existing VPC ?** \r\n\r\nis this tag will make the job ?\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I provide you part of the vpc.tf file: module \"vpc\" { source = \"terraform-aws-modules/vpc/aws\" version = \"3.2.0\" cidr = \"10.11.0.0/16\" azs = data.aws_availability_zones.available.names private_subnets = [\"10.11.1.0/24\", \"10.11.2.0/24\", \"10.11.3.0/24\"] public_subnets = [\"10.11.4.0/24\", \"10.11.5.0/24\", \"10.11.6.0/24\"] enable_nat_gateway = true single_nat_gateway = true enable_dns_hostnames = true tags = { \"Name\" = \"10.11.0.0/16 - < name of existing VPC >\" --> **if i provide here this tag EKS will be created under the existing VPC ?** \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" } public_subnet_tags = { \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" \"kubernetes.io/role/elb\" = \"1\" } private_subnet_tags = { \"kubernetes.io/cluster/${local.cluster_name}\" = \"shared\" \"kubernetes.io/role/internal-elb\" = \"1\" ", "keywords": ["cluster"]}]}], "answers": [{"Id": "71810455", "PostTypeId": "2", "ParentId": "71799789", "CreationDate": "2022-04-09T17:41:42.927", "Score": "0", "Body": "<p>I don't understand the relevance of the tags here. You have created a vpc. Now when you create the <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster\" rel=\"nofollow noreferrer\">EKS Cluster</a>, just reference these values for the <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config\" rel=\"nofollow noreferrer\">vpc_config</a>.</p>\n<pre><code>resource &quot;aws_eks_cluster&quot; &quot;example&quot; {\n  name     = &quot;example&quot;\n\n  vpc_config {\n    subnet_ids = module.vpc.private_subnets\n  }\n}\n</code></pre>\n<hr />\n<p>Here is a good guide, <a href=\"https://learn.hashicorp.com/tutorials/terraform/eks\" rel=\"nofollow noreferrer\">How to Provision and EKS Cluster</a>, that shows great examples of the <a href=\"https://github.com/hashicorp/learn-terraform-provision-eks-cluster/blob/main/vpc.tf\" rel=\"nofollow noreferrer\">vpc configuration</a> and the <a href=\"https://github.com/hashicorp/learn-terraform-provision-eks-cluster/blob/main/eks-cluster.tf\" rel=\"nofollow noreferrer\">eks configuration</a> using the provided module.</p>\n", "OwnerUserId": "2081835", "LastEditorUserId": "2081835", "LastEditDate": "2022-04-09T17:47:39.783", "LastActivityDate": "2022-04-09T17:47:39.783", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "267838199", "PostHistoryTypeId": "2", "PostId": "71810455", "RevisionGUID": "c897445a-96ee-496e-96ba-628e79e757fb", "CreationDate": "2022-04-09T17:41:42.927", "UserId": "2081835", "Text": "I don't understand the relevance of the tags here. You have created a vpc. Now when you create the [EKS Cluster][1], just reference these values for the [vpc_config][2].\r\n\r\n``` hcl\r\nresource \"aws_eks_cluster\" \"example\" {\r\n  name     = \"example\"\r\n\r\n  vpc_config {\r\n    subnet_ids = module.vpc.private_subnets\r\n  }\r\n}\r\n```\r\n\r\n[1]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster\r\n[2]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Now when you create the [EKS Cluster][1], just reference these values for the [vpc_config][2]. ", "keywords": ["cluster"]}]}, {"Id": "267838440", "PostHistoryTypeId": "5", "PostId": "71810455", "RevisionGUID": "431dc672-283e-4ee6-b13a-39a6de4332f0", "CreationDate": "2022-04-09T17:47:39.783", "UserId": "2081835", "Comment": "Add information about the learning guide.", "Text": "I don't understand the relevance of the tags here. You have created a vpc. Now when you create the [EKS Cluster][1], just reference these values for the [vpc_config][2].\r\n\r\n``` hcl\r\nresource \"aws_eks_cluster\" \"example\" {\r\n  name     = \"example\"\r\n\r\n  vpc_config {\r\n    subnet_ids = module.vpc.private_subnets\r\n  }\r\n}\r\n```\r\n\r\n---\r\n\r\nHere is a good guide, [How to Provision and EKS Cluster][3], that shows great examples of the [vpc configuration][4] and the [eks configuration][5] using the provided module.\r\n\r\n[1]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster\r\n[2]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config\r\n[3]: https://learn.hashicorp.com/tutorials/terraform/eks\r\n[4]: https://github.com/hashicorp/learn-terraform-provision-eks-cluster/blob/main/vpc.tf\r\n[5]: https://github.com/hashicorp/learn-terraform-provision-eks-cluster/blob/main/eks-cluster.tf", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Now when you create the [EKS Cluster][1], just reference these values for the [vpc_config][2]. ``` hcl resource \"aws_eks_cluster\" \"example\" { name = \"example\" vpc_config { subnet_ids = module.vpc.private_subnets } } ``` --- Here is a good guide, [How to Provision and EKS Cluster][3], that shows great examples of the [vpc configuration][4] and the [eks configuration][5] using the provided module. [1]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster [2]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config [3]: https://learn.hashicorp.com/tutorials/terraform/eks [4]: https://github.com/hashicorp/learn-terraform-provision-eks-cluster/blob/main/vpc.tf [5]: https://github.com/hashicorp/learn-terraform-provision-eks-cluster/blob/main/eks-cluster.tf", "keywords": ["cluster"]}]}], "filtered-sentences": [{"source": "Body", "text": "Now when you create the EKS Cluster, just reference these values for the vpc_config. ", "keywords": ["cluster"]}, {"source": "Body", "text": "Here is a good guide, How to Provision and EKS Cluster, that shows great examples of the vpc configuration and the eks configuration using the provided module.", "keywords": ["cluster"]}]}, {"Id": "73776961", "PostTypeId": "2", "ParentId": "71799789", "CreationDate": "2022-09-19T17:07:20.213", "Score": "0", "Body": "<p>I suspect you are afraid of screwing up something in an existing VPC. I would suggest that you try this in a separate account by simply create a VPC manually and then play around with your eks terraform. If you destroy the cluster and corresponding resources immediately after the provisioning, your cost should be minimal or none for testing out.</p>\n<p>I don't think the tags you provided will put your cluster in an existing VPC. You need to configure more than that. You could potentially end up with an additional VPC.</p>\n", "OwnerUserId": "15876302", "LastActivityDate": "2022-09-19T17:07:20.213", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "278532238", "PostHistoryTypeId": "2", "PostId": "73776961", "RevisionGUID": "4f873cb9-2cbe-41e8-9b93-bc2675497516", "CreationDate": "2022-09-19T17:07:20.213", "UserId": "15876302", "Text": "I suspect you are afraid of screwing up something in an existing VPC. I would suggest that you try this in a separate account by simply create a VPC manually and then play around with your eks terraform. If you destroy the cluster and corresponding resources immediately after the provisioning, your cost should be minimal or none for testing out.\r\n\r\nI don't think the tags you provided will put your cluster in an existing VPC. You need to configure more than that. You could potentially end up with an additional VPC.  ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If you destroy the cluster and corresponding resources immediately after the provisioning, your cost should be minimal or none for testing out. ", "keywords": ["cost", "cluster", "test"]}, {"source": "Text", "text": "I don't think the tags you provided will put your cluster in an existing VPC. ", "keywords": ["cluster"]}]}], "filtered-sentences": [{"source": "Body", "text": "If you destroy the cluster and corresponding resources immediately after the provisioning, your cost should be minimal or none for testing out. ", "keywords": ["cost", "cluster", "test"]}, {"source": "Body", "text": "I don't think the tags you provided will put your cluster in an existing VPC. ", "keywords": ["cluster"]}]}], "contains-topic": true, "filtered-sentences": []}