{"Id": "56530721", "PostTypeId": "1", "AcceptedAnswerId": "58596954", "CreationDate": "2019-06-10T17:13:13.573", "Score": "0", "ViewCount": "718", "Body": "<ul>\n<li>Load balancers cost an hourly rate</li>\n<li>(Re)creating EB costs uploads to S3 and takes a long time</li>\n</ul>\n\n<p>So for EB that is sitting idle (used only during development), just as EC2 can be scaled down to 0 instances, how can the load balancer be toggled off (and later toggled back on)? Could Terraform be employed, such that the absence of the ALB is detected and gets recreated with an apply?</p>\n\n<p>I already terminate EC2 instances under EB when idle, but all the while my unused load balancer is charging me! Ideally I'd have a zero cost during idle time, by also deleting the load balancer. But when I go to recreate the ALB when needed, Terraform state isn't explicitly tracking the ALB (it's managed by EB environment), so it doesn't get recreated.</p>\n\n<p>I know <a href=\"https://stackoverflow.com/questions/8014046/elastic-beanstalk-without-elastic-load-balancer\">Elastic Beanstalk environments can be created without load balancers</a>. I'm hoping the \"scalability\" of AWS provides a cleaner and faster approach to just toggling the existence of the load balancer <strong>besides recreating the whole EB environment</strong>.</p>\n", "OwnerUserId": "1080804", "LastActivityDate": "2020-04-02T19:12:07.150", "Title": "Toggle Elastic Beanstalk load balancer off/on with Terraform?", "Tags": "<terraform><amazon-elastic-beanstalk><amazon-elb>", "AnswerCount": "1", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "99646616", "PostId": "56530721", "Score": "0", "Text": "That is not possible simple because AWS doesn't provide that feature.", "CreationDate": "2019-06-10T18:27:22.517", "UserId": "2904202", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "That is not possible simple because AWS doesn't provide that feature.", "keywords": ["feature"]}]}, {"Id": "99653991", "PostId": "56530721", "Score": "0", "Text": "If you need zero cost during idle time, should you go with serverless with new design? Think about it, more than struggle with current situation.", "CreationDate": "2019-06-11T02:24:23.563", "UserId": "498256", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If you need zero cost during idle time, should you go with serverless with new design? ", "keywords": ["cost"]}]}, {"Id": "100909704", "PostId": "56530721", "Score": "1", "Text": "@BMW in 10 years or less I bet your suggestion will be the general solution, but as of 2019 serverless designs (e.g. using Lambda, API Gateway, or AppSync) still can have latency issues, typically exceeding 1 second (in addition to the \"cold start\" issue).", "CreationDate": "2019-07-25T11:32:59.757", "UserId": "1080804", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "100929134", "PostId": "56530721", "Score": "0", "Text": "Good point!. Serverless can't cover many cases which is sensitive about the latency.   If this is the main reason you choice Elastic beanstalk, then seems it has no other choice to avoid using ALB/ELB", "CreationDate": "2019-07-26T00:13:34.560", "UserId": "498256", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "links": [{"Id": "1684404001", "CreationDate": "2019-06-10T17:13:13.573", "PostId": "56530721", "RelatedPostId": "8014046", "LinkTypeId": "1"}], "history": [{"Id": "199398882", "PostHistoryTypeId": "2", "PostId": "56530721", "RevisionGUID": "290b5fb5-2191-4a0c-bb41-fff775b32db7", "CreationDate": "2019-06-10T17:13:13.573", "UserId": "1080804", "Text": " - Load balancers cost an hourly rate\r\n - (Re)creating EB costs uploads to S3 and takes a long time\r\n\r\n\r\nSo for EB that is sitting idle (used only during development), just as EC2 can be scaled down to 0 instances, how can the load balancer be toggled off (and later toggled back on)? Could Terraform be employed, such that the absence of the ALB is detected and gets recreated with an apply?\r\n\r\n\r\nI already terminate EC2 instances under EB when idle, but all the while my unused load balancer is charging me! Ideally I'd have a zero cost during idle time, by also deleting the load balancer. But when I go to recreate the ALB when needed, Terraform state isn't explicitly tracking the ALB (it's managed by EB environment), so it doesn't get recreated.\r\n\r\n\r\nI know [Elastic Beanstalk environments can be created without load balancers][1]. I'm hoping the \"scalability\" of AWS provides a cleaner and faster approach to just toggling the existence of the load balancer **besides recreating the whole EB environment**.\r\n\r\n\r\n  [1]: https://stackoverflow.com/questions/8014046/elastic-beanstalk-without-elastic-load-balancer", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "- Load balancers cost an hourly rate - (Re)creating EB costs uploads to S3 and takes a long time ", "keywords": ["cost"]}, {"source": "Text", "text": "Ideally I'd have a zero cost during idle time, by also deleting the load balancer. ", "keywords": ["cost"]}]}, {"Id": "199398883", "PostHistoryTypeId": "1", "PostId": "56530721", "RevisionGUID": "290b5fb5-2191-4a0c-bb41-fff775b32db7", "CreationDate": "2019-06-10T17:13:13.573", "UserId": "1080804", "Text": "Toggle Elastic Beanstalk load balancer off/on with Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "199398884", "PostHistoryTypeId": "3", "PostId": "56530721", "RevisionGUID": "290b5fb5-2191-4a0c-bb41-fff775b32db7", "CreationDate": "2019-06-10T17:13:13.573", "UserId": "1080804", "Text": "<terraform><amazon-elastic-beanstalk><amazon-elb>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "58596954", "PostTypeId": "2", "ParentId": "56530721", "CreationDate": "2019-10-28T19:05:29.500", "Score": "1", "Body": "<p>You can temporarily disable all Elastic Beanstalk infrastructure that costs money, allowing you to suspend the application for free until you're ready to turn it back on, without the expense of destroying and recreating it from scratch.</p>\n\n<p>Via the EB Environment Configuration:</p>\n\n<ol>\n<li>(temporarily) demote <code>Capacity</code> \n\n<ul>\n<li>from: <code>Environment type: load balancing, auto scaling</code> </li>\n<li>to: <code>Single-Instance Environment</code></li>\n</ul></li>\n<li>Delete the single instance and static ip it generates</li>\n<li>Just to be safe, ensure your autoscaling group config allows a maximum of <code>0</code> instances</li>\n</ol>\n\n<p>Leave running for months this way, without paying a dime...</p>\n\n<p>Then, You can turn everything back on the way it was quickly:</p>\n\n<ol>\n<li>Switch Load balancing back on and ensure autoscaling group has non-zero instance count.</li>\n<li><code>terraform refresh</code> to import the new instance ids of your autoscaling targets</li>\n<li>resume using terraform as usual (e.g. <code>plan</code>, <code>apply</code>)</li>\n</ol>\n", "OwnerUserId": "1080804", "LastEditorUserId": "1080804", "LastEditDate": "2020-04-02T19:12:07.150", "LastActivityDate": "2020-04-02T19:12:07.150", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "208116367", "PostHistoryTypeId": "2", "PostId": "58596954", "RevisionGUID": "3880ca73-ed29-4e06-8c03-f16ca14ea496", "CreationDate": "2019-10-28T19:05:29.500", "UserId": "1080804", "Text": "One approach to suspending Elastic Beanstalk costs without the time-consuming create/destroy process is to, via EB Environment Configuration:\r\n\r\n 1. (temporarily) demote `Capacity` from \"Environment type: load balancing, auto scaling\" to: \"Single-Instance Environment\"\r\n 1. Delete the single instance and static ip it generates (Now no instances will be attached to load balancers)\r\n\r\nThis process is reversible by re-applying the original configuration, which could be coordinated automatically by a service such as Terraform.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "(temporarily) demote `Capacity` from \"Environment type: load balancing, auto scaling\" to: \"Single-Instance Environment\" ", "keywords": ["instance"]}, {"source": "Text", "text": "Delete the single instance and static ip it generates (Now no instances will be attached to load balancers) ", "keywords": ["instance"]}]}, {"Id": "208116577", "PostHistoryTypeId": "12", "PostId": "58596954", "RevisionGUID": "b9093cee-df88-4939-9baf-43fefe1352c9", "CreationDate": "2019-10-28T19:09:51.230", "UserId": "1080804", "Comment": "via Vote", "Text": "{\"Voters\":[{\"Id\":1080804,\"DisplayName\":\"ecoe\"}]}", "filtered-sentences": []}, {"Id": "218289352", "PostHistoryTypeId": "5", "PostId": "58596954", "RevisionGUID": "e670e8e6-859c-4acc-9fd1-da3c85a86274", "CreationDate": "2020-04-02T19:12:07.150", "UserId": "1080804", "Comment": "added 401 characters in body", "Text": "You can temporarily disable all Elastic Beanstalk infrastructure that costs money, allowing you to suspend the application for free until you're ready to turn it back on, without the expense of destroying and recreating it from scratch.\r\n\r\nVia the EB Environment Configuration:\r\n\r\n 1. (temporarily) demote `Capacity` \r\n    * from: `Environment type: load balancing, auto scaling` \r\n    * to: `Single-Instance Environment`\r\n 1. Delete the single instance and static ip it generates\r\n 1. Just to be safe, ensure your autoscaling group config allows a maximum of `0` instances\r\n\r\nLeave running for months this way, without paying a dime...\r\n\r\nThen, You can turn everything back on the way it was quickly:\r\n\r\n 1.  Switch Load balancing back on and ensure autoscaling group has non-zero instance count.\r\n 1.  `terraform refresh` to import the new instance ids of your autoscaling targets\r\n 1.  resume using terraform as usual (e.g. `plan`, `apply`)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can temporarily disable all Elastic Beanstalk infrastructure that costs money, allowing you to suspend the application for free until you're ready to turn it back on, without the expense of destroying and recreating it from scratch. ", "keywords": ["expense"]}, {"source": "Text", "text": "(temporarily) demote `Capacity` * from: `Environment type: load balancing, auto scaling` * to: `Single-Instance Environment` ", "keywords": ["instance"]}, {"source": "Text", "text": "Delete the single instance and static ip it generates ", "keywords": ["instance"]}, {"source": "Text", "text": "Then, You can turn everything back on the way it was quickly: 1. Switch Load balancing back on and ensure autoscaling group has non-zero instance count. ", "keywords": ["instance"]}, {"source": "Text", "text": "1. `terraform refresh` to import the new instance ids of your autoscaling targets ", "keywords": ["instance"]}]}, {"Id": "218289361", "PostHistoryTypeId": "13", "PostId": "58596954", "RevisionGUID": "29c90e00-021a-4b5d-91d6-e7403c0dff40", "CreationDate": "2020-04-02T19:12:12.553", "UserId": "1080804", "Text": "{\"Voters\":[{\"Id\":1080804,\"DisplayName\":\"ecoe\"}]}", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "You can temporarily disable all Elastic Beanstalk infrastructure that costs money, allowing you to suspend the application for free until you're ready to turn it back on, without the expense of destroying and recreating it from scratch. ", "keywords": ["expense"]}, {"source": "Body", "text": "Via the EB Environment Configuration: (temporarily) demote Capacity from: Environment type: load balancing, auto scaling to: Single-Instance Environment Delete the single instance and static ip it generates ", "keywords": ["instance"]}, {"source": "Body", "text": "Then, You can turn everything back on the way it was quickly: Switch Load balancing back on and ensure autoscaling group has non-zero instance count. ", "keywords": ["instance"]}, {"source": "Body", "text": "terraform refresh to import the new instance ids of your autoscaling targets resume using terraform as usual (e.g. plan, apply)", "keywords": ["instance"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "Load balancers cost an hourly rate (Re)creating EB costs uploads to S3 and takes a long time ", "keywords": ["cost"]}, {"source": "Body", "text": "Ideally I'd have a zero cost during idle time, by also deleting the load balancer. ", "keywords": ["cost"]}]}