{"Id": "76339774", "PostTypeId": "1", "AcceptedAnswerId": "76340435", "CreationDate": "2023-05-26T10:05:52.090", "Score": "0", "ViewCount": "371", "Body": "<p>I've created a terraform script with an azurerm_linux_function_app with vnet integration (using azurerm_app_service_virtual_network_swift_connection). If I run the Terraform script everything works as expected, but if I run Terraform again it proposes to update the function app in-place by removing the virtual_network_subnet_id, which then breaks the vnet integration. If I run terraform again it proposes to create azurerm_app_service_virtual_network_swift_connection again and everything works and this loop continues.</p>\n<pre><code>resource &quot;azurerm_subnet&quot; &quot;this&quot; {\n  name                 = &quot;name&quot;\n  resource_group_name  = azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = [&quot;10.0.5.128/26&quot;]\n  service_endpoints    = [&quot;Microsoft.AzureCosmosDB&quot;]\n  delegation {\n    name = &quot;name-delegation&quot;\n\n    service_delegation {\n      name    = &quot;Microsoft.Web/serverFarms&quot;\n      actions = [&quot;Microsoft.Network/virtualNetworks/subnets/action&quot;]\n    }\n  }\n}\n\nresource &quot;azurerm_linux_function_app&quot; &quot;this&quot; {\n  name                       = &quot;name&quot;\n  resource_group_name        = azurerm_resource_group.rg.name\n  location                   = azurerm_resource_group.rg.location\n  storage_account_name       = azurerm_storage_account.this.name\n  storage_account_access_key = azurerm_storage_account.this.primary_access_key\n  service_plan_id            = azurerm_service_plan.this.id\n  https_only                 = true\n  site_config {\n    vnet_route_all_enabled = true\n    cors {\n      allowed_origins = [&quot;https://portal.azure.com&quot;]\n    }\n    application_stack {\n      node_version = &quot;18&quot;\n    }\n  }\n  app_settings = {\n  }\n  depends_on = [azurerm_cosmosdb_account.db]\n}\n\nresource &quot;azurerm_app_service_virtual_network_swift_connection&quot; &quot;this&quot; {\n  app_service_id = azurerm_linux_function_app.this.id\n  subnet_id      = azurerm_subnet.this.id\n}\n</code></pre>\n", "OwnerUserId": "18937923", "LastEditorUserId": "18937923", "LastEditDate": "2023-05-26T10:33:24.657", "LastActivityDate": "2023-05-26T12:00:53.790", "Title": "Terraform keeps removing virtual_network_subnet_id and in a subsequent run re-adding the vnet integration for an azurerm_linux_function_app", "Tags": "<terraform><azure-functions><terraform-provider-azure><subnet><vnet>", "AnswerCount": "1", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "134617461", "PostId": "76339774", "Score": "0", "Text": "The `plan` outputs' snippets would be relevant here too.", "CreationDate": "2023-05-26T10:55:00.497", "UserId": "5343387", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "134617664", "PostId": "76339774", "Score": "0", "Text": "Problem was solved by adding virtual_network_subnet_id  = azurerm_subnet.this.id to the linux function app directly and by removing the swift connection", "CreationDate": "2023-05-26T11:13:58.820", "UserId": "18937923", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "links": [{"Id": "2047876945", "CreationDate": "2023-05-26T11:36:50.027", "PostId": "76339774", "RelatedPostId": "73856640", "LinkTypeId": "1"}], "history": [{"Id": "293336769", "PostHistoryTypeId": "2", "PostId": "76339774", "RevisionGUID": "204a0398-3fda-4215-8143-1c5ba80d84e6", "CreationDate": "2023-05-26T10:05:52.090", "UserId": "18937923", "Text": "I've created a terraform script with an azurerm_linux_function_app with vnet integration (using azurerm_app_service_virtual_network_swift_connection). If I run the Terraform script everything works as expected, but if I run Terraform again it propose to update the function app in-place by removing the virtual_network_subnet_id that breaks the vnet integration. If I run terraform again it proposes to create azurerm_app_service_virtual_network_swift_connection and everything works again and this loop continues.\r\n\r\n\r\n```\r\nresource \"azurerm_subnet\" \"this\" {\r\n  name                 = \"name\"\r\n  resource_group_name  = azurerm_resource_group.rg.name\r\n  virtual_network_name = azurerm_virtual_network.vnet.name\r\n  address_prefixes     = [\"10.0.5.128/26\"]\r\n  service_endpoints    = [\"Microsoft.AzureCosmosDB\"]\r\n  delegation {\r\n    name = \"name-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n}\r\n\r\nresource \"azurerm_linux_function_app\" \"this\" {\r\n  name                       = \"name\"\r\n  resource_group_name        = azurerm_resource_group.rg.name\r\n  location                   = azurerm_resource_group.rg.location\r\n  storage_account_name       = azurerm_storage_account.this.name\r\n  storage_account_access_key = azurerm_storage_account.this.primary_access_key\r\n  service_plan_id            = azurerm_service_plan.this.id\r\n  https_only                 = true\r\n  site_config {\r\n    vnet_route_all_enabled = true\r\n    cors {\r\n      allowed_origins = [\"https://portal.azure.com\"]\r\n    }\r\n    application_stack {\r\n      node_version = \"18\"\r\n    }\r\n  }\r\n  app_settings = {\r\n  }\r\n  depends_on = [azurerm_cosmosdb_account.db]\r\n}\r\n\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"flow\" {\r\n  app_service_id = azurerm_linux_function_app.this.id\r\n  subnet_id      = azurerm_subnet.this.id\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "293336771", "PostHistoryTypeId": "1", "PostId": "76339774", "RevisionGUID": "204a0398-3fda-4215-8143-1c5ba80d84e6", "CreationDate": "2023-05-26T10:05:52.090", "UserId": "18937923", "Text": "How can I prevent Terraform from removing virtual_network_subnet_id when updating an azurerm_linux_function_app with vnet integration?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "293336772", "PostHistoryTypeId": "3", "PostId": "76339774", "RevisionGUID": "204a0398-3fda-4215-8143-1c5ba80d84e6", "CreationDate": "2023-05-26T10:05:52.090", "UserId": "18937923", "Text": "<terraform><azure-functions><terraform-provider-azure><subnet><vnet>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "293336773", "PostHistoryTypeId": "66", "PostId": "76339774", "RevisionGUID": "204a0398-3fda-4215-8143-1c5ba80d84e6", "CreationDate": "2023-05-26T10:05:52.090", "UserId": "18937923", "filtered-sentences": []}, {"Id": "293336805", "PostHistoryTypeId": "5", "PostId": "76339774", "RevisionGUID": "66ec136a-7eaf-49f7-ad2e-c9ce3c1c6579", "CreationDate": "2023-05-26T10:06:19.940", "UserId": "18937923", "Comment": "edited body", "Text": "I've created a terraform script with an azurerm_linux_function_app with vnet integration (using azurerm_app_service_virtual_network_swift_connection). If I run the Terraform script everything works as expected, but if I run Terraform again it propose to update the function app in-place by removing the virtual_network_subnet_id that breaks the vnet integration. If I run terraform again it proposes to create azurerm_app_service_virtual_network_swift_connection and everything works again and this loop continues.\r\n\r\n\r\n```\r\nresource \"azurerm_subnet\" \"this\" {\r\n  name                 = \"name\"\r\n  resource_group_name  = azurerm_resource_group.rg.name\r\n  virtual_network_name = azurerm_virtual_network.vnet.name\r\n  address_prefixes     = [\"10.0.5.128/26\"]\r\n  service_endpoints    = [\"Microsoft.AzureCosmosDB\"]\r\n  delegation {\r\n    name = \"name-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n}\r\n\r\nresource \"azurerm_linux_function_app\" \"this\" {\r\n  name                       = \"name\"\r\n  resource_group_name        = azurerm_resource_group.rg.name\r\n  location                   = azurerm_resource_group.rg.location\r\n  storage_account_name       = azurerm_storage_account.this.name\r\n  storage_account_access_key = azurerm_storage_account.this.primary_access_key\r\n  service_plan_id            = azurerm_service_plan.this.id\r\n  https_only                 = true\r\n  site_config {\r\n    vnet_route_all_enabled = true\r\n    cors {\r\n      allowed_origins = [\"https://portal.azure.com\"]\r\n    }\r\n    application_stack {\r\n      node_version = \"18\"\r\n    }\r\n  }\r\n  app_settings = {\r\n  }\r\n  depends_on = [azurerm_cosmosdb_account.db]\r\n}\r\n\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_linux_function_app.this.id\r\n  subnet_id      = azurerm_subnet.this.id\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "293337112", "PostHistoryTypeId": "5", "PostId": "76339774", "RevisionGUID": "440dda0d-8f30-419e-9bcf-7bbb1a4b6442", "CreationDate": "2023-05-26T10:13:18.580", "UserId": "18937923", "Comment": "added 8 characters in body", "Text": "I've created a terraform script with an azurerm_linux_function_app with vnet integration (using azurerm_app_service_virtual_network_swift_connection). If I run the Terraform script everything works as expected, but if I run Terraform again it proposes to update the function app in-place by removing the virtual_network_subnet_id, which then breaks the vnet integration. If I run terraform again it proposes to create azurerm_app_service_virtual_network_swift_connection again and everything works and this loop continues.\r\n\r\n\r\n```\r\nresource \"azurerm_subnet\" \"this\" {\r\n  name                 = \"name\"\r\n  resource_group_name  = azurerm_resource_group.rg.name\r\n  virtual_network_name = azurerm_virtual_network.vnet.name\r\n  address_prefixes     = [\"10.0.5.128/26\"]\r\n  service_endpoints    = [\"Microsoft.AzureCosmosDB\"]\r\n  delegation {\r\n    name = \"name-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n}\r\n\r\nresource \"azurerm_linux_function_app\" \"this\" {\r\n  name                       = \"name\"\r\n  resource_group_name        = azurerm_resource_group.rg.name\r\n  location                   = azurerm_resource_group.rg.location\r\n  storage_account_name       = azurerm_storage_account.this.name\r\n  storage_account_access_key = azurerm_storage_account.this.primary_access_key\r\n  service_plan_id            = azurerm_service_plan.this.id\r\n  https_only                 = true\r\n  site_config {\r\n    vnet_route_all_enabled = true\r\n    cors {\r\n      allowed_origins = [\"https://portal.azure.com\"]\r\n    }\r\n    application_stack {\r\n      node_version = \"18\"\r\n    }\r\n  }\r\n  app_settings = {\r\n  }\r\n  depends_on = [azurerm_cosmosdb_account.db]\r\n}\r\n\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_linux_function_app.this.id\r\n  subnet_id      = azurerm_subnet.this.id\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "293337802", "PostHistoryTypeId": "4", "PostId": "76339774", "RevisionGUID": "c2f26316-01fa-4fe2-b220-d779168f9ea6", "CreationDate": "2023-05-26T10:32:38.910", "UserId": "18937923", "Comment": "edited title", "Text": "Terraform keeps removing virtual_network_subnet_id and in the next terraform iteration re-adding the vnet integration for a azurerm_linux_function_app", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "293337823", "PostHistoryTypeId": "4", "PostId": "76339774", "RevisionGUID": "e621795b-f327-46d8-b4d0-c22b1452cfa4", "CreationDate": "2023-05-26T10:33:24.657", "UserId": "18937923", "Comment": "edited title", "Text": "Terraform keeps removing virtual_network_subnet_id and in a subsequent run re-adding the vnet integration for an azurerm_linux_function_app", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "76340435", "PostTypeId": "2", "ParentId": "76339774", "CreationDate": "2023-05-26T11:36:50.027", "Score": "0", "Body": "<p><em><strong>Glad the problem was solved As a workaround instead of removing swift connection</strong></em></p>\n<p><em><strong>You can make use of lifecycle block as mentioned in this <a href=\"https://stackoverflow.com/questions/73856640/terraform-lifecycle-ignore-changes\">SO thread</a> in your terraform code to avoid your swift connection from updating again</strong></em>, Refer below:-</p>\n<p><strong>My Terraform code:-</strong></p>\n<blockquote>\n<p><strong>I have referred the below terraform code from this <a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection\" rel=\"nofollow noreferrer\"><strong>Official  Terraform document</strong></a>  and modified the code by adding Depends on and lifecycle block.</strong></p>\n</blockquote>\n<pre><code>\n# We strongly recommend using the required_providers block to set the\n# Azure Provider source and version being used\nterraform {\n  required_providers {\n    azurerm = {\n      source  = &quot;hashicorp/azurerm&quot;\n      version = &quot;=3.58.0&quot;\n    }\n  }\n}\n\n# Configure the Microsoft Azure Provider\nprovider &quot;azurerm&quot; {\n  \nsubscription_id = &quot;subid&quot;\ntenant_id = &quot;tenantid&quot;\nclient_id = &quot;clientid&quot;\nclient_secret = &quot;clientsecret&quot;\nfeatures {\n  resource_group {\n    prevent_deletion_if_contains_resources = false\n  }\n}\n\n}\n\nresource &quot;azurerm_resource_group&quot; &quot;example&quot; {\n  name     = &quot;example-resources&quot;\n  location = &quot;West Europe&quot;\n}\n\nresource &quot;azurerm_virtual_network&quot; &quot;example&quot; {\n  name                = &quot;example-virtual-network&quot;\n  address_space       = [&quot;10.0.0.0/16&quot;]\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n  depends_on = [ azurerm_resource_group.example ]\n}\n\nresource &quot;azurerm_subnet&quot; &quot;example&quot; {\n  name                 = &quot;example-subnet&quot;\n  resource_group_name  = azurerm_resource_group.example.name\n  virtual_network_name = azurerm_virtual_network.example.name\n  address_prefixes     = [&quot;10.0.1.0/24&quot;]\n  \n\n  delegation {\n    name = &quot;example-delegation&quot;\n\n    service_delegation {\n      name    = &quot;Microsoft.Web/serverFarms&quot;\n      actions = [&quot;Microsoft.Network/virtualNetworks/subnets/action&quot;]\n    }\n  }\n  depends_on = [ azurerm_virtual_network.example ]\n}\n\nresource &quot;azurerm_app_service_plan&quot; &quot;example&quot; {\n  name                = &quot;example-app-service-plan&quot;\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n  depends_on = [ azurerm_resource_group.example ]\n\n  sku {\n    tier = &quot;Standard&quot;\n    size = &quot;S1&quot;\n  }\n}\n\nresource &quot;azurerm_storage_account&quot; &quot;example&quot; {\n  name                     = &quot;siliconstrg54332&quot;\n  resource_group_name      = azurerm_resource_group.example.name\n  location                 = azurerm_resource_group.example.location\n  account_tier             = &quot;Standard&quot;\n  account_replication_type = &quot;LRS&quot;\n  depends_on = [ azurerm_resource_group.example ]\n}\n\nresource &quot;azurerm_function_app&quot; &quot;example&quot; {\n  name                       = &quot;siliconfunc-0987&quot;\n  location                   = azurerm_resource_group.example.location\n  resource_group_name        = azurerm_resource_group.example.name\n  app_service_plan_id        = azurerm_app_service_plan.example.id\n  storage_account_name       = azurerm_storage_account.example.name\n  storage_account_access_key = azurerm_storage_account.example.primary_access_key\n  depends_on = [azurerm_app_service_plan.example]\n}\nresource &quot;azurerm_app_service_virtual_network_swift_connection&quot; &quot;this&quot; {\n  app_service_id = azurerm_function_app.example.id\n  subnet_id      = azurerm_subnet.example.id\n\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\n  lifecycle {\n    ignore_changes = [\n      subnet_id,\n    ]\n  }\n}\n</code></pre>\n<p><strong>lifecycle block:-</strong></p>\n<pre><code>resource &quot;azurerm_app_service_virtual_network_swift_connection&quot; &quot;this&quot; {\n  app_service_id = azurerm_function_app.example.id\n  subnet_id      = azurerm_subnet.example.id\n\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\n  lifecycle {\n    ignore_changes = [\n      subnet_id,\n    ]\n  }\n}\n</code></pre>\n<p><strong>Output:-</strong></p>\n<p><img src=\"https://i.imgur.com/EOX223r.png\" alt=\"enter image description here\" /></p>\n<p><img src=\"https://i.imgur.com/Wqz4aVR.png\" alt=\"enter image description here\" /></p>\n<p>When I ran the Plan again it did not ask me to update Swift connection or Function app except for asking me to add the tag as cost center refer below:-</p>\n<p><img src=\"https://i.imgur.com/3rAlCRG.png\" alt=\"enter image description here\" /></p>\n<p>You can add the tags by adding this</p>\n<pre><code>tags = { costCenter = &quot;My Cost Center&quot; } \n</code></pre>\n<p>in your resource block after tadding this in my resource block when I ran the plan I got the desired state refer below:-</p>\n<p><img src=\"https://i.imgur.com/qeSVM6N.png\" alt=\"enter image description here\" /></p>\n<blockquote>\n<p><strong>Complete code with tag referred from this <a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection\" rel=\"nofollow noreferrer\">Official Terraform Document</a> modified with Depends on and lifecycle block.</strong></p>\n</blockquote>\n<pre><code># We strongly recommend using the required_providers block to set the\n# Azure Provider source and version being used\nterraform {\n  required_providers {\n    azurerm = {\n      source  = &quot;hashicorp/azurerm&quot;\n      version = &quot;=3.58.0&quot;\n    }\n  }\n}\n\n# Configure the Microsoft Azure Provider\nprovider &quot;azurerm&quot; {\n  \nsubscription_id = &quot;subid&quot;\ntenant_id = &quot;tenantid&quot;\nclient_id = &quot;clientid&quot;\nclient_secret = &quot;clientsecret&quot;\nfeatures {\n  resource_group {\n    prevent_deletion_if_contains_resources = false\n  }\n}\n\n}\n\nresource &quot;azurerm_resource_group&quot; &quot;example&quot; {\n  name     = &quot;example-resources&quot;\n  location = &quot;West Europe&quot;\n}\n\nresource &quot;azurerm_virtual_network&quot; &quot;example&quot; {\n  name                = &quot;example-virtual-network&quot;\n  address_space       = [&quot;10.0.0.0/16&quot;]\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n  tags = {\n    costCenter = &quot;My Cost Center&quot;\n  }\n  depends_on = [ azurerm_resource_group.example ]\n}\n\nresource &quot;azurerm_subnet&quot; &quot;example&quot; {\n  name                 = &quot;example-subnet&quot;\n  resource_group_name  = azurerm_resource_group.example.name\n  virtual_network_name = azurerm_virtual_network.example.name\n  address_prefixes     = [&quot;10.0.1.0/24&quot;]\n  \n\n  delegation {\n    name = &quot;example-delegation&quot;\n\n    service_delegation {\n      name    = &quot;Microsoft.Web/serverFarms&quot;\n      actions = [&quot;Microsoft.Network/virtualNetworks/subnets/action&quot;]\n    }\n  }\n  depends_on = [ azurerm_virtual_network.example ]\n}\n\nresource &quot;azurerm_app_service_plan&quot; &quot;example&quot; {\n  name                = &quot;example-app-service-plan&quot;\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n  depends_on = [ azurerm_resource_group.example ]\n\n  sku {\n    tier = &quot;Standard&quot;\n    size = &quot;S1&quot;\n  }\n  tags = {\n    costCenter = &quot;My Cost Center&quot;\n}\n}\n\nresource &quot;azurerm_storage_account&quot; &quot;example&quot; {\n  name                     = &quot;siliconstrg54332&quot;\n  resource_group_name      = azurerm_resource_group.example.name\n  location                 = azurerm_resource_group.example.location\n  account_tier             = &quot;Standard&quot;\n  account_replication_type = &quot;LRS&quot;\n  \n  tags = {\n    costCenter = &quot;My Cost Center&quot;\n  }\n  depends_on = [ azurerm_resource_group.example ]\n}\n\nresource &quot;azurerm_function_app&quot; &quot;example&quot; {\n  name                       = &quot;siliconfunc-0987&quot;\n  location                   = azurerm_resource_group.example.location\n  resource_group_name        = azurerm_resource_group.example.name\n  app_service_plan_id        = azurerm_app_service_plan.example.id\n  storage_account_name       = azurerm_storage_account.example.name\n  storage_account_access_key = azurerm_storage_account.example.primary_access_key\n  tags = {\n    costCenter = &quot;My Cost Center&quot;\n  }\n  depends_on = [azurerm_app_service_plan.example]\n}\nresource &quot;azurerm_app_service_virtual_network_swift_connection&quot; &quot;this&quot; {\n  app_service_id = azurerm_function_app.example.id\n  subnet_id      = azurerm_subnet.example.id\n\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\n  lifecycle {\n    ignore_changes = [\n      subnet_id,\n    ]\n  }\n}\n</code></pre>\n", "OwnerUserId": "20849135", "LastEditorUserId": "20849135", "LastEditDate": "2023-05-26T12:00:53.790", "LastActivityDate": "2023-05-26T12:00:53.790", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "293340567", "PostHistoryTypeId": "2", "PostId": "76340435", "RevisionGUID": "273a1736-50e7-4e26-8aeb-e1ba1df09277", "CreationDate": "2023-05-26T11:36:50.027", "UserId": "20849135", "Text": "***Glad the problem was solved As a workaround instead of removing swift connection***\r\n\r\n***You can make use of lifecycle block as mentioned in this [SO thread](https://stackoverflow.com/questions/73856640/terraform-lifecycle-ignore-changes) in your terraform code to avoid your swift connection from updating again***, Refer below:-\r\n\r\n**My Terraform code:-**\r\n\r\nI have referred the below terraform code from this [**Official Terraform document**](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection)\r\n\r\n```hcl\r\n# We strongly recommend using the required_providers block to set the\r\n# Azure Provider source and version being used\r\nterraform {\r\n  required_providers {\r\n    azurerm = {\r\n      source  = \"hashicorp/azurerm\"\r\n      version = \"=3.58.0\"\r\n    }\r\n  }\r\n}\r\n\r\n# Configure the Microsoft Azure Provider\r\nprovider \"azurerm\" {\r\n  \r\nsubscription_id = \"subid\"\r\ntenant_id = \"tenantid\"\r\nclient_id = \"clientid\"\r\nclient_secret = \"clientsecret\"\r\nfeatures {\r\n  resource_group {\r\n    prevent_deletion_if_contains_resources = false\r\n  }\r\n}\r\n\r\n}\r\n\r\nresource \"azurerm_resource_group\" \"example\" {\r\n  name     = \"example-resources\"\r\n  location = \"West Europe\"\r\n}\r\n\r\nresource \"azurerm_virtual_network\" \"example\" {\r\n  name                = \"example-virtual-network\"\r\n  address_space       = [\"10.0.0.0/16\"]\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_subnet\" \"example\" {\r\n  name                 = \"example-subnet\"\r\n  resource_group_name  = azurerm_resource_group.example.name\r\n  virtual_network_name = azurerm_virtual_network.example.name\r\n  address_prefixes     = [\"10.0.1.0/24\"]\r\n  \r\n\r\n  delegation {\r\n    name = \"example-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n  depends_on = [ azurerm_virtual_network.example ]\r\n}\r\n\r\nresource \"azurerm_app_service_plan\" \"example\" {\r\n  name                = \"example-app-service-plan\"\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  depends_on = [ azurerm_resource_group.example ]\r\n\r\n  sku {\r\n    tier = \"Standard\"\r\n    size = \"S1\"\r\n  }\r\n}\r\n\r\nresource \"azurerm_storage_account\" \"example\" {\r\n  name                     = \"siliconstrg54332\"\r\n  resource_group_name      = azurerm_resource_group.example.name\r\n  location                 = azurerm_resource_group.example.location\r\n  account_tier             = \"Standard\"\r\n  account_replication_type = \"LRS\"\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_function_app\" \"example\" {\r\n  name                       = \"siliconfunc-0987\"\r\n  location                   = azurerm_resource_group.example.location\r\n  resource_group_name        = azurerm_resource_group.example.name\r\n  app_service_plan_id        = azurerm_app_service_plan.example.id\r\n  storage_account_name       = azurerm_storage_account.example.name\r\n  storage_account_access_key = azurerm_storage_account.example.primary_access_key\r\n  depends_on = [azurerm_app_service_plan.example]\r\n}\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_function_app.example.id\r\n  subnet_id      = azurerm_subnet.example.id\r\n\r\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\r\n  lifecycle {\r\n    ignore_changes = [\r\n      subnet_id,\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n**lifecycle block:-**\r\n\r\n```hcl\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_function_app.example.id\r\n  subnet_id      = azurerm_subnet.example.id\r\n\r\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\r\n  lifecycle {\r\n    ignore_changes = [\r\n      subnet_id,\r\n    ]\r\n  }\r\n}\r\n```\r\n**Output:-**\r\n\r\n![enter image description here](https://i.imgur.com/EOX223r.png)\r\n\r\n![enter image description here](https://i.imgur.com/Wqz4aVR.png)\r\n\r\nWhen I ran the Plan again it did not ask me to update Swift connection or Function app except for asking me to add the tag as cost center refer below:-\r\n\r\n![enter image description here](https://i.imgur.com/3rAlCRG.png)\r\n\r\nYou can add the tags by adding this\r\n```hcl\r\ntags = { costCenter = \"My Cost Center\" } \r\n```\r\nin your resource block after adding this in my resource block when I ran the plan I got the desired state refer below:-\r\n\r\n![enter image description here](https://i.imgur.com/qeSVM6N.png)\r\n\r\nComplete code with tag referred from this [Official Terraform Document](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection)\r\n\r\n```hcl\r\n# We strongly recommend using the required_providers block to set the\r\n# Azure Provider source and version being used\r\nterraform {\r\n  required_providers {\r\n    azurerm = {\r\n      source  = \"hashicorp/azurerm\"\r\n      version = \"=3.58.0\"\r\n    }\r\n  }\r\n}\r\n\r\n# Configure the Microsoft Azure Provider\r\nprovider \"azurerm\" {\r\n  \r\nsubscription_id = \"subid\"\r\ntenant_id = \"tenantid\"\r\nclient_id = \"clientid\"\r\nclient_secret = \"clientsecret\"\r\nfeatures {\r\n  resource_group {\r\n    prevent_deletion_if_contains_resources = false\r\n  }\r\n}\r\n\r\n}\r\n\r\nresource \"azurerm_resource_group\" \"example\" {\r\n  name     = \"example-resources\"\r\n  location = \"West Europe\"\r\n}\r\n\r\nresource \"azurerm_virtual_network\" \"example\" {\r\n  name                = \"example-virtual-network\"\r\n  address_space       = [\"10.0.0.0/16\"]\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n  }\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_subnet\" \"example\" {\r\n  name                 = \"example-subnet\"\r\n  resource_group_name  = azurerm_resource_group.example.name\r\n  virtual_network_name = azurerm_virtual_network.example.name\r\n  address_prefixes     = [\"10.0.1.0/24\"]\r\n  \r\n\r\n  delegation {\r\n    name = \"example-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n  depends_on = [ azurerm_virtual_network.example ]\r\n}\r\n\r\nresource \"azurerm_app_service_plan\" \"example\" {\r\n  name                = \"example-app-service-plan\"\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  depends_on = [ azurerm_resource_group.example ]\r\n\r\n  sku {\r\n    tier = \"Standard\"\r\n    size = \"S1\"\r\n  }\r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n}\r\n}\r\n\r\nresource \"azurerm_storage_account\" \"example\" {\r\n  name                     = \"siliconstrg54332\"\r\n  resource_group_name      = azurerm_resource_group.example.name\r\n  location                 = azurerm_resource_group.example.location\r\n  account_tier             = \"Standard\"\r\n  account_replication_type = \"LRS\"\r\n  \r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n  }\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_function_app\" \"example\" {\r\n  name                       = \"siliconfunc-0987\"\r\n  location                   = azurerm_resource_group.example.location\r\n  resource_group_name        = azurerm_resource_group.example.name\r\n  app_service_plan_id        = azurerm_app_service_plan.example.id\r\n  storage_account_name       = azurerm_storage_account.example.name\r\n  storage_account_access_key = azurerm_storage_account.example.primary_access_key\r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n  }\r\n  depends_on = [azurerm_app_service_plan.example]\r\n}\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_function_app.example.id\r\n  subnet_id      = azurerm_subnet.example.id\r\n\r\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\r\n  lifecycle {\r\n    ignore_changes = [\r\n      subnet_id,\r\n    ]\r\n  }\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "***Glad the problem was solved As a workaround instead of removing swift connection*** ***You can make use of lifecycle block as mentioned in this [SO thread](https://stackoverflow.com/questions/73856640/terraform-lifecycle-ignore-changes) in your terraform code to avoid your swift connection from updating again***, Refer below:- **My Terraform code:-** I have referred the below terraform code from this [**Official Terraform document**](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection) ```hcl # We strongly recommend using the required_providers block to set the # Azure Provider source and version being used terraform { required_providers { azurerm = { source = \"hashicorp/azurerm\" version = \"=3.58.0\" } } } # Configure the Microsoft Azure Provider provider \"azurerm\" { subscription_id = \"subid\" tenant_id = \"tenantid\" client_id = \"clientid\" client_secret = \"clientsecret\" features { resource_group { prevent_deletion_if_contains_resources = false } } } resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_virtual_network\" \"example\" { name = \"example-virtual-network\" address_space = [\"10.0.0.0/16\"] location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_subnet\" \"example\" { name = \"example-subnet\" resource_group_name = azurerm_resource_group.example.name virtual_network_name = azurerm_virtual_network.example.name address_prefixes = [\"10.0.1.0/24\"] delegation { name = \"example-delegation\" service_delegation { name = \"Microsoft.Web/serverFarms\" actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"] } } depends_on = [ azurerm_virtual_network.example ] } resource \"azurerm_app_service_plan\" \"example\" { name = \"example-app-service-plan\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name depends_on = [ azurerm_resource_group.example ] sku { tier = \"Standard\" size = \"S1\" } } resource \"azurerm_storage_account\" \"example\" { name = \"siliconstrg54332\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_function_app\" \"example\" { name = \"siliconfunc-0987\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key depends_on = [azurerm_app_service_plan.example] } resource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" { app_service_id = azurerm_function_app.example.id subnet_id = azurerm_subnet.example.id depends_on = [azurerm_subnet.example, azurerm_function_app.example] lifecycle { ignore_changes = [ subnet_id, ] } } ``` **lifecycle block:-** ```hcl resource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" { app_service_id = azurerm_function_app.example.id subnet_id = azurerm_subnet.example.id depends_on = [azurerm_subnet.example, azurerm_function_app.example] lifecycle { ignore_changes = [ subnet_id, ] } } ``` **Output:-** ![enter image description here](https://i.imgur.com/EOX223r.png) ![enter image description here](https://i.imgur.com/Wqz4aVR.png) When I ran the Plan again it did not ask me to update Swift connection or Function app except for asking me to add the tag as cost center refer below:- ![enter image description here](https://i.imgur.com/3rAlCRG.png) You can add the tags by adding this ```hcl tags = { costCenter = \"My Cost Center\" } ``` in your resource block after adding this in my resource block when I ran the plan I got the desired state refer below:- ![enter image description here](https://i.imgur.com/qeSVM6N.png) Complete code with tag referred from this [Official Terraform Document](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection) ```hcl # We strongly recommend using the required_providers block to set the # Azure Provider source and version being used terraform { required_providers { azurerm = { source = \"hashicorp/azurerm\" version = \"=3.58.0\" } } } # Configure the Microsoft Azure Provider provider \"azurerm\" { subscription_id = \"subid\" tenant_id = \"tenantid\" client_id = \"clientid\" client_secret = \"clientsecret\" features { resource_group { prevent_deletion_if_contains_resources = false } } } resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_virtual_network\" \"example\" { name = \"example-virtual-network\" address_space = [\"10.0.0.0/16\"] location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name tags = { costCenter = \"My Cost Center\" } depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_subnet\" \"example\" { name = \"example-subnet\" resource_group_name = azurerm_resource_group.example.name virtual_network_name = azurerm_virtual_network.example.name address_prefixes = [\"10.0.1.0/24\"] delegation { name = \"example-delegation\" service_delegation { name = \"Microsoft.Web/serverFarms\" actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"] } } depends_on = [ azurerm_virtual_network.example ] } resource \"azurerm_app_service_plan\" \"example\" { name = \"example-app-service-plan\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name depends_on = [ azurerm_resource_group.example ] sku { tier = \"Standard\" size = \"S1\" } tags = { costCenter = \"My Cost Center\" } } resource \"azurerm_storage_account\" \"example\" { name = \"siliconstrg54332\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" tags = { costCenter = \"My Cost Center\" } depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_function_app\" \"example\" { name = \"siliconfunc-0987\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key tags = { costCenter = \"My Cost Center\" } depends_on = [azurerm_app_service_plan.example] } resource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" { app_service_id = azurerm_function_app.example.id subnet_id = azurerm_subnet.example.id depends_on = [azurerm_subnet.example, azurerm_function_app.example] lifecycle { ignore_changes = [ subnet_id, ] } ", "keywords": ["cost", "provider", "change"]}]}, {"Id": "293341630", "PostHistoryTypeId": "5", "PostId": "76340435", "RevisionGUID": "0e2715f5-ae04-493d-b717-6e274e41d8e6", "CreationDate": "2023-05-26T12:00:53.790", "UserId": "20849135", "Comment": "added reference I have referred the below terraform code from this Official Terraform document and modified the code by adding Depends on and lifecycle block.", "Text": "***Glad the problem was solved As a workaround instead of removing swift connection***\r\n\r\n***You can make use of lifecycle block as mentioned in this [SO thread](https://stackoverflow.com/questions/73856640/terraform-lifecycle-ignore-changes) in your terraform code to avoid your swift connection from updating again***, Refer below:-\r\n\r\n**My Terraform code:-**\r\n\r\n> **I have referred the below terraform code from this [**Official  Terraform document**](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection)  and modified the code by adding Depends on and lifecycle block.**\r\n\r\n```hcl\r\n\r\n# We strongly recommend using the required_providers block to set the\r\n# Azure Provider source and version being used\r\nterraform {\r\n  required_providers {\r\n    azurerm = {\r\n      source  = \"hashicorp/azurerm\"\r\n      version = \"=3.58.0\"\r\n    }\r\n  }\r\n}\r\n\r\n# Configure the Microsoft Azure Provider\r\nprovider \"azurerm\" {\r\n  \r\nsubscription_id = \"subid\"\r\ntenant_id = \"tenantid\"\r\nclient_id = \"clientid\"\r\nclient_secret = \"clientsecret\"\r\nfeatures {\r\n  resource_group {\r\n    prevent_deletion_if_contains_resources = false\r\n  }\r\n}\r\n\r\n}\r\n\r\nresource \"azurerm_resource_group\" \"example\" {\r\n  name     = \"example-resources\"\r\n  location = \"West Europe\"\r\n}\r\n\r\nresource \"azurerm_virtual_network\" \"example\" {\r\n  name                = \"example-virtual-network\"\r\n  address_space       = [\"10.0.0.0/16\"]\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_subnet\" \"example\" {\r\n  name                 = \"example-subnet\"\r\n  resource_group_name  = azurerm_resource_group.example.name\r\n  virtual_network_name = azurerm_virtual_network.example.name\r\n  address_prefixes     = [\"10.0.1.0/24\"]\r\n  \r\n\r\n  delegation {\r\n    name = \"example-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n  depends_on = [ azurerm_virtual_network.example ]\r\n}\r\n\r\nresource \"azurerm_app_service_plan\" \"example\" {\r\n  name                = \"example-app-service-plan\"\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  depends_on = [ azurerm_resource_group.example ]\r\n\r\n  sku {\r\n    tier = \"Standard\"\r\n    size = \"S1\"\r\n  }\r\n}\r\n\r\nresource \"azurerm_storage_account\" \"example\" {\r\n  name                     = \"siliconstrg54332\"\r\n  resource_group_name      = azurerm_resource_group.example.name\r\n  location                 = azurerm_resource_group.example.location\r\n  account_tier             = \"Standard\"\r\n  account_replication_type = \"LRS\"\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_function_app\" \"example\" {\r\n  name                       = \"siliconfunc-0987\"\r\n  location                   = azurerm_resource_group.example.location\r\n  resource_group_name        = azurerm_resource_group.example.name\r\n  app_service_plan_id        = azurerm_app_service_plan.example.id\r\n  storage_account_name       = azurerm_storage_account.example.name\r\n  storage_account_access_key = azurerm_storage_account.example.primary_access_key\r\n  depends_on = [azurerm_app_service_plan.example]\r\n}\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_function_app.example.id\r\n  subnet_id      = azurerm_subnet.example.id\r\n\r\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\r\n  lifecycle {\r\n    ignore_changes = [\r\n      subnet_id,\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n**lifecycle block:-**\r\n\r\n```hcl\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_function_app.example.id\r\n  subnet_id      = azurerm_subnet.example.id\r\n\r\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\r\n  lifecycle {\r\n    ignore_changes = [\r\n      subnet_id,\r\n    ]\r\n  }\r\n}\r\n```\r\n**Output:-**\r\n\r\n![enter image description here](https://i.imgur.com/EOX223r.png)\r\n\r\n![enter image description here](https://i.imgur.com/Wqz4aVR.png)\r\n\r\nWhen I ran the Plan again it did not ask me to update Swift connection or Function app except for asking me to add the tag as cost center refer below:-\r\n\r\n![enter image description here](https://i.imgur.com/3rAlCRG.png)\r\n\r\nYou can add the tags by adding this\r\n```hcl\r\ntags = { costCenter = \"My Cost Center\" } \r\n```\r\nin your resource block after tadding this in my resource block when I ran the plan I got the desired state refer below:-\r\n\r\n![enter image description here](https://i.imgur.com/qeSVM6N.png)\r\n\r\n> **Complete code with tag referred from this [Official Terraform Document](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection) modified with Depends on and lifecycle block.**\r\n\r\n```hcl\r\n# We strongly recommend using the required_providers block to set the\r\n# Azure Provider source and version being used\r\nterraform {\r\n  required_providers {\r\n    azurerm = {\r\n      source  = \"hashicorp/azurerm\"\r\n      version = \"=3.58.0\"\r\n    }\r\n  }\r\n}\r\n\r\n# Configure the Microsoft Azure Provider\r\nprovider \"azurerm\" {\r\n  \r\nsubscription_id = \"subid\"\r\ntenant_id = \"tenantid\"\r\nclient_id = \"clientid\"\r\nclient_secret = \"clientsecret\"\r\nfeatures {\r\n  resource_group {\r\n    prevent_deletion_if_contains_resources = false\r\n  }\r\n}\r\n\r\n}\r\n\r\nresource \"azurerm_resource_group\" \"example\" {\r\n  name     = \"example-resources\"\r\n  location = \"West Europe\"\r\n}\r\n\r\nresource \"azurerm_virtual_network\" \"example\" {\r\n  name                = \"example-virtual-network\"\r\n  address_space       = [\"10.0.0.0/16\"]\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n  }\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_subnet\" \"example\" {\r\n  name                 = \"example-subnet\"\r\n  resource_group_name  = azurerm_resource_group.example.name\r\n  virtual_network_name = azurerm_virtual_network.example.name\r\n  address_prefixes     = [\"10.0.1.0/24\"]\r\n  \r\n\r\n  delegation {\r\n    name = \"example-delegation\"\r\n\r\n    service_delegation {\r\n      name    = \"Microsoft.Web/serverFarms\"\r\n      actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"]\r\n    }\r\n  }\r\n  depends_on = [ azurerm_virtual_network.example ]\r\n}\r\n\r\nresource \"azurerm_app_service_plan\" \"example\" {\r\n  name                = \"example-app-service-plan\"\r\n  location            = azurerm_resource_group.example.location\r\n  resource_group_name = azurerm_resource_group.example.name\r\n  depends_on = [ azurerm_resource_group.example ]\r\n\r\n  sku {\r\n    tier = \"Standard\"\r\n    size = \"S1\"\r\n  }\r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n}\r\n}\r\n\r\nresource \"azurerm_storage_account\" \"example\" {\r\n  name                     = \"siliconstrg54332\"\r\n  resource_group_name      = azurerm_resource_group.example.name\r\n  location                 = azurerm_resource_group.example.location\r\n  account_tier             = \"Standard\"\r\n  account_replication_type = \"LRS\"\r\n  \r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n  }\r\n  depends_on = [ azurerm_resource_group.example ]\r\n}\r\n\r\nresource \"azurerm_function_app\" \"example\" {\r\n  name                       = \"siliconfunc-0987\"\r\n  location                   = azurerm_resource_group.example.location\r\n  resource_group_name        = azurerm_resource_group.example.name\r\n  app_service_plan_id        = azurerm_app_service_plan.example.id\r\n  storage_account_name       = azurerm_storage_account.example.name\r\n  storage_account_access_key = azurerm_storage_account.example.primary_access_key\r\n  tags = {\r\n    costCenter = \"My Cost Center\"\r\n  }\r\n  depends_on = [azurerm_app_service_plan.example]\r\n}\r\nresource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" {\r\n  app_service_id = azurerm_function_app.example.id\r\n  subnet_id      = azurerm_subnet.example.id\r\n\r\ndepends_on = [azurerm_subnet.example, azurerm_function_app.example]\r\n  lifecycle {\r\n    ignore_changes = [\r\n      subnet_id,\r\n    ]\r\n  }\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "***Glad the problem was solved As a workaround instead of removing swift connection*** ***You can make use of lifecycle block as mentioned in this [SO thread](https://stackoverflow.com/questions/73856640/terraform-lifecycle-ignore-changes) in your terraform code to avoid your swift connection from updating again***, Refer below:- **My Terraform code:-** > **I have referred the below terraform code from this [**Official Terraform document**](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection) and modified the code by adding Depends on and lifecycle block.** ```hcl # We strongly recommend using the required_providers block to set the # Azure Provider source and version being used terraform { required_providers { azurerm = { source = \"hashicorp/azurerm\" version = \"=3.58.0\" } } } # Configure the Microsoft Azure Provider provider \"azurerm\" { subscription_id = \"subid\" tenant_id = \"tenantid\" client_id = \"clientid\" client_secret = \"clientsecret\" features { resource_group { prevent_deletion_if_contains_resources = false } } } resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_virtual_network\" \"example\" { name = \"example-virtual-network\" address_space = [\"10.0.0.0/16\"] location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_subnet\" \"example\" { name = \"example-subnet\" resource_group_name = azurerm_resource_group.example.name virtual_network_name = azurerm_virtual_network.example.name address_prefixes = [\"10.0.1.0/24\"] delegation { name = \"example-delegation\" service_delegation { name = \"Microsoft.Web/serverFarms\" actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"] } } depends_on = [ azurerm_virtual_network.example ] } resource \"azurerm_app_service_plan\" \"example\" { name = \"example-app-service-plan\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name depends_on = [ azurerm_resource_group.example ] sku { tier = \"Standard\" size = \"S1\" } } resource \"azurerm_storage_account\" \"example\" { name = \"siliconstrg54332\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_function_app\" \"example\" { name = \"siliconfunc-0987\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key depends_on = [azurerm_app_service_plan.example] } resource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" { app_service_id = azurerm_function_app.example.id subnet_id = azurerm_subnet.example.id depends_on = [azurerm_subnet.example, azurerm_function_app.example] lifecycle { ignore_changes = [ subnet_id, ] } } ``` **lifecycle block:-** ```hcl resource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" { app_service_id = azurerm_function_app.example.id subnet_id = azurerm_subnet.example.id depends_on = [azurerm_subnet.example, azurerm_function_app.example] lifecycle { ignore_changes = [ subnet_id, ] } } ``` **Output:-** ![enter image description here](https://i.imgur.com/EOX223r.png) ![enter image description here](https://i.imgur.com/Wqz4aVR.png) When I ran the Plan again it did not ask me to update Swift connection or Function app except for asking me to add the tag as cost center refer below:- ![enter image description here](https://i.imgur.com/3rAlCRG.png) You can add the tags by adding this ```hcl tags = { costCenter = \"My Cost Center\" } ``` in your resource block after tadding this in my resource block when I ran the plan I got the desired state refer below:- ![enter image description here](https://i.imgur.com/qeSVM6N.png) > **Complete code with tag referred from this [Official Terraform Document](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_virtual_network_swift_connection) modified with Depends on and lifecycle block.** ```hcl # We strongly recommend using the required_providers block to set the # Azure Provider source and version being used terraform { required_providers { azurerm = { source = \"hashicorp/azurerm\" version = \"=3.58.0\" } } } # Configure the Microsoft Azure Provider provider \"azurerm\" { subscription_id = \"subid\" tenant_id = \"tenantid\" client_id = \"clientid\" client_secret = \"clientsecret\" features { resource_group { prevent_deletion_if_contains_resources = false } } } resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_virtual_network\" \"example\" { name = \"example-virtual-network\" address_space = [\"10.0.0.0/16\"] location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name tags = { costCenter = \"My Cost Center\" } depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_subnet\" \"example\" { name = \"example-subnet\" resource_group_name = azurerm_resource_group.example.name virtual_network_name = azurerm_virtual_network.example.name address_prefixes = [\"10.0.1.0/24\"] delegation { name = \"example-delegation\" service_delegation { name = \"Microsoft.Web/serverFarms\" actions = [\"Microsoft.Network/virtualNetworks/subnets/action\"] } } depends_on = [ azurerm_virtual_network.example ] } resource \"azurerm_app_service_plan\" \"example\" { name = \"example-app-service-plan\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name depends_on = [ azurerm_resource_group.example ] sku { tier = \"Standard\" size = \"S1\" } tags = { costCenter = \"My Cost Center\" } } resource \"azurerm_storage_account\" \"example\" { name = \"siliconstrg54332\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" tags = { costCenter = \"My Cost Center\" } depends_on = [ azurerm_resource_group.example ] } resource \"azurerm_function_app\" \"example\" { name = \"siliconfunc-0987\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key tags = { costCenter = \"My Cost Center\" } depends_on = [azurerm_app_service_plan.example] } resource \"azurerm_app_service_virtual_network_swift_connection\" \"this\" { app_service_id = azurerm_function_app.example.id subnet_id = azurerm_subnet.example.id depends_on = [azurerm_subnet.example, azurerm_function_app.example] lifecycle { ignore_changes = [ subnet_id, ] } ", "keywords": ["cost", "provider", "change"]}]}], "filtered-sentences": [{"source": "Body", "text": "Glad the problem was solved As a workaround instead of removing swift connection You can make use of lifecycle block as mentioned in this SO thread in your terraform code to avoid your swift connection from updating again, Refer below:- My Terraform code:- I have referred the below terraform code from this Official Terraform document and modified the code by adding Depends on and lifecycle block. lifecycle block:- Output:- When I ran the Plan again it did not ask me to update Swift connection or Function app except for asking me to add the tag as cost center refer below:- You can add the tags by adding this in your resource block after tadding this in my resource block when I ran the plan I got the desired state refer below:- Complete code with tag referred from this Official Terraform Document modified with Depends on and lifecycle block.", "keywords": ["cost"]}]}], "contains-topic": true, "filtered-sentences": []}