{"Id": "70969899", "PostTypeId": "1", "CreationDate": "2022-02-03T10:46:20.280", "Score": "2", "ViewCount": "179", "Body": "<p>I am setting up alerting in AWS, using AWS Budgets to trigger an alert if an account\u2019s cost is exceeding x% or x amount of the cost by x date of the month, to identify when spikes in price occur.</p>\n<pre><code>resource &quot;aws_budgets_budget&quot; &quot;all-cost-budget&quot; {\n  name         = &quot;all-cost-budget&quot;\n  budget_type  = &quot;COST&quot;\n  limit_amount = &quot;10&quot;\n  limit_unit   = &quot;USD&quot;\n  time_unit    = &quot;DAILY&quot;\n\n  notification {\n    comparison_operator        = &quot;GREATER_THAN&quot;\n    threshold                  = &quot;100&quot;\n    threshold_type             = &quot;PERCENTAGE&quot;\n    notification_type          = &quot;ACTUAL&quot;\n    subscriber_email_addresses = [&quot;email address&quot;]\n  }\n}\n</code></pre>\n<p>We currently do not have a specific limit amount, and would like to set it based on the previous month's spending.</p>\n<p>Is there a way to do this dynamically within AWS and Terraform?</p>\n", "OwnerUserId": "10495960", "LastActivityDate": "2022-02-03T19:51:08.273", "Title": "Setting a dynamic limit_amount in AWS Budget Billing Module", "Tags": "<amazon-web-services><terraform>", "AnswerCount": "1", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "125460899", "PostId": "70969899", "Score": "1", "Text": "Well, maybe add a Lambda function which would get the notification (use `subscriber_sns_topic_arns` to define SNS topics that have email and Lambda as the destinations), extract the limit amount from the SNS message in lambda handler and modify the Terraform file with that value, push it to a repository, trigger `plan`, `init`, `apply`. But that's just thinking out loud. :)", "CreationDate": "2022-02-03T11:15:57.767", "UserId": "8343484", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "263329687", "PostHistoryTypeId": "2", "PostId": "70969899", "RevisionGUID": "081f6aaa-dda6-432a-a21c-1b474d51275a", "CreationDate": "2022-02-03T10:46:20.280", "UserId": "10495960", "Text": "I am setting up alerting in AWS, using AWS Budgets to trigger an alert if an account\u2019s cost is exceeding x% or x amount of the cost by x date of the month, to identify when spikes in price occur.\r\n\r\n    resource \"aws_budgets_budget\" \"all-cost-budget\" {\r\n      name         = \"all-cost-budget\"\r\n      budget_type  = \"COST\"\r\n      limit_amount = \"10\"\r\n      limit_unit   = \"USD\"\r\n      time_unit    = \"DAILY\"\r\n    \r\n      notification {\r\n        comparison_operator        = \"GREATER_THAN\"\r\n        threshold                  = \"100\"\r\n        threshold_type             = \"PERCENTAGE\"\r\n        notification_type          = \"ACTUAL\"\r\n        subscriber_email_addresses = [\"email address\"]\r\n      }\r\n    }\r\n\r\nWe currently do not have a specific limit amount, and would like to set it based on the previous month's spending.\r\n\r\nIs there a way to do this dynamically within AWS and Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I am setting up alerting in AWS, using AWS Budgets to trigger an alert if an account\u2019s cost is exceeding x% or x amount of the cost by x date of the month, to identify when spikes in price occur. resource \"aws_budgets_budget\" \"all-cost-budget\" { name = \"all-cost-budget\" budget_type = \"COST\" limit_amount = \"10\" limit_unit = \"USD\" time_unit = \"DAILY\" notification { comparison_operator = \"GREATER_THAN\" threshold = \"100\" threshold_type = \"PERCENTAGE\" notification_type = \"ACTUAL\" subscriber_email_addresses = [\"email address\"] } } ", "keywords": ["cost"]}]}, {"Id": "263329689", "PostHistoryTypeId": "1", "PostId": "70969899", "RevisionGUID": "081f6aaa-dda6-432a-a21c-1b474d51275a", "CreationDate": "2022-02-03T10:46:20.280", "UserId": "10495960", "Text": "Setting a dynamic limit_amount in AWS Budget Billing Module", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "263329690", "PostHistoryTypeId": "3", "PostId": "70969899", "RevisionGUID": "081f6aaa-dda6-432a-a21c-1b474d51275a", "CreationDate": "2022-02-03T10:46:20.280", "UserId": "10495960", "Text": "<amazon-web-services><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "70977427", "PostTypeId": "2", "ParentId": "70969899", "CreationDate": "2022-02-03T19:51:08.273", "Score": "0", "Body": "<p>You can setup a Lambda function which would automatically execute at the start of every month and update the budget value. The AWS quickstart for Landing Zone has a CloudFormation template which does something similar to what you have described, setting the budget as the rolling average of the last three months (<a href=\"https://github.com/aws-quickstart/quickstart-superwerker/blob/main/templates/budget.yaml\" rel=\"nofollow noreferrer\">Template</a>, <a href=\"https://github.com/aws-quickstart/quickstart-superwerker/blob/main/docs/adrs/budget.md\" rel=\"nofollow noreferrer\">Documentation</a>). You will need to convert the CloudFormation template to Terraform and tweak the criteria to match your requirements. You might also want to consider using <code>FORECASTED</code> instead of <code>ACTUAL</code>.</p>\n", "OwnerUserId": "17896613", "LastActivityDate": "2022-02-03T19:51:08.273", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "263368436", "PostHistoryTypeId": "2", "PostId": "70977427", "RevisionGUID": "ea260174-9bfb-456f-8c9d-e29964b6d954", "CreationDate": "2022-02-03T19:51:08.273", "UserId": "17896613", "Text": "You can setup a Lambda function which would automatically execute at the start of every month and update the budget value. The AWS quickstart for Landing Zone has a CloudFormation template which does something similar to what you have described, setting the budget as the rolling average of the last three months ([Template][1], [Documentation][2]). You will need to convert the CloudFormation template to Terraform and tweak the criteria to match your requirements. You might also want to consider using `FORECASTED` instead of `ACTUAL`.\r\n\r\n\r\n  [1]: https://github.com/aws-quickstart/quickstart-superwerker/blob/main/templates/budget.yaml\r\n  [2]: https://github.com/aws-quickstart/quickstart-superwerker/blob/main/docs/adrs/budget.md", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "I am setting up alerting in AWS, using AWS Budgets to trigger an alert if an account\u2019s cost is exceeding x% or x amount of the cost by x date of the month, to identify when spikes in price occur. ", "keywords": ["cost"]}]}