{"Id": "50610221", "PostTypeId": "1", "CreationDate": "2018-05-30T17:14:20.440", "Score": "0", "ViewCount": "267", "Body": "<p>I read the Terraform spot fleet example usages from <a href=\"https://www.terraform.io/docs/providers/aws/r/spot_fleet_request.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>What is the significance of \"iam_instance_profile_arn\" and what does it do in Example 1?</p>\n\n<p>I'm getting the error \"launch_specification.0: invalid or unknown key: tags\" in some cases, while not in others so I thought maybe it is related to the iam_profile.</p>\n\n<pre><code>iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\n</code></pre>\n\n<p>Example 1:</p>\n\n<pre><code># Request a Spot fleet\nresource \"aws_spot_fleet_request\" \"cheap_compute\" {\n  iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price          = \"0.03\"\n  allocation_strategy = \"diversified\"\n  target_capacity     = 6\n  valid_until         = \"2019-11-04T20:44:20Z\"\n\n  launch_specification {\n    instance_type             = \"m4.10xlarge\"\n    ami                       = \"ami-1234\"\n    spot_price                = \"2.793\"\n    placement_tenancy         = \"dedicated\"\n    iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\n  }\n\n  launch_specification {\n    instance_type             = \"m4.4xlarge\"\n    ami                       = \"ami-5678\"\n    key_name                  = \"my-key\"\n    spot_price                = \"1.117\"\n    iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\n    availability_zone         = \"us-west-1a\"\n    subnet_id                 = \"subnet-1234\"\n    weighted_capacity         = 35\n\n    root_block_device {\n      volume_size = \"300\"\n      volume_type = \"gp2\"\n    }\n\n    tags {\n      Name = \"spot-fleet-example\"\n    }\n  }\n}\n</code></pre>\n\n<p>Example 2:</p>\n\n<pre><code>resource \"aws_spot_fleet_request\" \"foo\" {\n  iam_fleet_role  = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price      = \"0.005\"\n  target_capacity = 2\n  valid_until     = \"2019-11-04T20:44:20Z\"\n\n  launch_specification {\n    instance_type     = \"m1.small\"\n    ami               = \"ami-d06a90b0\"\n    key_name          = \"my-key\"\n    availability_zone = \"us-west-2a\"\n  }\n\n  launch_specification {\n    instance_type     = \"m3.large\"\n    ami               = \"ami-d06a90b0\"\n    key_name          = \"my-key\"\n    availability_zone = \"us-west-2a\"\n  }\n\n  depends_on = [\"aws_iam_policy_attachment.test-attach\"]\n}\n</code></pre>\n", "OwnerUserId": "4133463", "LastActivityDate": "2018-05-30T17:28:58.173", "Title": "Terraform aws_spot_fleet_request iam_instance_profile", "Tags": "<amazon-web-services><terraform><terraform-provider-aws>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "174541485", "PostHistoryTypeId": "2", "PostId": "50610221", "RevisionGUID": "9961e3a3-3ddf-4abe-a8d6-d72ae9b6ab55", "CreationDate": "2018-05-30T17:14:20.440", "UserId": "4133463", "Text": "I read the Terraform spot fleet example usages from [here][1].\r\n\r\nWhat is the significance of \"iam_instance_profile_arn\" and what does it do in Example 1?\r\n\r\nI'm getting the error \"launch_specification.0: invalid or unknown key: tags\" in some cases, while not in others so I thought maybe it is related to the iam_profile.\r\n\r\n    iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\r\n\r\nExample 1:\r\n\r\n    # Request a Spot fleet\r\n    resource \"aws_spot_fleet_request\" \"cheap_compute\" {\r\n      iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\r\n      spot_price          = \"0.03\"\r\n      allocation_strategy = \"diversified\"\r\n      target_capacity     = 6\r\n      valid_until         = \"2019-11-04T20:44:20Z\"\r\n    \r\n      launch_specification {\r\n        instance_type             = \"m4.10xlarge\"\r\n        ami                       = \"ami-1234\"\r\n        spot_price                = \"2.793\"\r\n        placement_tenancy         = \"dedicated\"\r\n        iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\r\n      }\r\n    \r\n      launch_specification {\r\n        instance_type             = \"m4.4xlarge\"\r\n        ami                       = \"ami-5678\"\r\n        key_name                  = \"my-key\"\r\n        spot_price                = \"1.117\"\r\n        iam_instance_profile_arn  = \"${aws_iam_instance_profile.example.arn}\"\r\n        availability_zone         = \"us-west-1a\"\r\n        subnet_id                 = \"subnet-1234\"\r\n        weighted_capacity         = 35\r\n    \r\n        root_block_device {\r\n          volume_size = \"300\"\r\n          volume_type = \"gp2\"\r\n        }\r\n    \r\n        tags {\r\n          Name = \"spot-fleet-example\"\r\n        }\r\n      }\r\n    }\r\n\r\nExample 2:\r\n\r\n    resource \"aws_spot_fleet_request\" \"foo\" {\r\n      iam_fleet_role  = \"arn:aws:iam::12345678:role/spot-fleet\"\r\n      spot_price      = \"0.005\"\r\n      target_capacity = 2\r\n      valid_until     = \"2019-11-04T20:44:20Z\"\r\n    \r\n      launch_specification {\r\n        instance_type     = \"m1.small\"\r\n        ami               = \"ami-d06a90b0\"\r\n        key_name          = \"my-key\"\r\n        availability_zone = \"us-west-2a\"\r\n      }\r\n    \r\n      launch_specification {\r\n        instance_type     = \"m3.large\"\r\n        ami               = \"ami-d06a90b0\"\r\n        key_name          = \"my-key\"\r\n        availability_zone = \"us-west-2a\"\r\n      }\r\n    \r\n      depends_on = [\"aws_iam_policy_attachment.test-attach\"]\r\n    }\r\n\r\n  [1]: https://www.terraform.io/docs/providers/aws/r/spot_fleet_request.html\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "iam_instance_profile_arn = \"${aws_iam_instance_profile.example.arn}\" Example 1: # Request a Spot fleet resource \"aws_spot_fleet_request\" \"cheap_compute\" { iam_fleet_role = \"arn:aws:iam::12345678:role/spot-fleet\" spot_price = \"0.03\" allocation_strategy = \"diversified\" target_capacity = 6 valid_until = \"2019-11-04T20:44:20Z\" launch_specification { instance_type = \"m4.10xlarge\" ami = \"ami-1234\" spot_price = \"2.793\" placement_tenancy = \"dedicated\" iam_instance_profile_arn = \"${aws_iam_instance_profile.example.arn}\" } launch_specification { instance_type = \"m4.4xlarge\" ami = \"ami-5678\" key_name = \"my-key\" spot_price = \"1.117\" iam_instance_profile_arn = \"${aws_iam_instance_profile.example.arn}\" availability_zone = \"us-west-1a\" subnet_id = \"subnet-1234\" weighted_capacity = 35 root_block_device { volume_size = \"300\" volume_type = \"gp2\" } tags { Name = \"spot-fleet-example\" } } } Example 2: resource \"aws_spot_fleet_request\" \"foo\" { iam_fleet_role = \"arn:aws:iam::12345678:role/spot-fleet\" spot_price = \"0.005\" target_capacity = 2 valid_until = \"2019-11-04T20:44:20Z\" launch_specification { instance_type = \"m1.small\" ami = \"ami-d06a90b0\" key_name = \"my-key\" availability_zone = \"us-west-2a\" ", "keywords": ["cheap"]}, {"source": "Text", "text": "} depends_on = [\"aws_iam_policy_attachment.test-attach\"] } [1]: https://www", "keywords": ["test"]}]}, {"Id": "174541486", "PostHistoryTypeId": "1", "PostId": "50610221", "RevisionGUID": "9961e3a3-3ddf-4abe-a8d6-d72ae9b6ab55", "CreationDate": "2018-05-30T17:14:20.440", "UserId": "4133463", "Text": "Terraform aws_spot_fleet_request iam_instance_profile", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "174541487", "PostHistoryTypeId": "3", "PostId": "50610221", "RevisionGUID": "9961e3a3-3ddf-4abe-a8d6-d72ae9b6ab55", "CreationDate": "2018-05-30T17:14:20.440", "UserId": "4133463", "Text": "<amazon-web-services><terraform><terraform-provider-aws>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "50610451", "PostTypeId": "2", "ParentId": "50610221", "CreationDate": "2018-05-30T17:28:58.173", "Score": "0", "Body": "<p>The instance profile is unrelated to the error. The error is saying this:</p>\n\n<pre><code>tags {\n       Name = \"spot-fleet-example\"\n     }\n</code></pre>\n\n<p>Part of the first example isnt recognized. You can read about what instance profiles are <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>An instance profile is a container for an IAM role that you can use to\n  pass role information to an EC2 instance when the instance starts.</p>\n</blockquote>\n", "OwnerUserId": "9797143", "LastActivityDate": "2018-05-30T17:28:58.173", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "174542468", "PostHistoryTypeId": "2", "PostId": "50610451", "RevisionGUID": "eaadc41b-1c5d-4387-b12b-5cb04ce114cc", "CreationDate": "2018-05-30T17:28:58.173", "UserId": "9797143", "Text": "The instance profile is unrelated to the error. The error is saying this:\r\n\r\n    tags {\r\n           Name = \"spot-fleet-example\"\r\n         }\r\nPart of the first example isnt recognized. You can read about what instance profiles are [here][1]:\r\n\r\n> An instance profile is a container for an IAM role that you can use to\r\n> pass role information to an EC2 instance when the instance starts.\r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "The instance profile is unrelated to the error. ", "keywords": ["instance"]}, {"source": "Text", "text": "You can read about what instance profiles are [here][1]: > An instance profile is a container for an IAM role that you can use to > pass role information to an EC2 instance when the instance starts. [1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html", "keywords": ["instance"]}]}], "filtered-sentences": [{"source": "Body", "text": "The instance profile is unrelated to the error. ", "keywords": ["instance"]}, {"source": "Body", "text": "You can read about what instance profiles are here: ", "keywords": ["instance"]}, {"source": "Body", "text": "An instance profile is a container for an IAM role that you can use to pass role information to an EC2 instance when the instance starts.", "keywords": ["instance"]}]}], "contains-topic": true, "filtered-sentences": []}