{"Id": "72506227", "PostTypeId": "1", "CreationDate": "2022-06-05T09:35:11.650", "Score": "1", "ViewCount": "2320", "Body": "<p>I read all aws articles. I followed each one by one. But it didn't work any of them. Let me briefly summarize my situation. I created EKS automation with terraform. 1 vpc, 3 public subnets, 3 private subnets, 3 security group, 1 nat gateway(on public), and 2 autoscaled worker node groups. I checked all infra which created with terraform. There are no problem.</p>\n<p>My main problem is that after the installation I can't see the nodes and nodes are not join to the cluster. I applied below steps but didn't worked. What should I do? By the way don't tag my question as a duplication I checked all similar questions on stackoverflow. My steps look true but does not work.</p>\n<blockquote>\n<p>kubectl get nodes</p>\n</blockquote>\n<pre><code>No resources found\n</code></pre>\n<p>Before checking node with above command.Firstly I applied below command for setting kubeconfig.</p>\n<pre><code>aws eks update-kubeconfig --name eks-DS7h --region us-east-1\n</code></pre>\n<p>Here my kubeconfig:</p>\n<pre><code>apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJfgzsfhadfzasdfrzsd.........\n    server: https://0F97E579A.gr7.us-east-1.eks.amazonaws.com\n  name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\ncontexts:\n- context:\n    cluster: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\n    user: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\n  name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\ncurrent-context: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\nkind: Config\npreferences: {}\nusers:\n- name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1beta1\n      args:\n      - --region\n      - us-east-1\n      - eks\n      - get-token\n      - --cluster-name\n      - eks-DS7h\n      command: aws\n</code></pre>\n<p>After this I checked the nodes again but I still get no resource found. Than I try to edit aws-auth. Before the edit I check my user on the terminal where I triggered all terraform steps installation.</p>\n<blockquote>\n<p>aws sts get-caller-identity</p>\n</blockquote>\n<pre><code>{\n    &quot;UserId&quot;: &quot;ASDFGSDFGDGSDGDFHSFDSDC&quot;,\n    &quot;Account&quot;: &quot;545153234644&quot;,\n    &quot;Arn&quot;: &quot;arn:aws:iam::545153234644:user/white&quot;\n}\n</code></pre>\n<p>I took my user info and I added blank mapuser area in aws-auth. But still getting <code>No resources found</code>.</p>\n<blockquote>\n<p>kubectl get cm -n kube-system aws-auth</p>\n</blockquote>\n<pre><code>apiVersion: v1\ndata:\n  mapAccounts: |\n    []\n  mapRoles: |\n    - &quot;groups&quot;:\n      - &quot;system:bootstrappers&quot;\n      - &quot;system:nodes&quot;\n      - &quot;system:masters&quot;\n      &quot;rolearn&quot;: &quot;arn:aws:iam::545153234644:role/eks-DS7h22060508195731770000000e&quot;\n      &quot;username&quot;: &quot;system:node:{{EC2PrivateDNSName}}&quot;\n  mapUsers: &quot;- \\&quot;userarn\\&quot;: \\&quot;arn:aws:iam::545153234644:user/white\\&quot;\\n  \\&quot;username\\&quot;:\n    \\&quot;white\\&quot;\\n  \\&quot;groups\\&quot;:\\n  - \\&quot;system:masters\\&quot;\\n  - \\&quot;system:nodes\\&quot;  \\n&quot;\nkind: ConfigMap\nmetadata:\n  creationTimestamp: &quot;2022-06-05T08:20:02Z&quot;\n  labels:\n    app.kubernetes.io/managed-by: Terraform\n    terraform.io/module: terraform-aws-modules.eks.aws\n  name: aws-auth\n  namespace: kube-system\n  resourceVersion: &quot;4976&quot;\n  uid: b12341-33ff-4f78-af0a-758f88\n</code></pre>\n<p>Oh also when I check EKS cluster on dashboard I see below warning too. I don't know is it relevant or not. I want to share it too maybe it will help.</p>\n<p><a href=\"https://i.stack.imgur.com/YfSSk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YfSSk.png\" alt=\"enter image description here\" /></a></p>\n", "OwnerUserId": "5681176", "LastEditorUserId": "5681176", "LastEditDate": "2022-06-05T09:43:46.490", "LastActivityDate": "2022-06-05T09:43:46.490", "Title": "EKS: can't see nodes and nodes are not join to the cluster", "Tags": "<amazon-web-services><kubernetes><terraform><amazon-eks>", "AnswerCount": "0", "CommentCount": "15", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "128083463", "PostId": "72506227", "Score": "0", "Text": "Do the worker nodes exist in the ASG(s) that you created for EKS?", "CreationDate": "2022-06-05T10:33:00.260", "UserId": "5343387", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "128083653", "PostId": "72506227", "Score": "0", "Text": "yea running and tagged like other services.", "CreationDate": "2022-06-05T10:51:44.223", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "128086799", "PostId": "72506227", "Score": "0", "Text": "Can you show the worker config? Is it a managed or unmanaged node group? The warning means the user your using to access the console is not the creator of the cluster and/or not present in the aws-auth configmap.", "CreationDate": "2022-06-05T15:18:48.613", "UserId": "1032785", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "The warning means the user your using to access the console is not the creator of the cluster and/or not present in the aws-auth configmap.", "keywords": ["cluster"]}]}, {"Id": "128105071", "PostId": "72506227", "Score": "0", "Text": "@jordanm I'm not sure, here is my code can you check please. [link](https://github.com/Daggerphobia/EKS) When I triggered terraform I'm not seeing any node group under EKS.  Terraform creating instances with incremental names. If I can succesfully attach it will not a problem.", "CreationDate": "2022-06-06T14:31:31.017", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "128105292", "PostId": "72506227", "Score": "0", "Text": "I see that you are specifying `worker_groups`, but I don't see that in the [docs](https://registry.terraform.io/modules/terraform-aws-modules/eks/aws/latest). Looks like that should be `self_managed_node_groups` or `eks_managed_node_groups`. Your userdata script also contains undefined variables.", "CreationDate": "2022-06-06T14:41:11.867", "UserId": "1032785", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "128105677", "PostId": "72506227", "Score": "0", "Text": "@jordanm maybe the problem is userdata. How should I change it?", "CreationDate": "2022-06-06T14:55:19.670", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "How should I change it?", "keywords": ["change"]}]}, {"Id": "128105718", "PostId": "72506227", "Score": "0", "Text": "Don't know, ive always used managed node groups. They don't have any extra cost so ive never had a reason not to.", "CreationDate": "2022-06-06T14:56:56.747", "UserId": "1032785", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "They don't have any extra cost so ive never had a reason not to.", "keywords": ["cost"]}]}, {"Id": "128105739", "PostId": "72506227", "Score": "0", "Text": "You probably need to change the userdata script to a template so you can inject those values into the userdata.", "CreationDate": "2022-06-06T14:58:03.327", "UserId": "1032785", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You probably need to change the userdata script to a template so you can inject those values into the userdata.", "keywords": ["change"]}]}, {"Id": "128105812", "PostId": "72506227", "Score": "0", "Text": "do u know any good managed node groups repo example? I will also try in that way", "CreationDate": "2022-06-06T15:00:39.680", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "128121484", "PostId": "72506227", "Score": "0", "Text": "@jordanm one more question do you know how can I open or create public ipv4 ip. I need to reach my app. https://github.com/terraform-aws-modules/terraform-aws-eks\nI check the repo but I couldnt find it.", "CreationDate": "2022-06-07T09:04:11.807", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "128128595", "PostId": "72506227", "Score": "0", "Text": "There are examples for managed node groups in the link you just provided. Public access to your cluster should be done via an ingress, through a load balancer created by aws-load-balancer-controller.", "CreationDate": "2022-06-07T14:19:32.450", "UserId": "1032785", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Public access to your cluster should be done via an ingress, through a load balancer created by aws-load-balancer-controller.", "keywords": ["cluster"]}]}, {"Id": "128147644", "PostId": "72506227", "Score": "0", "Text": "@jordanm Finally I managed to fix it. Like you said the problem is userdata undefined part. Please write an answer. I will mark it as anwer. By the way I have different problem right now. EKS working fine but I can't reach the app on browser. There are no ipv4 ip address. I don't want to add lb for cost problem. I want to expose on igw but when I checked the actual github repo which call main module from there. (also you mentioned above) They didn't define any igw in their code. So how can I add igw without broke the automation ffunctionality.", "CreationDate": "2022-06-08T10:14:35.247", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I don't want to add lb for cost problem. ", "keywords": ["cost"]}]}, {"Id": "128154608", "PostId": "72506227", "Score": "1", "Text": "Internet gateway is for outgoing traffic, not incoming traffic. A load balancer is half the cost of the EKS control plane. If you use an ingress like nginx or traefik, you can have one load balancer service all workloads.", "CreationDate": "2022-06-08T14:55:07.783", "UserId": "1032785", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "A load balancer is half the cost of the EKS control plane. ", "keywords": ["cost"]}]}, {"Id": "128175380", "PostId": "72506227", "Score": "0", "Text": "@jordanm can you copy the below code snippet and write as an answer please. I figured out because of you. Maybe someone will stuck in same point in the future. This will help them. When you post it I will delete this comment.\n`MIME-Version: 1.0\nContent-Type: multipart/mixed; boundary=\"==MYBOUNDARY==\"\n\n--==MYBOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -ex\n/etc/eks/bootstrap.sh ${CLUSTER_NAME} --b64-cluster-ca ${B64_CLUSTER_CA} --apiserver-endpoint ${API_SERVER_URL}\n\n--==MYBOUNDARY==--\\`", "CreationDate": "2022-06-09T11:56:49.537", "UserId": "5681176", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "`MIME-Version: 1.0 Content-Type: multipart/mixed; boundary=\"==MYBOUNDARY==\" --==MYBOUNDARY== Content-Type: text/x-shellscript; charset=\"us-ascii\" #!/bin/bash set -ex /etc/eks/bootstrap.sh ${CLUSTER_NAME} --b64-cluster-ca ${B64_CLUSTER_CA} --apiserver-endpoint ${API_SERVER_URL} --==MYBOUNDARY==--\\", "keywords": ["cluster"]}]}, {"Id": "131141148", "PostId": "72506227", "Score": "0", "Text": "Try steps from https://stackoverflow.com/questions/73868433/worker-node-group-doesnt-join-the-eks-cluster/74278536#74278536", "CreationDate": "2022-11-01T19:23:21.157", "UserId": "481275", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Try steps from https://stackoverflow.com/questions/73868433/worker-node-group-doesnt-join-the-eks-cluster/74278536#74278536", "keywords": ["cluster"]}]}], "links": [{"Id": "2010811570", "CreationDate": "2022-11-01T19:23:21.157", "PostId": "72506227", "RelatedPostId": "73868433", "LinkTypeId": "1"}], "history": [{"Id": "271607968", "PostHistoryTypeId": "2", "PostId": "72506227", "RevisionGUID": "c4025c0a-f958-477c-9b8b-8e25e966109c", "CreationDate": "2022-06-05T09:35:11.650", "UserId": "5681176", "Text": "I read all aws articles. I followed each one by one. But it didn't work any of them. Let me briefly summarize my situation. I created EKS automation with terraform. 1 vpc, 3 public subnets, 3 private subnets, 3 security group, 1 nat gateway(on public), and 2 autoscaled worker node groups. I checked all infra which created with terraform. There are no problem.\r\n\r\nMy main problem is that after the installation I can't see the nodes and nodes are not join to the cluster. I applied below steps but didn't worked. What should I do? By the way don't tag my question as a duplication I checked all similar questions on stackoverflow. My steps look true but does not work.\r\n\r\n>kubectl get nodes\r\n\r\n    No resources found\r\n\r\n\r\nBefore checking node with above command.Firstly I applied below command for setting kubeconfig.\r\n\r\n    aws eks update-kubeconfig --name eks-DS7h --region us-east-1\r\n\r\nHere my kubeconfig:\r\n\r\n    apiVersion: v1\r\n    clusters:\r\n    - cluster:\r\n        certificate-authority-data: LS0tLS1CRUdJfgzsfhadfzasdfrzsd.........\r\n        server: https://0F97E579A.gr7.us-east-1.eks.amazonaws.com\r\n      name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n    contexts:\r\n    - context:\r\n        cluster: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n        user: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n      name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n    current-context: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n    kind: Config\r\n    preferences: {}\r\n    users:\r\n    - name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n      user:\r\n        exec:\r\n          apiVersion: client.authentication.k8s.io/v1beta1\r\n          args:\r\n          - --region\r\n          - us-east-1\r\n          - eks\r\n          - get-token\r\n          - --cluster-name\r\n          - eks-DS7h\r\n          command: aws\r\n\r\n\r\nAfter this I checked the nodes again but I still get no resource found. Than I try to edit aws-auth. Before the edit I check my user on the terminal where I triggered all terraform steps installation.\r\n\r\n\r\n>aws sts get-caller-identity\r\n\r\n    {\r\n        \"UserId\": \"ASDFGSDFGDGSDGDFHSFDSDC\",\r\n        \"Account\": \"545153234644\",\r\n        \"Arn\": \"arn:aws:iam::545153234644:user/white\"\r\n    }\r\n\r\n\r\nI took my user info and I added blank mapuser area in aws-auth. But still getting `No resources found`.\r\n\r\n>kubectl get cm -n kube-system aws-auth\r\n\r\n    apiVersion: v1\r\n    data:\r\n      mapAccounts: |\r\n        []\r\n      mapRoles: |\r\n        - \"groups\":\r\n          - \"system:bootstrappers\"\r\n          - \"system:nodes\"\r\n          - \"system:masters\"\r\n          \"rolearn\": \"arn:aws:iam::545153234644:role/eks-DS7h22060508195731770000000e\"\r\n          \"username\": \"system:node:{{EC2PrivateDNSName}}\"\r\n      mapUsers: \"- \\\"userarn\\\": \\\"arn:aws:iam::545153234644:user/white\\\"\\n  \\\"username\\\":\r\n        \\\"white\\\"\\n  \\\"groups\\\":\\n  - \\\"system:masters\\\"\\n  - \\\"system:nodes\\\"  \\n\"\r\n    kind: ConfigMap\r\n    metadata:\r\n      creationTimestamp: \"2022-06-05T08:20:02Z\"\r\n      labels:\r\n        app.kubernetes.io/managed-by: Terraform\r\n        terraform.io/module: terraform-aws-modules.eks.aws\r\n      name: aws-auth\r\n      namespace: kube-system\r\n      resourceVersion: \"4976\"\r\n      uid: b12341-33ff-4f78-af0a-758f88\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I created EKS automation with terraform. 1 vpc, 3 public subnets, 3 private subnets, 3 security group, 1 nat gateway(on public), and 2 autoscaled worker node groups. ", "keywords": ["nat"]}, {"source": "Text", "text": "My main problem is that after the installation I can't see the nodes and nodes are not join to the cluster. ", "keywords": ["cluster"]}, {"source": "Text", "text": "Firstly I applied below command for setting kubeconfig. aws eks update-kubeconfig --name eks-DS7h --region us-east-1 Here my kubeconfig: apiVersion: v1 clusters: - cluster: certificate-authority-data: LS0tLS1CRUdJfgzsfhadfzasdfrzsd......... server: https://0F97E579A.gr7.us-east-1.eks.amazonaws.com name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h contexts: - context: cluster: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h user: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h current-context: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h kind: Config preferences: {} users: - name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h user: exec: apiVersion: client.authentication.k8s.io/v1beta1 args: - --region - us-east-1 - eks - get-token - --cluster-name - eks-DS7h command: aws After this I checked the nodes again but I still get no resource found. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I took my user info and I added blank mapuser area in aws-auth. ", "keywords": ["area"]}]}, {"Id": "271607970", "PostHistoryTypeId": "1", "PostId": "72506227", "RevisionGUID": "c4025c0a-f958-477c-9b8b-8e25e966109c", "CreationDate": "2022-06-05T09:35:11.650", "UserId": "5681176", "Text": "EKS: can't see nodes and nodes are not join to the cluster", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "EKS: can't see nodes and nodes are not join to the cluster", "keywords": ["cluster"]}]}, {"Id": "271607971", "PostHistoryTypeId": "3", "PostId": "72506227", "RevisionGUID": "c4025c0a-f958-477c-9b8b-8e25e966109c", "CreationDate": "2022-06-05T09:35:11.650", "UserId": "5681176", "Text": "<amazon-web-services><kubernetes><terraform><amazon-eks>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "271608268", "PostHistoryTypeId": "5", "PostId": "72506227", "RevisionGUID": "7c315cfb-7b30-4e60-8295-186acc10e7c7", "CreationDate": "2022-06-05T09:43:46.490", "UserId": "5681176", "Comment": "added 238 characters in body", "Text": "I read all aws articles. I followed each one by one. But it didn't work any of them. Let me briefly summarize my situation. I created EKS automation with terraform. 1 vpc, 3 public subnets, 3 private subnets, 3 security group, 1 nat gateway(on public), and 2 autoscaled worker node groups. I checked all infra which created with terraform. There are no problem.\r\n\r\nMy main problem is that after the installation I can't see the nodes and nodes are not join to the cluster. I applied below steps but didn't worked. What should I do? By the way don't tag my question as a duplication I checked all similar questions on stackoverflow. My steps look true but does not work.\r\n\r\n>kubectl get nodes\r\n\r\n    No resources found\r\n\r\n\r\nBefore checking node with above command.Firstly I applied below command for setting kubeconfig.\r\n\r\n    aws eks update-kubeconfig --name eks-DS7h --region us-east-1\r\n\r\nHere my kubeconfig:\r\n\r\n    apiVersion: v1\r\n    clusters:\r\n    - cluster:\r\n        certificate-authority-data: LS0tLS1CRUdJfgzsfhadfzasdfrzsd.........\r\n        server: https://0F97E579A.gr7.us-east-1.eks.amazonaws.com\r\n      name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n    contexts:\r\n    - context:\r\n        cluster: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n        user: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n      name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n    current-context: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n    kind: Config\r\n    preferences: {}\r\n    users:\r\n    - name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h\r\n      user:\r\n        exec:\r\n          apiVersion: client.authentication.k8s.io/v1beta1\r\n          args:\r\n          - --region\r\n          - us-east-1\r\n          - eks\r\n          - get-token\r\n          - --cluster-name\r\n          - eks-DS7h\r\n          command: aws\r\n\r\n\r\nAfter this I checked the nodes again but I still get no resource found. Than I try to edit aws-auth. Before the edit I check my user on the terminal where I triggered all terraform steps installation.\r\n\r\n\r\n>aws sts get-caller-identity\r\n\r\n    {\r\n        \"UserId\": \"ASDFGSDFGDGSDGDFHSFDSDC\",\r\n        \"Account\": \"545153234644\",\r\n        \"Arn\": \"arn:aws:iam::545153234644:user/white\"\r\n    }\r\n\r\n\r\nI took my user info and I added blank mapuser area in aws-auth. But still getting `No resources found`.\r\n\r\n>kubectl get cm -n kube-system aws-auth\r\n\r\n    apiVersion: v1\r\n    data:\r\n      mapAccounts: |\r\n        []\r\n      mapRoles: |\r\n        - \"groups\":\r\n          - \"system:bootstrappers\"\r\n          - \"system:nodes\"\r\n          - \"system:masters\"\r\n          \"rolearn\": \"arn:aws:iam::545153234644:role/eks-DS7h22060508195731770000000e\"\r\n          \"username\": \"system:node:{{EC2PrivateDNSName}}\"\r\n      mapUsers: \"- \\\"userarn\\\": \\\"arn:aws:iam::545153234644:user/white\\\"\\n  \\\"username\\\":\r\n        \\\"white\\\"\\n  \\\"groups\\\":\\n  - \\\"system:masters\\\"\\n  - \\\"system:nodes\\\"  \\n\"\r\n    kind: ConfigMap\r\n    metadata:\r\n      creationTimestamp: \"2022-06-05T08:20:02Z\"\r\n      labels:\r\n        app.kubernetes.io/managed-by: Terraform\r\n        terraform.io/module: terraform-aws-modules.eks.aws\r\n      name: aws-auth\r\n      namespace: kube-system\r\n      resourceVersion: \"4976\"\r\n      uid: b12341-33ff-4f78-af0a-758f88\r\n\r\nOh also when I check EKS cluster on dashboard I see below warning too. I don't know is it relevant or not. I want to share it too maybe it will help.\r\n\r\n[![enter image description here][1]][1]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/YfSSk.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I created EKS automation with terraform. 1 vpc, 3 public subnets, 3 private subnets, 3 security group, 1 nat gateway(on public), and 2 autoscaled worker node groups. ", "keywords": ["nat"]}, {"source": "Text", "text": "My main problem is that after the installation I can't see the nodes and nodes are not join to the cluster. ", "keywords": ["cluster"]}, {"source": "Text", "text": "Firstly I applied below command for setting kubeconfig. aws eks update-kubeconfig --name eks-DS7h --region us-east-1 Here my kubeconfig: apiVersion: v1 clusters: - cluster: certificate-authority-data: LS0tLS1CRUdJfgzsfhadfzasdfrzsd......... server: https://0F97E579A.gr7.us-east-1.eks.amazonaws.com name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h contexts: - context: cluster: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h user: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h current-context: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h kind: Config preferences: {} users: - name: arn:aws:eks:us-east-1:545153234644:cluster/eks-DS7h user: exec: apiVersion: client.authentication.k8s.io/v1beta1 args: - --region - us-east-1 - eks - get-token - --cluster-name - eks-DS7h command: aws After this I checked the nodes again but I still get no resource found. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I took my user info and I added blank mapuser area in aws-auth. ", "keywords": ["area"]}, {"source": "Text", "text": ">kubectl get cm -n kube-system aws-auth apiVersion: v1 data: mapAccounts: | [] mapRoles: | - \"groups\": - \"system:bootstrappers\" - \"system:nodes\" - \"system:masters\" \"rolearn\": \"arn:aws:iam::545153234644:role/eks-DS7h22060508195731770000000e\" \"username\": \"system:node:{{EC2PrivateDNSName}}\" mapUsers: \"- \\\"userarn\\\": \\\"arn:aws:iam::545153234644:user/white\\\"\\n \\\"username\\\": \\\"white\\\"\\n \\\"groups\\\":\\n - \\\"system:masters\\\"\\n - \\\"system:nodes\\\" \\n\" kind: ConfigMap metadata: creationTimestamp: \"2022-06-05T08:20:02Z\" labels: app.kubernetes.io/managed-by: Terraform terraform.io/module: terraform-aws-modules.eks.aws name: aws-auth namespace: kube-system resourceVersion: \"4976\" uid: b12341-33ff-4f78-af0a-758f88 Oh also when I check EKS cluster on dashboard I see below warning too. ", "keywords": ["cluster"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "EKS: can't see nodes and nodes are not join to the cluster", "keywords": ["cluster"]}, {"source": "Body", "text": "I created EKS automation with terraform. 1 vpc, 3 public subnets, 3 private subnets, 3 security group, 1 nat gateway(on public), and 2 autoscaled worker node groups. ", "keywords": ["nat"]}, {"source": "Body", "text": "My main problem is that after the installation I can't see the nodes and nodes are not join to the cluster. ", "keywords": ["cluster"]}, {"source": "Body", "text": "aws sts get-caller-identity I took my user info and I added blank mapuser area in aws-auth. ", "keywords": ["area"]}, {"source": "Body", "text": "But still getting No resources found. kubectl get cm -n kube-system aws-auth Oh also when I check EKS cluster on dashboard I see below warning too. ", "keywords": ["cluster"]}]}