{"Id": "69746439", "PostTypeId": "1", "AcceptedAnswerId": "69748128", "CreationDate": "2021-10-27T23:06:14.223", "Score": "1", "ViewCount": "719", "Body": "<p>I am struggling to find a way to include all load balancers with certain tag value's (e.g. Shield protection = ON) in an aws account.\nCurrently i have a map of arn's in a variable and running a for loop. This method work's but not in an efficient way; since every time I have to add the ARN of a new Load balancer manually.</p>\n<pre><code>resource &quot;aws_shield_protection&quot; &quot;this&quot; {\n  for_each = var.listofarn\n\n  name         = &quot;shield protection&quot;.each.key\n  resource_arn = each.key\n}\n\nvariable listofarn {\n  type = map(string)\n  default = {\n  appx_alb=&quot;arn::xxxxx&quot;\n  appy_alb=&quot;arn:yyyyy&quot;\n }\n}\n</code></pre>\n<p>Is there a way to use data resource &quot;aws_lb&quot;.\nthanks.</p>\n", "OwnerUserId": "9628112", "LastActivityDate": "2021-10-28T03:56:55.473", "Title": "aws_shield_protection Terraform", "Tags": "<amazon-web-services><terraform><terraform-provider-aws><aws-cdk>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "256769960", "PostHistoryTypeId": "2", "PostId": "69746439", "RevisionGUID": "cfc96b54-57ec-45d3-8bc2-20da4f636814", "CreationDate": "2021-10-27T23:06:14.223", "UserId": "9628112", "Text": "I am struggling to find a way to include all load balancers with certain tag value's (e.g. Shield protection = ON) in an aws account.\r\nCurrently i have a map of arn's in a variable and running a for loop. This method work's but not in an efficient way; since every time I have to add the ARN of a new Load balancer manually.\r\n\r\n```\r\nresource \"aws_shield_protection\" \"this\" {\r\n  for_each = var.listofarn\r\n\r\n  name         = \"shield protection\".each.key\r\n  resource_arn = each.key\r\n}\r\n\r\nvariable listofarn {\r\n  type = map(string)\r\n  default = {\r\n  appx_alb=\"arn::xxxxx\"\r\n  appy_alb=\"arn:yyyyy\"\r\n }\r\n}\r\n````\r\nIs there a way to use data resource \"aws_lb\".\r\nthanks. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This method work's but not in an efficient way; since every time I have to add the ARN of a new Load balancer manually. ", "keywords": ["efficient"]}]}, {"Id": "256769962", "PostHistoryTypeId": "1", "PostId": "69746439", "RevisionGUID": "cfc96b54-57ec-45d3-8bc2-20da4f636814", "CreationDate": "2021-10-27T23:06:14.223", "UserId": "9628112", "Text": "aws_shield_protection Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "256769963", "PostHistoryTypeId": "3", "PostId": "69746439", "RevisionGUID": "cfc96b54-57ec-45d3-8bc2-20da4f636814", "CreationDate": "2021-10-27T23:06:14.223", "UserId": "9628112", "Text": "<amazon-web-services><terraform><terraform-provider-aws><aws-cdk>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "69748128", "PostTypeId": "2", "ParentId": "69746439", "CreationDate": "2021-10-28T03:56:55.473", "Score": "1", "Body": "<p>Using data source <strong>wouldn't help much</strong>. <code>aws_lb</code> data source can only return <strong>one alb</strong>. You can't use it to get information about all your ALBs. You would have to run the <code>aws_lb</code> data source in a for_loop with tags or some ALB id.</p>\n<p>But you could overcome your issue through development of an <a href=\"https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data_source\" rel=\"nofollow noreferrer\">external data source</a>. Since its a fully custom data source, it can return information about all your ALBs in the form you want.</p>\n", "OwnerUserId": "248823", "LastActivityDate": "2021-10-28T03:56:55.473", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "123310821", "PostId": "69748128", "Score": "0", "Text": "Thanks Marcin for the reply; are there any examples that resembles this problem & you can share for the external data source. Terraform documentation does help much.", "CreationDate": "2021-10-28T21:19:51.060", "UserId": "9628112", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "256779249", "PostHistoryTypeId": "2", "PostId": "69748128", "RevisionGUID": "13935279-b6b8-4ebe-8cad-63e80d3cd2d2", "CreationDate": "2021-10-28T03:56:55.473", "UserId": "248823", "Text": "Using data source **wouldn't help much**. `aws_lb` data source can only return **one alb**. You can't use it to get information about all your ALBs. You would have to run the `aws_lb` data source in a for_loop with tags or some ALB id. \r\n\r\nBut you could overcome your issue through development of an [external data source](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data_source). Since its a fully custom data source, it can return information about all your ALBs in the form you want. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "This method work's but not in an efficient way; since every time I have to add the ARN of a new Load balancer manually. ", "keywords": ["efficient"]}]}