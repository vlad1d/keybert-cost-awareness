{"Id": "34029717", "PostTypeId": "1", "CreationDate": "2015-12-01T20:41:37.470", "Score": "0", "ViewCount": "242", "Body": "<p>I would like to create an ELB the spans three subnets and then to somehow configure three listeners that will forward ELB traffic to only instances on each subnet. Is there a way to do this without layering ELBs (1 ELB -> 3 subnet specific ELBs -> instances)?</p>\n\n<p>To be more descriptive, I want 3 RabbitMQ clusters in 3 different subnets. Messages should be able to be arbitrarily published to any of the RMQ instances through an ELB. However, I would also like to be able to access the admin web consoles for each individual cluster through the ELB where the cluster is specified by using a different ELB port. In the [disfavored] multi-tier ELB configuration I described above, the main ELB would be used to publish messages and then the 3 subnet specific ELBs would be accessed when viewing the admin console.</p>\n\n<p>Here is an example Terraform ELB resource that I'm currently using that has one listener that will forward to any instance in any of the subnets but I would like to have 3 listeners with 3 different lb_ports that forward to only instances on one of the 3 subnets:</p>\n\n<pre><code>resource \"aws_elb\" \"rabbit-elb\" {\n  name = \"${var.short_name}-rmq-elb\"\n  security_groups = [\"${split(\",\", var.security_groups)}\"]\n  subnets = [\"${split(\",\",var.rabbit_subnets)}\"]\n  instances = [\"${aws_instance.rabbitmq.*.id}\"]\n  internal = \"true\"\n  cross_zone_load_balancing = true\n\n  listener {\n    instance_port = \"${var.elb_port_http}\"\n    instance_protocol = \"http\"\n    lb_port = \"${var.elb_lb_port_http}\"\n    lb_protocol = \"http\"\n  }\n}\n</code></pre>\n", "OwnerUserId": "2507838", "LastActivityDate": "2015-12-01T20:41:37.470", "Title": "AWS - Is it possible to create subnet specific ELB Listeners?", "Tags": "<amazon-web-services><amazon-ec2><terraform>", "AnswerCount": "0", "CommentCount": "4", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "55820402", "PostId": "34029717", "Score": "1", "Text": "Why don't you just access admin web console directly, skipping the ELB?", "CreationDate": "2015-12-01T23:57:57.850", "UserId": "1145196", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "55824806", "PostId": "34029717", "Score": "0", "Text": "That is just one example. Regardless of the reason, I want to be able to target a specific cluster when the clusters are separated by subnet/AZ.", "CreationDate": "2015-12-02T04:09:04.237", "UserId": "2507838", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Regardless of the reason, I want to be able to target a specific cluster when the clusters are separated by subnet/AZ.", "keywords": ["cluster"]}]}, {"Id": "55837897", "PostId": "34029717", "Score": "1", "Text": "I see. If you need to target different set of instances, you will need a new ELB. Or use more configurable load balancer such as nginx/HAproxy (for the purpose of accessing admin web console it can run on cheap/free micro instance)", "CreationDate": "2015-12-02T11:32:08.517", "UserId": "1145196", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Or use more configurable load balancer such as nginx/HAproxy (for the purpose of accessing admin web console it can run on cheap/free micro instance)", "keywords": ["cheap", "instance"]}]}, {"Id": "55850643", "PostId": "34029717", "Score": "0", "Text": "That's pretty much what I thought. Thanks for your help!", "CreationDate": "2015-12-02T16:35:40.483", "UserId": "2507838", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "history": [{"Id": "105401147", "PostHistoryTypeId": "2", "PostId": "34029717", "RevisionGUID": "54664eeb-ba28-4b0f-8d35-d18d9f02bc5d", "CreationDate": "2015-12-01T20:41:37.470", "UserId": "2507838", "Text": "I would like to create an ELB the spans three subnets and then to somehow configure three listeners that will forward ELB traffic to only instances on each subnet. Is there a way to do this without layering ELBs (1 ELB -> 3 subnet specific ELBs -> instances)?\r\n\r\nTo be more descriptive, I want 3 RabbitMQ clusters in 3 different subnets. Messages should be able to be arbitrarily published to any of the RMQ instances through an ELB. However, I would also like to be able to access the admin web consoles for each individual cluster through the ELB where the cluster is specified by using a different ELB port. In the [disfavored] multi-tier ELB configuration I described above, the main ELB would be used to publish messages and then the 3 subnet specific ELBs would be accessed when viewing the admin console.\r\n\r\nHere is an example Terraform ELB resource that I'm currently using that has one listener that will forward to any instance in any of the subnets but I would like to have 3 listeners with 3 different lb_ports that forward to only instances on one of the 3 subnets:\r\n\r\n    resource \"aws_elb\" \"rabbit-elb\" {\r\n      name = \"${var.short_name}-rmq-elb\"\r\n      security_groups = [\"${split(\",\", var.security_groups)}\"]\r\n      subnets = [\"${split(\",\",var.rabbit_subnets)}\"]\r\n      instances = [\"${aws_instance.rabbitmq.*.id}\"]\r\n      internal = \"true\"\r\n      cross_zone_load_balancing = true\r\n    \r\n      listener {\r\n        instance_port = \"${var.elb_port_http}\"\r\n        instance_protocol = \"http\"\r\n        lb_port = \"${var.elb_lb_port_http}\"\r\n        lb_protocol = \"http\"\r\n      }\r\n    }", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "However, I would also like to be able to access the admin web consoles for each individual cluster through the ELB where the cluster is specified by using a different ELB port. ", "keywords": ["cluster"]}, {"source": "Text", "text": "Here is an example Terraform ELB resource that I'm currently using that has one listener that will forward to any instance in any of the subnets but I would like to have 3 listeners with 3 different lb_ports that forward to only instances on one of the 3 subnets: resource \"aws_elb\" \"rabbit-elb\" { name = \"${var.short_name}-rmq-elb\" security_groups = [\"${split(\",\", var.security_groups)}\"] subnets = [\"${split(\",\",var.rabbit_subnets)}\"] instances = [\"${aws_instance.rabbitmq.*.id}\"] internal = \"true\" cross_zone_load_balancing = true listener { instance_port = \"${var.elb_port_http}\" instance_protocol = \"http\" lb_port = \"${var.elb_lb_port_http}\" lb_protocol = \"http\" } }", "keywords": ["instance"]}]}, {"Id": "105401148", "PostHistoryTypeId": "1", "PostId": "34029717", "RevisionGUID": "54664eeb-ba28-4b0f-8d35-d18d9f02bc5d", "CreationDate": "2015-12-01T20:41:37.470", "UserId": "2507838", "Text": "AWS - Is it possible to create subnet specific ELB Listeners?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "105401149", "PostHistoryTypeId": "3", "PostId": "34029717", "RevisionGUID": "54664eeb-ba28-4b0f-8d35-d18d9f02bc5d", "CreationDate": "2015-12-01T20:41:37.470", "UserId": "2507838", "Text": "<amazon-web-services><amazon-ec2><terraform>", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "However, I would also like to be able to access the admin web consoles for each individual cluster through the ELB where the cluster is specified by using a different ELB port. ", "keywords": ["cluster"]}, {"source": "Body", "text": "Here is an example Terraform ELB resource that I'm currently using that has one listener that will forward to any instance in any of the subnets but I would like to have 3 listeners with 3 different lb_ports that forward to only instances on one of the 3 subnets:", "keywords": ["instance"]}]}