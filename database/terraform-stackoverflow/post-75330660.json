{"Id": "75330660", "PostTypeId": "1", "CreationDate": "2023-02-03T01:38:12.577", "Score": "0", "ViewCount": "197", "Body": "<p>I'm trying to create a mechanism so that I use terraform backend to upload the state to a S3, so that my teammate can use my terraform state to resume my work. This is my setup:</p>\n<pre><code>terraform {\n  backend &quot;s3&quot; {\n    bucket         = &quot;username-terraform-state&quot;\n    key            = &quot;billow/terraform.tfstate&quot;\n    region         = &quot;us-west-2&quot;\n    dynamodb_table = &quot;username-terraform-state-test-locks&quot;\n    encrypt        = true\n  }\n}\n\ndata &quot;terraform_remote_state&quot; &quot;network&quot; {\n  backend = &quot;s3&quot;\n  config = {\n    bucket = &quot;username-terraform-state&quot;\n    key    = &quot;billow/terraform.tfstate&quot;\n    region = var.region\n  }\n}\n</code></pre>\n<p>With this setup, I have two folders in the S3 bucket. One is <code>billow/</code> with a <code>terraform.tfstate</code> file. There's another folder <code>env:/remote_s3/billow/</code> (<code>remote_s3</code> is the name of my terraform workspace) with another <code>terraform.tfstate</code>. Both of them are updated also when I execute a <code>terraform import</code> command.</p>\n<p>What I want is when I create a new workspace, I would be able to pull the state file from existing folder in the bucket, and continue the project. The step I took was placing the same <code>.tf</code> file in the directory and run <code>terraform init</code>, <code>terraform refresh</code> and then <code>terraform state pull</code> to pull the state file. However, this only pulls an empty state file, and I would need to re-import all the resources again.</p>\n<p>So here are my two questions:</p>\n<ol>\n<li>Why are there two folders in the bucket? I thought with my backend setup there should be only one of them.</li>\n<li>What should I do to make it so that when I set up a new terraform workspace, I would be able to import the whole state file from my previously saved terraform state?</li>\n</ol>\n<p>Thanks!</p>\n", "OwnerUserId": "6472650", "LastActivityDate": "2023-02-03T01:38:12.577", "Title": "Unable to pull terraform state from AWS-S3", "Tags": "<terraform>", "AnswerCount": "0", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "287358302", "PostHistoryTypeId": "2", "PostId": "75330660", "RevisionGUID": "f62f14f8-827b-4d07-af69-cf46e5463841", "CreationDate": "2023-02-03T01:38:12.577", "UserId": "6472650", "Text": "I'm trying to create a mechanism so that I use terraform backend to upload the state to a S3, so that my teammate can use my terraform state to resume my work. This is my setup: \r\n```\r\nterraform {\r\n  backend \"s3\" {\r\n    bucket         = \"username-terraform-state\"\r\n    key            = \"billow/terraform.tfstate\"\r\n    region         = \"us-west-2\"\r\n    dynamodb_table = \"username-terraform-state-test-locks\"\r\n    encrypt        = true\r\n  }\r\n}\r\n\r\ndata \"terraform_remote_state\" \"network\" {\r\n  backend = \"s3\"\r\n  config = {\r\n    bucket = \"username-terraform-state\"\r\n    key    = \"billow/terraform.tfstate\"\r\n    region = var.region\r\n  }\r\n}\r\n```\r\nWith this setup, I have two folders in the S3 bucket. One is `billow/` with a `terraform.tfstate` file. There's another folder `env:/remote_s3/billow/` (`remote_s3` is the name of my terraform workspace) with another `terraform.tfstate`. Both of them are updated also when I execute a `terraform import` command.\r\n\r\nWhat I want is when I create a new workspace, I would be able to pull the state file from existing folder in the bucket, and continue the project. The step I took was placing the same `.tf` file in the directory and run `terraform init`, `terraform refresh` and then `terraform state pull` to pull the state file. However, this only pulls an empty state file, and I would need to re-import all the resources again.\r\n\r\nSo here are my two questions:\r\n1. Why are there two folders in the bucket? I thought with my backend setup there should be only one of them. \r\n2. What should I do to make it so that when I set up a new terraform workspace, I would be able to import the whole state file from my previously saved terraform state?\r\n\r\nThanks!", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This is my setup: ``` terraform { backend \"s3\" { bucket = \"username-terraform-state\" key = \"billow/terraform.tfstate\" region = \"us-west-2\" dynamodb_table = \"username-terraform-state-test-locks\" encrypt = true } } data \"terraform_remote_state\" \"network\" { backend = \"s3\" config = { bucket = \"username-terraform-state\" key = \"billow/terraform.tfstate\" region = var.region } } ``` ", "keywords": ["bill", "test"]}, {"source": "Text", "text": "One is `billow/` with a `terraform.tfstate` file. ", "keywords": ["bill"]}, {"source": "Text", "text": "There's another folder `env:/remote_s3/billow/` (`remote_s3` is the name of my terraform workspace) with another `terraform.tfstate`. ", "keywords": ["bill"]}]}, {"Id": "287358304", "PostHistoryTypeId": "1", "PostId": "75330660", "RevisionGUID": "f62f14f8-827b-4d07-af69-cf46e5463841", "CreationDate": "2023-02-03T01:38:12.577", "UserId": "6472650", "Text": "Unable to pull terraform state from AWS-S3", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "287358305", "PostHistoryTypeId": "3", "PostId": "75330660", "RevisionGUID": "f62f14f8-827b-4d07-af69-cf46e5463841", "CreationDate": "2023-02-03T01:38:12.577", "UserId": "6472650", "Text": "<terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "One is billow/ with a terraform.tfstate file. ", "keywords": ["bill"]}, {"source": "Body", "text": "There's another folder env:/remote_s3/billow/ (remote_s3 is the name of my terraform workspace) with another terraform.tfstate. ", "keywords": ["bill"]}]}