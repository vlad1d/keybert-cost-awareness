{"Id": "77011214", "PostTypeId": "1", "CreationDate": "2023-08-30T20:02:35.613", "Score": "0", "ViewCount": "24", "Body": "<p>I have an NPM package that deploys CDK resources and Lambda JavaScript runtime code (compiled from TS). Exactly the same runtime code is used in a separate Terraform module. What would be the most efficient way to share the runtime code between the projects?</p>\n<p>Also preferably whenever new version of NPM package is published - new release of terraform should be created with latest runtime code.</p>\n<p>I could probably do something like upload compiled code to an S3 bucket whenever package is published by CI/CD but this adds a whole new level of complexity - including permissions for the module to download the code etc. There has to be a simpler way.</p>\n", "OwnerUserId": "961695", "LastActivityDate": "2023-08-31T15:32:59.690", "Title": "Share runtime code between CDK package and Terraform module", "Tags": "<aws-lambda><terraform><runtime><share><aws-cdk>", "AnswerCount": "1", "CommentCount": "1", "ClosedDate": "2023-08-31T21:32:53.190", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "135766514", "PostId": "77011214", "Score": "1", "Text": "You'd have to separate the lifecycle of the runtime code - have a separate CI process for it, then pull from a shared source in both versions. Lots of ways to do it, though, this question will likely be closed due to being opinion-based.", "CreationDate": "2023-08-31T08:58:07.257", "UserId": "10418515", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "297302315", "PostHistoryTypeId": "2", "PostId": "77011214", "RevisionGUID": "9b5b7f48-6ab4-458f-a223-e28e3dd7fa5e", "CreationDate": "2023-08-30T20:02:35.613", "UserId": "961695", "Text": "I have an NPM package that deploys CDK resources and Lambda JavaScript runtime code (compiled from TS). Exactly the same runtime code is used in a separate Terraform module. What would be the most efficient way to share the runtime code between the projects?\r\n\r\nAlso preferably whenever new version of NPM package is published - new release of terraform should be created with latest runtime code.\r\n\r\nI could probably do something like upload compiled code to an S3 bucket whenever package is published by CI/CD but this adds a whole new level of complexity - including permissions for the module to download the code etc. There has to be a simpler way. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "What would be the most efficient way to share the runtime code between the projects? ", "keywords": ["efficient"]}]}, {"Id": "297302317", "PostHistoryTypeId": "1", "PostId": "77011214", "RevisionGUID": "9b5b7f48-6ab4-458f-a223-e28e3dd7fa5e", "CreationDate": "2023-08-30T20:02:35.613", "UserId": "961695", "Text": "Share runtime code between CDK package and Terraform module", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "297302318", "PostHistoryTypeId": "3", "PostId": "77011214", "RevisionGUID": "9b5b7f48-6ab4-458f-a223-e28e3dd7fa5e", "CreationDate": "2023-08-30T20:02:35.613", "UserId": "961695", "Text": "<aws-lambda><terraform><runtime><share><aws-cdk>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "297349334", "PostHistoryTypeId": "10", "PostId": "77011214", "RevisionGUID": "c4b928b0-1818-4072-b128-57904b7c731f", "CreationDate": "2023-08-31T21:32:53.190", "UserId": "-1", "Comment": "105", "Text": "{\"Voters\":[{\"Id\":8343484,\"DisplayName\":\"Marko E\"},{\"Id\":2756409,\"DisplayName\":\"TylerH\"},{\"Id\":16217248,\"DisplayName\":\"user16217248\"}]}", "filtered-sentences": []}], "answers": [{"Id": "77017313", "PostTypeId": "2", "ParentId": "77011214", "CreationDate": "2023-08-31T15:32:59.690", "Score": "0", "Body": "<p>I think I found a reasonable compromise that would work.</p>\n<ol>\n<li>Combine to projects (CDK and terraform) into one repo - this way runtime code can be easily shared</li>\n<li>For lambda runtime code switch it from TypeScript to JavaScript, so no compiling is involved, and both CDK lambda, and terraform lambda can reference the code assets directly.</li>\n<li>Same GitHub action that automatically publish the NPM package will also create a new release for the terraform module under the same version.</li>\n</ol>\n", "OwnerUserId": "961695", "LastActivityDate": "2023-08-31T15:32:59.690", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "297337285", "PostHistoryTypeId": "2", "PostId": "77017313", "RevisionGUID": "4d7828f9-e61a-414c-b410-9d6425f4be8c", "CreationDate": "2023-08-31T15:32:59.690", "UserId": "961695", "Text": "I think I found a reasonable compromise that would work.\r\n\r\n1. Combine to projects (CDK and terraform) into one repo - this way runtime code can be easily shared\r\n2. For lambda runtime code switch it from TypeScript to JavaScript, so no compiling is involved, and both CDK lambda, and terraform lambda can reference the code assets directly.\r\n3. Same GitHub action that automatically publish the NPM package will also create a new release for the terraform module under the same version.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "What would be the most efficient way to share the runtime code between the projects? ", "keywords": ["efficient"]}]}