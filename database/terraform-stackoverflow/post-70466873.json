{"Id": "70466873", "PostTypeId": "1", "CreationDate": "2021-12-23T19:58:39.020", "Score": "1", "ViewCount": "1132", "Body": "<p>I'm trying to provision GCP resources through Terraform, but it's timing out while also throwing errors saying that resources already exist (I've looked in GCP and through the CLI, and the resources do not exist).</p>\n<pre><code> Error: Error waiting to create Image: Error waiting for Creating Image: timeout while waiting for state to become 'DONE' (last state: 'RUNNING', timeout: 15m0s)\n\u2502\n\u2502   with google_compute_image.student-image,\n\u2502   on main.tf line 29, in resource &quot;google_compute_image&quot; &quot;student-image&quot;:\n\u2502   29: resource &quot;google_compute_image&quot; &quot;student-image&quot; {\n\u2502\n\u2575\n\u2577\n\u2502 Error: Error creating Firewall: googleapi: Error 409: The resource 'projects/**-****-**********-******/global/firewalls/*****-*********-*******-*****-firewall' already exists, alreadyExists\n\u2502\n\u2502   with google_compute_firewall.default,\n\u2502   on main.tf line 46, in resource &quot;google_compute_firewall&quot; &quot;default&quot;:\n\u2502   46: resource &quot;google_compute_firewall&quot; &quot;default&quot; {\n</code></pre>\n<p>Some (perhaps salient) details:</p>\n<ul>\n<li>I have previously provisioned these resources successfully using this same approach.</li>\n<li>My billing account has since changed.</li>\n<li>At another point, it was saying that the machine image existed (which, if it does, I can't see either in the console or the CLI).</li>\n</ul>\n<p>I welcome any insights/suggestions.</p>\n<p><strong>EDIT</strong>\nIncluding HCL; variables are defined in <code>variables.tf</code> and <code>terraform.tfvars</code></p>\n<pre><code>provider google {\n  region = var.region\n}\n\nresource &quot;google_compute_image&quot; &quot;student-image&quot; {\n  name    = var.google_compute_image_name\n  project = var.project\n\n  raw_disk {\n    source = var.google_compute_image_source\n  }\n\n  timeouts {\n    create = &quot;15m&quot;\n    update = &quot;15m&quot;\n    delete = &quot;15m&quot;\n  }\n}\n\nresource &quot;google_compute_firewall&quot; &quot;default&quot; {\n  name    = &quot;cloud-computing-project-image-firewall&quot;\n  network = &quot;default&quot;\n  project = var.project\n\n  allow {\n    protocol = &quot;tcp&quot;\n\n    # 22: SSH\n    # 80: HTTP\n    ports = [\n      &quot;22&quot;,\n      &quot;80&quot;,\n    ]\n  }\n\n  source_ranges = [&quot;0.0.0.0/0&quot;]\n}\n\n  source = &quot;./vm&quot;\n  name = &quot;workspace-vm&quot;\n\n  project      = var.project\n  image        = google_compute_image.student-image.self_link\n  machine_type = &quot;n1-standard-1&quot;\n}\n</code></pre>\n<p>There is a <code>vm</code> subdirectory with <code>main.tf</code>:</p>\n<pre><code>resource &quot;google_compute_instance&quot; &quot;student_instance&quot; {\n  name = var.name\n\n  machine_type = var.machine_type\n  zone         = var.zone\n  project      = var.project\n\n  boot_disk {\n    initialize_params {\n      image = var.image\n      size  = var.disk_size\n    }\n  }\n\n  network_interface {\n    network = &quot;default&quot;\n\n    access_config {\n      \n    }\n  }\n\n  labels = {\n    project = &quot;machine-learning-on-the-cloud&quot;\n  }\n}\n</code></pre>\n<p>...and <code>variables.tf</code>:</p>\n<pre><code>variable name {}\n\nvariable project {}\n\nvariable zone {\n  default = &quot;us-east1-b&quot;\n}\n\nvariable image {}\n\nvariable machine_type {}\n\nvariable disk_size {\n  default = 20\n}\n\n</code></pre>\n", "OwnerUserId": "17060920", "LastEditorUserId": "17060920", "LastEditDate": "2021-12-25T06:45:28.393", "LastActivityDate": "2021-12-25T06:45:28.393", "Title": "Terraform/GCP Timeout (and Resources Already Exist)", "Tags": "<google-cloud-platform><terraform>", "AnswerCount": "1", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "124566791", "PostId": "70466873", "Score": "0", "Text": "Edit your question and include the Terraform HCL.", "CreationDate": "2021-12-23T23:00:34.760", "UserId": "8016720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "260650123", "PostHistoryTypeId": "2", "PostId": "70466873", "RevisionGUID": "1b229974-34eb-448b-b096-c1ef8a7f6ae1", "CreationDate": "2021-12-23T19:58:39.020", "UserId": "17060920", "Text": "I'm trying to provision GCP resources through Terraform, but it's timing out while also throwing errors saying that resources already exist (I've looked in GCP and through the CLI, and the resources do not exist). \r\n\r\n```\r\n Error: Error waiting to create Image: Error waiting for Creating Image: timeout while waiting for state to become 'DONE' (last state: 'RUNNING', timeout: 15m0s)\r\n\u2502\r\n\u2502   with google_compute_image.student-image,\r\n\u2502   on main.tf line 29, in resource \"google_compute_image\" \"student-image\":\r\n\u2502   29: resource \"google_compute_image\" \"student-image\" {\r\n\u2502\r\n\u2575\r\n\u2577\r\n\u2502 Error: Error creating Firewall: googleapi: Error 409: The resource 'projects/**-****-**********-******/global/firewalls/*****-*********-*******-*****-firewall' already exists, alreadyExists\r\n\u2502\r\n\u2502   with google_compute_firewall.default,\r\n\u2502   on main.tf line 46, in resource \"google_compute_firewall\" \"default\":\r\n\u2502   46: resource \"google_compute_firewall\" \"default\" {\r\n```\r\n\r\nSome (perhaps salient) details: \r\n- I have previously provisioned these resources successfully using this same approach.\r\n- My billing account has since changed. \r\n- At another point, it was saying that the machine image existed (which, if it does, I can't see either in the console or the CLI). \r\n\r\nI welcome any insights/suggestions.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "- My billing account has since changed. ", "keywords": ["bill", "change"]}]}, {"Id": "260650125", "PostHistoryTypeId": "1", "PostId": "70466873", "RevisionGUID": "1b229974-34eb-448b-b096-c1ef8a7f6ae1", "CreationDate": "2021-12-23T19:58:39.020", "UserId": "17060920", "Text": "Terraform/GCP Timeout (and Resources Already Exist)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "260650126", "PostHistoryTypeId": "3", "PostId": "70466873", "RevisionGUID": "1b229974-34eb-448b-b096-c1ef8a7f6ae1", "CreationDate": "2021-12-23T19:58:39.020", "UserId": "17060920", "Text": "<google-cloud-platform><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "260714795", "PostHistoryTypeId": "5", "PostId": "70466873", "RevisionGUID": "d9ecceea-1a98-47cd-b8e4-d23fdfce213a", "CreationDate": "2021-12-25T06:45:28.393", "UserId": "17060920", "Comment": "added 1624 characters in body", "Text": "I'm trying to provision GCP resources through Terraform, but it's timing out while also throwing errors saying that resources already exist (I've looked in GCP and through the CLI, and the resources do not exist). \r\n\r\n```\r\n Error: Error waiting to create Image: Error waiting for Creating Image: timeout while waiting for state to become 'DONE' (last state: 'RUNNING', timeout: 15m0s)\r\n\u2502\r\n\u2502   with google_compute_image.student-image,\r\n\u2502   on main.tf line 29, in resource \"google_compute_image\" \"student-image\":\r\n\u2502   29: resource \"google_compute_image\" \"student-image\" {\r\n\u2502\r\n\u2575\r\n\u2577\r\n\u2502 Error: Error creating Firewall: googleapi: Error 409: The resource 'projects/**-****-**********-******/global/firewalls/*****-*********-*******-*****-firewall' already exists, alreadyExists\r\n\u2502\r\n\u2502   with google_compute_firewall.default,\r\n\u2502   on main.tf line 46, in resource \"google_compute_firewall\" \"default\":\r\n\u2502   46: resource \"google_compute_firewall\" \"default\" {\r\n```\r\n\r\nSome (perhaps salient) details: \r\n- I have previously provisioned these resources successfully using this same approach.\r\n- My billing account has since changed. \r\n- At another point, it was saying that the machine image existed (which, if it does, I can't see either in the console or the CLI). \r\n\r\nI welcome any insights/suggestions.\r\n\r\n**EDIT**\r\nIncluding HCL; variables are defined in `variables.tf` and `terraform.tfvars`\r\n\r\n```\r\nprovider google {\r\n  region = var.region\r\n}\r\n\r\nresource \"google_compute_image\" \"student-image\" {\r\n  name    = var.google_compute_image_name\r\n  project = var.project\r\n\r\n  raw_disk {\r\n    source = var.google_compute_image_source\r\n  }\r\n\r\n  timeouts {\r\n    create = \"15m\"\r\n    update = \"15m\"\r\n    delete = \"15m\"\r\n  }\r\n}\r\n\r\nresource \"google_compute_firewall\" \"default\" {\r\n  name    = \"cloud-computing-project-image-firewall\"\r\n  network = \"default\"\r\n  project = var.project\r\n\r\n  allow {\r\n    protocol = \"tcp\"\r\n\r\n    # 22: SSH\r\n    # 80: HTTP\r\n    ports = [\r\n      \"22\",\r\n      \"80\",\r\n    ]\r\n  }\r\n\r\n  source_ranges = [\"0.0.0.0/0\"]\r\n}\r\n\r\n  source = \"./vm\"\r\n  name = \"workspace-vm\"\r\n\r\n  project      = var.project\r\n  image        = google_compute_image.student-image.self_link\r\n  machine_type = \"n1-standard-1\"\r\n}\r\n```\r\nThere is a `vm` subdirectory with `main.tf`:\r\n```\r\nresource \"google_compute_instance\" \"student_instance\" {\r\n  name = var.name\r\n\r\n  machine_type = var.machine_type\r\n  zone         = var.zone\r\n  project      = var.project\r\n\r\n  boot_disk {\r\n    initialize_params {\r\n      image = var.image\r\n      size  = var.disk_size\r\n    }\r\n  }\r\n\r\n  network_interface {\r\n    network = \"default\"\r\n\r\n    access_config {\r\n      \r\n    }\r\n  }\r\n\r\n  labels = {\r\n    project = \"machine-learning-on-the-cloud\"\r\n  }\r\n}\r\n```\r\n...and `variables.tf`:\r\n```\r\nvariable name {}\r\n\r\nvariable project {}\r\n\r\nvariable zone {\r\n  default = \"us-east1-b\"\r\n}\r\n\r\nvariable image {}\r\n\r\nvariable machine_type {}\r\n\r\nvariable disk_size {\r\n  default = 20\r\n}\r\n\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "- My billing account has since changed. ", "keywords": ["bill", "change"]}, {"source": "Text", "text": "Including HCL; variables are defined in `variables.tf` and `terraform.tfvars` ``` provider google { region = var.region } resource \"google_compute_image\" \"student-image\" { name = var.google_compute_image_name project = var.project raw_disk { source = var.google_compute_image_source } timeouts { create = \"15m\" update = \"15m\" delete = \"15m\" } } resource \"google_compute_firewall\" \"default\" { name = \"cloud-computing-project-image-firewall\" network = \"default\" project = var.project allow { protocol = \"tcp\" # 22: SSH # 80: HTTP ports = [ \"22\", \"80\", ] } source_ranges = [\"0.0.0.0/0\"] } source = \"./vm\" name = \"workspace-vm\" project = var.project image = google_compute_image.student-image.self_link machine_type = \"n1-standard-1\" } ``` There is a `vm` subdirectory with `main.tf`: ``` resource \"google_compute_instance\" \"student_instance\" { name = var.name machine_type = var.machine_type zone = var.zone project = var.project boot_disk { initialize_params { image = var.image size = var.disk_size } } network_interface { network = \"default\" access_config { } } labels = { project = \"machine-learning-on-the-cloud\" } } ``` ", "keywords": ["provider"]}]}], "answers": [{"Id": "70468888", "PostTypeId": "2", "ParentId": "70466873", "CreationDate": "2021-12-24T01:47:26.313", "Score": "0", "Body": "<p>It sounds like maybe the resources were provisioned with Terraform but perhaps someone deleted them manually and so now your state file and what's actual doesn't match.  <a href=\"https://www.terraform.io/cli/commands/refresh\" rel=\"nofollow noreferrer\"><code>terraform refresh</code></a> might solve your problem.</p>\n", "OwnerUserId": "17675150", "LastActivityDate": "2021-12-24T01:47:26.313", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "124584617", "PostId": "70468888", "Score": "0", "Text": "Thanks, @glen-yu; tried that but got the same errors. I welcome any other ideas.", "CreationDate": "2021-12-25T06:46:58.887", "UserId": "17060920", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "260660732", "PostHistoryTypeId": "2", "PostId": "70468888", "RevisionGUID": "2aa96e49-c63e-40a4-af3e-41bfb444bcc2", "CreationDate": "2021-12-24T01:47:26.313", "UserId": "17675150", "Text": "It sounds like maybe the resources were provisioned with Terraform but perhaps someone deleted them manually and so now your state file and what's actual doesn't match.  [`terraform refresh`][1] might solve your problem.\r\n\r\n\r\n  [1]: https://www.terraform.io/cli/commands/refresh", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "My billing account has since changed. ", "keywords": ["bill", "change"]}]}