{"Id": "63598319", "PostTypeId": "1", "AcceptedAnswerId": "63624839", "CreationDate": "2020-08-26T13:04:59.257", "Score": "0", "ViewCount": "2704", "Body": "<p>I get the error below when I automatically create a new GCP project with various resources for example: Redis, SQL, GKE, etc... using Terraform code:</p>\n<pre><code>Error: error creating NodePool: googleapi: Error 403:\n    (1) insufficient regional quota to satisfy request: resource &quot;CPUS&quot;: request requires '35.0' and is short '24.0'. project has a quota of '24.0' with '24.0' available. View and manage quotas at https://console.cloud.google.com/iam-admin/quotas?usage=USED&amp;project=&lt;PROJECT_ID&gt;\n    (2) insufficient regional quota to satisfy request: resource &quot;IN_USE_ADDRESSES&quot;: request requires '10.0' and is short '4.0'. project has a quota of '8.0' with '8.0' available. View and manage quotas at https://console.cloud.google.com/iam-admin/quotas?usage=USED&amp;project=&lt;PROJECT_ID&gt;., forbidden\n</code></pre>\n<p>The Terraform code that I was trying to run:</p>\n<pre><code>resource &quot;google_project&quot; &quot;my_project&quot; {\n  provider   = google-beta\n  name       = &quot;tf-test-project&quot;\n  project_id = &quot;quota-123&quot;\n  org_id     = &quot;123456789&quot;\n}\n\nresource &quot;google_service_usage_consumer_quota_override&quot; &quot;override&quot; {\n  provider       = google-beta\n  project        = google_project.my_project.project_id\n  service        = &quot;compute.googleapis.com&quot;\n  metric         = &quot;compute.googleapis.com%2Fcpus&quot;\n  limit          = &quot;%2Fproject%2Fregion&quot;\n  override_value = &quot;95&quot;\n  force          = true\n}\n</code></pre>\n<p>The error I get after running the Terraform resource <strong>google_service_usage_consumer_quota_override.override</strong></p>\n<pre><code>Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com.\nDetails:\n[\n  {\n    &quot;@type&quot;: &quot;type.googleapis.com/google.rpc.PreconditionFailure&quot;,\n    &quot;violations&quot;: [\n      {\n        &quot;subject&quot;: &quot;?error_code=101035\\u0026quota_unit=1/%7Bproject%7D/%7Bregion%7D\\u0026metric=compute.googleapis.com/cpus\\u0026service=compute.googleapis.com&quot;,\n        &quot;type&quot;: &quot;googleapis.com&quot;\n      }\n    ]\n  }\n]\non quota.tf line 1, in resource &quot;google_service_usage_consumer_quota_override&quot; &quot;override&quot;:\n  1: resource &quot;google_service_usage_consumer_quota_override&quot; &quot;override&quot; {\n</code></pre>\n<p>I'd like to increase both <strong>GCP</strong> resources &quot;<strong>CPUS</strong>&quot; and &quot;<strong>IN_USE_ADDRESSES</strong>&quot; quotas using <strong>Terraform</strong> module for the new GCP project.</p>\n<p>Is it possible?</p>\n<p>Thanks!</p>\n<p><a href=\"https://www.terraform.io/docs/providers/google/r/service_usage_consumer_quota_override.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/providers/google/r/service_usage_consumer_quota_override.html</a></p>\n", "OwnerUserId": "3762850", "LastEditorUserId": "3762850", "LastEditDate": "2020-08-27T06:37:06.790", "LastActivityDate": "2020-08-27T22:15:34.907", "Title": "How to increase Quota on GCP using Terraform Module?", "Tags": "<google-cloud-platform><terraform><terraform-provider-gcp>", "AnswerCount": "1", "CommentCount": "4", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "112463495", "PostId": "63598319", "Score": "0", "Text": "Did you do any research before posing this question?  https://cloud.google.com/docs/quota", "CreationDate": "2020-08-26T14:01:17.047", "UserId": "8016720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "112463545", "PostId": "63598319", "Score": "0", "Text": "I\u2019m voting to close this question because this is a question about a vendor's billing policies.", "CreationDate": "2020-08-26T14:02:32.143", "UserId": "8016720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I\u2019m voting to close this question because this is a question about a vendor's billing policies.", "keywords": ["bill"]}]}, {"Id": "112463991", "PostId": "63598319", "Score": "0", "Text": "Of course I did some research before I posted this question. My question is not about a vendor's billing policies is about what am I doing wrong or what am I missing in the Terraform code?", "CreationDate": "2020-08-26T14:15:07.907", "UserId": "3762850", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "My question is not about a vendor's billing policies is about what am I doing wrong or what am I missing in the Terraform code?", "keywords": ["bill"]}]}, {"Id": "112465805", "PostId": "63598319", "Score": "0", "Text": "Please edit your question and include your research. This link might help you: https://stackoverflow.com/help/how-to-ask", "CreationDate": "2020-08-26T15:05:32.437", "UserId": "8016720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "229562057", "PostHistoryTypeId": "2", "PostId": "63598319", "RevisionGUID": "8bda7cdb-1622-4a08-bfe1-67197c36998b", "CreationDate": "2020-08-26T13:04:59.257", "UserId": "3762850", "Text": "I'd like to increase both **GCP** resources \"**CPUS**\" and \"**IN_USE_ADDRESSES**\" quotas using **Terraform** module.\r\n\r\nShould I do it for each GCP region, if so how can I choose for instance: \"europe-west1\"?\r\n\r\n**Terraform code that I was trying to run:**\r\n\r\n    resource \"google_project\" \"my_project\" {\r\n      provider   = google-beta\r\n      name       = \"tf-test-project\"\r\n      project_id = \"quota-123\"\r\n      org_id     = \"123456789\"\r\n    }\r\n    \r\n    resource \"google_service_usage_consumer_quota_override\" \"override\" {\r\n      provider       = google-beta\r\n      project        = google_project.my_project.project_id\r\n      service        = \"compute.googleapis.com\"\r\n      metric         = \"compute.googleapis.com%2Fcpus\"\r\n      limit          = \"%2Fproject%2Fregion\"\r\n      override_value = \"95\"\r\n      force          = true\r\n    }\r\n\r\n**The error I got:**\r\n\r\n    Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com.\r\n    Details:\r\n    [\r\n      {\r\n        \"@type\": \"type.googleapis.com/google.rpc.PreconditionFailure\",\r\n        \"violations\": [\r\n          {\r\n            \"subject\": \"?error_code=101035\\u0026quota_unit=1/%7Bproject%7D/%7Bregion%7D\\u0026metric=compute.googleapis.com/cpus\\u0026service=compute.googleapis.com\",\r\n            \"type\": \"googleapis.com\"\r\n          }\r\n        ]\r\n      }\r\n    ]\r\n    on quota.tf line 1, in resource \"google_service_usage_consumer_quota_override\" \"override\":\r\n      1: resource \"google_service_usage_consumer_quota_override\" \"override\" {\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Should I do it for each GCP region, if so how can I choose for instance: \"europe-west1\"? **Terraform code that I was trying to run:** resource \"google_project\" \"my_project\" { provider = google-beta name = \"tf-test-project\" project_id = \"quota-123\" org_id = \"123456789\" } resource \"google_service_usage_consumer_quota_override\" \"override\" { provider = google-beta project = google_project.my_project.project_id service = \"compute.googleapis.com\" metric = \"compute.googleapis.com%2Fcpus\" limit = \"%2Fproject%2Fregion\" override_value = \"95\" force = true } **The error I got:** Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com. ", "keywords": ["instance", "provider", "test"]}]}, {"Id": "229562058", "PostHistoryTypeId": "1", "PostId": "63598319", "RevisionGUID": "8bda7cdb-1622-4a08-bfe1-67197c36998b", "CreationDate": "2020-08-26T13:04:59.257", "UserId": "3762850", "Text": "How to increase Quota on GCP using Terraform Module?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "229562059", "PostHistoryTypeId": "3", "PostId": "63598319", "RevisionGUID": "8bda7cdb-1622-4a08-bfe1-67197c36998b", "CreationDate": "2020-08-26T13:04:59.257", "UserId": "3762850", "Text": "<google-cloud-platform><terraform><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "229567859", "PostHistoryTypeId": "5", "PostId": "63598319", "RevisionGUID": "0bce4936-e6ea-47bb-84c4-5bfe490e3a3d", "CreationDate": "2020-08-26T14:23:19.587", "UserId": "3762850", "Comment": "deleted 26 characters in body", "Text": "I'd like to increase both **GCP** resources \"**CPUS**\" and \"**IN_USE_ADDRESSES**\" quotas using **Terraform** module for a specific **europe-west1** region.\r\n\r\n**Terraform code that I was trying to run:**\r\n\r\n    resource \"google_project\" \"my_project\" {\r\n      provider   = google-beta\r\n      name       = \"tf-test-project\"\r\n      project_id = \"quota-123\"\r\n      org_id     = \"123456789\"\r\n    }\r\n    \r\n    resource \"google_service_usage_consumer_quota_override\" \"override\" {\r\n      provider       = google-beta\r\n      project        = google_project.my_project.project_id\r\n      service        = \"compute.googleapis.com\"\r\n      metric         = \"compute.googleapis.com%2Fcpus\"\r\n      limit          = \"%2Fproject%2Fregion\"\r\n      override_value = \"95\"\r\n      force          = true\r\n    }\r\n\r\n**The error I got:**\r\n\r\n    Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com.\r\n    Details:\r\n    [\r\n      {\r\n        \"@type\": \"type.googleapis.com/google.rpc.PreconditionFailure\",\r\n        \"violations\": [\r\n          {\r\n            \"subject\": \"?error_code=101035\\u0026quota_unit=1/%7Bproject%7D/%7Bregion%7D\\u0026metric=compute.googleapis.com/cpus\\u0026service=compute.googleapis.com\",\r\n            \"type\": \"googleapis.com\"\r\n          }\r\n        ]\r\n      }\r\n    ]\r\n    on quota.tf line 1, in resource \"google_service_usage_consumer_quota_override\" \"override\":\r\n      1: resource \"google_service_usage_consumer_quota_override\" \"override\" {\r\n\r\nHow can I do that?\r\nThanks!", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I'd like to increase both **GCP** resources \"**CPUS**\" and \"**IN_USE_ADDRESSES**\" quotas using **Terraform** module for a specific **europe-west1** region. **Terraform code that I was trying to run:** resource \"google_project\" \"my_project\" { provider = google-beta name = \"tf-test-project\" project_id = \"quota-123\" org_id = \"123456789\" } resource \"google_service_usage_consumer_quota_override\" \"override\" { provider = google-beta project = google_project.my_project.project_id service = \"compute.googleapis.com\" metric = \"compute.googleapis.com%2Fcpus\" limit = \"%2Fproject%2Fregion\" override_value = \"95\" force = true } **The error I got:** Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com. ", "keywords": ["provider", "test"]}]}, {"Id": "229612121", "PostHistoryTypeId": "5", "PostId": "63598319", "RevisionGUID": "58951df5-b419-4ff1-9a7f-b00cfdc28127", "CreationDate": "2020-08-27T06:37:06.790", "UserId": "3762850", "Comment": "added 880 characters in body", "Text": "I get the error below when I automatically create a new GCP project with various resources for example: Redis, SQL, GKE, etc... using Terraform code:\r\n\r\n    Error: error creating NodePool: googleapi: Error 403:\r\n     (1) insufficient regional quota to satisfy request: resource \"CPUS\": request requires '35.0' and is short '24.0'. project has a quota of '24.0' with '24.0' available. View and manage quotas at https://console.cloud.google.com/iam-admin/quotas?usage=USED&project=<PROJECT_ID>\r\n     (2) insufficient regional quota to satisfy request: resource \"IN_USE_ADDRESSES\": request requires '10.0' and is short '4.0'. project has a quota of '8.0' with '8.0' available. View and manage quotas at https://console.cloud.google.com/iam-admin/quotas?usage=USED&project=<PROJECT_ID>., forbidden\r\n    \r\nThe Terraform code that I was trying to run:\r\n\r\n    resource \"google_project\" \"my_project\" {\r\n      provider   = google-beta\r\n      name       = \"tf-test-project\"\r\n      project_id = \"quota-123\"\r\n      org_id     = \"123456789\"\r\n    }\r\n    \r\n    resource \"google_service_usage_consumer_quota_override\" \"override\" {\r\n      provider       = google-beta\r\n      project        = google_project.my_project.project_id\r\n      service        = \"compute.googleapis.com\"\r\n      metric         = \"compute.googleapis.com%2Fcpus\"\r\n      limit          = \"%2Fproject%2Fregion\"\r\n      override_value = \"95\"\r\n      force          = true\r\n    }\r\n\r\nThe error I get after running the Terraform resource **google_service_usage_consumer_quota_override.override**\r\n\r\n    Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com.\r\n    Details:\r\n    [\r\n      {\r\n        \"@type\": \"type.googleapis.com/google.rpc.PreconditionFailure\",\r\n        \"violations\": [\r\n          {\r\n            \"subject\": \"?error_code=101035\\u0026quota_unit=1/%7Bproject%7D/%7Bregion%7D\\u0026metric=compute.googleapis.com/cpus\\u0026service=compute.googleapis.com\",\r\n            \"type\": \"googleapis.com\"\r\n          }\r\n        ]\r\n      }\r\n    ]\r\n    on quota.tf line 1, in resource \"google_service_usage_consumer_quota_override\" \"override\":\r\n      1: resource \"google_service_usage_consumer_quota_override\" \"override\" {\r\n\r\n\r\nI'd like to increase both **GCP** resources \"**CPUS**\" and \"**IN_USE_ADDRESSES**\" quotas using **Terraform** module for the new GCP project. \r\n\r\nIs it possible?\r\n\r\nThanks!\r\n\r\nhttps://www.terraform.io/docs/providers/google/r/service_usage_consumer_quota_override.html\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "View and manage quotas at https://console.cloud.google.com/iam-admin/quotas?usage=USED&project=., forbidden The Terraform code that I was trying to run: resource \"google_project\" \"my_project\" { provider = google-beta name = \"tf-test-project\" project_id = \"quota-123\" org_id = \"123456789\" } resource \"google_service_usage_consumer_quota_override\" \"override\" { provider = google-beta project = google_project.my_project.project_id service = \"compute.googleapis.com\" metric = \"compute.googleapis.com%2Fcpus\" limit = \"%2Fproject%2Fregion\" override_value = \"95\" force = true } The error I get after running the Terraform resource **google_service_usage_consumer_quota_override.override** Error: Error creating ConsumerQuotaOverride: googleapi: Error 400: Precise override for limit with quota unit '1/{project}/{region}' on metric 'compute.googleapis.com/cpus' can't be applied in service: compute.googleapis.com. ", "keywords": ["provider", "test"]}]}], "answers": [{"Id": "63624839", "PostTypeId": "2", "ParentId": "63598319", "CreationDate": "2020-08-27T22:15:34.907", "Score": "5", "Body": "<p>You are getting those errors because the values you are using are exceeding the quota limits.</p>\n<p>Each quota limit has a default value for all consumers, set by the service owner. This default value can be changed by a quota override.</p>\n<p>But a quota override cannot increase the available quota beyond what is allowed by the service default and any existing overrides by other parties (such as the service owner or an organization's quota administrator).</p>\n<p>To increase available quota, use the <a href=\"https://cloud.google.com/compute/quotas#requesting_additional_quota\" rel=\"noreferrer\">Edit Quotas</a> option on the main quota page or ask the org admin for a quota uplift.</p>\n<p>You can check the quota information for a project using the <a href=\"https://console.cloud.google.com/iam-admin/quotas?_ga=2.192902056.305402083.1598273128-638966553.1591892739\" rel=\"noreferrer\">Quota</a> page:</p>\n<p>GCP Navigation =&gt; IAM &amp; admin =&gt; Quotas,</p>\n<p>or through the following gcloud commands:</p>\n<pre><code>$ gcloud compute project-info describe --project project-name \n$ gcloud compute regions describe region-name\n</code></pre>\n<p>In your particular case 10 addresses were requested, and the deployment was short of 4 addresses because of the quota of 8 addresses. Same thing for the CPUs,35 CPUs were requested, and the limit  of the quota is 24 CPUs.</p>\n", "OwnerUserId": "14004844", "LastActivityDate": "2020-08-27T22:15:34.907", "CommentCount": "5", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "112520259", "PostId": "63624839", "Score": "0", "Text": "Thank you for sharing the information, I create and destroy the GCP Project's environment dynamically and automatically using Terraform IaC tool. Is there any way to increase the available quota via Python/Terraform/gcloud CLI and not through the GCP dashboard manually?", "CreationDate": "2020-08-28T09:35:24.133", "UserId": "3762850", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "112528012", "PostId": "63624839", "Score": "0", "Text": "There is no way to automate the process for [Request a change to quota](https://cloud.google.com/compute/quotas#request_quotas), because you need to fill out a form, with  your name, email, and phone number, and according to the documentation a support representative from the Compute Engine team will respond to your request within 24 to 48 hours.", "CreationDate": "2020-08-28T14:07:17.560", "UserId": "14004844", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "There is no way to automate the process for [Request a change to quota](https://cloud.google.com/compute/quotas#request_quotas), because you need to fill out a form, with your name, email, and phone number, and according to the documentation a support representative from the Compute Engine team will respond to your request within 24 to 48 hours.", "keywords": ["change"]}]}, {"Id": "112530018", "PostId": "63624839", "Score": "0", "Text": "If so can I increase both GCP resources \"CPUS\" and \"IN_USE_ADDRESSES\" quotas for all GCP Projects as Default value for specific region via Dashboard and not for specific project?", "CreationDate": "2020-08-28T15:11:37.113", "UserId": "3762850", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "112535058", "PostId": "63624839", "Score": "0", "Text": "CPU quota is a regional quota, so there is a different limit and usage count for each region. For example, to launch an n1-standard-16 instance in any zone in the us-central1 region, you need enough quota for at least 16 CPUs in us-central1.\n\nFor IP addresses in-use and static external assigned to load balancers and HTTP(S) proxies consume global quotas.\n\nYou could check the following [document](https://cloud.google.com/compute/quotas#regional_and_global_quotas) for more information.", "CreationDate": "2020-08-28T18:38:24.537", "UserId": "14004844", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "CPU quota is a regional quota, so there is a different limit and usage count for each region. ", "keywords": ["cpu"]}, {"source": "Text", "text": "For example, to launch an n1-standard-16 instance in any zone in the us-central1 region, you need enough quota for at least 16 CPUs in us-central1. ", "keywords": ["instance"]}]}, {"Id": "112535061", "PostId": "63624839", "Score": "0", "Text": "Also this other [document](https://cloud.google.com/docs/quota) contains the following information:\nNot all projects have the same quotas for the same services. If you are using a free trial account to explore the platform, for example, you may have a very limited quota. Higher quotas for some services are available only after you have enabled billing for your project. As your use of Google Cloud expands over time, your quotas may increase accordingly.", "CreationDate": "2020-08-28T18:38:32.993", "UserId": "14004844", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Higher quotas for some services are available only after you have enabled billing for your project. ", "keywords": ["bill"]}]}], "history": [{"Id": "229671228", "PostHistoryTypeId": "2", "PostId": "63624839", "RevisionGUID": "01f4b1b8-e3d4-4368-9c56-134abecfbd7d", "CreationDate": "2020-08-27T22:15:34.907", "UserId": "14004844", "Text": "You are getting those errors because the values you are using are exceeding the quota limits. \r\n\r\nEach quota limit has a default value for all consumers, set by the service owner. This default value can be changed by a quota override.\r\n\r\nBut a quota override cannot increase the available quota beyond what is allowed by the service default and any existing overrides by other parties (such as the service owner or an organization's quota administrator).\r\n\r\nTo increase available quota, use the [Edit Quotas](https://cloud.google.com/compute/quotas#requesting_additional_quota) option on the main quota page or ask the org admin for a quota uplift.\r\n\r\n\r\nYou can check the quota information for a project using the [Quota](https://console.cloud.google.com/iam-admin/quotas?_ga=2.192902056.305402083.1598273128-638966553.1591892739) page:\r\n\r\nGCP Navigation => IAM & admin => Quotas,\r\n\r\n or through the following gcloud commands:\r\n```\r\n$ gcloud compute project-info describe --project project-name \r\n$ gcloud compute regions describe region-name\r\n```\r\nIn your particular case 10 addresses were requested, and the deployment was short of 4 addresses because of the quota of 8 addresses. Same thing for the CPUs,35 CPUs were requested, and the limit  of the quota is 24 CPUs.\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This default value can be changed by a quota override. ", "keywords": ["change"]}]}], "filtered-sentences": [{"source": "Body", "text": "This default value can be changed by a quota override. ", "keywords": ["change"]}]}], "contains-topic": true, "filtered-sentences": []}