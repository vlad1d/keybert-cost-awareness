{"Id": "57395138", "PostTypeId": "1", "AcceptedAnswerId": "57400515", "CreationDate": "2019-08-07T13:02:07.977", "Score": "1", "ViewCount": "1655", "Body": "<p>I have a Terraform script that creates a Virtual Machine on Azure based on this image from the Azure Marketplace:\n<a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/gitlab.gitlab-ce\" rel=\"nofollow noreferrer\">https://azuremarketplace.microsoft.com/en-us/marketplace/apps/gitlab.gitlab-ce</a></p>\n\n<p>But I don't know how to identify the values to put in these fields:</p>\n\n<ul>\n<li>publisher</li>\n<li>offer</li>\n<li>sku</li>\n<li>version</li>\n</ul>\n\n<p>This is a snippet from the Terraform script</p>\n\n<pre><code>resource \"azurerm_virtual_machine\" \"gitlab_vm\" {\n  # ... other configuration\n\n  storage_image_reference {\n    publisher = \"GitLab\"\n    offer     = \"GitLab Community Edition\"\n    # sku       = \"???\"\n    version   = \"latest\"\n  }\n\n  # ... other configuration\n}\n</code></pre>\n\n<p>If I run the previous details with <code>terraform plan</code> and e.g. <code>publisher = \"GitLabXXX\"</code> (something that does not exist), then Terraform does not raise any error. When I run <code>terraform apply</code> after a while an error is raised and the VM resource is not created (although all the other resources e.g. the networking stuff are created).</p>\n\n<p>This applies in a similar way to Azure ARM templates:</p>\n\n<pre><code>\"imageReference\": {\n    \"publisher\": \"[variables('pubName')]\",\n    \"offer\": \"[variables('offerName')]\",\n    \"sku\" : \"[parameters('skuName')]\",\n    \"version\":\"latest\"\n},\n</code></pre>\n\n<p>I have some virtual machine that are up and running with a similar Terraform configuration that I found on the internet (see the Ubuntu example below), but what are the rules to translate the information from the Azure Marketplace webpage to the script?</p>\n\n<pre><code>  storage_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"UbuntuServer\"\n    sku       = \"16.04-LTS\"\n    version   = \"latest\"\n  }\n</code></pre>\n", "OwnerUserId": "1264920", "LastEditorUserId": "1264920", "LastEditDate": "2019-08-08T09:02:31.407", "LastActivityDate": "2019-08-08T09:02:31.407", "Title": "How to set the virtual machine image details e.g. publisher, offer, sku and version", "Tags": "<azure><gitlab-ci><azure-virtual-machine><azure-rm-template><terraform-provider-azure>", "AnswerCount": "1", "CommentCount": "0", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "203050128", "PostHistoryTypeId": "2", "PostId": "57395138", "RevisionGUID": "3c0a4f9c-364c-4b6b-81ac-be5990d9bb2f", "CreationDate": "2019-08-07T13:02:07.977", "UserId": "1264920", "Text": "I have a Terraform script that creates a Virtual Machine on Azure based on this image from the Azure Marketplace:\r\nhttps://azuremarketplace.microsoft.com/en-us/marketplace/apps/gitlab.gitlab-ce\r\n\r\nBut I don't know how to identify the values to put in these fields:\r\n\r\n- publisher\r\n- offer\r\n- sku\r\n- version\r\n\r\nThis is a snippet from the Terraform script\r\n\r\n    resource \"azurerm_virtual_machine\" \"gitlab_vm\" {\r\n      # ... other configuration\r\n    \r\n      storage_image_reference {\r\n        publisher = \"GitLab\"\r\n        offer     = \"GitLab Community Edition\"\r\n        # sku       = \"???\"\r\n        version   = \"latest\"\r\n      }\r\n\r\nIf I run the previous details with `terraform plan` and e.g. `publisher = \"GitLabXXX\"` (something that does not exist), then Terraform does not raise any error.\r\n\r\nbut it applies in a similar way to Azure ARM templates:\r\n\r\n    \"imageReference\": {\r\n        \"publisher\": \"[variables('pubName')]\",\r\n        \"offer\": \"[variables('offerName')]\",\r\n        \"sku\" : \"[parameters('skuName')]\",\r\n        \"version\":\"latest\"\r\n    },\r\n\r\nI have some virtual machine that are up and running with this Terraform configuration that I found on the internet, but what are the rules to translate the information from the Azure Marketplace webpage to the script?\r\n\r\n      storage_image_reference {\r\n        publisher = \"Canonical\"\r\n        offer     = \"UbuntuServer\"\r\n        sku       = \"16.04-LTS\"\r\n        version   = \"latest\"\r\n      }\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "203050129", "PostHistoryTypeId": "1", "PostId": "57395138", "RevisionGUID": "3c0a4f9c-364c-4b6b-81ac-be5990d9bb2f", "CreationDate": "2019-08-07T13:02:07.977", "UserId": "1264920", "Text": "How to set the virtual machine image details e.g. publisher, offer, sku and version", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "203050130", "PostHistoryTypeId": "3", "PostId": "57395138", "RevisionGUID": "3c0a4f9c-364c-4b6b-81ac-be5990d9bb2f", "CreationDate": "2019-08-07T13:02:07.977", "UserId": "1264920", "Text": "<azure><gitlab-ci><azure-virtual-machine><azure-rm-template><terraform-provider-azure>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "203106506", "PostHistoryTypeId": "5", "PostId": "57395138", "RevisionGUID": "a5755402-7c31-4cb3-84e4-93c1b305de1e", "CreationDate": "2019-08-08T09:02:31.407", "UserId": "1264920", "Comment": "added 245 characters in body", "Text": "I have a Terraform script that creates a Virtual Machine on Azure based on this image from the Azure Marketplace:\r\nhttps://azuremarketplace.microsoft.com/en-us/marketplace/apps/gitlab.gitlab-ce\r\n\r\nBut I don't know how to identify the values to put in these fields:\r\n\r\n- publisher\r\n- offer\r\n- sku\r\n- version\r\n\r\nThis is a snippet from the Terraform script\r\n\r\n    resource \"azurerm_virtual_machine\" \"gitlab_vm\" {\r\n      # ... other configuration\r\n    \r\n      storage_image_reference {\r\n        publisher = \"GitLab\"\r\n        offer     = \"GitLab Community Edition\"\r\n        # sku       = \"???\"\r\n        version   = \"latest\"\r\n      }\r\n\r\n      # ... other configuration\r\n    }\r\n\r\nIf I run the previous details with `terraform plan` and e.g. `publisher = \"GitLabXXX\"` (something that does not exist), then Terraform does not raise any error. When I run `terraform apply` after a while an error is raised and the VM resource is not created (although all the other resources e.g. the networking stuff are created).\r\n\r\nThis applies in a similar way to Azure ARM templates:\r\n\r\n    \"imageReference\": {\r\n        \"publisher\": \"[variables('pubName')]\",\r\n        \"offer\": \"[variables('offerName')]\",\r\n        \"sku\" : \"[parameters('skuName')]\",\r\n        \"version\":\"latest\"\r\n    },\r\n\r\nI have some virtual machine that are up and running with a similar Terraform configuration that I found on the internet (see the Ubuntu example below), but what are the rules to translate the information from the Azure Marketplace webpage to the script?\r\n\r\n      storage_image_reference {\r\n        publisher = \"Canonical\"\r\n        offer     = \"UbuntuServer\"\r\n        sku       = \"16.04-LTS\"\r\n        version   = \"latest\"\r\n      }\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "When I run `terraform apply` after a while an error is raised and the VM resource is not created (although all the other resources e.g. the networking stuff are created). ", "keywords": ["networking"]}]}], "answers": [{"Id": "57400515", "PostTypeId": "2", "ParentId": "57395138", "CreationDate": "2019-08-07T18:40:39.390", "Score": "2", "Body": "<p>There may be a more efficient way to do this, but I typically use the Azure CLI to get the publisher, offer, SKU, and version.  First, if you do something like:</p>\n\n<blockquote>\n  <p>az vm image list --offer GitLab -o table --all</p>\n</blockquote>\n\n<p>You'll get back a list with the offer, publisher, SKU, URN, and Version.  In your case, it should be something like this for gitlab-ce:</p>\n\n<ul>\n<li>Publisher: gitlab</li>\n<li>Offer: gitlab-ce</li>\n<li>SKU: gitlab-ce</li>\n<li>Version: 1.0.4</li>\n</ul>\n\n<p>I'm pretty sure the azurerm provider just calls ARM with these values so it should match what you get from the CLI, though I can certainly be corrected on this if I'm mistaken.</p>\n\n<p>You'll also need to include a <a href=\"https://www.terraform.io/docs/providers/azurerm/r/virtual_machine.html#plan\" rel=\"nofollow noreferrer\">plan block</a>.  The details for that can be retrieved via the CLI with something like this:</p>\n\n<blockquote>\n  <p>az vm image show --location westus --urn gitlab:gitlab-ce:gitlab-ce:1.0.4 -o json</p>\n</blockquote>\n\n<p>So your plan block would look something like:</p>\n\n<pre><code>plan {\n  name = \"gitlab-ce\" \n  publisher = \"gitlab\"\n  product = \"gitlab-ce\"\n}\n</code></pre>\n", "OwnerUserId": "5344028", "LastEditorUserId": "5344028", "LastEditDate": "2019-08-07T19:15:58.473", "LastActivityDate": "2019-08-07T19:15:58.473", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "203072302", "PostHistoryTypeId": "2", "PostId": "57400515", "RevisionGUID": "227f5620-9ac9-469d-8d82-44e412d73ea5", "CreationDate": "2019-08-07T18:40:39.390", "UserId": "5344028", "Text": "There may be a more efficient way to do this, but I typically use the Azure CLI to get the publisher, offer, SKU, and version.  First, if you do something like:\r\n> az vm image list --offer GitLab -o table --all\r\n\r\nYou'll get back a list with the offer, publisher, SKU, URN, and Version.  In your case, it should be something like this for gitlab-ce:\r\n\r\n - Publisher: gitlab\r\n - Offer: gitlab-ce\r\n - SKU: gitlab-ce\r\n - Version: 1.0.4\r\n\r\nI'm pretty sure the azurerm provider just calls ARM with these values so it should match what you get from the CLI, though I can certainly be corrected on this if I'm mistaken.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "There may be a more efficient way to do this, but I typically use the Azure CLI to get the publisher, offer, SKU, and version. ", "keywords": ["efficient"]}, {"source": "Text", "text": "In your case, it should be something like this for gitlab-ce: - Publisher: gitlab - Offer: gitlab-ce - SKU: gitlab-ce - Version: 1.0.4 I'm pretty sure the azurerm provider just calls ARM with these values so it should match what you get from the CLI, though I can certainly be corrected on this if I'm mistaken.", "keywords": ["provider"]}]}, {"Id": "203074265", "PostHistoryTypeId": "5", "PostId": "57400515", "RevisionGUID": "2d4c32fb-6ed7-4857-8159-76dfd2ba430a", "CreationDate": "2019-08-07T19:15:58.473", "UserId": "5344028", "Comment": "added the plan block, which is necessary for Terraform to create the resource", "Text": "There may be a more efficient way to do this, but I typically use the Azure CLI to get the publisher, offer, SKU, and version.  First, if you do something like:\r\n> az vm image list --offer GitLab -o table --all\r\n\r\nYou'll get back a list with the offer, publisher, SKU, URN, and Version.  In your case, it should be something like this for gitlab-ce:\r\n\r\n - Publisher: gitlab\r\n - Offer: gitlab-ce\r\n - SKU: gitlab-ce\r\n - Version: 1.0.4\r\n\r\nI'm pretty sure the azurerm provider just calls ARM with these values so it should match what you get from the CLI, though I can certainly be corrected on this if I'm mistaken.\r\n\r\nYou'll also need to include a [plan block](https://www.terraform.io/docs/providers/azurerm/r/virtual_machine.html#plan).  The details for that can be retrieved via the CLI with something like this:\r\n>az vm image show --location westus --urn gitlab:gitlab-ce:gitlab-ce:1.0.4 -o json\r\n\r\nSo your plan block would look something like:\r\n\r\n    plan {\r\n      name = \"gitlab-ce\" \r\n      publisher = \"gitlab\"\r\n      product = \"gitlab-ce\"\r\n    }", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "There may be a more efficient way to do this, but I typically use the Azure CLI to get the publisher, offer, SKU, and version. ", "keywords": ["efficient"]}, {"source": "Text", "text": "In your case, it should be something like this for gitlab-ce: - Publisher: gitlab - Offer: gitlab-ce - SKU: gitlab-ce - Version: 1.0.4 I'm pretty sure the azurerm provider just calls ARM with these values so it should match what you get from the CLI, though I can certainly be corrected on this if I'm mistaken. ", "keywords": ["provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "There may be a more efficient way to do this, but I typically use the Azure CLI to get the publisher, offer, SKU, and version. ", "keywords": ["efficient"]}, {"source": "Body", "text": "In your case, it should be something like this for gitlab-ce: Publisher: gitlab Offer: gitlab-ce SKU: gitlab-ce Version: 1.0.4 I'm pretty sure the azurerm provider just calls ARM with these values so it should match what you get from the CLI, though I can certainly be corrected on this if I'm mistaken. ", "keywords": ["provider"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "When I run terraform apply after a while an error is raised and the VM resource is not created (although all the other resources e.g. the networking stuff are created). ", "keywords": ["networking"]}]}