{"Id": "71725712", "PostTypeId": "1", "CreationDate": "2022-04-03T12:04:26.430", "Score": "0", "ViewCount": "974", "Body": "<p>We are trying to create Azure subscriptions using Terraform &amp; deploying through Github Actions.\nwhere we are obtaining the error message in terraform apply stage. Attaching the screenshot for reference. The <strong>use case description</strong> is below for reference:</p>\n<ol>\n<li>SPN (Azure Service principal) created in Azure environment is used for this deployment.</li>\n<li>SPN is assigned Owner role in Tenant level.</li>\n<li>Have also followed this link &amp; assigned the necessary privileges\nfor the subscription creator role using API on enrollment account.</li>\n<li>we have the set the Github Actions &quot;Secrets&quot; perfect with the same\nSPN details for authenticating the environment &amp; rest resources are\ngetting spun up well.</li>\n</ol>\n<p><strong>Link</strong>: <a href=\"https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn\" rel=\"nofollow noreferrer\">https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn</a>.</p>\n<p>Error Message:</p>\n<pre><code>creating new Subscription (Alias &quot;823XXXXXXX-285b-4084-92d8-885a43a7f7a5&quot;): subscription.AliasClient#Create: Failure sending request: StatusCode=401 -- Original Error: Code=&quot;UserNotAuthorized&quot; Message=&quot;User is not authorized to create subscriptions on this enrollment account&quot;\n</code></pre>\n<p><strong>Error message screenshot:</strong>\n<a href=\"https://i.stack.imgur.com/kdZeK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kdZeK.png\" alt=\"enter image description here\" /></a></p>\n<p>Any guidance or help on this will be very useful for us a quick solution!!\nThanks in Adavnce!</p>\n", "OwnerUserId": "13840480", "LastEditorUserId": "576752", "LastEditDate": "2022-04-04T19:11:09.200", "LastActivityDate": "2022-04-04T19:11:09.200", "Title": "Issue on Creating Azure subscription using terraform with Github Actions", "Tags": "<github><terraform><github-actions><azure-service-principal><azure-subscription>", "AnswerCount": "0", "CommentCount": "5", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "126770114", "PostId": "71725712", "Score": "0", "Text": "Please copy/paste error messages instead of screenshots, because that allows people to find your question if they have the same problem :)", "CreationDate": "2022-04-04T07:13:20.423", "UserId": "1080523", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "126773358", "PostId": "71725712", "Score": "0", "Text": "@rethab Thanks for the response! Have shared the error message as requested By editing the question! Please find the same!", "CreationDate": "2022-04-04T09:54:38.587", "UserId": "13840480", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "126774084", "PostId": "71725712", "Score": "0", "Text": "@AnirudhBragadeesan You can try to follow these prerequisites: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/programmatically-create-subscription-enterprise-agreement?tabs=rest#prerequisites", "CreationDate": "2022-04-04T10:27:02.080", "UserId": "4197899", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can try to follow these prerequisites: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/programmatically-create-subscription-enterprise-agreement?tabs=rest#prerequisites", "keywords": ["bill", "cost"]}]}, {"Id": "126775272", "PostId": "71725712", "Score": "0", "Text": "@LukaszKurzyniec Yeah...tried already going thru the link last Friday but still not able to grab exact point from that, we did assign subscription creator role thru REST API but didn't still work! Can you please help me grabbing the exact point. So it that we need to create that SPN as user in EA portal?", "CreationDate": "2022-04-04T11:22:57.817", "UserId": "13840480", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "129824755", "PostId": "71725712", "Score": "0", "Text": "@AnirudhBragadeesan when you have Enterprise Agreement with Microsoft, then you get access to a new portal (https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/ea-portal-administration). In that portal, you have to create a department and an account. Remember to assign \"Account owner\" role and associate that account to a department.\nThen, create a Service Principal which would be able to impersonate/authenticate as an above account and that is it.", "CreationDate": "2022-08-28T09:14:54.893", "UserId": "4197899", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "@AnirudhBragadeesan when you have Enterprise Agreement with Microsoft, then you get access to a new portal (https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/ea-portal-administration). ", "keywords": ["bill", "cost"]}]}], "history": [{"Id": "267380426", "PostHistoryTypeId": "2", "PostId": "71725712", "RevisionGUID": "3737c179-8062-46fb-bd5d-8e8916b09f4a", "CreationDate": "2022-04-03T12:04:26.430", "UserId": "13840480", "Text": "We are trying to create Azure subscriptions using Terraform & deploying through Github Actions.\r\nwhere we are obtaining the error message in terraform apply stage. Attaching the screenshot for reference. The **use case description** is below for reference:\r\n\r\n 1. SPN (Azure Service principal) created in Azure environment is used for this deployment.\r\n 2. SPN is assigned Owner role in Tenant level.\r\n 3. Have also followed this link & assigned the necessary privileges \r\n    for the subscription creator role using API on enrollment account.\r\n 4. we have the set the Github Actions \"Secrets\" perfect with the same\r\n    SPN details for authenticating the environment & rest resources are\r\n    getting spun up well.\r\n\r\n**Link**: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn.\r\n\r\n**Error message screenshot:**\r\n[![enter image description here][1]][1]\r\n\r\nAny guidance or help on this will be very useful for us a quick solution!!\r\nThanks in Adavnce!\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/kdZeK.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "**Link**: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn. **Error message screenshot:** [![enter image description here][1]][1] Any guidance or help on this will be very useful for us a quick solution!! Thanks in Adavnce! [1]: https://i.stack.imgur.com/kdZeK.png", "keywords": ["bill", "cost"]}]}, {"Id": "267380428", "PostHistoryTypeId": "1", "PostId": "71725712", "RevisionGUID": "3737c179-8062-46fb-bd5d-8e8916b09f4a", "CreationDate": "2022-04-03T12:04:26.430", "UserId": "13840480", "Text": "Issue on Creating Azure subscription using terraform with Github Actions", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267380429", "PostHistoryTypeId": "3", "PostId": "71725712", "RevisionGUID": "3737c179-8062-46fb-bd5d-8e8916b09f4a", "CreationDate": "2022-04-03T12:04:26.430", "UserId": "13840480", "Text": "<github><terraform><github-actions><azure-service-principal><azure-subscription>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267431238", "PostHistoryTypeId": "5", "PostId": "71725712", "RevisionGUID": "2746e4bd-b37b-436e-86e8-82d421e98b3c", "CreationDate": "2022-04-04T09:53:30.910", "UserId": "13840480", "Comment": "added 296 characters in body", "Text": "We are trying to create Azure subscriptions using Terraform & deploying through Github Actions.\r\nwhere we are obtaining the error message in terraform apply stage. Attaching the screenshot for reference. The **use case description** is below for reference:\r\n\r\n 1. SPN (Azure Service principal) created in Azure environment is used for this deployment.\r\n 2. SPN is assigned Owner role in Tenant level.\r\n 3. Have also followed this link & assigned the necessary privileges \r\n    for the subscription creator role using API on enrollment account.\r\n 4. we have the set the Github Actions \"Secrets\" perfect with the same\r\n    SPN details for authenticating the environment & rest resources are\r\n    getting spun up well.\r\n\r\n**Link**: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn.\r\n\r\nError Message:\r\ncreating new Subscription (Alias \"823XXXXXXX-285b-4084-92d8-885a43a7f7a5\"): subscription.AliasClient#Create: Failure sending request: StatusCode=401 -- Original Error: Code=\"UserNotAuthorized\" Message=\"User is not authorized to create subscriptions on this enrollment account\"\r\n\r\n**Error message screenshot:**\r\n[![enter image description here][1]][1]\r\n\r\nAny guidance or help on this will be very useful for us a quick solution!!\r\nThanks in Adavnce!\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/kdZeK.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "**Link**: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn. ", "keywords": ["bill", "cost"]}]}, {"Id": "267469850", "PostHistoryTypeId": "5", "PostId": "71725712", "RevisionGUID": "222d10ed-d866-4571-be17-ad1a0bb8b699", "CreationDate": "2022-04-04T19:11:09.200", "UserId": "576752", "Comment": "code formatting", "Text": "We are trying to create Azure subscriptions using Terraform & deploying through Github Actions.\r\nwhere we are obtaining the error message in terraform apply stage. Attaching the screenshot for reference. The **use case description** is below for reference:\r\n\r\n 1. SPN (Azure Service principal) created in Azure environment is used for this deployment.\r\n 2. SPN is assigned Owner role in Tenant level.\r\n 3. Have also followed this link & assigned the necessary privileges \r\n    for the subscription creator role using API on enrollment account.\r\n 4. we have the set the Github Actions \"Secrets\" perfect with the same\r\n    SPN details for authenticating the environment & rest resources are\r\n    getting spun up well.\r\n\r\n**Link**: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn.\r\n\r\nError Message:\r\n\r\n    creating new Subscription (Alias \"823XXXXXXX-285b-4084-92d8-885a43a7f7a5\"): subscription.AliasClient#Create: Failure sending request: StatusCode=401 -- Original Error: Code=\"UserNotAuthorized\" Message=\"User is not authorized to create subscriptions on this enrollment account\"\r\n\r\n**Error message screenshot:**\r\n[![enter image description here][1]][1]\r\n\r\nAny guidance or help on this will be very useful for us a quick solution!!\r\nThanks in Adavnce!\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/kdZeK.png", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "**Link**: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn. ", "keywords": ["bill", "cost"]}]}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "Link: https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#assign-the-subscription-creator-role-to-the-spn. ", "keywords": ["bill", "cost"]}]}