{"Id": "51267710", "PostTypeId": "1", "AcceptedAnswerId": "51269941", "CreationDate": "2018-07-10T14:22:33.697", "Score": "0", "ViewCount": "117", "Body": "<p>Ok.</p>\n\n<p>So I'm new to deploying <strong><em>infrastructure</em></strong> to Azure.</p>\n\n<p>I do understand the basics.</p>\n\n<p>I've been tasked to create a \"web tier\", \"middle tier machine\", and \"database server\" in Azure.  I'm probably using on-premise terms for these....maybe they map to Azure.</p>\n\n<p>I am using App-Service-Plan and App-Service.  Windows flavored.</p>\n\n<p>I am also liking terraform very much, but this question isn't terraform dependent I think.  (terraform is just the fancier way to create the necessary objects in Azure, or that's my novice understanding).</p>\n\n<p>So right now, I've been able to create.</p>\n\n<p>App-Service (which would be my \"web-server\").  I'll call this AppServiceWT.</p>\n\n<p>App-Service (which would be my \"middle tier\").  I'll call this AppServiceMT.</p>\n\n<p>And Sql-Server/Sql-Server database.</p>\n\n<p>I've been able to create some of this using terraform flavored scripts.</p>\n\n<pre><code>resource \"azurerm_resource_group\" \"testrg\" {}\n</code></pre>\n\n<p>..</p>\n\n<pre><code>resource \"azurerm_app_service_plan\" \"testaspwt\" {\n  name                = \"some-app-service-plan-for-webtier\"\n\n  sku {\n    tier = \"Standard\"\n    size = \"S1\"\n  }\n}\n\nresource \"azurerm_app_service\" \"testaswt\" {\n    name                = \"AppServiceWT_SomeGlobalUniqueName\"\n}\n</code></pre>\n\n<p>..</p>\n\n<pre><code>resource \"azurerm_app_service_plan\" \"testaspmt\" {\n  name                = \"some-app-service-plan-for-middletier\"\n\n  sku {\n    tier = \"Standard\"\n    size = \"S1\"\n  }\n}\n\nresource \"azurerm_app_service\" \"testasmt\" {\n    name                = \"AppServiceMT_SomeGlobalUniqueName\"\n}\n</code></pre>\n\n<p>..</p>\n\n<pre><code>resource \"azurerm_sql_server\" \"primary_azurerm_sql_server\" {}\n\nresource \"azurerm_sql_database\" \"primary_azurerm_sql_database\" {}\n</code></pre>\n\n<p>So I have the \"parts\" ( I think ??? ).</p>\n\n<p>So my hurdle now is.</p>\n\n<p>What am I doing to secure the network traffic.</p>\n\n<p>Requirements:</p>\n\n<p>The middleTier can make requests sql-server-tier.  sql-server-tier is not accessible to anything besides middle-tier.  In the on-premise world, we would open up port 1433 on the sql-server to allow traffic.</p>\n\n<p>The webTier can make requests middle-tier.  middle-tier is not accessible to anything besides web-tier.  In the on-premise world, we would open up port 80/443 on the middle-tier to allow traffic.</p>\n\n<p>WebTier is open to world.</p>\n\n<p>What azure \"objects\" am I missing?</p>\n\n<p>Bonus points for pointing to terraform \"tasks\" (or whatever they are called).</p>\n\n<p><a href=\"https://www.terraform.io/docs/providers/azurerm/index.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/providers/azurerm/index.html</a></p>\n\n<p>But yeah, I'm reaching out to SOF for help to fill in the \"traffic\" and \"secure network\" gaps in my head.</p>\n\n<p>Thanks in Advance.</p>\n\n<p>If I'm asking the wrong questions, let me know.</p>\n\n<p>I do not want to maintain my own VM's.  So I think Azure App-Service-Plan and App-Service is the correct choice.  While I'm a little familiar with Azure-Functions and Logic-Apps, we want to not use those for this project.</p>\n\n<p>To add a little more info.</p>\n\n<p>I'm eventually trying to do a \"hello world\" using the below microsoft how-to article.  The article above does not have a middle-tier, but once I have the concepts down, I think I can make a web/middle/sql 'hello world'.</p>\n\n<p><a href=\"https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-dotnetcore-sqldb\" rel=\"nofollow noreferrer\">https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-dotnetcore-sqldb</a></p>\n", "OwnerUserId": "214977", "LastEditorUserId": "214977", "LastEditDate": "2018-07-10T14:35:50.360", "LastActivityDate": "2018-07-10T16:11:51.977", "Title": "Securing a \"tiered\" application in Azure", "Tags": "<azure><azure-web-app-service><terraform><terraform-provider-azure>", "AnswerCount": "2", "CommentCount": "6", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "89513891", "PostId": "51267710", "Score": "0", "Text": "my personal opinion, web apps stink (especially windows ones), you should avoid them like a plague.", "CreationDate": "2018-07-10T14:27:01.350", "UserId": "6067741", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "89514296", "PostId": "51267710", "Score": "0", "Text": "I appreciate the input.  Do you have any concrete reasons/links why they \"stink\"?", "CreationDate": "2018-07-10T14:37:12.793", "UserId": "214977", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "89514418", "PostId": "51267710", "Score": "0", "Text": "slow,clunky,expensive", "CreationDate": "2018-07-10T14:40:34.447", "UserId": "6067741", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "slow,clunky,expensive", "keywords": ["expense"]}]}, {"Id": "89514873", "PostId": "51267710", "Score": "0", "Text": "So what is your \"alternate\" better proposals in your opinion?", "CreationDate": "2018-07-10T14:51:49.070", "UserId": "214977", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "89515026", "PostId": "51267710", "Score": "0", "Text": "serverless, containers", "CreationDate": "2018-07-10T14:55:29.507", "UserId": "6067741", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "89515241", "PostId": "51267710", "Score": "0", "Text": "Ok. Yeah, I agree serverless is so smooth (azure functions and .. using some of the logic app connectors).  The architects don't want to bite that off yet.  And we're trying to go containers on version TWO.  :(  But thanks for the input....#foodForThought", "CreationDate": "2018-07-10T15:00:44.643", "UserId": "214977", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "177346319", "PostHistoryTypeId": "2", "PostId": "51267710", "RevisionGUID": "0b77796c-35f2-4b8a-bd84-2ccd1814be85", "CreationDate": "2018-07-10T14:22:33.697", "UserId": "214977", "Text": "\r\nOk.\r\n\r\nSo I'm new to deploying ***infrastructure*** to Azure.\r\n\r\nI do understand the basics.\r\n\r\nI've been tasked to create a \"web tier\", \"middle tier machine\", and \"database server\" in Azure.  I'm probably using on-premise terms for these....maybe they map to Azure.\r\n\r\nI am using App-Service-Plan and App-Service.  Windows flavored.\r\n\r\nI am also liking terraform very much, but this question isn't terraform dependent I think.  (terraform is just the fancier way to create the necessary objects in Azure, or that's my novice understanding).\r\n\r\nSo right now, I've been able to create.\r\n\r\nApp-Service (which would be my \"web-server\").  I'll call this AppServiceWT.\r\n\r\nApp-Service (which would be my \"middle tier\").  I'll call this AppServiceMT.\r\n\r\nAnd Sql-Server/Sql-Server database.\r\n\r\nI've been able to create some of this using terraform flavored scripts.\r\n\r\n    resource \"azurerm_resource_group\" \"testrg\" {}\r\n    \r\n..\r\n\r\n    resource \"azurerm_app_service_plan\" \"testaspwt\" {\r\n      name                = \"some-app-service-plan-for-webtier\"\r\n    \r\n      sku {\r\n        tier = \"Standard\"\r\n        size = \"S1\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_app_service\" \"testaswt\" {\r\n        name                = \"AppServiceWT_SomeGlobalUniqueName\"\r\n    }\r\n\r\n..\r\n\r\n    resource \"azurerm_app_service_plan\" \"testaspmt\" {\r\n      name                = \"some-app-service-plan-for-middletier\"\r\n    \r\n      sku {\r\n        tier = \"Standard\"\r\n        size = \"S1\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_app_service\" \"testasmt\" {\r\n        name                = \"AppServiceMT_SomeGlobalUniqueName\"\r\n    }\r\n\r\n..\r\n\r\n    resource \"azurerm_sql_server\" \"primary_azurerm_sql_server\" {}\r\n\r\n    resource \"azurerm_sql_database\" \"primary_azurerm_sql_database\" {}\r\n\r\n\r\n\r\nSo I have the \"parts\" ( I think ??? ).\r\n\r\nSo my hurdle now is.\r\n\r\nWhat am I doing to secure the network traffic.\r\n\r\nRequirements:\r\n\r\nThe middleTier can make requests sql-server-tier.  sql-server-tier is not accessible to anything besides middle-tier.  In the on-premise world, we would open up port 1433 on the sql-server to allow traffic.\r\n\r\nThe webTier can make requests middle-tier.  middle-tier is not accessible to anything besides web-tier.  In the on-premise world, we would open up port 80/443 on the middle-tier to allow traffic.\r\n\r\nWebTier is open to world.\r\n\r\nWhat azure \"objects\" am I missing?\r\n\r\nBonus points for pointing to terraform \"tasks\" (or whatever they are called).\r\n\r\nhttps://www.terraform.io/docs/providers/azurerm/index.html\r\n\r\nBut yeah, I'm reaching out to SOF for help to fill in the \"traffic\" and \"secure network\" gaps in my head.\r\n\r\nThanks in Advance.\r\n\r\nIf I'm asking the wrong questions, let me know.\r\n\r\nI do not want to maintain my own VM's.  So I think Azure App-Service-Plan and App-Service is the correct choice.  While I'm a little familiar with Azure-Functions and Logic-Apps, we want to not use those for this project.\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I've been able to create some of this using terraform flavored scripts. resource \"azurerm_resource_group\" \"testrg\" {} .. resource \"azurerm_app_service_plan\" \"testaspwt\" { name = \"some-app-service-plan-for-webtier\" sku { tier = \"Standard\" size = \"S1\" } } resource \"azurerm_app_service\" \"testaswt\" { name = \"AppServiceWT_SomeGlobalUniqueName\" } .. resource \"azurerm_app_service_plan\" \"testaspmt\" { name = \"some-app-service-plan-for-middletier\" sku { tier = \"Standard\" size = \"S1\" } } resource \"azurerm_app_service\" \"testasmt\" { name = \"AppServiceMT_SomeGlobalUniqueName\" } .. resource \"azurerm_sql_server\" \"primary_azurerm_sql_server\" {} resource \"azurerm_sql_database\" \"primary_azurerm_sql_database\" {} So I have the \"parts\" ( I think ??? ). ", "keywords": ["test"]}]}, {"Id": "177346320", "PostHistoryTypeId": "1", "PostId": "51267710", "RevisionGUID": "0b77796c-35f2-4b8a-bd84-2ccd1814be85", "CreationDate": "2018-07-10T14:22:33.697", "UserId": "214977", "Text": "Securing a \"tiered\" application in Azure", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "177346321", "PostHistoryTypeId": "3", "PostId": "51267710", "RevisionGUID": "0b77796c-35f2-4b8a-bd84-2ccd1814be85", "CreationDate": "2018-07-10T14:22:33.697", "UserId": "214977", "Text": "<azure><azure-web-app-service><terraform><terraform-provider-azure>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "177347478", "PostHistoryTypeId": "5", "PostId": "51267710", "RevisionGUID": "1420ce3b-573b-48e2-9984-949926738849", "CreationDate": "2018-07-10T14:35:50.360", "UserId": "214977", "Comment": "added 351 characters in body", "Text": "Ok.\r\n\r\nSo I'm new to deploying ***infrastructure*** to Azure.\r\n\r\nI do understand the basics.\r\n\r\nI've been tasked to create a \"web tier\", \"middle tier machine\", and \"database server\" in Azure.  I'm probably using on-premise terms for these....maybe they map to Azure.\r\n\r\nI am using App-Service-Plan and App-Service.  Windows flavored.\r\n\r\nI am also liking terraform very much, but this question isn't terraform dependent I think.  (terraform is just the fancier way to create the necessary objects in Azure, or that's my novice understanding).\r\n\r\nSo right now, I've been able to create.\r\n\r\nApp-Service (which would be my \"web-server\").  I'll call this AppServiceWT.\r\n\r\nApp-Service (which would be my \"middle tier\").  I'll call this AppServiceMT.\r\n\r\nAnd Sql-Server/Sql-Server database.\r\n\r\nI've been able to create some of this using terraform flavored scripts.\r\n\r\n    resource \"azurerm_resource_group\" \"testrg\" {}\r\n    \r\n..\r\n\r\n    resource \"azurerm_app_service_plan\" \"testaspwt\" {\r\n      name                = \"some-app-service-plan-for-webtier\"\r\n    \r\n      sku {\r\n        tier = \"Standard\"\r\n        size = \"S1\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_app_service\" \"testaswt\" {\r\n        name                = \"AppServiceWT_SomeGlobalUniqueName\"\r\n    }\r\n\r\n..\r\n\r\n    resource \"azurerm_app_service_plan\" \"testaspmt\" {\r\n      name                = \"some-app-service-plan-for-middletier\"\r\n    \r\n      sku {\r\n        tier = \"Standard\"\r\n        size = \"S1\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_app_service\" \"testasmt\" {\r\n        name                = \"AppServiceMT_SomeGlobalUniqueName\"\r\n    }\r\n\r\n..\r\n\r\n    resource \"azurerm_sql_server\" \"primary_azurerm_sql_server\" {}\r\n\r\n    resource \"azurerm_sql_database\" \"primary_azurerm_sql_database\" {}\r\n\r\n\r\n\r\nSo I have the \"parts\" ( I think ??? ).\r\n\r\nSo my hurdle now is.\r\n\r\nWhat am I doing to secure the network traffic.\r\n\r\nRequirements:\r\n\r\nThe middleTier can make requests sql-server-tier.  sql-server-tier is not accessible to anything besides middle-tier.  In the on-premise world, we would open up port 1433 on the sql-server to allow traffic.\r\n\r\nThe webTier can make requests middle-tier.  middle-tier is not accessible to anything besides web-tier.  In the on-premise world, we would open up port 80/443 on the middle-tier to allow traffic.\r\n\r\nWebTier is open to world.\r\n\r\nWhat azure \"objects\" am I missing?\r\n\r\nBonus points for pointing to terraform \"tasks\" (or whatever they are called).\r\n\r\nhttps://www.terraform.io/docs/providers/azurerm/index.html\r\n\r\nBut yeah, I'm reaching out to SOF for help to fill in the \"traffic\" and \"secure network\" gaps in my head.\r\n\r\nThanks in Advance.\r\n\r\nIf I'm asking the wrong questions, let me know.\r\n\r\nI do not want to maintain my own VM's.  So I think Azure App-Service-Plan and App-Service is the correct choice.  While I'm a little familiar with Azure-Functions and Logic-Apps, we want to not use those for this project.\r\n\r\n\r\nTo add a little more info.\r\n\r\nI'm eventually trying to do a \"hello world\" using the below microsoft how-to article.  The article above does not have a middle-tier, but once I have the concepts down, I think I can make a web/middle/sql 'hello world'.\r\n\r\nhttps://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-dotnetcore-sqldb\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I've been able to create some of this using terraform flavored scripts. resource \"azurerm_resource_group\" \"testrg\" {} .. resource \"azurerm_app_service_plan\" \"testaspwt\" { name = \"some-app-service-plan-for-webtier\" sku { tier = \"Standard\" size = \"S1\" } } resource \"azurerm_app_service\" \"testaswt\" { name = \"AppServiceWT_SomeGlobalUniqueName\" } .. resource \"azurerm_app_service_plan\" \"testaspmt\" { name = \"some-app-service-plan-for-middletier\" sku { tier = \"Standard\" size = \"S1\" } } resource \"azurerm_app_service\" \"testasmt\" { name = \"AppServiceMT_SomeGlobalUniqueName\" } .. resource \"azurerm_sql_server\" \"primary_azurerm_sql_server\" {} resource \"azurerm_sql_database\" \"primary_azurerm_sql_database\" {} So I have the \"parts\" ( I think ??? ). ", "keywords": ["test"]}]}], "answers": [{"Id": "51269941", "PostTypeId": "2", "ParentId": "51267710", "CreationDate": "2018-07-10T16:11:51.977", "Score": "1", "Body": "<p>There are a few ways you can secure the application in the app service you are creating - </p>\n\n<p>1.I believe you are already doing it or not sure if you require it but\n    we can authenticate access to the web app (using OAuth2.0 etc..).   </p>\n\n<p>2.If you want more control over the network where we are  deploying the apps we<br>\n    can utilize App service Environments which provides\n    virtual network integration feature that helps you restrict incoming\n    source IP addresses through network security groups (NSGs). \n    Probably once can use it for both the front end and middle tier.    </p>\n\n<p>3.White-list  the allowed ranges of IP Address in the database.In your case if \n    any other service should not access the database other\n    than the web app , then it should be the IP of the frontend web app.</p>\n", "OwnerUserId": "8185214", "LastActivityDate": "2018-07-10T16:11:51.977", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "89595878", "PostId": "51269941", "Score": "0", "Text": "Avanish.  Thank you for your tip, with the key phrase \"App Service Environments\".  I think this is what I'm looking for.   \"devs can create a layered security architecture providing differing levels of network access for each physical application tier. desire is to hide API back-ends from general Internet access, and only allow APIs to be called by upstream web apps.  NSGs can be used on subnets containing App Service Environments to restrict public access to API applications.\"   https://docs.microsoft.com/en-us/azure/app-service/environment/app-service-app-service-environment-layered-security", "CreationDate": "2018-07-12T15:40:00.553", "UserId": "214977", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "89824316", "PostId": "51269941", "Score": "1", "Text": "For future readers.............App Service Environments is the answer for App-Services, BUT it is an EXPENSIVE feature for Azure.   (Monthly base cost of about $1500 before \"usage\").  So we're looking at Azure Container Instances instead because of the co$t.", "CreationDate": "2018-07-19T15:32:03.603", "UserId": "214977", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For future readers.............App Service Environments is the answer for App-Services, BUT it is an EXPENSIVE feature for Azure. ", "keywords": ["expense", "feature"]}, {"source": "Text", "text": "(Monthly base cost of about $1500 before \"usage\"). ", "keywords": ["cost"]}]}], "history": [{"Id": "177355310", "PostHistoryTypeId": "2", "PostId": "51269941", "RevisionGUID": "dee63116-85d9-4166-ae45-df7c1f033834", "CreationDate": "2018-07-10T16:11:51.977", "UserId": "8185214", "Text": "There are a few ways you can secure the application in the app service you are creating - \r\n\r\n 1.I believe you are already doing it or not sure if you require it but\r\n    we can authenticate access to the web app (using OAuth2.0 etc..).   \r\n        \r\n  2.If you want more control over the network where we are  deploying the apps we  \r\n    can utilize App service Environments which provides\r\n    virtual network integration feature that helps you restrict incoming\r\n    source IP addresses through network security groups (NSGs). \r\n    Probably once can use it for both the front end and middle tier.    \r\n        \r\n  3.White-list  the allowed ranges of IP Address in the database.In your case if \r\n    any other service should not access the database other\r\n    than the web app , then it should be the IP of the frontend web app.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "2.If you want more control over the network where we are deploying the apps we can utilize App service Environments which provides virtual network integration feature that helps you restrict incoming source IP addresses through network security groups (NSGs). ", "keywords": ["feature"]}]}], "filtered-sentences": [{"source": "Body", "text": "2.If you want more control over the network where we are deploying the apps we can utilize App service Environments which provides virtual network integration feature that helps you restrict incoming source IP addresses through network security groups (NSGs). ", "keywords": ["feature"]}]}, {"Id": "51267868", "PostTypeId": "2", "ParentId": "51267710", "CreationDate": "2018-07-10T14:29:09.067", "Score": "0", "Body": "<p>With webapps, your only option is opening webapp external ip addresses to sql to be able to talk to each other.</p>\n\n<p>webapp has got several potential external ip addresses it can have, so you open those on sql. traffic will use azure back bone as long as azure sql\\webapp are in the same region.</p>\n\n<p>On the middle tier you should use ip restrictions (web.config can do that).</p>\n", "OwnerUserId": "6067741", "LastActivityDate": "2018-07-10T14:29:09.067", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "177346952", "PostHistoryTypeId": "2", "PostId": "51267868", "RevisionGUID": "fbe11b9e-0c85-47a5-965f-1cdf4a913f21", "CreationDate": "2018-07-10T14:29:09.067", "UserId": "6067741", "Text": "With webapps, your only option is opening webapp external ip addresses to sql to be able to talk to each other.\r\n\r\nwebapp has got several potential external ip addresses it can have, so you open those on sql. traffic will use azure back bone as long as azure sql\\webapp are in the same region.\r\n\r\nOn the middle tier you should use ip restrictions (web.config can do that).", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}