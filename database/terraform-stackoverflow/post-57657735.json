{"Id": "57657735", "PostTypeId": "1", "CreationDate": "2019-08-26T12:13:07.667", "Score": "0", "ViewCount": "42", "Body": "<p>I want to try to develope my lambda-function in terraform. Since the function is a cross account costoverview, how can I assume in terraform multiple accounts?</p>\n\n<p>So this is a codesnippet from my <code>main.tf</code></p>\n\n<pre><code>\n#ROLE FOR ACCOUNT A COST REPORT\nresource \"aws_iam_role\" \"role_costoverview\" {\n  name                  = \"role_costoverview\"\n  description           = \"default cross report role\"\n  assume_role_policy    = \"${file(\"policy_account_a.json\")}\"\n}\n\n\n#ROLE FOR ACCOUNT B COST REPORT                      \nresource \"aws_iam_role\" \"role_costoverview\" {\n  name                  = \"role_costoverview\"\n  description           = \"assume_role cross report role\"\n  assume_role_policy    = \"${file(\"policy_account_b.json\")}\"\n}\n</code></pre>\n\n<p>So how can I write the code that Terraform recognize, there are two accounts?</p>\n", "OwnerUserId": "11793317", "LastActivityDate": "2019-09-03T14:16:48.487", "Title": "How to assign accounts in Terraform", "Tags": "<amazon-web-services><terraform>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "204180613", "PostHistoryTypeId": "2", "PostId": "57657735", "RevisionGUID": "207fed65-cecf-4cd5-829c-9aabfb860cd5", "CreationDate": "2019-08-26T12:13:07.667", "UserId": "11793317", "Text": "I want to try to develope my lambda-function in terraform. Since the function is a cross account costoverview, how can I assume in terraform multiple accounts?\r\n\r\nSo this is a codesnippet from my ```main.tf```\r\n```terraform\r\n\r\n#ROLE FOR ACCOUNT A COST REPORT\r\nresource \"aws_iam_role\" \"role_costoverview\" {\r\n  name                  = \"role_costoverview\"\r\n  description           = \"default cross report role\"\r\n  assume_role_policy    = \"${file(\"policy_account_a.json\")}\"\r\n}\r\n\r\n\r\n#ROLE FOR ACCOUNT B COST REPORT                      \r\nresource \"aws_iam_role\" \"role_costoverview\" {\r\n  name                  = \"role_costoverview\"\r\n  description           = \"assume_role cross report role\"\r\n  assume_role_policy    = \"${file(\"policy_account_b.json\")}\"\r\n}\r\n```\r\n\r\nSo how can I write the code that Terraform recognize, there are two accounts?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "So this is a codesnippet from my ```main.tf``` ```terraform #ROLE FOR ACCOUNT A COST REPORT resource \"aws_iam_role\" \"role_costoverview\" { name = \"role_costoverview\" description = \"default cross report role\" assume_role_policy = \"${file(\"policy_account_a.json\")}\" } #ROLE FOR ACCOUNT B COST REPORT resource \"aws_iam_role\" \"role_costoverview\" { name = \"role_costoverview\" description = \"assume_role cross report role\" assume_role_policy = \"${file(\"policy_account_b.json\")}\" ", "keywords": ["cost"]}]}, {"Id": "204180614", "PostHistoryTypeId": "1", "PostId": "57657735", "RevisionGUID": "207fed65-cecf-4cd5-829c-9aabfb860cd5", "CreationDate": "2019-08-26T12:13:07.667", "UserId": "11793317", "Text": "How to assign accounts in Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "204180615", "PostHistoryTypeId": "3", "PostId": "57657735", "RevisionGUID": "207fed65-cecf-4cd5-829c-9aabfb860cd5", "CreationDate": "2019-08-26T12:13:07.667", "UserId": "11793317", "Text": "<amazon-web-services><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "57773582", "PostTypeId": "2", "ParentId": "57657735", "CreationDate": "2019-09-03T14:16:48.487", "Score": "0", "Body": "<p>As far as I understood your question, you have TWO different AWS accounts, right?\nI do also work with different AWS accounts, and each time I have to set the environment variable for required account.\nSo, I have small script (<code>script.sh</code>) with account details:</p>\n\n<pre><code>export AWS_REGION=\"region-where-I-want-to-apply\"\nexport AWS_ACCESS_KEY_ID=\"XXXXXXXXXXXXXX\"\nexport AWS_SECRET_ACCESS_KEY=\"XXXXXXXXXXXXXXXXXXXXXXXXXXX\"\nexport TF_VAR_region=\"${AWS_REGION}\"\nexport TF_VAR_public_key='ssh-rsa AAAAB3NzXXXXXXXXXXXXXXXXXXXXXXXXX XXX-ssh-key'\n\nexport TF_VAR_access_key=$AWS_ACCESS_KEY_ID\nexport TF_VAR_secret_key=$AWS_SECRET_ACCESS_KEY\n</code></pre>\n\n<p>The AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY are from one account and for another account you can create another file.\nI just have to <code>source</code> this script before switching to another account.\n<code>$source /script/path/script.sh</code></p>\n", "OwnerUserId": "4273422", "LastActivityDate": "2019-09-03T14:16:48.487", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "204669446", "PostHistoryTypeId": "2", "PostId": "57773582", "RevisionGUID": "b5902fdb-b2bb-4352-8035-969c846cf4c1", "CreationDate": "2019-09-03T14:16:48.487", "UserId": "4273422", "Text": "As far as I understood your question, you have TWO different AWS accounts, right?\r\nI do also work with different AWS accounts, and each time I have to set the environment variable for required account.\r\nSo, I have small script (`script.sh`) with account details:\r\n```\r\nexport AWS_REGION=\"region-where-I-want-to-apply\"\r\nexport AWS_ACCESS_KEY_ID=\"XXXXXXXXXXXXXX\"\r\nexport AWS_SECRET_ACCESS_KEY=\"XXXXXXXXXXXXXXXXXXXXXXXXXXX\"\r\nexport TF_VAR_region=\"${AWS_REGION}\"\r\nexport TF_VAR_public_key='ssh-rsa AAAAB3NzXXXXXXXXXXXXXXXXXXXXXXXXX XXX-ssh-key'\r\n\r\nexport TF_VAR_access_key=$AWS_ACCESS_KEY_ID\r\nexport TF_VAR_secret_key=$AWS_SECRET_ACCESS_KEY\r\n```\r\n\r\nThe AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY are from one account and for another account you can create another file.\r\nI just have to `source` this script before switching to another account.\r\n``` $source /script/path/script.sh ```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": []}