{"Id": "66644265", "PostTypeId": "1", "CreationDate": "2021-03-15T19:14:05.683", "Score": "3", "ViewCount": "2885", "Body": "<p>I'm trying to create a google cloud project with terraform. I'm refering to this link as a reference...\n<a href=\"https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742\" rel=\"nofollow noreferrer\">https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742</a></p>\n<p>I followed the instruction on project creation and IAM roles from the medium post. From what it looks like you need a separate project and service account just for creating projects with terraform. I also refered to googles documentation on the subject...\n<a href=\"https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform\" rel=\"nofollow noreferrer\">https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform</a></p>\n<p>So I ended up with this in my main.tf</p>\n<pre><code># This is the provider used to spin up the gcloud instance\nprovider &quot;google&quot; {\n  credentials = &quot;/path/to/seed-credentials.json&quot;\n}\n\n# Locks the version of Terraform for this particular use case\nterraform {\n  required_version = &quot;0.14.6&quot;\n}\n\n\nresource &quot;random_id&quot; &quot;id&quot; {\n  byte_length = 4\n  prefix      = var.project_name\n}\n\nresource &quot;google_project&quot; &quot;project&quot; {\n  name            = var.project_name\n  project_id      = random_id.id.hex\n  billing_account = var.billing_account\n}\n\noutput &quot;project_id&quot; {\n  value = google_project.project.project_id\n }\n\n</code></pre>\n<p>I created a remote backend</p>\n<pre><code>terraform {\n backend &quot;gcs&quot; {\n   bucket  = &quot;seed-bucket&quot;\n   prefix  = &quot;terraform/state&quot;\n   credentials = &quot;/path/to/seed-credentials.json&quot;\n }\n}\n</code></pre>\n<p>here's my variables.tf file</p>\n<pre><code>variable &quot;project_name&quot; {\n  type = string\n}\n\nvariable &quot;billing_account&quot; {\n  type = string\n}\n\n</code></pre>\n<p>and last but not least my terraform.tfvars</p>\n<pre><code>project_name = &quot;test-project&quot;\nbilling_account = &quot;1234-5678-90xxx&quot;\n</code></pre>\n<p>Terraform init works it configures the remote backend. Terraform plan gives me no errors. However when I run terraform apply I get the following error &quot;Error: failed pre-requisites: missing permission on &quot;billingAccounts/1234-5678-9xxx&quot;: billing.resourceAssociations.create&quot;\nNow I have no organizations for this account. I'm assuming that's what's giving me the error?\nThe author of the Medium blog post said something about &quot; Firstly you need to create an Organization based in your domain&quot;\nI've never used organiztions for my google projects. I go into my google console and it says I need domain verification to get an organization for my account. That seems troublesome. I don't really don't to go through the trouble of getting a new domain just for this. Now is my code correct? I'm assuming the error is from me not having an &quot;organization&quot;. Is there an easy way to get an organization without domain verification?</p>\n", "OwnerUserId": "15114500", "LastEditorUserId": "8016720", "LastEditDate": "2021-03-15T19:55:45.333", "LastActivityDate": "2022-03-24T13:15:44.417", "Title": "Terraform GCP Project creation", "Tags": "<google-cloud-platform><terraform><terraform-provider-gcp><google-cloud-iam><google-cloud-billing>", "AnswerCount": "3", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "links": [{"Id": "1852382845", "CreationDate": "2021-03-16T00:46:12.400", "PostId": "66644265", "RelatedPostId": "56311272", "LinkTypeId": "1"}], "history": [{"Id": "242730849", "PostHistoryTypeId": "2", "PostId": "66644265", "RevisionGUID": "b481e1af-4640-4756-8fe0-6a4225b003c5", "CreationDate": "2021-03-15T19:14:05.683", "UserId": "15114500", "Text": "I'm trying to create a google cloud project with terraform. I'm refering to this link as a reference...\r\n[https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742][1]\r\n\r\n\r\nI followed the instruction on project creation and IAM roles from the medium post. From what it looks like you need a separate project and service account just for creating projects with terraform. I also refered to googles documentation on the subject...\r\n[https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform][2]\r\n\r\nSo I ended up with this in my main.tf\r\n\r\n```\r\n# This is the provider used to spin up the gcloud instance\r\nprovider \"google\" {\r\n  credentials = \"/path/to/seed-credentials.json\"\r\n}\r\n\r\n# Locks the version of Terraform for this particular use case\r\nterraform {\r\n  required_version = \"0.14.6\"\r\n}\r\n\r\n\r\nresource \"random_id\" \"id\" {\r\n  byte_length = 4\r\n  prefix      = var.project_name\r\n}\r\n\r\nresource \"google_project\" \"project\" {\r\n  name            = var.project_name\r\n  project_id      = random_id.id.hex\r\n  billing_account = var.billing_account\r\n}\r\n\r\noutput \"project_id\" {\r\n  value = google_project.project.project_id\r\n }\r\n\r\n```\r\nI created a remote backend\r\n```\r\nterraform {\r\n backend \"gcs\" {\r\n   bucket  = \"seed-bucket\"\r\n   prefix  = \"terraform/state\"\r\n   credentials = \"/path/to/seed-credentials.json\"\r\n }\r\n}\r\n```\r\nhere's my variables.tf file\r\n```\r\nvariable \"project_name\" {\r\n  type = string\r\n}\r\n\r\nvariable \"billing_account\" {\r\n  type = string\r\n}\r\n\r\n```\r\nand last but not least my terraform.tfvars\r\n```\r\nproject_name = \"test-project\"\r\nbilling_account = \"1234-5678-90xxx\"\r\n```\r\nTerraform init works it configures the remote backend. Terraform plan gives me no errors. However when I run terraform apply I get the following error \"Error: failed pre-requisites: missing permission on \"billingAccounts/1234-5678-9xxx\": billing.resourceAssociations.create\"\r\nNow I have no organizations for this account. I'm assuming that's what's giving me the error?\r\nThe author of the Medium blog post said something about \" Firstly you need to create an Organization based in your domain\"\r\nI've never used organiztions for my google projects. I go into my google console and it says I need domain verification to get an organization for my account. That seems troublesome. I don't really don't to go through the trouble of getting a new domain just for this. Now is my code correct? I'm assuming the error is from me not having an \"organization\". Is there an easy way to get an organization without domain verification?\r\n\r\n  [1]: https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742\r\n  [2]: https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "So I ended up with this in my main.tf ``` # This is the provider used to spin up the gcloud instance provider \"google\" { credentials = \"/path/to/seed-credentials.json\" } # Locks the version of Terraform for this particular use case terraform { required_version = \"0.14.6\" } resource \"random_id\" \"id\" { byte_length = 4 prefix = var.project_name } resource \"google_project\" \"project\" { name = var.project_name project_id = random_id.id.hex billing_account = var.billing_account } output \"project_id\" { value = google_project.project.project_id } ``` I created a remote backend ``` terraform { backend \"gcs\" { bucket = \"seed-bucket\" prefix = \"terraform/state\" credentials = \"/path/to/seed-credentials.json\" } } ``` here's my variables.tf file ``` variable \"project_name\" { type = string } variable \"billing_account\" { type = string } ``` and last but not least my terraform.tfvars ``` project_name = \"test-project\" billing_account = \"1234-5678-90xxx\" ``` ", "keywords": ["bill", "instance", "provider", "test"]}, {"source": "Text", "text": "However when I run terraform apply I get the following error \"Error: failed pre-requisites: missing permission on \"billingAccounts/1234-5678-9xxx\": billing.resourceAssociations.create\" ", "keywords": ["bill"]}, {"source": "Text", "text": "Firstly you need to create an Organization based in your domain\" ", "keywords": ["domain"]}, {"source": "Text", "text": "I go into my google console and it says I need domain verification to get an organization for my account. ", "keywords": ["domain"]}, {"source": "Text", "text": "I don't really don't to go through the trouble of getting a new domain just for this. ", "keywords": ["domain"]}, {"source": "Text", "text": "Is there an easy way to get an organization without domain verification? ", "keywords": ["domain"]}]}, {"Id": "242730850", "PostHistoryTypeId": "1", "PostId": "66644265", "RevisionGUID": "b481e1af-4640-4756-8fe0-6a4225b003c5", "CreationDate": "2021-03-15T19:14:05.683", "UserId": "15114500", "Text": "Terraform GCP Project creation", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "242730851", "PostHistoryTypeId": "3", "PostId": "66644265", "RevisionGUID": "b481e1af-4640-4756-8fe0-6a4225b003c5", "CreationDate": "2021-03-15T19:14:05.683", "UserId": "15114500", "Text": "<google-cloud-platform><service><terraform><project><account>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "242733083", "PostHistoryTypeId": "6", "PostId": "66644265", "RevisionGUID": "6b39623c-61c6-42cd-ac8d-d43fa4f5dd65", "CreationDate": "2021-03-15T19:55:45.333", "UserId": "8016720", "Comment": "edited tags", "Text": "<google-cloud-platform><terraform><terraform-provider-gcp><google-cloud-iam><google-cloud-billing>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "71603199", "PostTypeId": "2", "ParentId": "66644265", "CreationDate": "2022-03-24T13:15:44.417", "Score": "0", "Body": "<p>I also faced similar kind of issue, 403 error and it was taking my personal google credential, however the reason was I remove the credentials file detail in during testing and forgot to add again. therefore, it was taking my personal account credentials, after adding the credential file correctly it worked.</p>\n", "OwnerUserId": "18011679", "LastActivityDate": "2022-03-24T13:15:44.417", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "266704490", "PostHistoryTypeId": "2", "PostId": "71603199", "RevisionGUID": "b5a43b72-ecd2-4b6d-b92e-bae63db4a6a0", "CreationDate": "2022-03-24T13:15:44.417", "UserId": "18011679", "Text": "I also faced similar kind of issue, 403 error and it was taking my personal google credential, however the reason was I remove the credentials file detail in during testing and forgot to add again. therefore, it was taking my personal account credentials, after adding the credential file correctly it worked.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I also faced similar kind of issue, 403 error and it was taking my personal google credential, however the reason was I remove the credentials file detail in during testing and forgot to add again. ", "keywords": ["test"]}]}], "filtered-sentences": [{"source": "Body", "text": "I also faced similar kind of issue, 403 error and it was taking my personal google credential, however the reason was I remove the credentials file detail in during testing and forgot to add again. ", "keywords": ["test"]}]}, {"Id": "68212128", "PostTypeId": "2", "ParentId": "66644265", "CreationDate": "2021-07-01T14:34:41.137", "Score": "0", "Body": "<p>Once billing administrator permission is allocated as suggested above, Project Creator role can be granted using following flow.</p>\n<p>Go to GCP Console and search for Manage Resource Page (Google Console) --&gt; Select organization --&gt; Permissions Tab (Right hand window ) --&gt; Add Member --&gt; Allocate Project Creator role to Terraform service account (save)</p>\n<p>Verify : You will see Terraform service account listed in &quot;Project Creator under Role/Member section on right side panel of this page (Resource Manager Page).</p>\n", "OwnerUserId": "12880763", "LastActivityDate": "2021-07-01T14:34:41.137", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "249488281", "PostHistoryTypeId": "2", "PostId": "68212128", "RevisionGUID": "284d8cc8-6395-47f2-b7d3-ec6d1c6f50d4", "CreationDate": "2021-07-01T14:34:41.137", "UserId": "12880763", "Text": "Once billing administrator permission is allocated as suggested above, Project Creator role can be granted using following flow.\r\n\r\nGo to GCP Console and search for Manage Resource Page (Google Console) --> Select organization --> Permissions Tab (Right hand window ) --> Add Member --> Allocate Project Creator role to Terraform service account (save)\r\n\r\nVerify : You will see Terraform service account listed in \"Project Creator under Role/Member section on right side panel of this page (Resource Manager Page).", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Once billing administrator permission is allocated as suggested above, Project Creator role can be granted using following flow. ", "keywords": ["bill"]}]}], "filtered-sentences": [{"source": "Body", "text": "Once billing administrator permission is allocated as suggested above, Project Creator role can be granted using following flow. ", "keywords": ["bill"]}]}, {"Id": "66644811", "PostTypeId": "2", "ParentId": "66644265", "CreationDate": "2021-03-15T19:55:07.170", "Score": "4", "Body": "<p>The error <code>missing permission on &quot;billingAccounts/1234-5678-9xxx&quot;: billing.resourceAssociations.create&quot;</code> means that the service account does not have permission to link the billing account to a new project.</p>\n<ul>\n<li>Go to the <a href=\"https://console.cloud.google.com/billing\" rel=\"nofollow noreferrer\">Billing</a> in the Google Cloud Console.</li>\n<li>In the top right of the window, click &quot;SHOW INFO PANEL&quot;.</li>\n<li>Select the billing account and then click &quot;ADD MEMBER&quot;.</li>\n<li>Enter the service account email address.</li>\n<li>Select the role <code>Billing Account User</code>.</li>\n<li>Click SAVE.</li>\n</ul>\n<p>The service account now has permission to attach the billing account to new projects.</p>\n<p><a href=\"https://cloud.google.com/billing/docs/how-to/billing-access\" rel=\"nofollow noreferrer\">Overview of Cloud Billing access control</a></p>\n", "OwnerUserId": "8016720", "LastActivityDate": "2021-03-15T19:55:07.170", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "118948443", "PostId": "66644811", "Score": "2", "Text": "I was getting same error and applied this solution. It worked! I was following this tutorial to create projects via \"Service Account\" and \"Terraform\": https://cloud.google.com/community/tutorials/managing-gcp-projects-with-terraform\n\nProject, Organization and Billing are 3 separate components for permissions. Giving \"Organization\" level is not enough. The permission should be given from \"Billing Account\" as well.", "CreationDate": "2021-04-28T06:59:19.280", "UserId": "5727268", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "242733060", "PostHistoryTypeId": "2", "PostId": "66644811", "RevisionGUID": "c8753d41-ca93-4195-8fb2-8848920b9a3d", "CreationDate": "2021-03-15T19:55:07.170", "UserId": "8016720", "Text": "The error `missing permission on \"billingAccounts/1234-5678-9xxx\": billing.resourceAssociations.create\"` means that the service account does not have permission to link the billing account to a new project.\r\n\r\n - Go to the [Billing][1] in the Google Cloud Console.\r\n - In the top right of the window, click \"SHOW INFO PANEL\".\r\n - Select the billing account and then click \"ADD MEMBER\".\r\n - Enter the service account email address.\r\n - Select the role `Billing Account User`.\r\n - Click SAVE.\r\n\r\nThe service account now has permission to attach the billing account to new projects.\r\n\r\n[Overview of Cloud Billing access control][2]\r\n\r\n\r\n  [1]: https://console.cloud.google.com/billing\r\n  [2]: https://cloud.google.com/billing/docs/how-to/billing-access", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "The error `missing permission on \"billingAccounts/1234-5678-9xxx\": billing.resourceAssociations.create\"` means that the service account does not have permission to link the billing account to a new project. ", "keywords": ["bill"]}, {"source": "Text", "text": "- Select the billing account and then click \"ADD MEMBER\". ", "keywords": ["bill"]}, {"source": "Text", "text": "The service account now has permission to attach the billing account to new projects. ", "keywords": ["bill"]}, {"source": "Text", "text": "[Overview of Cloud Billing access control][2] [1]: https://console.cloud.google.com/billing [2]: https://cloud.google.com/billing/docs/how-to/billing-access", "keywords": ["bill"]}]}], "filtered-sentences": [{"source": "Body", "text": "The error missing permission on \"billingAccounts/1234-5678-9xxx\": billing.resourceAssociations.create\" means that the service account does not have permission to link the billing account to a new project. ", "keywords": ["bill"]}, {"source": "Body", "text": "Select the billing account and then click \"ADD MEMBER\". ", "keywords": ["bill"]}, {"source": "Body", "text": "The service account now has permission to attach the billing account to new projects. ", "keywords": ["bill"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "However when I run terraform apply I get the following error \"Error: failed pre-requisites: missing permission on \"billingAccounts/1234-5678-9xxx\": billing.resourceAssociations.create\" ", "keywords": ["bill"]}, {"source": "Body", "text": "Firstly you need to create an Organization based in your domain\" ", "keywords": ["domain"]}, {"source": "Body", "text": "I go into my google console and it says I need domain verification to get an organization for my account. ", "keywords": ["domain"]}, {"source": "Body", "text": "I don't really don't to go through the trouble of getting a new domain just for this. ", "keywords": ["domain"]}, {"source": "Body", "text": "Is there an easy way to get an organization without domain verification?", "keywords": ["domain"]}]}