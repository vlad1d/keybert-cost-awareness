{"Id": "75506396", "PostTypeId": "1", "AcceptedAnswerId": "75506442", "CreationDate": "2023-02-20T07:31:44.047", "Score": "0", "ViewCount": "771", "Body": "<p>It seems that modifying a dynamo table is <a href=\"https://stackoverflow.com/a/66387833/10946893\">not allowed with terraform</a>.</p>\n<p>How would I go about adding a GSI to an existing table with terraform? I was previously doing it in python (with boto3 <code>update_table</code>), but now trying to do it in Terraform. I don't want to lose data nor to have to do it manually.</p>\n<p>This is the error I keep getting:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>Error: error creating DynamoDB Table: ResourceInUseException: Table already exists\n</code></pre>\n<p>And my code:</p>\n<pre><code># Create a DynamoDB table with GSIs.\nresource &quot;aws_dynamodb_table&quot; &quot;table&quot; {\n  name         = var.function_name\n  billing_mode = &quot;PAY_PER_REQUEST&quot;\n  hash_key     = &quot;PK&quot; # partition key\n  range_key    = &quot;SK&quot; # sort key\n\n  # Partition Key.\n  attribute {\n    name = &quot;PK&quot;\n    type = &quot;S&quot;\n  }\n\n  # Sort Key (datetime in UTC).\n  attribute {\n    name = &quot;SK&quot;\n    type = &quot;S&quot;\n  }\n\n  # Date (no time).\n  attribute {\n    name = &quot;date&quot;\n    type = &quot;S&quot;\n  }\n\n  # Define a GSI.\n  global_secondary_index {\n    name            = &quot;date-index&quot;\n    hash_key        = &quot;date&quot; # partition key\n    range_key       = &quot;SK&quot;\n    projection_type = &quot;ALL&quot;\n  }\n}\n</code></pre>\n", "OwnerUserId": "10946893", "LastActivityDate": "2023-02-20T07:37:46.140", "Title": "Adding a GSI to a DynamoDB table with terraform", "Tags": "<amazon-web-services><terraform><amazon-dynamodb><terraform-provider-aws>", "AnswerCount": "1", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133219696", "PostId": "75506396", "Score": "0", "Text": "Modifying a table is allowed for values that can be updated. That is not a terraform thing; you just can change keys without recreating the table. You can on a GSI thought, just not main table or LSI.", "CreationDate": "2023-02-20T08:27:57.710", "UserId": "2081835", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "That is not a terraform thing; you just can change keys without recreating the table. ", "keywords": ["change"]}]}, {"Id": "133224173", "PostId": "75506396", "Score": "1", "Text": "@theherk you can add a GSI without recreating the table, but the table has to be managed by terraform first.", "CreationDate": "2023-02-20T13:01:47.230", "UserId": "13070", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "133226510", "PostId": "75506396", "Score": "0", "Text": "@MarkB: That is precisely what I intended; I was referencing the line that terraform doesn't allow updating tables. In summary, the issue was that it wasn't imported. Neither AWS nor terraform prevent addition of GSI's.", "CreationDate": "2023-02-20T15:07:33.210", "UserId": "2081835", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "links": [{"Id": "2024474326", "CreationDate": "2023-02-20T07:31:44.047", "PostId": "75506396", "RelatedPostId": "66387610", "LinkTypeId": "1"}], "history": [{"Id": "288386396", "PostHistoryTypeId": "2", "PostId": "75506396", "RevisionGUID": "8e1228aa-920e-4dcb-b7a4-94285eb2e5d6", "CreationDate": "2023-02-20T07:31:44.047", "UserId": "10946893", "Text": "It seems that modifying a dynamo table is [not allowed with terraform](https://stackoverflow.com/a/66387833/10946893).\r\n\r\nHow would I go about adding a GSI to an existing table with terraform? I was previously doing it in python (with boto3 `update_table`), but now trying to do it in Terraform. I don't want to lose data nor to have to do it manually.\r\n\r\nThis is the error I keep getting:\r\n\r\n```sh\r\nError: error creating DynamoDB Table: ResourceInUseException: Table already exists\r\n```\r\n\r\nAnd my code:\r\n\r\n```hcl\r\n# Create a DynamoDB table with GSIs.\r\nresource \"aws_dynamodb_table\" \"table\" {\r\n  name         = var.function_name\r\n  billing_mode = \"PAY_PER_REQUEST\"\r\n  hash_key     = \"PK\" # partition key\r\n  range_key    = \"SK\" # sort key\r\n\r\n  # Partition Key.\r\n  attribute {\r\n    name = \"PK\"\r\n    type = \"S\"\r\n  }\r\n\r\n  # Sort Key (datetime in UTC).\r\n  attribute {\r\n    name = \"SK\"\r\n    type = \"S\"\r\n  }\r\n\r\n  # Date (no time).\r\n  attribute {\r\n    name = \"date\"\r\n    type = \"S\"\r\n  }\r\n\r\n  # Define a GSI.\r\n  global_secondary_index {\r\n    name            = \"date-index\"\r\n    hash_key        = \"date\" # partition key\r\n    range_key       = \"SK\"\r\n    projection_type = \"ALL\"\r\n  }\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "And my code: ```hcl # Create a DynamoDB table with GSIs. resource \"aws_dynamodb_table\" \"table\" { name = var.function_name billing_mode = \"PAY_PER_REQUEST\" hash_key = \"PK\" # partition key range_key = \"SK\" # sort key # Partition Key. attribute { name = \"PK\" type = \"S\" ", "keywords": ["bill"]}]}, {"Id": "288386398", "PostHistoryTypeId": "1", "PostId": "75506396", "RevisionGUID": "8e1228aa-920e-4dcb-b7a4-94285eb2e5d6", "CreationDate": "2023-02-20T07:31:44.047", "UserId": "10946893", "Text": "Adding a GSI to a DynamoDB table with terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "288386399", "PostHistoryTypeId": "3", "PostId": "75506396", "RevisionGUID": "8e1228aa-920e-4dcb-b7a4-94285eb2e5d6", "CreationDate": "2023-02-20T07:31:44.047", "UserId": "10946893", "Text": "<amazon-web-services><terraform><amazon-dynamodb><terraform-provider-aws>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "75506442", "PostTypeId": "2", "ParentId": "75506396", "CreationDate": "2023-02-20T07:37:46.140", "Score": "2", "Body": "<p>You have to first <a href=\"https://developer.hashicorp.com/terraform/cli/commands/import\" rel=\"nofollow noreferrer\">import</a> your table into terraform. Only then you will be able to edit it using TF.</p>\n", "OwnerUserId": "248823", "LastActivityDate": "2023-02-20T07:37:46.140", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "288386652", "PostHistoryTypeId": "2", "PostId": "75506442", "RevisionGUID": "6f3b4885-2895-4033-9584-3a1f13724107", "CreationDate": "2023-02-20T07:37:46.140", "UserId": "248823", "Text": "You have to first [import](https://developer.hashicorp.com/terraform/cli/commands/import) your table into terraform. Only then you will be able to edit it using TF.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}