{"Id": "56311272", "PostTypeId": "1", "AcceptedAnswerId": "72378813", "CreationDate": "2019-05-26T06:40:48.533", "Score": "5", "ViewCount": "2358", "Body": "<p>I'm following the <a href=\"https://medium.com/@mudrii/google-gke-and-sql-with-terraform-294fb84061\" rel=\"nofollow noreferrer\">Google GKE and SQL with terraform</a> tutorial\nBut I'm not able to create a <em>google_project.project</em>.\nI have tried both as the owner of the project and as the service described in the tutorial. Both attempts end with this error:</p>\n\n<pre><code>Error: Error applying plan:\n\n1 error(s) occurred:\n\n* google_project.project: 1 error(s) occurred:\n\n* google_project.project: error creating project terraform-dev-357aa670 \n (terraform-dev): googleapi: Error 403: User is not authorized., forbidden. \n  If you received a 403 error, make sure \n  you have the `roles/resourcemanager.projectCreator` permission\n</code></pre>\n\n<p>I would think that I had the correct permissions as the project owner, but apparently not.</p>\n\n<p><strong>Here's how I created the service account:</strong></p>\n\n<pre><code>$ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\                                (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default)\n&gt; --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\\n&gt; --role roles/resourcemanager.projectCreator\nUpdated IAM policy for organization [00000].\nbindings:\n- members:\n  - domain:my-domain.no\n  role: roles/billing.creator\n- members:\n  - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\n  - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\n  role: roles/billing.user\n- members:\n  - domain:min-familie.no\n  - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\n  - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\n  role: roles/resourcemanager.projectCreator\netag: BwWJxJTDnQs=\nversion: 19d\n</code></pre>\n\n<p>Creating a project \"manually\" works.\n<code>$ gcloud projects create ${TF_ADMIN}</code>.</p>\n\n<p>Any ideas what might be wrong?</p>\n", "OwnerUserId": "375721", "LastEditorUserId": "375721", "LastEditDate": "2019-05-29T06:18:47.757", "LastActivityDate": "2022-05-25T13:45:30.190", "Title": "Unable to create google project with Terraform", "Tags": "<google-cloud-platform><terraform>", "AnswerCount": "2", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "99238688", "PostId": "56311272", "Score": "0", "Text": "Maybe try and create a project using the gcloud command from the command line and see if you can perform that task without going near terraform ... see  https://cloud.google.com/sdk/gcloud/reference/projects/create", "CreationDate": "2019-05-26T15:18:17.150", "UserId": "1738915", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "198471912", "PostHistoryTypeId": "2", "PostId": "56311272", "RevisionGUID": "dbd01102-7e55-4bba-a030-0efc55e88c3f", "CreationDate": "2019-05-26T06:40:48.533", "UserId": "375721", "Text": "I'm following the [Google GKE and SQL with terraform][1] tutorial\r\nBut I'm not able to create a *google_project.project*.\r\nI have tried both as the owner of the project and as the service described in the tutorial. Both attempts end with this error:\r\n\r\n  [1]: https://medium.com/@mudrii/google-gke-and-sql-with-terraform-294fb84061\r\n\r\n    Error: Error applying plan:\r\n    \r\n    1 error(s) occurred:\r\n    \r\n    * google_project.project: 1 error(s) occurred:\r\n    \r\n    * google_project.project: error creating project terraform-dev-357aa670 \r\n     (terraform-dev): googleapi: Error 403: User is not authorized., forbidden. \r\n      If you received a 403 error, make sure \r\n      you have the `roles/resourcemanager.projectCreator` permission\r\n\r\n\r\nI would think that I had the correct permissions as the project owner, but apparently not.\r\n\r\n\r\n**Here's how I created the service account:**\r\n\r\n    $ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\                                (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default)\r\n    > --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\\r\n    > --role roles/resourcemanager.projectCreator\r\n    Updated IAM policy for organization [00000].\r\n    bindings:\r\n    - members:\r\n      - domain:min-familie.no\r\n      role: roles/billing.creator\r\n    - members:\r\n      - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\r\n      - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\r\n      role: roles/billing.user\r\n    - members:\r\n      - domain:min-familie.no\r\n      - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\r\n      - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\r\n      role: roles/resourcemanager.projectCreator\r\n    etag: BwWJxJTDnQs=\r\n    version: 19d\r\n\r\n\r\nAny ideas what might be wrong?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If you received a 403 error, make sure you have the `roles/resourcemanager.projectCreator` permission I would think that I had the correct permissions as the project owner, but apparently not. **Here's how I created the service account:** $ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\ (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default) > --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\ > --role roles/resourcemanager.projectCreator Updated IAM policy for organization [00000]. bindings: - members: - domain:min-familie.no role: roles/billing.creator - members: - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com role: roles/billing.user - members: - domain:min-familie.no - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com role: roles/resourcemanager.projectCreator etag: BwWJxJTDnQs= version: 19d Any ideas what might be wrong?", "keywords": ["bill", "domain", "policy"]}]}, {"Id": "198471913", "PostHistoryTypeId": "1", "PostId": "56311272", "RevisionGUID": "dbd01102-7e55-4bba-a030-0efc55e88c3f", "CreationDate": "2019-05-26T06:40:48.533", "UserId": "375721", "Text": "Unable to create google project with Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "198471914", "PostHistoryTypeId": "3", "PostId": "56311272", "RevisionGUID": "dbd01102-7e55-4bba-a030-0efc55e88c3f", "CreationDate": "2019-05-26T06:40:48.533", "UserId": "375721", "Text": "<google-cloud-platform><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "198535356", "PostHistoryTypeId": "5", "PostId": "56311272", "RevisionGUID": "c81b1ef9-efb7-4b8e-8138-1534ea849ca8", "CreationDate": "2019-05-27T12:29:36.623", "UserId": "375721", "Comment": "deleted 2 characters in body", "Text": "I'm following the [Google GKE and SQL with terraform][1] tutorial\r\nBut I'm not able to create a *google_project.project*.\r\nI have tried both as the owner of the project and as the service described in the tutorial. Both attempts end with this error:\r\n\r\n  [1]: https://medium.com/@mudrii/google-gke-and-sql-with-terraform-294fb84061\r\n\r\n    Error: Error applying plan:\r\n    \r\n    1 error(s) occurred:\r\n    \r\n    * google_project.project: 1 error(s) occurred:\r\n    \r\n    * google_project.project: error creating project terraform-dev-357aa670 \r\n     (terraform-dev): googleapi: Error 403: User is not authorized., forbidden. \r\n      If you received a 403 error, make sure \r\n      you have the `roles/resourcemanager.projectCreator` permission\r\n\r\n\r\nI would think that I had the correct permissions as the project owner, but apparently not.\r\n\r\n\r\n**Here's how I created the service account:**\r\n\r\n    $ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\                                (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default)\r\n    > --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\\r\n    > --role roles/resourcemanager.projectCreator\r\n    Updated IAM policy for organization [00000].\r\n    bindings:\r\n    - members:\r\n      - domain:my-domain.no\r\n      role: roles/billing.creator\r\n    - members:\r\n      - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\r\n      - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\r\n      role: roles/billing.user\r\n    - members:\r\n      - domain:min-familie.no\r\n      - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\r\n      - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\r\n      role: roles/resourcemanager.projectCreator\r\n    etag: BwWJxJTDnQs=\r\n    version: 19d\r\n\r\n\r\nAny ideas what might be wrong?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If you received a 403 error, make sure you have the `roles/resourcemanager.projectCreator` permission I would think that I had the correct permissions as the project owner, but apparently not. **Here's how I created the service account:** $ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\ (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default) > --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\ > --role roles/resourcemanager.projectCreator Updated IAM policy for organization [00000]. bindings: - members: - domain:my-domain.no role: roles/billing.creator - members: - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com role: roles/billing.user - members: - domain:min-familie.no - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com role: roles/resourcemanager.projectCreator etag: BwWJxJTDnQs= version: 19d Any ideas what might be wrong?", "keywords": ["bill", "domain", "policy"]}]}, {"Id": "198651120", "PostHistoryTypeId": "5", "PostId": "56311272", "RevisionGUID": "53969d59-36f7-4df1-ad4b-6c417126c2cb", "CreationDate": "2019-05-29T06:18:47.757", "UserId": "375721", "Comment": "added 45 characters in body", "Text": "I'm following the [Google GKE and SQL with terraform][1] tutorial\r\nBut I'm not able to create a *google_project.project*.\r\nI have tried both as the owner of the project and as the service described in the tutorial. Both attempts end with this error:\r\n\r\n  [1]: https://medium.com/@mudrii/google-gke-and-sql-with-terraform-294fb84061\r\n\r\n    Error: Error applying plan:\r\n    \r\n    1 error(s) occurred:\r\n    \r\n    * google_project.project: 1 error(s) occurred:\r\n    \r\n    * google_project.project: error creating project terraform-dev-357aa670 \r\n     (terraform-dev): googleapi: Error 403: User is not authorized., forbidden. \r\n      If you received a 403 error, make sure \r\n      you have the `roles/resourcemanager.projectCreator` permission\r\n\r\n\r\nI would think that I had the correct permissions as the project owner, but apparently not.\r\n\r\n\r\n**Here's how I created the service account:**\r\n\r\n    $ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\                                (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default)\r\n    > --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\\r\n    > --role roles/resourcemanager.projectCreator\r\n    Updated IAM policy for organization [00000].\r\n    bindings:\r\n    - members:\r\n      - domain:my-domain.no\r\n      role: roles/billing.creator\r\n    - members:\r\n      - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\r\n      - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\r\n      role: roles/billing.user\r\n    - members:\r\n      - domain:min-familie.no\r\n      - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com\r\n      - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com\r\n      role: roles/resourcemanager.projectCreator\r\n    etag: BwWJxJTDnQs=\r\n    version: 19d\r\n\r\nCreating a project \"manually\" works.\r\n`$ gcloud projects create ${TF_ADMIN}`.\r\n\r\nAny ideas what might be wrong?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If you received a 403 error, make sure you have the `roles/resourcemanager.projectCreator` permission I would think that I had the correct permissions as the project owner, but apparently not. **Here's how I created the service account:** $ gcloud organizations add-iam-policy-binding ${TF_VAR_org_id} \\ (gke_my-domain-218910_europe-west1-b_my-domain-vpc-native/default) > --member serviceAccount:terraform@${TF_ADMIN}.iam.gserviceaccount.com \\ > --role roles/resourcemanager.projectCreator Updated IAM policy for organization [00000]. bindings: - members: - domain:my-domain.no role: roles/billing.creator - members: - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com role: roles/billing.user - members: - domain:min-familie.no - serviceAccount:terraform@my-domain-terraform-admin-3.iam.gserviceaccount.com - serviceAccount:terraform@my-domain-terraform-admin.iam.gserviceaccount.com role: roles/resourcemanager.projectCreator etag: BwWJxJTDnQs= version: 19d Creating a project \"manually\" works. `$ gcloud projects create ${TF_ADMIN}`", "keywords": ["bill", "domain", "policy"]}]}], "answers": [{"Id": "63840788", "PostTypeId": "2", "ParentId": "56311272", "CreationDate": "2020-09-11T04:30:03.163", "Score": "0", "Body": "<p>I had exact same problem!</p>\n<p>Steps that solved this problem for me:</p>\n<ol>\n<li><p>Downloaded the key for that Service Account (Using GCP Console) to : /Users/johndoe/sa.json</p>\n</li>\n<li><p>export GOOGLE_APPLICATION_CREDENTIALS=/Users/johndoe/factory.json</p>\n</li>\n<li><p>terraform apply</p>\n</li>\n</ol>\n<p>Hope this works for you.</p>\n<p>Found the solution from Seth Fargo here:\n<a href=\"https://github.com/sethvargo/vault-on-gke/issues/16\" rel=\"nofollow noreferrer\">https://github.com/sethvargo/vault-on-gke/issues/16</a></p>\n", "OwnerUserId": "5691932", "LastEditorUserId": "5691932", "LastEditDate": "2020-09-11T04:45:00.000", "LastActivityDate": "2020-09-11T04:45:00.000", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "230593953", "PostHistoryTypeId": "2", "PostId": "63840788", "RevisionGUID": "1dd4c4f9-54d3-4fd1-9081-b3961c9573cb", "CreationDate": "2020-09-11T04:30:03.163", "UserId": "5691932", "Text": "I had exact same problem!\r\n\r\nSteps that solved this problem for me:\r\n\r\n1. Downloaded the key for that Service Account (Using GCP Console) to : /Users/johndoe/sa.json\r\n\r\n2. export GOOGLE_APPLICATION_CREDENTIALS=/Users/johndoe/factory.json\r\n\r\n3. terraform apply\r\n\r\nHope this works for you.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "230594450", "PostHistoryTypeId": "5", "PostId": "63840788", "RevisionGUID": "2a7e683a-7c03-4872-905d-ea3d576f1c9a", "CreationDate": "2020-09-11T04:45:00.000", "UserId": "5691932", "Comment": "added 99 characters in body", "Text": "I had exact same problem!\r\n\r\nSteps that solved this problem for me:\r\n\r\n1. Downloaded the key for that Service Account (Using GCP Console) to : /Users/johndoe/sa.json\r\n\r\n2. export GOOGLE_APPLICATION_CREDENTIALS=/Users/johndoe/factory.json\r\n\r\n3. terraform apply\r\n\r\nHope this works for you.\r\n\r\n\r\nFound the solution from Seth Fargo here:\r\nhttps://github.com/sethvargo/vault-on-gke/issues/16", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "72378813", "PostTypeId": "2", "ParentId": "56311272", "CreationDate": "2022-05-25T13:45:30.190", "Score": "1", "Body": "<p>In order to create folders and projects, your account need to have the respective permissions and, of course you need to make sure that you are using the right account.</p>\n<p>First make sure the user has the right permissions:</p>\n<pre><code>gcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/billing.admin\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.organizationAdmin\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.folderCreator\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.projectCreator\n</code></pre>\n<p>Then make sure you set the application defaults and login to exactly this account:</p>\n<pre><code>gcloud auth application-default login\n</code></pre>\n<p>The set a project that the API calls will be billed to by default. Read more about this <a href=\"https://cloud.google.com/sdk/gcloud/reference/auth/application-default/set-quota-project\" rel=\"nofollow noreferrer\">here</a>.  If you don't set this, you might get a quota error when you run <code>terraform apply</code>.</p>\n<pre><code>gcloud auth application-default set-quota-project SOME_BILLING_PROJECT\n</code></pre>\n", "OwnerUserId": "923493", "LastActivityDate": "2022-05-25T13:45:30.190", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "270905413", "PostHistoryTypeId": "2", "PostId": "72378813", "RevisionGUID": "f25710e2-0484-42b8-8c6b-17523666f142", "CreationDate": "2022-05-25T13:45:30.190", "UserId": "923493", "Text": "In order to create folders and projects, your account need to have the respective permissions and, of course you need to make sure that you are using the right account. \r\n\r\nFirst make sure the user has the right permissions:  \r\n  \r\n```\r\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/billing.admin\r\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.organizationAdmin\r\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.folderCreator\r\ngcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.projectCreator\r\n```\r\n\r\nThen make sure you set the application defaults and login to exactly this account:  \r\n\r\n```\r\ngcloud auth application-default login\r\n```\r\n\r\nThe set a project that the API calls will be billed to by default. Read more about this [here](https://cloud.google.com/sdk/gcloud/reference/auth/application-default/set-quota-project).  If you don't set this, you might get a quota error when you run `terraform apply`.\r\n  \r\n```  \r\ngcloud auth application-default set-quota-project SOME_BILLING_PROJECT\r\n```\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "First make sure the user has the right permissions: ``` gcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/billing.admin gcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.organizationAdmin gcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.folderCreator gcloud organizations add-iam-policy-binding YOUR_ORGANIZATION_ID --member=user:your@email.com --role=roles/resourcemanager.projectCreator ``` ", "keywords": ["bill", "policy"]}, {"source": "Text", "text": "The set a project that the API calls will be billed to by default. ", "keywords": ["bill"]}]}], "filtered-sentences": [{"source": "Body", "text": "The set a project that the API calls will be billed to by default. ", "keywords": ["bill"]}]}], "contains-topic": true, "filtered-sentences": []}