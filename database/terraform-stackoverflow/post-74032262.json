{"Id": "74032262", "PostTypeId": "1", "CreationDate": "2022-10-11T17:57:52.617", "Score": "0", "ViewCount": "12", "Body": "<p>Friends,</p>\n<p>I am learning terraform and got stuck with this issue: I can create all the resources listed bellow without problems but when I run <code>terraform destroy</code> to delete them, Terraform returns a permission denied error while trying to destroy the s3 bucket (where <code>.tfstate</code> was being saved):</p>\n<pre><code>Error: deleting S3 Bucket (tfur-state-bucket): AccessDenied: Access Denied\n</code></pre>\n<p>It's also worth mentioning, that the IAM user of terraform has already administrator permissions. I am trying to delete the resources like this:</p>\n<p>I (1) delete the backend resource from main.tf,(2) run <code>terraform init -migrate-state</code> and (3) finally run <code>terraform destroy</code>.</p>\n<p>The version of Terraform I am running:</p>\n<pre><code>Terraform v1.3.2\ndarwin_arm64\n</code></pre>\n<p>Any idea about what I may have been missing? Here is my code:</p>\n<pre><code>terraform {\n  required_providers {\n    aws = {\n      source = &quot;hashicorp/aws&quot;\n    }\n  }\n}\n\nprovider &quot;aws&quot; {\n  region                   = &quot;us-east-1&quot;\n  shared_credentials_files = [&quot;~/.aws/credentials&quot;]\n  profile                  = &quot;vscode&quot;\n}\n\nresource &quot;aws_s3_bucket&quot; &quot;tf_state&quot; {\n  bucket = &quot;tfur-state-bucket&quot;\n  #lifecycle {\n  #  prevent_destroy = true\n  #}\n}\n\nresource &quot;aws_s3_bucket_versioning&quot; &quot;bucket_versioning&quot; {\n  bucket = aws_s3_bucket.tf_state.id\n  versioning_configuration {\n    status = &quot;Enabled&quot;\n  }\n}\n\nresource &quot;aws_s3_bucket_server_side_encryption_configuration&quot; &quot;encryption_for_tf_state&quot; {\n  bucket = aws_s3_bucket.tf_state.bucket\n\n  rule {\n    apply_server_side_encryption_by_default {\n      sse_algorithm = &quot;AES256&quot;\n    }\n  }\n}\n\nresource &quot;aws_s3_bucket_public_access_block&quot; &quot;public_access&quot; {\n  bucket                  = aws_s3_bucket.tf_state.id\n  block_public_acls       = true\n  block_public_policy     = true\n  ignore_public_acls      = true\n  restrict_public_buckets = true\n}\n\nresource &quot;aws_dynamodb_table&quot; &quot;terraform_locks&quot; {\n  name         = &quot;terraform-locks&quot;\n  billing_mode = &quot;PAY_PER_REQUEST&quot;\n  hash_key     = &quot;LockID&quot;\n  attribute {\n    name = &quot;LockID&quot;\n    type = &quot;S&quot;\n  }\n}\n\nterraform {\n  backend &quot;s3&quot; {\n    bucket         = &quot;tfur-state-bucket&quot;\n    key            = &quot;global/s3/terraform.tfstate&quot;\n    region         = &quot;us-east-1&quot;\n    dynamodb_table = &quot;terraform-locks&quot;\n    encrypt        = true\n  }\n}\n</code></pre>\n", "OwnerUserId": "15255863", "LastActivityDate": "2022-10-11T17:57:52.617", "Title": "terraform - delete s3 bucket (tfs-state-bucket): access denied", "Tags": "<terraform><terraform-provider-aws>", "AnswerCount": "0", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "279920251", "PostHistoryTypeId": "2", "PostId": "74032262", "RevisionGUID": "ca7be01d-c54d-42a7-b7f3-148277b6095e", "CreationDate": "2022-10-11T17:57:52.617", "UserId": "15255863", "Text": "Friends,\r\n\r\nI am learning terraform and got stuck with this issue: I can create all the resources listed bellow without problems but when I run `terraform destroy` to delete them, Terraform returns a permission denied error while trying to destroy the s3 bucket (where `.tfstate` was being saved):\r\n\r\n    Error: deleting S3 Bucket (tfur-state-bucket): AccessDenied: Access Denied\r\n\r\nIt's also worth mentioning, that the IAM user of terraform has already administrator permissions. I am trying to delete the resources like this:\r\n\r\nI (1) delete the backend resource from main.tf,(2) run `terraform init -migrate-state` and (3) finally run `terraform destroy`.\r\n\r\nThe version of Terraform I am running:\r\n\r\n    Terraform v1.3.2\r\n    darwin_arm64\r\n\r\n\r\nAny idea about what I may have been missing? Here is my code:\r\n\r\n    terraform {\r\n      required_providers {\r\n        aws = {\r\n          source = \"hashicorp/aws\"\r\n        }\r\n      }\r\n    }\r\n    \r\n    provider \"aws\" {\r\n      region                   = \"us-east-1\"\r\n      shared_credentials_files = [\"~/.aws/credentials\"]\r\n      profile                  = \"vscode\"\r\n    }\r\n    \r\n    resource \"aws_s3_bucket\" \"tf_state\" {\r\n      bucket = \"tfur-state-bucket\"\r\n      #lifecycle {\r\n      #  prevent_destroy = true\r\n      #}\r\n    }\r\n    \r\n    resource \"aws_s3_bucket_versioning\" \"bucket_versioning\" {\r\n      bucket = aws_s3_bucket.tf_state.id\r\n      versioning_configuration {\r\n        status = \"Enabled\"\r\n      }\r\n    }\r\n    \r\n    resource \"aws_s3_bucket_server_side_encryption_configuration\" \"encryption_for_tf_state\" {\r\n      bucket = aws_s3_bucket.tf_state.bucket\r\n    \r\n      rule {\r\n        apply_server_side_encryption_by_default {\r\n          sse_algorithm = \"AES256\"\r\n        }\r\n      }\r\n    }\r\n    \r\n    resource \"aws_s3_bucket_public_access_block\" \"public_access\" {\r\n      bucket                  = aws_s3_bucket.tf_state.id\r\n      block_public_acls       = true\r\n      block_public_policy     = true\r\n      ignore_public_acls      = true\r\n      restrict_public_buckets = true\r\n    }\r\n    \r\n    resource \"aws_dynamodb_table\" \"terraform_locks\" {\r\n      name         = \"terraform-locks\"\r\n      billing_mode = \"PAY_PER_REQUEST\"\r\n      hash_key     = \"LockID\"\r\n      attribute {\r\n        name = \"LockID\"\r\n        type = \"S\"\r\n      }\r\n    }\r\n    \r\n    terraform {\r\n      backend \"s3\" {\r\n        bucket         = \"tfur-state-bucket\"\r\n        key            = \"global/s3/terraform.tfstate\"\r\n        region         = \"us-east-1\"\r\n        dynamodb_table = \"terraform-locks\"\r\n        encrypt        = true\r\n      }\r\n    }\r\n    \r\n  ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Here is my code: terraform { required_providers { aws = { source = \"hashicorp/aws\" } } } provider \"aws\" { region = \"us-east-1\" shared_credentials_files = [\"~/.aws/credentials\"] profile = \"vscode\" } resource \"aws_s3_bucket\" \"tf_state\" { bucket = \"tfur-state-bucket\" #lifecycle { # prevent_destroy = true #} } resource \"aws_s3_bucket_versioning\" \"bucket_versioning\" { bucket = aws_s3_bucket.tf_state.id versioning_configuration { status = \"Enabled\" } } resource \"aws_s3_bucket_server_side_encryption_configuration\" \"encryption_for_tf_state\" { bucket = aws_s3_bucket.tf_state.bucket rule { apply_server_side_encryption_by_default { sse_algorithm = \"AES256\" } } } resource \"aws_s3_bucket_public_access_block\" \"public_access\" { bucket = aws_s3_bucket.tf_state.id block_public_acls = true block_public_policy = true ignore_public_acls = true restrict_public_buckets = true } resource \"aws_dynamodb_table\" \"terraform_locks\" { name = \"terraform-locks\" billing_mode = \"PAY_PER_REQUEST\" hash_key = \"LockID\" attribute { name = \"LockID\" type = \"S\" ", "keywords": ["bill", "provider"]}]}, {"Id": "279920253", "PostHistoryTypeId": "1", "PostId": "74032262", "RevisionGUID": "ca7be01d-c54d-42a7-b7f3-148277b6095e", "CreationDate": "2022-10-11T17:57:52.617", "UserId": "15255863", "Text": "terraform - delete s3 bucket (tfs-state-bucket): access denied", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "279920254", "PostHistoryTypeId": "3", "PostId": "74032262", "RevisionGUID": "ca7be01d-c54d-42a7-b7f3-148277b6095e", "CreationDate": "2022-10-11T17:57:52.617", "UserId": "15255863", "Text": "<terraform><terraform-provider-aws>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}