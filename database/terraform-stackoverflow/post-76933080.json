{"Id": "76933080", "PostTypeId": "1", "CreationDate": "2023-08-18T23:56:41.657", "Score": "0", "ViewCount": "42", "Body": "<p>Terraform 1.4.5 on Windows, authenticating as individual user via <code>gcloud auth application-default login</code>.  I suddenly started getting this error a few hours whenever I do any operating involving the state file stored in a Google Cloud Storage bucket:</p>\n<blockquote>\n<p>Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist</p>\n</blockquote>\n<p>My <code>backend.tf</code> file has not changed in several months.  It simply lists the GCS bucket name and prefix:</p>\n<pre><code>terraform {\n  backend &quot;gcs&quot; {\n    bucket = &quot;my-bucket-name&quot;\n    prefix = &quot;my-module-name&quot;\n  }\n}\n\n</code></pre>\n<p>I've tried the usual fixes, such as running <code>terraform init -reconfigure</code> and deleting the <code>.terraform</code> hidden directory, but always get the same error message.</p>\n<p>This did happen around the time there were some permission changes and cleanup tasks done by the group that manages our GCP projects.  But, the bucket still exists and I have read/write access to it.</p>\n", "OwnerUserId": "12358733", "LastEditorUserId": "807126", "LastEditDate": "2023-08-19T00:28:38.837", "LastActivityDate": "2023-08-19T00:28:38.837", "Title": "Terraform claims backend GCS bucket doesn't exist", "Tags": "<google-cloud-platform><terraform><google-cloud-storage><terraform-provider-gcp>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "296831778", "PostHistoryTypeId": "2", "PostId": "76933080", "RevisionGUID": "aee00449-8fc5-44b6-9531-f3faacef648b", "CreationDate": "2023-08-18T23:56:41.657", "UserId": "12358733", "Text": "Terraform 1.4.5 on Windows, authenticating as individual user via `gcloud auth application-default login`.  I suddenly started getting this error a few hours whenever I do any operating involving the state file stored in a Google Cloud Storage bucket:\r\n```\r\n\u2502 Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist\r\n```\r\nMy `backend.tf` file has not changed in several months.  It simply lists the GCS bucket name and prefix:\r\n```\r\nterraform {\r\n  backend \"gcs\" {\r\n    bucket = \"my-bucket-name\"\r\n    prefix = \"my-module-name\"\r\n  }\r\n}\r\n\r\n```\r\nI've tried the usual fixes, such as running `terraform init -reconfigure` and deleting the `.terraform` hidden directory, but always get the same error message.\r\n\r\nThis did happen around the time there were some permission changes and cleanup tasks done by the group that manages our GCP projects.  But, the bucket still exists and I have read/write access to it.  ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I suddenly started getting this error a few hours whenever I do any operating involving the state file stored in a Google Cloud Storage bucket: ``` \u2502 Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist ``` ", "keywords": ["storage"]}, {"source": "Text", "text": "My `backend.tf` file has not changed in several months. ", "keywords": ["change"]}, {"source": "Text", "text": "This did happen around the time there were some permission changes and cleanup tasks done by the group that manages our GCP projects. ", "keywords": ["change"]}]}, {"Id": "296831780", "PostHistoryTypeId": "1", "PostId": "76933080", "RevisionGUID": "aee00449-8fc5-44b6-9531-f3faacef648b", "CreationDate": "2023-08-18T23:56:41.657", "UserId": "12358733", "Text": "Terraform claims backend GCS bucket doesn't exist", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "296831781", "PostHistoryTypeId": "3", "PostId": "76933080", "RevisionGUID": "aee00449-8fc5-44b6-9531-f3faacef648b", "CreationDate": "2023-08-18T23:56:41.657", "UserId": "12358733", "Text": "<google-cloud-platform><terraform><google-cloud-storage><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "296832128", "PostHistoryTypeId": "5", "PostId": "76933080", "RevisionGUID": "fcfd8af7-7745-40c8-b9fa-70151a964128", "CreationDate": "2023-08-19T00:28:38.837", "UserId": "807126", "Comment": "deleted 6 characters in body", "Text": "Terraform 1.4.5 on Windows, authenticating as individual user via `gcloud auth application-default login`.  I suddenly started getting this error a few hours whenever I do any operating involving the state file stored in a Google Cloud Storage bucket:\r\n\r\n> Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist\r\n\r\nMy `backend.tf` file has not changed in several months.  It simply lists the GCS bucket name and prefix:\r\n```\r\nterraform {\r\n  backend \"gcs\" {\r\n    bucket = \"my-bucket-name\"\r\n    prefix = \"my-module-name\"\r\n  }\r\n}\r\n\r\n```\r\nI've tried the usual fixes, such as running `terraform init -reconfigure` and deleting the `.terraform` hidden directory, but always get the same error message.\r\n\r\nThis did happen around the time there were some permission changes and cleanup tasks done by the group that manages our GCP projects.  But, the bucket still exists and I have read/write access to it.  ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I suddenly started getting this error a few hours whenever I do any operating involving the state file stored in a Google Cloud Storage bucket: > Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist My `backend.tf` file has not changed in several months. ", "keywords": ["storage", "change"]}, {"source": "Text", "text": "This did happen around the time there were some permission changes and cleanup tasks done by the group that manages our GCP projects. ", "keywords": ["change"]}]}, {"Id": "296832129", "PostHistoryTypeId": "33", "PostId": "76933080", "RevisionGUID": "732d3bfb-0d16-44f1-af67-a5e1cdef49a0", "CreationDate": "2023-08-19T00:28:38.837", "UserId": "-1002", "Comment": "334075", "filtered-sentences": []}], "answers": [{"Id": "76933081", "PostTypeId": "2", "ParentId": "76933080", "CreationDate": "2023-08-18T23:56:41.657", "Score": "2", "Body": "<p>Found the root cause of this error is gcloud's default project had been deleted.  This doesn't affect Terraform directly, but was influencing the quota project, which can be viewed in file <code>$HOME/.config/gcloud/application_default_credentials.json</code> (Linux/Mac) or <code>$env:APPDATA\\gcloud\\application_default_credentials.json</code> (Windows)</p>\n<p>To fix, I did this:</p>\n<pre><code>gcloud auth login\ngcloud config set project my-main-project-id\ngcloud auth application-default login\n</code></pre>\n<p>This should also do the trick:</p>\n<pre><code>gcloud auth application-default set-quota-project my-main-project-id\n</code></pre>\n", "OwnerUserId": "12358733", "LastActivityDate": "2023-08-18T23:56:41.657", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "135623191", "PostId": "76933081", "Score": "0", "Text": "`set-quota-project` is the solution. The other commands might solve the problem due to side effects (setting the project id) but might fail later. The technical reason is that the CLI uses a Google OAuth Client ID that is not part of your ORG/Project which also means it is not part of your billing account. So you have to tell the CLI which project is to be billed.", "CreationDate": "2023-08-19T00:49:22.507", "UserId": "8016720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "The technical reason is that the CLI uses a Google OAuth Client ID that is not part of your ORG/Project which also means it is not part of your billing account. ", "keywords": ["bill"]}, {"source": "Text", "text": "So you have to tell the CLI which project is to be billed.", "keywords": ["bill"]}]}, {"Id": "135638401", "PostId": "76933081", "Score": "0", "Text": "Ahhh thank you.  I never quite understood what the quota project was, or if I should care about it.  That makes sense.", "CreationDate": "2023-08-21T01:35:20.497", "UserId": "12358733", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "296831784", "PostHistoryTypeId": "2", "PostId": "76933081", "RevisionGUID": "f1d1cae5-a4cf-484b-90b0-271a646510c2", "CreationDate": "2023-08-18T23:56:41.657", "UserId": "12358733", "Text": "Found the root cause of this error is gcloud's default project had been deleted.  This doesn't affect Terraform directly, but was influencing the quota project, which can be viewed in file `$HOME/.config/gcloud/application_default_credentials.json` (Linux/Mac) or `$env:APPDATA\\gcloud\\application_default_credentials.json` (Windows)\r\n\r\nTo fix, I did this:\r\n```\r\ngcloud auth login\r\ngcloud config set project my-main-project-id\r\ngcloud auth application-default login\r\n```\r\nThis should also do the trick:\r\n```\r\ngcloud auth application-default set-quota-project my-main-project-id\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I suddenly started getting this error a few hours whenever I do any operating involving the state file stored in a Google Cloud Storage bucket: Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist My backend.tf file has not changed in several months. ", "keywords": ["storage", "change"]}, {"source": "Body", "text": "This did happen around the time there were some permission changes and cleanup tasks done by the group that manages our GCP projects. ", "keywords": ["change"]}]}