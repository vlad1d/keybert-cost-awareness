{"Id": "73649742", "PostTypeId": "1", "AcceptedAnswerId": "73662560", "CreationDate": "2022-09-08T13:19:27.680", "Score": "2", "ViewCount": "559", "Body": "<p>We have different GKE clusters in different GCP Projects, and we'd like to get detailed costs per labels. We have a billing account that spans all the GCP projects.</p>\n<p>From the doc I understand both cloud billing and GKE cost allocations have to be configured to export to bigquery for this. No issues with configuring cloud billing exports from the billing account to bigquery, but GKE cost allocation can only be exported to a dataset in the same project.</p>\n<p>How can I reconcile that, having one billing account for all projects but needing to export it to a dataset in each project ?\nDo I need to setup multiple sinks with filters, and if so what would those filters look like ?</p>\n<p>Or can I just export cloud billing to one dataset in one project, then GKE to each cluster's project in a different dataset, and &quot;merge&quot; all of this later on in the dashboard ?</p>\n<p>Thanks</p>\n", "OwnerUserId": "19949990", "LastActivityDate": "2022-09-09T15:31:16.147", "Title": "GCP / GKE export cost to bigquery per project", "Tags": "<google-cloud-platform><google-kubernetes-engine><terraform-provider-gcp>", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "277836624", "PostHistoryTypeId": "2", "PostId": "73649742", "RevisionGUID": "be7e2e8b-f84a-4e71-b933-b7f2f61b9f5e", "CreationDate": "2022-09-08T13:19:27.680", "UserId": "19949990", "Text": "We have different GKE clusters in different GCP Projects, and we'd like to get detailed costs per labels. We have a billing account that spans all the GCP projects.\r\n\r\nFrom the doc I understand both cloud billing and GKE cost allocations have to be configured to export to bigquery for this. No issues with configuring cloud billing exports from the billing account to bigquery, but GKE cost allocation can only be exported to a dataset in the same project.\r\n\r\nHow can I reconcile that, having one billing account for all projects but needing to export it to a dataset in each project ?\r\nDo I need to setup multiple sinks with filters, and if so what would those filters look like ?\r\n\r\nOr can I just export cloud billing to one dataset in one project, then GKE to each cluster's project in a different dataset, and \"merge\" all of this later on in the dashboard ?\r\n\r\nThanks", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "We have a billing account that spans all the GCP projects. ", "keywords": ["bill"]}, {"source": "Text", "text": "From the doc I understand both cloud billing and GKE cost allocations have to be configured to export to bigquery for this. ", "keywords": ["bill", "cost"]}, {"source": "Text", "text": "No issues with configuring cloud billing exports from the billing account to bigquery, but GKE cost allocation can only be exported to a dataset in the same project. ", "keywords": ["bill", "cost"]}, {"source": "Text", "text": "How can I reconcile that, having one billing account for all projects but needing to export it to a dataset in each project ? ", "keywords": ["bill"]}, {"source": "Text", "text": "Or can I just export cloud billing to one dataset in one project, then GKE to each cluster's project in a different dataset, and \"merge\" all of this later on in the dashboard ? ", "keywords": ["bill", "cluster"]}]}, {"Id": "277836626", "PostHistoryTypeId": "1", "PostId": "73649742", "RevisionGUID": "be7e2e8b-f84a-4e71-b933-b7f2f61b9f5e", "CreationDate": "2022-09-08T13:19:27.680", "UserId": "19949990", "Text": "GCP / GKE export cost to bigquery per project", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "GCP / GKE export cost to bigquery per project", "keywords": ["cost"]}]}, {"Id": "277836627", "PostHistoryTypeId": "3", "PostId": "73649742", "RevisionGUID": "be7e2e8b-f84a-4e71-b933-b7f2f61b9f5e", "CreationDate": "2022-09-08T13:19:27.680", "UserId": "19949990", "Text": "<google-cloud-platform><google-kubernetes-engine><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "73659618", "PostTypeId": "2", "ParentId": "73649742", "CreationDate": "2022-09-09T08:52:13.913", "Score": "0", "Body": "<p>There are two ways to export GKE cost data to BigQuery.  The original functionality was <a href=\"https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-usage-metering\" rel=\"nofollow noreferrer\">GKE Usage metering</a> and I believe this worked on a per project basis in terms of the export to BigQuery.</p>\n<p>There is also the new <a href=\"https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations\" rel=\"nofollow noreferrer\">GKE cost allocation</a> functionality which is natively integrated with Cloud Billing.  It does support filtering on labels, so should work for you.  Using this, you should be able to view the cost info for multiple projects under the same billing account.  You should create a separate project for cost/billing exports (linked to the billing account you want) and the export here should include all billing info across all projects and will actually include GKE info as well.</p>\n", "OwnerUserId": "5529712", "LastActivityDate": "2022-09-09T08:52:13.913", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "130142744", "PostId": "73659618", "Score": "0", "Text": "That's why I was confused, I didn't realize there's two different ways. Thanks a lot, that explains it !", "CreationDate": "2022-09-13T07:47:12.577", "UserId": "19949990", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "277889455", "PostHistoryTypeId": "2", "PostId": "73659618", "RevisionGUID": "b9caefda-e9e0-48f3-a0f8-e534b61a6dc5", "CreationDate": "2022-09-09T08:52:13.913", "UserId": "5529712", "Text": "There are two ways to export GKE cost data to BigQuery.  The original functionality was [GKE Usage metering](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-usage-metering) and I believe this worked on a per project basis in terms of the export to BigQuery.\r\n\r\nThere is also the new [GKE cost allocation](https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations) functionality which is natively integrated with Cloud Billing.  It does support filtering on labels, so should work for you.  Using this, you should be able to view the cost info for multiple projects under the same billing account.  You should create a separate project for cost/billing exports (linked to the billing account you want) and the export here should include all billing info across all projects and will actually include GKE info as well.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "There are two ways to export GKE cost data to BigQuery. ", "keywords": ["cost"]}, {"source": "Text", "text": "The original functionality was [GKE Usage metering](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-usage-metering) and I believe this worked on a per project basis in terms of the export to BigQuery. ", "keywords": ["cluster"]}, {"source": "Text", "text": "There is also the new [GKE cost allocation](https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations) functionality which is natively integrated with Cloud Billing. ", "keywords": ["cost"]}, {"source": "Text", "text": "Using this, you should be able to view the cost info for multiple projects under the same billing account. ", "keywords": ["bill", "cost"]}, {"source": "Text", "text": "You should create a separate project for cost/billing exports (linked to the billing account you want) and the export here should include all billing info across all projects and will actually include GKE info as well.", "keywords": ["bill", "cost"]}]}, {"Id": "277889457", "PostHistoryTypeId": "33", "PostId": "73659618", "RevisionGUID": "86e74d19-5b92-47e3-a482-c8b40007d29b", "CreationDate": "2022-09-09T08:52:13.913", "UserId": "-1002", "Comment": "287601", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "There are two ways to export GKE cost data to BigQuery. ", "keywords": ["cost"]}, {"source": "Body", "text": "There is also the new GKE cost allocation functionality which is natively integrated with Cloud Billing. ", "keywords": ["cost"]}, {"source": "Body", "text": "Using this, you should be able to view the cost info for multiple projects under the same billing account. ", "keywords": ["bill", "cost"]}, {"source": "Body", "text": "You should create a separate project for cost/billing exports (linked to the billing account you want) and the export here should include all billing info across all projects and will actually include GKE info as well.", "keywords": ["bill", "cost"]}]}, {"Id": "73662560", "PostTypeId": "2", "ParentId": "73649742", "CreationDate": "2022-09-09T13:00:08.923", "Score": "2", "Body": "<p>You can configure the cloud billing export to a central dataset in a project. Make sure you enable <strong>Detailed usage cost</strong> export since the latest GKE cost allocation labels are exported here.</p>\n<img src=\"https://i.stack.imgur.com/FlQGF.png\" width=\"600\" />\n<p>Once the detailed usage cost is setup, <a href=\"https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations#enable_breakdown\" rel=\"nofollow noreferrer\">GKE cost allocation</a> needs to be enabled at a per cluster level. The GKE labels of enabled clusters would start to appear in the detailed usage cost export within 48 hours. This feature was released in <a href=\"https://cloud.google.com/billing/docs/release-notes#June_30_2022\" rel=\"nofollow noreferrer\">June, 2022</a> and you no longer need to maintain separate cluster datasets across projects.</p>\n<p>I would recommend setting up a cloud cost management platform for GKE cost analysis out of the box. You can check out <a href=\"https://www.economize.cloud/\" rel=\"nofollow noreferrer\">Economize</a> - connects with your GCP billing dataset and you can create custom GKE cost views.</p>\n", "OwnerUserId": "3524733", "LastEditorUserId": "3524733", "LastEditDate": "2022-09-09T15:31:16.147", "LastActivityDate": "2022-09-09T15:31:16.147", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "130142732", "PostId": "73662560", "Score": "0", "Text": "That explains the confusion, I didn't realize there were two methods. Looks like cost allocation just made it's way into the terraform provider last week so we'll have to wait a bit before we can upgrade to it, but that's perfect, thanks !", "CreationDate": "2022-09-13T07:46:48.037", "UserId": "19949990", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Looks like cost allocation just made it's way into the terraform provider last week so we'll have to wait a bit before we can upgrade to it, but that's perfect, thanks !", "keywords": ["cost", "provider"]}]}, {"Id": "130706376", "PostId": "73662560", "Score": "1", "Text": "Got around to checking out Economize and it sounds interesting, a central place to show the cost of each team across all cloud providers would be great, although I do wish there was more information, screenshots and details on the site. Requested access to the demo a couple of weeks ago and never heard back", "CreationDate": "2022-10-11T10:53:46.007", "UserId": "19949990", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Got around to checking out Economize and it sounds interesting, a central place to show the cost of each team across all cloud providers would be great, although I do wish there was more information, screenshots and details on the site. ", "keywords": ["cost"]}]}, {"Id": "130711418", "PostId": "73662560", "Score": "0", "Text": "Hey @user19949990, I run Economize. I'm sorry we didn't get back on your demo request, I'm happy to schedule a call and give an overview of the platform. Do you mind dropping your email [here](https://www.economize.cloud/start) or a mail to anirudh[at]economize.cloud.", "CreationDate": "2022-10-11T14:13:48.813", "UserId": "2675931", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "130737052", "PostId": "73662560", "Score": "0", "Text": "Hey, I hadn't used that form because it requires a phone number, I used [this one](https://www.economize.cloud/demo) instead but never heard back. I've just tried the one you linked with an invalid phone number, hopefully that's okay as I don't have a pro phone number and I'd rather keep my private one private. Thanks", "CreationDate": "2022-10-12T15:14:30.613", "UserId": "19949990", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "277905890", "PostHistoryTypeId": "2", "PostId": "73662560", "RevisionGUID": "458cb864-9f9f-4303-bf2a-c9d343cbab0a", "CreationDate": "2022-09-09T13:00:08.923", "UserId": "3524733", "Text": "You can configure the cloud billing export to a central dataset in a project. Make sure you enable **Detailed usage cost** export since the latest GKE cost allocation labels are exported here.\r\n\r\n<img src=\"https://i.stack.imgur.com/FlQGF.png\" width=\"600\" />\r\n\r\nOnce the detailed usage cost is setup, [GKE cost allocation][1] needs to be enabled at a per cluster level. The GKE labels of enabled clusters would start to appear in the detailed usage cost export within 48 hours. This feature was released in [June, 2022][2] and you no longer to need maintain separate cluster datasets across projects.\r\n\r\nI would recommend setting up a cloud cost management platform for GKE cost analysis out of the box. You can check out [Economize][3] - connects with your GCP billing dataset and you can create custom GKE cost views. \r\n\r\n\r\n  [1]: https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations#enable_breakdown\r\n  [2]: https://cloud.google.com/billing/docs/release-notes#June_30_2022\r\n  [3]: https://www.economize.cloud/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can configure the cloud billing export to a central dataset in a project. ", "keywords": ["bill"]}, {"source": "Text", "text": "Make sure you enable **Detailed usage cost** export since the latest GKE cost allocation labels are exported here. ", "keywords": ["cost"]}, {"source": "Text", "text": "Once the detailed usage cost is setup, [GKE cost allocation][1] needs to be enabled at a per cluster level. ", "keywords": ["cost", "cluster"]}, {"source": "Text", "text": "The GKE labels of enabled clusters would start to appear in the detailed usage cost export within 48 hours. ", "keywords": ["cost"]}, {"source": "Text", "text": "This feature was released in [June, 2022][2] and you no longer to need maintain separate cluster datasets across projects. ", "keywords": ["feature", "cluster"]}, {"source": "Text", "text": "I would recommend setting up a cloud cost management platform for GKE cost analysis out of the box. ", "keywords": ["cost"]}, {"source": "Text", "text": "You can check out [Economize][3] - connects with your GCP billing dataset and you can create custom GKE cost views. [1]: https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations#enable_breakdown [2]: https://cloud.google.com/billing/docs/release-notes#June_30_2022 [3]: https://www", "keywords": ["bill", "cost"]}]}, {"Id": "277916215", "PostHistoryTypeId": "5", "PostId": "73662560", "RevisionGUID": "4c71cc65-ecb7-4d71-9f6a-532b4752d803", "CreationDate": "2022-09-09T15:31:16.147", "UserId": "3524733", "Comment": "fixed grammar", "Text": "You can configure the cloud billing export to a central dataset in a project. Make sure you enable **Detailed usage cost** export since the latest GKE cost allocation labels are exported here.\r\n\r\n<img src=\"https://i.stack.imgur.com/FlQGF.png\" width=\"600\" />\r\n\r\nOnce the detailed usage cost is setup, [GKE cost allocation][1] needs to be enabled at a per cluster level. The GKE labels of enabled clusters would start to appear in the detailed usage cost export within 48 hours. This feature was released in [June, 2022][2] and you no longer need to maintain separate cluster datasets across projects.\r\n\r\nI would recommend setting up a cloud cost management platform for GKE cost analysis out of the box. You can check out [Economize][3] - connects with your GCP billing dataset and you can create custom GKE cost views. \r\n\r\n\r\n  [1]: https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations#enable_breakdown\r\n  [2]: https://cloud.google.com/billing/docs/release-notes#June_30_2022\r\n  [3]: https://www.economize.cloud/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can configure the cloud billing export to a central dataset in a project. ", "keywords": ["bill"]}, {"source": "Text", "text": "Make sure you enable **Detailed usage cost** export since the latest GKE cost allocation labels are exported here. ", "keywords": ["cost"]}, {"source": "Text", "text": "Once the detailed usage cost is setup, [GKE cost allocation][1] needs to be enabled at a per cluster level. ", "keywords": ["cost", "cluster"]}, {"source": "Text", "text": "The GKE labels of enabled clusters would start to appear in the detailed usage cost export within 48 hours. ", "keywords": ["cost"]}, {"source": "Text", "text": "This feature was released in [June, 2022][2] and you no longer need to maintain separate cluster datasets across projects. ", "keywords": ["feature", "cluster"]}, {"source": "Text", "text": "I would recommend setting up a cloud cost management platform for GKE cost analysis out of the box. ", "keywords": ["cost"]}, {"source": "Text", "text": "You can check out [Economize][3] - connects with your GCP billing dataset and you can create custom GKE cost views. [1]: https://cloud.google.com/kubernetes-engine/docs/how-to/cost-allocations#enable_breakdown [2]: https://cloud.google.com/billing/docs/release-notes#June_30_2022 [3]: https://www", "keywords": ["bill", "cost"]}]}], "filtered-sentences": [{"source": "Body", "text": "You can configure the cloud billing export to a central dataset in a project. ", "keywords": ["bill"]}, {"source": "Body", "text": "Detailed usage cost export since the latest GKE cost allocation labels are exported here. ", "keywords": ["cost"]}, {"source": "Body", "text": "Once the detailed usage cost is setup, GKE cost allocation needs to be enabled at a per cluster level. ", "keywords": ["cost", "cluster"]}, {"source": "Body", "text": "The GKE labels of enabled clusters would start to appear in the detailed usage cost export within 48 hours. ", "keywords": ["cost"]}, {"source": "Body", "text": "This feature was released in June, 2022 and you no longer need to maintain separate cluster datasets across projects. ", "keywords": ["feature", "cluster"]}, {"source": "Body", "text": "I would recommend setting up a cloud cost management platform for GKE cost analysis out of the box. ", "keywords": ["cost"]}, {"source": "Body", "text": "You can check out Economize - connects with your GCP billing dataset and you can create custom GKE cost views.", "keywords": ["bill", "cost"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "GCP / GKE export cost to bigquery per project", "keywords": ["cost"]}, {"source": "Body", "text": "We have a billing account that spans all the GCP projects. ", "keywords": ["bill"]}, {"source": "Body", "text": "From the doc I understand both cloud billing and GKE cost allocations have to be configured to export to bigquery for this. ", "keywords": ["bill", "cost"]}, {"source": "Body", "text": "No issues with configuring cloud billing exports from the billing account to bigquery, but GKE cost allocation can only be exported to a dataset in the same project. ", "keywords": ["bill", "cost"]}, {"source": "Body", "text": "How can I reconcile that, having one billing account for all projects but needing to export it to a dataset in each project ? ", "keywords": ["bill"]}, {"source": "Body", "text": "Or can I just export cloud billing to one dataset in one project, then GKE to each cluster's project in a different dataset, and \"merge\" all of this later on in the dashboard ? ", "keywords": ["bill", "cluster"]}]}