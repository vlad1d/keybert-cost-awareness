{"Id": "51250060", "PostTypeId": "1", "AcceptedAnswerId": "51259722", "CreationDate": "2018-07-09T16:23:21.677", "Score": "0", "ViewCount": "439", "Body": "<p>I got below error message from command prompt after around 17 minutes. Also it seems too long for execution? or is it an expected duration?</p>\n\n<blockquote>\n  <p>azurerm_virtual_machine.vm: Still creating... (17m30s elapsed)\n  Releasing state lock. This may take a few moments...</p>\n  \n  <p>Error: Error applying plan:</p>\n  \n  <p>1 error(s) occurred:</p>\n  \n  <ul>\n  <li><p>azurerm_virtual_machine.vm: 1 error(s) occurred:</p></li>\n  <li><p>azurerm_virtual_machine.vm: unexpected EOF</p></li>\n  </ul>\n  \n  <p>Terraform does not automatically rollback in the face of errors.\n  Instead, your Terraform state file has been partially updated with any\n  resources that successfully completed. Please address the error above\n  and apply again to incrementally change your infrastructure.</p>\n</blockquote>\n\n<p>Once checked inside portal, it's still showing \"Creating...\" status. I used below .tf file. Any issues in it?</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>provider \"azurerm\" {}\r\n\r\nvariable \"location\" {\r\n  default = \"East US\"\r\n}\r\n\r\nvariable \"username\" {\r\n  default = \"...\"\r\n}\r\n\r\nvariable \"password\" {\r\n  default = \"...\"\r\n}\r\n\r\nresource \"azurerm_resource_group\" \"resourceGroup\" {\r\n  name     = \"TerraformResearchResourceGroup\"\r\n  location = \"${var.location}\"\r\n}\r\n\r\nresource \"azurerm_public_ip\" \"publicip\" {\r\n  name                         = \"terraformresearchpublicip\"\r\n  location                     = \"${var.location}\"\r\n  resource_group_name          = \"${azurerm_resource_group.resourceGroup.name}\"\r\n  public_ip_address_allocation = \"Dynamic\"\r\n  idle_timeout_in_minutes      = 30\r\n\r\n  tags {\r\n    environment = \"test\"\r\n  }\r\n}\r\n\r\nresource \"azurerm_virtual_network\" \"vnet\" {\r\n  name                = \"terraformresearchnetwork\"\r\n  address_space       = [\"10.0.0.0/16\"]\r\n  location            = \"${var.location}\"\r\n  resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\"\r\n}\r\n\r\nresource \"azurerm_subnet\" \"subnet\" {\r\n  name                 = \"terraformresearchsubnet\"\r\n  resource_group_name  = \"${azurerm_resource_group.resourceGroup.name}\"\r\n  virtual_network_name = \"${azurerm_virtual_network.vnet.name}\"\r\n  address_prefix       = \"10.0.2.0/24\"\r\n}\r\n\r\nresource \"azurerm_network_interface\" \"nic\" {\r\n  name                = \"terraformresearchnic\"\r\n  location            = \"${var.location}\"\r\n  resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\"\r\n\r\n  ip_configuration {\r\n    name                          = \"terraformresearchconfiguration\"\r\n    subnet_id                     = \"${azurerm_subnet.subnet.id}\"\r\n    private_ip_address_allocation = \"dynamic\"\r\n    public_ip_address_id          = \"${azurerm_public_ip.publicip.id}\"\r\n  }\r\n}\r\n\r\nresource \"azurerm_storage_account\" \"storageacc\" {\r\n  name                     = \"terraformresearchstoacc\"\r\n  resource_group_name      = \"${azurerm_resource_group.resourceGroup.name}\"\r\n  location                 = \"${var.location}\"\r\n  account_tier             = \"Standard\"\r\n  account_replication_type = \"GRS\"\r\n}\r\n\r\nresource \"azurerm_storage_container\" \"storagecont\" {\r\n  name                  = \"terraformresearchstoragecont\"\r\n  resource_group_name   = \"${azurerm_resource_group.resourceGroup.name}\"\r\n  storage_account_name  = \"${azurerm_storage_account.storageacc.name}\"\r\n  container_access_type = \"private\"\r\n}\r\n\r\nresource \"azurerm_managed_disk\" \"datadisk\" {\r\n  name                 = \"terraformresearchdatadisk\"\r\n  location             = \"${var.location}\"\r\n  resource_group_name  = \"${azurerm_resource_group.resourceGroup.name}\"\r\n  storage_account_type = \"Standard_LRS\"\r\n  create_option        = \"Empty\"\r\n  disk_size_gb         = \"1023\"\r\n}\r\n\r\nresource \"azurerm_virtual_machine\" \"vm\" {\r\n  name                  = \"terraformrvm\"\r\n  location              = \"${var.location}\"\r\n  resource_group_name   = \"${azurerm_resource_group.resourceGroup.name}\"\r\n  network_interface_ids = [\"${azurerm_network_interface.nic.id}\"]\r\n  vm_size               = \"Standard_A0\"\r\n\r\n  storage_image_reference {\r\n    publisher = \"MicrosoftWindowsServer\"\r\n    offer     = \"WindowsServer\"\r\n    sku       = \"2016-Datacenter\"\r\n    version   = \"latest\"\r\n  }\r\n\r\n  storage_os_disk {\r\n    name              = \"terraformresearhosdisk\"\r\n    caching           = \"ReadWrite\"\r\n    create_option     = \"FromImage\"\r\n    managed_disk_type = \"Standard_LRS\"\r\n  }\r\n\r\n  storage_data_disk {\r\n    name            = \"${azurerm_managed_disk.datadisk.name}\"\r\n    managed_disk_id = \"${azurerm_managed_disk.datadisk.id}\"\r\n    create_option   = \"Attach\"\r\n    lun             = 1\r\n    disk_size_gb    = \"${azurerm_managed_disk.datadisk.disk_size_gb}\"\r\n  }\r\n\r\n  os_profile {\r\n    computer_name  = \"terraformrvm\"\r\n    admin_username = \"${var.username}\"\r\n    admin_password = \"${var.password}\"\r\n  }\r\n\r\n  os_profile_windows_config {\r\n    enable_automatic_upgrades = false\r\n    provision_vm_agent = true\r\n  }\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n", "OwnerUserId": "1909812", "LastActivityDate": "2018-07-10T07:44:54.713", "Title": "Why can't I create Azure VMs with Terraform Smoothly", "Tags": "<.net><azure><terraform><azure-rm>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "177225413", "PostHistoryTypeId": "2", "PostId": "51250060", "RevisionGUID": "909a6ce3-61c5-4a6a-98d7-96e29456d558", "CreationDate": "2018-07-09T16:23:21.677", "UserId": "1909812", "Text": "I got below error message from command prompt after around 17 minutes. Also it seems too long for execution? or is it an expected duration?\r\n\r\n> azurerm_virtual_machine.vm: Still creating... (17m30s elapsed)\r\n> Releasing state lock. This may take a few moments...\r\n> \r\n> Error: Error applying plan:\r\n> \r\n> 1 error(s) occurred:\r\n> \r\n> * azurerm_virtual_machine.vm: 1 error(s) occurred:\r\n> \r\n> * azurerm_virtual_machine.vm: unexpected EOF\r\n> \r\n> Terraform does not automatically rollback in the face of errors.\r\n> Instead, your Terraform state file has been partially updated with any\r\n> resources that successfully completed. Please address the error above\r\n> and apply again to incrementally change your infrastructure.\r\n\r\n\r\nOnce checked inside portal, it's still showing \"Creating...\" status. I used below .tf file. Any issues in it?\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-html -->\r\n\r\n    provider \"azurerm\" {}\r\n\r\n    variable \"location\" {\r\n      default = \"East US\"\r\n    }\r\n\r\n    variable \"username\" {\r\n      default = \"...\"\r\n    }\r\n\r\n    variable \"password\" {\r\n      default = \"...\"\r\n    }\r\n\r\n    resource \"azurerm_resource_group\" \"resourceGroup\" {\r\n      name     = \"TerraformResearchResourceGroup\"\r\n      location = \"${var.location}\"\r\n    }\r\n\r\n    resource \"azurerm_public_ip\" \"publicip\" {\r\n      name                         = \"terraformresearchpublicip\"\r\n      location                     = \"${var.location}\"\r\n      resource_group_name          = \"${azurerm_resource_group.resourceGroup.name}\"\r\n      public_ip_address_allocation = \"Dynamic\"\r\n      idle_timeout_in_minutes      = 30\r\n\r\n      tags {\r\n        environment = \"test\"\r\n      }\r\n    }\r\n\r\n    resource \"azurerm_virtual_network\" \"vnet\" {\r\n      name                = \"terraformresearchnetwork\"\r\n      address_space       = [\"10.0.0.0/16\"]\r\n      location            = \"${var.location}\"\r\n      resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\"\r\n    }\r\n\r\n    resource \"azurerm_subnet\" \"subnet\" {\r\n      name                 = \"terraformresearchsubnet\"\r\n      resource_group_name  = \"${azurerm_resource_group.resourceGroup.name}\"\r\n      virtual_network_name = \"${azurerm_virtual_network.vnet.name}\"\r\n      address_prefix       = \"10.0.2.0/24\"\r\n    }\r\n\r\n    resource \"azurerm_network_interface\" \"nic\" {\r\n      name                = \"terraformresearchnic\"\r\n      location            = \"${var.location}\"\r\n      resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\"\r\n\r\n      ip_configuration {\r\n        name                          = \"terraformresearchconfiguration\"\r\n        subnet_id                     = \"${azurerm_subnet.subnet.id}\"\r\n        private_ip_address_allocation = \"dynamic\"\r\n        public_ip_address_id          = \"${azurerm_public_ip.publicip.id}\"\r\n      }\r\n    }\r\n\r\n    resource \"azurerm_storage_account\" \"storageacc\" {\r\n      name                     = \"terraformresearchstoacc\"\r\n      resource_group_name      = \"${azurerm_resource_group.resourceGroup.name}\"\r\n      location                 = \"${var.location}\"\r\n      account_tier             = \"Standard\"\r\n      account_replication_type = \"GRS\"\r\n    }\r\n\r\n    resource \"azurerm_storage_container\" \"storagecont\" {\r\n      name                  = \"terraformresearchstoragecont\"\r\n      resource_group_name   = \"${azurerm_resource_group.resourceGroup.name}\"\r\n      storage_account_name  = \"${azurerm_storage_account.storageacc.name}\"\r\n      container_access_type = \"private\"\r\n    }\r\n\r\n    resource \"azurerm_managed_disk\" \"datadisk\" {\r\n      name                 = \"terraformresearchdatadisk\"\r\n      location             = \"${var.location}\"\r\n      resource_group_name  = \"${azurerm_resource_group.resourceGroup.name}\"\r\n      storage_account_type = \"Standard_LRS\"\r\n      create_option        = \"Empty\"\r\n      disk_size_gb         = \"1023\"\r\n    }\r\n\r\n    resource \"azurerm_virtual_machine\" \"vm\" {\r\n      name                  = \"terraformrvm\"\r\n      location              = \"${var.location}\"\r\n      resource_group_name   = \"${azurerm_resource_group.resourceGroup.name}\"\r\n      network_interface_ids = [\"${azurerm_network_interface.nic.id}\"]\r\n      vm_size               = \"Standard_A0\"\r\n\r\n      storage_image_reference {\r\n        publisher = \"MicrosoftWindowsServer\"\r\n        offer     = \"WindowsServer\"\r\n        sku       = \"2016-Datacenter\"\r\n        version   = \"latest\"\r\n      }\r\n\r\n      storage_os_disk {\r\n        name              = \"terraformresearhosdisk\"\r\n        caching           = \"ReadWrite\"\r\n        create_option     = \"FromImage\"\r\n        managed_disk_type = \"Standard_LRS\"\r\n      }\r\n\r\n      storage_data_disk {\r\n        name            = \"${azurerm_managed_disk.datadisk.name}\"\r\n        managed_disk_id = \"${azurerm_managed_disk.datadisk.id}\"\r\n        create_option   = \"Attach\"\r\n        lun             = 1\r\n        disk_size_gb    = \"${azurerm_managed_disk.datadisk.disk_size_gb}\"\r\n      }\r\n\r\n      os_profile {\r\n        computer_name  = \"terraformrvm\"\r\n        admin_username = \"${var.username}\"\r\n        admin_password = \"${var.password}\"\r\n      }\r\n\r\n      os_profile_windows_config {\r\n        enable_automatic_upgrades = false\r\n        provision_vm_agent = true\r\n      }\r\n    }\r\n\r\n<!-- end snippet -->\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Please address the error above > and apply again to incrementally change your infrastructure. ", "keywords": ["change"]}, {"source": "Text", "text": "Any issues in it? provider \"azurerm\" {} variable \"location\" { default = \"East US\" } variable \"username\" { default = \"...\" } variable \"password\" { default = \"...\" } resource \"azurerm_resource_group\" \"resourceGroup\" { name = \"TerraformResearchResourceGroup\" location = \"${var.location}\" } resource \"azurerm_public_ip\" \"publicip\" { name = \"terraformresearchpublicip\" location = \"${var.location}\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" public_ip_address_allocation = \"Dynamic\" idle_timeout_in_minutes = 30 tags { environment = \"test\" } } resource \"azurerm_virtual_network\" \"vnet\" { name = \"terraformresearchnetwork\" address_space = [\"10.0.0.0/16\"] location = \"${var.location}\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" } resource \"azurerm_subnet\" \"subnet\" { name = \"terraformresearchsubnet\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" virtual_network_name = \"${azurerm_virtual_network.vnet.name}\" address_prefix = \"10.0.2.0/24\" } resource \"azurerm_network_interface\" \"nic\" { name = \"terraformresearchnic\" location = \"${var.location}\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" ip_configuration { name = \"terraformresearchconfiguration\" subnet_id = \"${azurerm_subnet.subnet.id}\" private_ip_address_allocation = \"dynamic\" public_ip_address_id = \"${azurerm_public_ip.publicip.id}\" } } resource \"azurerm_storage_account\" \"storageacc\" { name = \"terraformresearchstoacc\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" location = \"${var.location}\" account_tier = \"Standard\" account_replication_type = \"GRS\" } resource \"azurerm_storage_container\" \"storagecont\" { name = \"terraformresearchstoragecont\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" storage_account_name = \"${azurerm_storage_account.storageacc.name}\" container_access_type = \"private\" } resource \"azurerm_managed_disk\" \"datadisk\" { name = \"terraformresearchdatadisk\" location = \"${var.location}\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" storage_account_type = \"Standard_LRS\" create_option = \"Empty\" disk_size_gb = \"1023\" } resource \"azurerm_virtual_machine\" \"vm\" { name = \"terraformrvm\" location = \"${var.location}\" resource_group_name = \"${azurerm_resource_group.resourceGroup.name}\" network_interface_ids = [\"${azurerm_network_interface.nic.id}\"] vm_size = \"Standard_A0\" storage_image_reference { publisher = \"MicrosoftWindowsServer\" offer = \"WindowsServer\" sku = \"2016-Datacenter\" version = \"latest\" } storage_os_disk { name = \"terraformresearhosdisk\" caching = \"ReadWrite\" create_option = \"FromImage\" managed_disk_type = \"Standard_LRS\" } storage_data_disk { name = \"${azurerm_managed_disk.datadisk.name}\" managed_disk_id = \"${azurerm_managed_disk.datadisk.id}\" create_option = \"Attach\" lun = 1 disk_size_gb = \"${azurerm_managed_disk.datadisk.disk_size_gb", "keywords": ["provider", "test"]}]}, {"Id": "177225414", "PostHistoryTypeId": "1", "PostId": "51250060", "RevisionGUID": "909a6ce3-61c5-4a6a-98d7-96e29456d558", "CreationDate": "2018-07-09T16:23:21.677", "UserId": "1909812", "Text": "Why can't I create Azure VMs with Terraform Smoothly", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "177225415", "PostHistoryTypeId": "3", "PostId": "51250060", "RevisionGUID": "909a6ce3-61c5-4a6a-98d7-96e29456d558", "CreationDate": "2018-07-09T16:23:21.677", "UserId": "1909812", "Text": "<.net><azure><terraform><azure-rm>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "51259722", "PostTypeId": "2", "ParentId": "51250060", "CreationDate": "2018-07-10T07:44:54.713", "Score": "1", "Body": "<p>For your issue, I take a test and there is something needed to change in your .tf file.</p>\n\n<p>First, the storage account name needs to be less or equal to 20 lengths.</p>\n\n<p>Second, your VM size is too small so it will cost a long time to create the VM. If you change to a bigger size and the time will be shortened.</p>\n\n<p>The last thing is that the username and password should be defined in the variables. I think you know it.</p>\n", "OwnerUserId": "9773937", "LastActivityDate": "2018-07-10T07:44:54.713", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "89520262", "PostId": "51259722", "Score": "0", "Text": "Thanks for the response. Storage account name allows up to a length of 24. I will try to increase VM size tomorrow and let you know. Any reason why bigger VM create with less time?Have you any preferred size than \"vm_size               = \"Standard_A0\", for this testing purpose?", "CreationDate": "2018-07-10T17:27:08.503", "UserId": "1909812", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Storage account name allows up to a length of 24. ", "keywords": ["storage"]}, {"source": "Text", "text": "Have you any preferred size than \"vm_size = \"Standard_A0\", for this testing purpose?", "keywords": ["test"]}]}, {"Id": "89529490", "PostId": "51259722", "Score": "0", "Text": "As my test, the Standard_A0 size takes about forty minutes and then timeout. Then I test Standard_A2 size, It takes about 8 minutes. So I suggest you can use size like this\uff0csuch as Standard_A2 or Standard_B2s. And why small size take much more time? As I think, something inside needs more CPU or memory to be used. And as my test with your .tf file, I got the error storage account name cannot more than 20 lengths, maybe there is something different.", "CreationDate": "2018-07-11T01:01:21.650", "UserId": "9773937", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "As my test, the Standard_A0 size takes about forty minutes and then timeout. ", "keywords": ["test"]}, {"source": "Text", "text": "Then I test Standard_A2 size, It takes about 8 minutes. ", "keywords": ["test"]}, {"source": "Text", "text": "As I think, something inside needs more CPU or memory to be used. ", "keywords": ["cpu"]}, {"source": "Text", "text": "And as my test with your .tf file, I got the error storage account name cannot more than 20 lengths, maybe there is something different.", "keywords": ["storage", "test"]}]}, {"Id": "89533309", "PostId": "51259722", "Score": "0", "Text": "I can confirm this behaviour. For me A2 size only took 5 minutes.", "CreationDate": "2018-07-11T05:36:08.583", "UserId": "1909812", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "89533377", "PostId": "51259722", "Score": "0", "Text": "I'm glad it's helpful to you! :-)", "CreationDate": "2018-07-11T05:38:28.807", "UserId": "9773937", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "177313898", "PostHistoryTypeId": "2", "PostId": "51259722", "RevisionGUID": "3e6954b1-6f19-4934-945f-ccb2916868a2", "CreationDate": "2018-07-10T07:44:54.713", "UserId": "9773937", "Text": "For your issue, I take a test and there is something needed to change in your .tf file.\r\n\r\nFirst, the storage account name needs to be less or equal to 20 lengths.\r\n\r\nSecond, your VM size is too small so it will cost a long time to create the VM. If you change to a bigger size and the time will be shortened.\r\n\r\nThe last thing is that the username and password should be defined in the variables. I think you know it.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For your issue, I take a test and there is something needed to change in your .tf file. ", "keywords": ["change", "test"]}, {"source": "Text", "text": "First, the storage account name needs to be less or equal to 20 lengths. ", "keywords": ["storage"]}, {"source": "Text", "text": "Second, your VM size is too small so it will cost a long time to create the VM. ", "keywords": ["cost"]}, {"source": "Text", "text": "If you change to a bigger size and the time will be shortened. ", "keywords": ["change"]}]}], "filtered-sentences": [{"source": "Body", "text": "For your issue, I take a test and there is something needed to change in your .tf file. ", "keywords": ["change", "test"]}, {"source": "Body", "text": "First, the storage account name needs to be less or equal to 20 lengths. ", "keywords": ["storage"]}, {"source": "Body", "text": "Second, your VM size is too small so it will cost a long time to create the VM. ", "keywords": ["cost"]}, {"source": "Body", "text": "If you change to a bigger size and the time will be shortened. ", "keywords": ["change"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "Please address the error above and apply again to incrementally change your infrastructure. ", "keywords": ["change"]}]}