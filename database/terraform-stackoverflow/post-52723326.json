{"Id": "52723326", "PostTypeId": "1", "AcceptedAnswerId": "52733323", "CreationDate": "2018-10-09T14:22:26.817", "Score": "0", "ViewCount": "3551", "Body": "<p>I wish to get a marketplace image to a managed disk and then have this managed disk attached to a Azure virtual machine with Terraform.</p>\n\n<p>This enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact.</p>\n\n<p>I have found people with similar problems but the issues get closed off with no example left of how to get this achieved.</p>\n\n<p>For the platform image</p>\n\n<pre><code>data \"azurerm_platform_image\" \"2016-Datacenter\" {\n  location  = \"West Europe\"\n  publisher = \"MicrosoftWindowsServer\"\n  offer     = \"WindowsServer\"\n  sku       = \"2016-Datacenter\"\n}\n</code></pre>\n\n<p>Create the managed disk with the platform image</p>\n\n<pre><code>resource \"azurerm_managed_disk\" \"Server-osdisk\" {\n  resource_group_name  = \"rgroup\"\n  location             = \"West Europe\"\n  create_option        = \"FromImage\"\n  image_reference_id   = \"${data.azurerm_platform_image.server2016.id}\"\n  disk_size_gb         = \"127\"\n  name                 = \"Server-osdisk\"\n  storage_account_type = \"Standard_LRS\"\n}\n</code></pre>\n\n<p>Then reference it in the <code>azurerm_virtual_machine</code></p>\n\n<pre><code>resource \"azurerm_virtual_machine\" \"main\" {\n  # ...\n\n  os_profile {\n    computer_name  = \"Server\"\n    admin_username = \"\"\n    admin_password = \"\"\n  }\n\n  storage_os_disk {\n    managed_disk_id = \"${azurerm_managed_disk.Server-osdisk.id}\"\n\n    # os_type           = \"Windows\"\n    managed_disk_type = \"Premium_LRS\"\n    caching           = \"ReadWrite\"\n    create_option     = \"Attach\"\n    name              = \"Server\"\n  }\n}\n</code></pre>\n\n<p>Throws </p>\n\n<blockquote>\n  <p>Status=400 Code=\"InvalidParameter\" Message=\"Required parameter\n  'osDisk.osType' is missing (null).\" Target=\"osDisk.osType\"</p>\n</blockquote>\n\n<p>If you add <code>os_type</code> in it throws up that you cannot have <code>os_profile</code> which is needed for computer name, username and password</p>\n\n<p>People with same problem </p>\n\n<p><a href=\"https://stackoverflow.com/questions/48079735/terraform-creating-vm-from-managed-disk-image-made-in-packer\">Terraform creating VM from managed disk image made in Packer</a></p>\n\n<p>Tried solution but throws up the error mentioned above</p>\n\n<p>What am I missing on this?</p>\n", "OwnerUserId": "8901076", "LastEditorUserId": "8901076", "LastEditDate": "2018-10-09T14:47:17.063", "LastActivityDate": "2020-10-06T13:08:08.743", "Title": "Terraform creating VM from managed disk image", "Tags": "<azure><terraform>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "links": [{"Id": "1629307492", "CreationDate": "2018-10-09T14:22:26.817", "PostId": "52723326", "RelatedPostId": "48079735", "LinkTypeId": "1"}], "history": [{"Id": "183397801", "PostHistoryTypeId": "2", "PostId": "52723326", "RevisionGUID": "cd5fde72-4498-444d-961f-d3a7023c0d3b", "CreationDate": "2018-10-09T14:22:26.817", "UserId": "8901076", "Text": "I wish to get a marketplace image to a managed disk and then have this managed disk attached to a Azure virtual machine with Terraform.\r\n\r\nThis enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact.\r\n\r\nI have found people with simlar problems but the issues get closed off with no example left of how to get this achieved.\r\n\r\nFor the platform image\r\n\r\n    data \"azurerm_platform_image\" \"2016-Datacenter\" {\r\n         location            = \"West Europe\"\r\n         publisher = \"MicrosoftWindowsServer\"\r\n         offer     = \"WindowsServer\"\r\n         sku       = \"2016-Datacenter\"\r\n         }\r\n\r\nCreate the managed disk with the platform image\r\n\r\n         resource \"azurerm_managed_disk\"  \"Server-osdisk\" {\r\n         resource_group_name = \"rgroup\"\r\n         location = \"West Europe\"\r\n         create_option = \"FromImage\"\r\n         image_reference_id  = \"${data.azurerm_platform_image.server2016.id}\"\r\n         disk_size_gb = \"127\"\r\n         name = \"Server-osdisk\"\r\n         storage_account_type = \"Standard_LRS\"\r\n\r\n         }\r\n\r\nThen reference it in the azurerm_virtual_machine, extracted\r\n\r\n         os_profile{\r\n         computer_name = \"Server\"\r\n         admin_username = \"\"\r\n         admin_password = \"\"\r\n         }\r\n\r\n         storage_os_disk {\r\n         managed_disk_id = \"${azurerm_managed_disk.Server-osdisk.id}\"\r\n         #  os_type           = \"Windows\"\r\n         managed_disk_type = \"Premium_LRS\"\r\n         caching           = \"ReadWrite\"\r\n         create_option     = \"Attach\"\r\n         name  = \"Server\"\r\n         }\r\n\r\nThrows \r\nStatus=400 Code=\"InvalidParameter\" Message=\"Required parameter 'osDisk.osType' is missing (null).\" Target=\"osDisk.osType\"\r\n\r\nIf you add os_type in it throws up that you cannot have os_profile which is needed for computer name, username and password\r\n\r\nPeople with same problem \r\n\r\nhttps://stackoverflow.com/questions/48079735/terraform-creating-vm-from-managed-disk-image-made-in-packer\r\n\r\nTried solution but throws up the error mentioned above\r\n\r\nhttps://stackoverflow.com/questions/48079735/terraform-creating-vm-from-managed-disk-image-made-in-packer/48884226#48884226\r\n\r\nWhat am I missing on this?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact. ", "keywords": ["change"]}]}, {"Id": "183397802", "PostHistoryTypeId": "1", "PostId": "52723326", "RevisionGUID": "cd5fde72-4498-444d-961f-d3a7023c0d3b", "CreationDate": "2018-10-09T14:22:26.817", "UserId": "8901076", "Text": "Terraform creating VM from managed disk image", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183397803", "PostHistoryTypeId": "3", "PostId": "52723326", "RevisionGUID": "cd5fde72-4498-444d-961f-d3a7023c0d3b", "CreationDate": "2018-10-09T14:22:26.817", "UserId": "8901076", "Text": "<terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183398384", "PostHistoryTypeId": "5", "PostId": "52723326", "RevisionGUID": "4f2f0780-9cda-4469-a6ea-902faba1187c", "CreationDate": "2018-10-09T14:29:22.700", "UserId": "2291321", "Comment": "added 64 characters in body; edited tags", "Text": "I wish to get a marketplace image to a managed disk and then have this managed disk attached to a Azure virtual machine with Terraform.\r\n\r\nThis enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact.\r\n\r\nI have found people with similar problems but the issues get closed off with no example left of how to get this achieved.\r\n\r\nFor the platform image\r\n\r\n    data \"azurerm_platform_image\" \"2016-Datacenter\" {\r\n      location  = \"West Europe\"\r\n      publisher = \"MicrosoftWindowsServer\"\r\n      offer     = \"WindowsServer\"\r\n      sku       = \"2016-Datacenter\"\r\n    }\r\n\r\nCreate the managed disk with the platform image\r\n\r\n    resource \"azurerm_managed_disk\" \"Server-osdisk\" {\r\n      resource_group_name  = \"rgroup\"\r\n      location             = \"West Europe\"\r\n      create_option        = \"FromImage\"\r\n      image_reference_id   = \"${data.azurerm_platform_image.server2016.id}\"\r\n      disk_size_gb         = \"127\"\r\n      name                 = \"Server-osdisk\"\r\n      storage_account_type = \"Standard_LRS\"\r\n    }\r\n\r\nThen reference it in the `azurerm_virtual_machine`\r\n\r\n    resource \"azurerm_virtual_machine\" \"main\" {\r\n      # ...\r\n    \r\n      os_profile {\r\n        computer_name  = \"Server\"\r\n        admin_username = \"\"\r\n        admin_password = \"\"\r\n      }\r\n    \r\n      storage_os_disk {\r\n        managed_disk_id = \"${azurerm_managed_disk.Server-osdisk.id}\"\r\n    \r\n        # os_type           = \"Windows\"\r\n        managed_disk_type = \"Premium_LRS\"\r\n        caching           = \"ReadWrite\"\r\n        create_option     = \"Attach\"\r\n        name              = \"Server\"\r\n      }\r\n    }\r\n\r\nThrows \r\n\r\n> Status=400 Code=\"InvalidParameter\" Message=\"Required parameter\r\n> 'osDisk.osType' is missing (null).\" Target=\"osDisk.osType\"\r\n\r\nIf you add `os_type` in it throws up that you cannot have `os_profile` which is needed for computer name, username and password\r\n\r\nPeople with same problem \r\n\r\nhttps://stackoverflow.com/questions/48079735/terraform-creating-vm-from-managed-disk-image-made-in-packer\r\n\r\nTried solution but throws up the error mentioned above\r\n\r\nhttps://stackoverflow.com/questions/48079735/terraform-creating-vm-from-managed-disk-image-made-in-packer/48884226#48884226\r\n\r\nWhat am I missing on this?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact. ", "keywords": ["change"]}]}, {"Id": "183398385", "PostHistoryTypeId": "6", "PostId": "52723326", "RevisionGUID": "4f2f0780-9cda-4469-a6ea-902faba1187c", "CreationDate": "2018-10-09T14:29:22.700", "UserId": "2291321", "Comment": "added 64 characters in body; edited tags", "Text": "<azure><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "183399775", "PostHistoryTypeId": "5", "PostId": "52723326", "RevisionGUID": "33b9cd8c-b806-4587-b695-b8f094020f43", "CreationDate": "2018-10-09T14:47:17.063", "UserId": "8901076", "Comment": "deleted 127 characters in body", "Text": "I wish to get a marketplace image to a managed disk and then have this managed disk attached to a Azure virtual machine with Terraform.\r\n\r\nThis enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact.\r\n\r\nI have found people with similar problems but the issues get closed off with no example left of how to get this achieved.\r\n\r\nFor the platform image\r\n\r\n    data \"azurerm_platform_image\" \"2016-Datacenter\" {\r\n      location  = \"West Europe\"\r\n      publisher = \"MicrosoftWindowsServer\"\r\n      offer     = \"WindowsServer\"\r\n      sku       = \"2016-Datacenter\"\r\n    }\r\n\r\nCreate the managed disk with the platform image\r\n\r\n    resource \"azurerm_managed_disk\" \"Server-osdisk\" {\r\n      resource_group_name  = \"rgroup\"\r\n      location             = \"West Europe\"\r\n      create_option        = \"FromImage\"\r\n      image_reference_id   = \"${data.azurerm_platform_image.server2016.id}\"\r\n      disk_size_gb         = \"127\"\r\n      name                 = \"Server-osdisk\"\r\n      storage_account_type = \"Standard_LRS\"\r\n    }\r\n\r\nThen reference it in the `azurerm_virtual_machine`\r\n\r\n    resource \"azurerm_virtual_machine\" \"main\" {\r\n      # ...\r\n    \r\n      os_profile {\r\n        computer_name  = \"Server\"\r\n        admin_username = \"\"\r\n        admin_password = \"\"\r\n      }\r\n    \r\n      storage_os_disk {\r\n        managed_disk_id = \"${azurerm_managed_disk.Server-osdisk.id}\"\r\n    \r\n        # os_type           = \"Windows\"\r\n        managed_disk_type = \"Premium_LRS\"\r\n        caching           = \"ReadWrite\"\r\n        create_option     = \"Attach\"\r\n        name              = \"Server\"\r\n      }\r\n    }\r\n\r\nThrows \r\n\r\n> Status=400 Code=\"InvalidParameter\" Message=\"Required parameter\r\n> 'osDisk.osType' is missing (null).\" Target=\"osDisk.osType\"\r\n\r\nIf you add `os_type` in it throws up that you cannot have `os_profile` which is needed for computer name, username and password\r\n\r\nPeople with same problem \r\n\r\nhttps://stackoverflow.com/questions/48079735/terraform-creating-vm-from-managed-disk-image-made-in-packer\r\n\r\nTried solution but throws up the error mentioned above\r\n\r\nWhat am I missing on this?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact. ", "keywords": ["change"]}]}], "answers": [{"Id": "52733323", "PostTypeId": "2", "ParentId": "52723326", "CreationDate": "2018-10-10T05:44:14.383", "Score": "3", "Body": "<p>For your issue, I have a try and make it out. You change things to yours, it is just an example. The file here:</p>\n\n<pre><code>resource \"azurerm_resource_group\" \"main\" {\n  name = \"acctestRG\"\n  location = \"West Europe\"\n}\n\ndata \"azurerm_platform_image\" \"linux\" {\n  location  = \"West Europe\"\n  publisher = \"Canonical\"\n  offer     = \"UbuntuServer\"\n  sku       = \"16.04-LTS\"\n}\n\nresource \"azurerm_managed_disk\" \"source\" {\n  name = \"acctestmd1\"\n  location = \"West Europe\"\n  resource_group_name = \"${azurerm_resource_group.main.name}\"\n  storage_account_type = \"Standard_LRS\"\n  create_option = \"FromImage\"\n  image_reference_id = \"${data.azurerm_platform_image.linux.id}\"\n\n  tags {\n    environment = \"staging\"\n  }\n}\n\nresource \"azurerm_virtual_network\" \"main\" {\n  name                = \"azuretestvnet\"\n  address_space       = [\"10.0.0.0/16\"]\n  location            = \"${azurerm_resource_group.main.location}\"\n  resource_group_name = \"${azurerm_resource_group.main.name}\"\n}\n\nresource \"azurerm_subnet\" \"internal\" {\n  name                 = \"internal\"\n  resource_group_name  = \"${azurerm_resource_group.main.name}\"\n  virtual_network_name = \"${azurerm_virtual_network.main.name}\"\n  address_prefix       = \"10.0.2.0/24\"\n}\n\nresource \"azurerm_network_interface\" \"main\" {\n  name                = \"azuretestnic\"\n  location            = \"${azurerm_resource_group.main.location}\"\n  resource_group_name = \"${azurerm_resource_group.main.name}\"\n\n  ip_configuration {\n    name                          = \"testconfiguration1\"\n    subnet_id                     = \"${azurerm_subnet.internal.id}\"\n    private_ip_address_allocation = \"dynamic\"\n  }\n}\n\nresource \"azurerm_virtual_machine\" \"main\" {\n  name  = \"azurevm\"\n  location = \"West Europe\"\n  resource_group_name = \"${azurerm_resource_group.main.name}\"\n  network_interface_ids = [\"${azurerm_network_interface.main.id}\"]\n  vm_size = \"Standard_DS1_v2\"\n\n\n  storage_os_disk {\n    os_type = \"Linux\"\n    name = \"acctestmd1\"\n    managed_disk_type = \"Standard_LRS\"\n    caching           = \"ReadWrite\"\n    create_option     = \"Attach\"\n    managed_disk_id   = \"${azurerm_managed_disk.source.id}\"\n  }\n  os_profile_linux_config {\n    disable_password_authentication = false\n  }\n}\n</code></pre>\n\n<p>And there are some things I have met and I think you should pay attention to them.</p>\n\n<ol>\n<li>the managed_disk_type in the VM and the storage_account_type in the managed disk should be same.</li>\n<li>the name of the managed disk should be the same in both.</li>\n</ol>\n\n<p>Hope this will help you.</p>\n", "OwnerUserId": "9773937", "LastEditorUserId": "9773937", "LastEditDate": "2018-10-10T06:42:54.770", "LastActivityDate": "2018-10-10T06:42:54.770", "CommentCount": "6", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "92397559", "PostId": "52733323", "Score": "0", "Text": "Hello,Thanks you for taking the time to respond, I did spot the disk sizes earlier and have amended, changed the name to keep the same, the problem with this setup is that you dont specifiy the computer name, username and password so the Windows machine is created from a image but in a generalized state.", "CreationDate": "2018-10-10T09:02:34.757", "UserId": "8901076", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Hello,Thanks you for taking the time to respond, I did spot the disk sizes earlier and have amended, changed the name to keep the same, the problem with this setup is that you dont specifiy the computer name, username and password so the Windows machine is created from a image but in a generalized state.", "keywords": ["change"]}]}, {"Id": "92398677", "PostId": "52733323", "Score": "0", "Text": "You can use vm extension to set the user for the windows vm and make sure the agent installed in it with the os_profile_windows_config. For Linux, you can use ssh key. Maybe it's an issue in Terraform.", "CreationDate": "2018-10-10T09:31:41.170", "UserId": "9773937", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92402900", "PostId": "52733323", "Score": "0", "Text": "do you mean something like `os_profile_windows_config {\n    provision_vm_agent = true\n    enable_automatic_upgrades = true\n   \n\n      additional_unattend_config {\n      pass = \"oobeSystem\"\n      component = \"Microsoft-Windows-Shell-Setup\"\n      setting_name = \"AutoLogon\"\n      content = \"<AutoLogon><Password><Value>Pass</Value></Password><Enabled>true</Enabled><LogonCount>1</LogonCount><Username>admin</Username></AutoLogon>\"\n    }\n      }` or the azurerm_virtual_machine_extension resource", "CreationDate": "2018-10-10T11:29:39.670", "UserId": "8901076", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92425541", "PostId": "52733323", "Score": "0", "Text": "Yeah, it's that.", "CreationDate": "2018-10-11T00:51:44.827", "UserId": "9773937", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92431738", "PostId": "52733323", "Score": "0", "Text": "Ok, I will create a xml for bypassing the sysprep and use the settings I mentioned to invoke it", "CreationDate": "2018-10-11T07:07:34.013", "UserId": "8901076", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "92431769", "PostId": "52733323", "Score": "0", "Text": "Good luck to you!", "CreationDate": "2018-10-11T07:08:34.790", "UserId": "9773937", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "183438232", "PostHistoryTypeId": "2", "PostId": "52733323", "RevisionGUID": "bcbc1823-b816-4ed6-929f-cf559456d413", "CreationDate": "2018-10-10T05:44:14.383", "UserId": "9773937", "Text": "For your issue, I have a try and make it out. You change things to yours, it is just an example. The file here:\r\n\r\n    resource \"azurerm_resource_group\" \"main\" {\r\n      name = \"acctestRG\"\r\n      location = \"West Europe\"\r\n    }\r\n    \r\n    data \"azurerm_platform_image\" \"linux\" {\r\n      location  = \"West Europe\"\r\n      publisher = \"Canonical\"\r\n      offer     = \"UbuntuServer\"\r\n      sku       = \"16.04-LTS\"\r\n    }\r\n    \r\n    resource \"azurerm_managed_disk\" \"source\" {\r\n      name = \"acctestmd1\"\r\n      location = \"West Europe\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n      storage_account_type = \"Standard_LRS\"\r\n      create_option = \"FromImage\"\r\n      image_reference_id = \"${data.azurerm_platform_image.linux.id}\"\r\n    \r\n      tags {\r\n        environment = \"staging\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_virtual_network\" \"main\" {\r\n      name                = \"azuretestvnet\"\r\n      address_space       = [\"10.0.0.0/16\"]\r\n      location            = \"${azurerm_resource_group.main.location}\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n    }\r\n    \r\n    resource \"azurerm_subnet\" \"internal\" {\r\n      name                 = \"internal\"\r\n      resource_group_name  = \"${azurerm_resource_group.main.name}\"\r\n      virtual_network_name = \"${azurerm_virtual_network.main.name}\"\r\n      address_prefix       = \"10.0.2.0/24\"\r\n    }\r\n    \r\n    resource \"azurerm_network_interface\" \"main\" {\r\n      name                = \"azuretestnic\"\r\n      location            = \"${azurerm_resource_group.main.location}\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n    \r\n      ip_configuration {\r\n        name                          = \"testconfiguration1\"\r\n        subnet_id                     = \"${azurerm_subnet.internal.id}\"\r\n        private_ip_address_allocation = \"dynamic\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_virtual_machine\" \"main\" {\r\n      name  = \"azurevm\"\r\n      location = \"West Europe\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n      network_interface_ids = [\"${azurerm_network_interface.main.id}\"]\r\n      vm_size = \"Standard_DS1_v2\"\r\n    \r\n    \r\n      storage_os_disk {\r\n        os_type = \"Linux\"\r\n        name = \"acctestmd1\"\r\n     managed_disk_type = \"Standard_LRS\"\r\n        caching           = \"ReadWrite\"\r\n        create_option     = \"Attach\"\r\n        managed_disk_id   = \"${azurerm_managed_disk.source.id}\"\r\n      }\r\n      os_profile_linux_config {\r\n        disable_password_authentication = false\r\n      }\r\n    }", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You change things to yours, it is just an example. ", "keywords": ["change"]}, {"source": "Text", "text": "The file here: resource \"azurerm_resource_group\" \"main\" { name = \"acctestRG\" location = \"West Europe\" } data \"azurerm_platform_image\" \"linux\" { location = \"West Europe\" publisher = \"Canonical\" offer = \"UbuntuServer\" sku = \"16.04-LTS\" } resource \"azurerm_managed_disk\" \"source\" { name = \"acctestmd1\" location = \"West Europe\" resource_group_name = \"${azurerm_resource_group.main.name}\" storage_account_type = \"Standard_LRS\" create_option = \"FromImage\" image_reference_id = \"${data.azurerm_platform_image.linux.id}\" tags { environment = \"staging\" } } resource \"azurerm_virtual_network\" \"main\" { name = \"azuretestvnet\" address_space = [\"10.0.0.0/16\"] location = \"${azurerm_resource_group.main.location}\" resource_group_name = \"${azurerm_resource_group.main.name}\" } resource \"azurerm_subnet\" \"internal\" { name = \"internal\" resource_group_name = \"${azurerm_resource_group.main.name}\" virtual_network_name = \"${azurerm_virtual_network.main.name}\" address_prefix = \"10.0.2.0/24\" } resource \"azurerm_network_interface\" \"main\" { name = \"azuretestnic\" location = \"${azurerm_resource_group.main.location}\" resource_group_name = \"${azurerm_resource_group.main.name}\" ip_configuration { name = \"testconfiguration1\" subnet_id = \"${azurerm_subnet.internal.id}\" private_ip_address_allocation = \"dynamic\" } } resource \"azurerm_virtual_machine\" \"main\" { name = \"azurevm\" location = \"West Europe\" resource_group_name = \"${azurerm_resource_group.main.name}\" network_interface_ids = [\"${azurerm_network_interface.main.id}\"] vm_size = \"Standard_DS1_v2\" storage_os_disk { os_type = \"Linux\" name = \"acctestmd1\" managed_disk_type = \"Standard_LRS\" caching = \"ReadWrite\" create_option = \"Attach\" managed_disk_id = \"${azurerm_managed_disk.source.id}\" ", "keywords": ["test"]}]}, {"Id": "183441586", "PostHistoryTypeId": "5", "PostId": "52733323", "RevisionGUID": "bdba2f1a-e766-430d-a681-96e83397794f", "CreationDate": "2018-10-10T06:42:54.770", "UserId": "9773937", "Comment": "added 280 characters in body", "Text": "For your issue, I have a try and make it out. You change things to yours, it is just an example. The file here:\r\n\r\n    resource \"azurerm_resource_group\" \"main\" {\r\n      name = \"acctestRG\"\r\n      location = \"West Europe\"\r\n    }\r\n    \r\n    data \"azurerm_platform_image\" \"linux\" {\r\n      location  = \"West Europe\"\r\n      publisher = \"Canonical\"\r\n      offer     = \"UbuntuServer\"\r\n      sku       = \"16.04-LTS\"\r\n    }\r\n    \r\n    resource \"azurerm_managed_disk\" \"source\" {\r\n      name = \"acctestmd1\"\r\n      location = \"West Europe\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n      storage_account_type = \"Standard_LRS\"\r\n      create_option = \"FromImage\"\r\n      image_reference_id = \"${data.azurerm_platform_image.linux.id}\"\r\n    \r\n      tags {\r\n        environment = \"staging\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_virtual_network\" \"main\" {\r\n      name                = \"azuretestvnet\"\r\n      address_space       = [\"10.0.0.0/16\"]\r\n      location            = \"${azurerm_resource_group.main.location}\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n    }\r\n    \r\n    resource \"azurerm_subnet\" \"internal\" {\r\n      name                 = \"internal\"\r\n      resource_group_name  = \"${azurerm_resource_group.main.name}\"\r\n      virtual_network_name = \"${azurerm_virtual_network.main.name}\"\r\n      address_prefix       = \"10.0.2.0/24\"\r\n    }\r\n    \r\n    resource \"azurerm_network_interface\" \"main\" {\r\n      name                = \"azuretestnic\"\r\n      location            = \"${azurerm_resource_group.main.location}\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n    \r\n      ip_configuration {\r\n        name                          = \"testconfiguration1\"\r\n        subnet_id                     = \"${azurerm_subnet.internal.id}\"\r\n        private_ip_address_allocation = \"dynamic\"\r\n      }\r\n    }\r\n    \r\n    resource \"azurerm_virtual_machine\" \"main\" {\r\n      name  = \"azurevm\"\r\n      location = \"West Europe\"\r\n      resource_group_name = \"${azurerm_resource_group.main.name}\"\r\n      network_interface_ids = [\"${azurerm_network_interface.main.id}\"]\r\n      vm_size = \"Standard_DS1_v2\"\r\n    \r\n    \r\n      storage_os_disk {\r\n        os_type = \"Linux\"\r\n        name = \"acctestmd1\"\r\n     managed_disk_type = \"Standard_LRS\"\r\n        caching           = \"ReadWrite\"\r\n        create_option     = \"Attach\"\r\n        managed_disk_id   = \"${azurerm_managed_disk.source.id}\"\r\n      }\r\n      os_profile_linux_config {\r\n        disable_password_authentication = false\r\n      }\r\n    }\r\n\r\nAnd there are some things I have met and I think you should pay attention to them.\r\n\r\n 1. the managed_disk_type in the VM and the storage_account_type in the managed disk should be same.\r\n 2. the name of the managed disk should be the same in both.\r\n\r\nHope this will help you.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You change things to yours, it is just an example. ", "keywords": ["change"]}, {"source": "Text", "text": "The file here: resource \"azurerm_resource_group\" \"main\" { name = \"acctestRG\" location = \"West Europe\" } data \"azurerm_platform_image\" \"linux\" { location = \"West Europe\" publisher = \"Canonical\" offer = \"UbuntuServer\" sku = \"16.04-LTS\" } resource \"azurerm_managed_disk\" \"source\" { name = \"acctestmd1\" location = \"West Europe\" resource_group_name = \"${azurerm_resource_group.main.name}\" storage_account_type = \"Standard_LRS\" create_option = \"FromImage\" image_reference_id = \"${data.azurerm_platform_image.linux.id}\" tags { environment = \"staging\" } } resource \"azurerm_virtual_network\" \"main\" { name = \"azuretestvnet\" address_space = [\"10.0.0.0/16\"] location = \"${azurerm_resource_group.main.location}\" resource_group_name = \"${azurerm_resource_group.main.name}\" } resource \"azurerm_subnet\" \"internal\" { name = \"internal\" resource_group_name = \"${azurerm_resource_group.main.name}\" virtual_network_name = \"${azurerm_virtual_network.main.name}\" address_prefix = \"10.0.2.0/24\" } resource \"azurerm_network_interface\" \"main\" { name = \"azuretestnic\" location = \"${azurerm_resource_group.main.location}\" resource_group_name = \"${azurerm_resource_group.main.name}\" ip_configuration { name = \"testconfiguration1\" subnet_id = \"${azurerm_subnet.internal.id}\" private_ip_address_allocation = \"dynamic\" } } resource \"azurerm_virtual_machine\" \"main\" { name = \"azurevm\" location = \"West Europe\" resource_group_name = \"${azurerm_resource_group.main.name}\" network_interface_ids = [\"${azurerm_network_interface.main.id}\"] vm_size = \"Standard_DS1_v2\" storage_os_disk { os_type = \"Linux\" name = \"acctestmd1\" managed_disk_type = \"Standard_LRS\" caching = \"ReadWrite\" create_option = \"Attach\" managed_disk_id = \"${azurerm_managed_disk.source.id}\" } os_profile_linux_config { disable_password_authentication = false } } And there are some things I have met and I think you should pay attention to them. 1. the managed_disk_type in the VM and the storage_account_type in the managed disk should be same. ", "keywords": ["pay", "test"]}]}], "filtered-sentences": [{"source": "Body", "text": "You change things to yours, it is just an example. ", "keywords": ["change"]}, {"source": "Body", "text": "The file here: And there are some things I have met and I think you should pay attention to them. ", "keywords": ["pay"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "This enables the change of the virtual machine configuration where a destroy and rebuild leaves the virtual machine intact. ", "keywords": ["change"]}]}