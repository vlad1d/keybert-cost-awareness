{"Id": "71165815", "PostTypeId": "1", "CreationDate": "2022-02-17T21:51:05.517", "Score": "0", "ViewCount": "705", "Body": "<p>I am currently using a one bucket per microservice approach for my GCP Cloud Run Services. This means each service I have has one Cloud Storage Bucket that contains a default.tfstate file for its Cloud Run Service. I have multiple GCP project environments suffixed with development, staging, or production. Each Cloud Run Service has a variation of itself in my three GCP project environments. For example, my foo-service exists in GCP development (when it's being developed), staging (when I merge it to main, deploy it, test it, etc), and in production (when I say quality is sufficient enough to deploy live to production). This one service has three GCP Cloud Storage Buckets which I have to name in a way to avoid naming conflicts with other buckets.</p>\n<p>Below you can see the structure I am using. Each bucket contains a default.tfstate file for Terraform.</p>\n<p>GCP project name: my-project-prod</p>\n<ul>\n<li>Bucket: service-one-prod</li>\n<li>Bucket: service-two-prod</li>\n<li>Bucket: service-three-prod</li>\n</ul>\n<p>GCP project name: my-project-stag</p>\n<ul>\n<li>Bucket: service-one-stag</li>\n<li>Bucket: service-two-stag</li>\n<li>Bucket: service-three-stag</li>\n</ul>\n<p>GCP project name: my-project-dev</p>\n<ul>\n<li>Bucket: service-one-dev</li>\n<li>Bucket: service-two-dev</li>\n<li>Bucket: service-three-dev</li>\n</ul>\n<p>Would there be an advantage to using one Cloud Storage Bucket per GCP project environment that contains sub-folders for each of my services, like this structure below? Each folder would contain the default.tfstate for Terraform.</p>\n<p>GCP project name: my-project-prod</p>\n<ul>\n<li>Bucket: my-project-prod\n<ul>\n<li>Folder: service-one</li>\n<li>Folder: service-two</li>\n<li>Folder: service-three</li>\n</ul>\n</li>\n</ul>\n<p>GCP project name: my-project-stag</p>\n<ul>\n<li>Bucket: my-project-stag\n<ul>\n<li>Folder: service-one</li>\n<li>Folder: service-two</li>\n<li>Folder: service-three</li>\n</ul>\n</li>\n</ul>\n<p>GCP project name: my-project-dev</p>\n<ul>\n<li>Bucket: my-project-dev\n<ul>\n<li>Folder: service-one</li>\n<li>Folder: service-two</li>\n<li>Folder: service-three</li>\n</ul>\n</li>\n</ul>\n<p>I am only using the bucket to store Terraform state for my Cloud Run Services. I am either going to create many buckets or many folders within one bucket.</p>\n<p><em><strong>Editing the original post for more context below.</strong></em></p>\n<p>I am in the early stages of my product development, so I am looking for best practices before I start to scale. I have five Cloud Run Services at this time with more to develop in the future. All the Cloud Run Services are in the us-central1 region and each is using the default Compute Engine service account for security. Each service has its own dedicated Cloud Storage Bucket, where the location is set to US (multiple regions) or us-central1. I am using the buckets to store the Cloud Run Service's default.tfstate, nothing more. My services are simple APIs that read/write data to/from mulitple sources, like other API's, databases, topics/queues.</p>\n<p>I would say these services are simple. They are not pushing the limits of buckets or bucket access.</p>\n", "OwnerUserId": "1450014", "LastEditorUserId": "1450014", "LastEditDate": "2022-02-18T20:04:38.507", "LastActivityDate": "2022-02-18T20:04:38.507", "Title": "One Cloud Storage Bucket with sub-folders or one Cloud Storage Bucket per microservice", "Tags": "<google-cloud-platform><google-cloud-storage><google-cloud-run><terraform-provider-gcp>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "264367341", "PostHistoryTypeId": "2", "PostId": "71165815", "RevisionGUID": "30c91433-df4b-468d-a71d-6d74f9358d7c", "CreationDate": "2022-02-17T21:51:05.517", "UserId": "1450014", "Text": "I am currently using a one bucket per microservice approach for my GCP Cloud Run Services. This means each service I have has one Cloud Storage Bucket that contains a default.tfstate file for its Cloud Run Service. I have multiple GCP project environments suffixed with development, staging, or production. Each Cloud Run Service has a variation of itself in my three GCP project environments. For example, my foo-service exists in GCP development (when it's being developed), staging (when I merge it to main, deploy it, test it, etc), and in production (when I say quality is sufficient enough to deploy live to production). This one service has three GCP Cloud Storage Buckets which I have to name in a way to avoid naming conflicts with other buckets.\r\n\r\nBelow you can see the structure I am using. Each bucket contains a default.tfstate file for Terraform.\r\n\r\nGCP project name: my-project-prod\r\n\r\n - Bucket: service-one-prod\r\n - Bucket: service-two-prod\r\n - Bucket: service-three-prod\r\n\r\nGCP project name: my-project-stag\r\n\r\n - Bucket: service-one-stag\r\n - Bucket: service-two-stag\r\n - Bucket: service-three-stag\r\n\r\nGCP project name: my-project-dev\r\n\r\n - Bucket: service-one-dev\r\n - Bucket: service-two-dev\r\n - Bucket: service-three-dev\r\n\r\nWould there be an advantage to using one Cloud Storage Bucket per GCP project environment that contains sub-folders for each of my services, like this structure below? Each folder would contain the default.tfstate for Terraform.\r\n\r\nGCP project name: my-project-prod\r\n\r\n - Bucket: my-project-prod\r\n    - Folder: service-one\r\n    - Folder: service-two\r\n    - Folder: service-three\r\n\r\nGCP project name: my-project-stag\r\n\r\n - Bucket: my-project-stag\r\n    - Folder: service-one\r\n    - Folder: service-two\r\n    - Folder: service-three\r\n\r\nGCP project name: my-project-dev\r\n\r\n - Bucket: my-project-dev\r\n    - Folder: service-one\r\n    - Folder: service-two\r\n    - Folder: service-three\r\n\r\nI am only using the bucket to store Terraform state for my Cloud Run Services. I am either going to create many buckets or many folders within one bucket. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This means each service I have has one Cloud Storage Bucket that contains a default.tfstate file for its Cloud Run Service. ", "keywords": ["storage"]}, {"source": "Text", "text": "For example, my foo-service exists in GCP development (when it's being developed), staging (when I merge it to main, deploy it, test it, etc), and in production (when I say quality is sufficient enough to deploy live to production). ", "keywords": ["test"]}, {"source": "Text", "text": "This one service has three GCP Cloud Storage Buckets which I have to name in a way to avoid naming conflicts with other buckets. ", "keywords": ["storage"]}, {"source": "Text", "text": "Each bucket contains a default.tfstate file for Terraform. GCP project name: my-project-prod - Bucket: service-one-prod - Bucket: service-two-prod - Bucket: service-three-prod GCP project name: my-project-stag - Bucket: service-one-stag - Bucket: service-two-stag - Bucket: service-three-stag GCP project name: my-project-dev - Bucket: service-one-dev - Bucket: service-two-dev - Bucket: service-three-dev Would there be an advantage to using one Cloud Storage Bucket per GCP project environment that contains sub-folders for each of my services, like this structure below? ", "keywords": ["storage"]}]}, {"Id": "264367343", "PostHistoryTypeId": "1", "PostId": "71165815", "RevisionGUID": "30c91433-df4b-468d-a71d-6d74f9358d7c", "CreationDate": "2022-02-17T21:51:05.517", "UserId": "1450014", "Text": "One Cloud Storage Bucket with sub-folders or one Cloud Storage Bucket per microservice", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "One Cloud Storage Bucket with sub-folders or one Cloud Storage Bucket per microservice", "keywords": ["storage"]}]}, {"Id": "264367344", "PostHistoryTypeId": "3", "PostId": "71165815", "RevisionGUID": "30c91433-df4b-468d-a71d-6d74f9358d7c", "CreationDate": "2022-02-17T21:51:05.517", "UserId": "1450014", "Text": "<google-cloud-platform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "264377183", "PostHistoryTypeId": "6", "PostId": "71165815", "RevisionGUID": "fb4da701-76d8-498f-b953-8938fbc9b2a2", "CreationDate": "2022-02-18T02:26:10.150", "UserId": "17720363", "Comment": "improved formatting, added tag, capitalization", "Text": "<google-cloud-platform><google-cloud-run>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "264377184", "PostHistoryTypeId": "24", "PostId": "71165815", "RevisionGUID": "fb4da701-76d8-498f-b953-8938fbc9b2a2", "CreationDate": "2022-02-18T02:26:10.150", "Comment": "Proposed by 17720363 approved by -1 edit id of 5331553", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "264377185", "PostHistoryTypeId": "6", "PostId": "71165815", "RevisionGUID": "86ee164d-cc54-4429-a90f-0ab96e805bf1", "CreationDate": "2022-02-18T02:26:10.150", "UserId": "8753991", "Comment": "improved formatting, added tag, capitalization", "Text": "<google-cloud-platform><google-cloud-storage><google-cloud-run><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "264437299", "PostHistoryTypeId": "5", "PostId": "71165815", "RevisionGUID": "625b76cf-0ac1-4b7b-ae8b-2f150c0119ba", "CreationDate": "2022-02-18T20:04:38.507", "UserId": "1450014", "Comment": "added 820 characters in body", "Text": "I am currently using a one bucket per microservice approach for my GCP Cloud Run Services. This means each service I have has one Cloud Storage Bucket that contains a default.tfstate file for its Cloud Run Service. I have multiple GCP project environments suffixed with development, staging, or production. Each Cloud Run Service has a variation of itself in my three GCP project environments. For example, my foo-service exists in GCP development (when it's being developed), staging (when I merge it to main, deploy it, test it, etc), and in production (when I say quality is sufficient enough to deploy live to production). This one service has three GCP Cloud Storage Buckets which I have to name in a way to avoid naming conflicts with other buckets.\r\n\r\nBelow you can see the structure I am using. Each bucket contains a default.tfstate file for Terraform.\r\n\r\nGCP project name: my-project-prod\r\n\r\n - Bucket: service-one-prod\r\n - Bucket: service-two-prod\r\n - Bucket: service-three-prod\r\n\r\nGCP project name: my-project-stag\r\n\r\n - Bucket: service-one-stag\r\n - Bucket: service-two-stag\r\n - Bucket: service-three-stag\r\n\r\nGCP project name: my-project-dev\r\n\r\n - Bucket: service-one-dev\r\n - Bucket: service-two-dev\r\n - Bucket: service-three-dev\r\n\r\nWould there be an advantage to using one Cloud Storage Bucket per GCP project environment that contains sub-folders for each of my services, like this structure below? Each folder would contain the default.tfstate for Terraform.\r\n\r\nGCP project name: my-project-prod\r\n\r\n - Bucket: my-project-prod\r\n    - Folder: service-one\r\n    - Folder: service-two\r\n    - Folder: service-three\r\n\r\nGCP project name: my-project-stag\r\n\r\n - Bucket: my-project-stag\r\n    - Folder: service-one\r\n    - Folder: service-two\r\n    - Folder: service-three\r\n\r\nGCP project name: my-project-dev\r\n\r\n - Bucket: my-project-dev\r\n    - Folder: service-one\r\n    - Folder: service-two\r\n    - Folder: service-three\r\n\r\nI am only using the bucket to store Terraform state for my Cloud Run Services. I am either going to create many buckets or many folders within one bucket. \r\n\r\n***Editing the original post for more context below.***\r\n\r\nI am in the early stages of my product development, so I am looking for best practices before I start to scale. I have five Cloud Run Services at this time with more to develop in the future. All the Cloud Run Services are in the us-central1 region and each is using the default Compute Engine service account for security. Each service has its own dedicated Cloud Storage Bucket, where the location is set to US (multiple regions) or us-central1. I am using the buckets to store the Cloud Run Service's default.tfstate, nothing more. My services are simple APIs that read/write data to/from mulitple sources, like other API's, databases, topics/queues.\r\n\r\nI would say these services are simple. They are not pushing the limits of buckets or bucket access. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This means each service I have has one Cloud Storage Bucket that contains a default.tfstate file for its Cloud Run Service. ", "keywords": ["storage"]}, {"source": "Text", "text": "For example, my foo-service exists in GCP development (when it's being developed), staging (when I merge it to main, deploy it, test it, etc), and in production (when I say quality is sufficient enough to deploy live to production). ", "keywords": ["test"]}, {"source": "Text", "text": "This one service has three GCP Cloud Storage Buckets which I have to name in a way to avoid naming conflicts with other buckets. ", "keywords": ["storage"]}, {"source": "Text", "text": "Each bucket contains a default.tfstate file for Terraform. GCP project name: my-project-prod - Bucket: service-one-prod - Bucket: service-two-prod - Bucket: service-three-prod GCP project name: my-project-stag - Bucket: service-one-stag - Bucket: service-two-stag - Bucket: service-three-stag GCP project name: my-project-dev - Bucket: service-one-dev - Bucket: service-two-dev - Bucket: service-three-dev Would there be an advantage to using one Cloud Storage Bucket per GCP project environment that contains sub-folders for each of my services, like this structure below? ", "keywords": ["storage"]}, {"source": "Text", "text": "Each service has its own dedicated Cloud Storage Bucket, where the location is set to US (multiple regions) or us-central1. ", "keywords": ["storage"]}]}], "answers": [{"Id": "71166981", "PostTypeId": "2", "ParentId": "71165815", "CreationDate": "2022-02-18T00:16:44.163", "Score": "1", "Body": "<p>It's literally the same to use on bucket per service or just subfolders unless:</p>\n<p>a) You have multiple services in multiple regions, in which case you want to ahve a bucket as near as possible to reduce latency and cost</p>\n<p>b) You are using uniform bucket access policy as your security method, in which case you want lo limit the access of a service to its bucket</p>\n<p>If you are just thinking about bucket vs subfolders performance there won't be a noticeable difference</p>\n<p>Maybe if you tell us a bit more about your project (security, regions, workload) I can help you further</p>\n", "OwnerUserId": "11504909", "LastActivityDate": "2022-02-18T00:16:44.163", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "125820761", "PostId": "71166981", "Score": "0", "Text": "Thanks for your response. I edited my original post to include more context at the bottom and answer your questions.", "CreationDate": "2022-02-18T20:05:36.357", "UserId": "1450014", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "125852324", "PostId": "71166981", "Score": "0", "Text": "For this use case I would stick with a single bucket with those files on it, I don't see the need to have dedicated buckets to store a single file on each. You can use folders to organize them if you want, however keep in mind that the [concept of folders](https://cloud.google.com/storage/docs/folders) in cloud storage is just representative and not functional.", "CreationDate": "2022-02-20T19:55:24.213", "UserId": "11504909", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can use folders to organize them if you want, however keep in mind that the [concept of folders](https://cloud.google.com/storage/docs/folders) in cloud storage is just representative and not functional.", "keywords": ["storage"]}]}], "history": [{"Id": "264373334", "PostHistoryTypeId": "2", "PostId": "71166981", "RevisionGUID": "23f19f50-6737-487b-a64e-dacc74a7b54a", "CreationDate": "2022-02-18T00:16:44.163", "UserId": "11504909", "Text": "It's literally the same to use on bucket per service or just subfolders unless:\r\n\r\na) You have multiple services in multiple regions, in which case you want to ahve a bucket as near as possible to reduce latency and cost\r\n\r\nb) You are using uniform bucket access policy as your security method, in which case you want lo limit the access of a service to its bucket\r\n\r\nIf you are just thinking about bucket vs subfolders performance there won't be a noticeable difference\r\n\r\nMaybe if you tell us a bit more about your project (security, regions, workload) I can help you further", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You have multiple services in multiple regions, in which case you want to ahve a bucket as near as possible to reduce latency and cost ", "keywords": ["cost"]}, {"source": "Text", "text": "You are using uniform bucket access policy as your security method, in which case you want lo limit the access of a service to its bucket ", "keywords": ["policy"]}]}], "filtered-sentences": [{"source": "Body", "text": "You have multiple services in multiple regions, in which case you want to ahve a bucket as near as possible to reduce latency and cost ", "keywords": ["cost"]}, {"source": "Body", "text": "You are using uniform bucket access policy as your security method, in which case you want lo limit the access of a service to its bucket ", "keywords": ["policy"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "One Cloud Storage Bucket with sub-folders or one Cloud Storage Bucket per microservice", "keywords": ["storage"]}, {"source": "Body", "text": "This means each service I have has one Cloud Storage Bucket that contains a default.tfstate file for its Cloud Run Service. ", "keywords": ["storage"]}, {"source": "Body", "text": "For example, my foo-service exists in GCP development (when it's being developed), staging (when I merge it to main, deploy it, test it, etc), and in production (when I say quality is sufficient enough to deploy live to production). ", "keywords": ["test"]}, {"source": "Body", "text": "This one service has three GCP Cloud Storage Buckets which I have to name in a way to avoid naming conflicts with other buckets. ", "keywords": ["storage"]}, {"source": "Body", "text": "Each bucket contains a default.tfstate file for Terraform. GCP project name: my-project-prod Bucket: service-one-prod Bucket: service-two-prod Bucket: service-three-prod GCP project name: my-project-stag Bucket: service-one-stag Bucket: service-two-stag Bucket: service-three-stag GCP project name: my-project-dev Bucket: service-one-dev Bucket: service-two-dev Bucket: service-three-dev Would there be an advantage to using one Cloud Storage Bucket per GCP project environment that contains sub-folders for each of my services, like this structure below? ", "keywords": ["storage"]}, {"source": "Body", "text": "Each service has its own dedicated Cloud Storage Bucket, where the location is set to US (multiple regions) or us-central1. ", "keywords": ["storage"]}]}