{"Id": "47669894", "PostTypeId": "1", "AcceptedAnswerId": "47687200", "CreationDate": "2017-12-06T08:30:38.207", "Score": "5", "ViewCount": "5386", "Body": "<h2>Question</h2>\n\n<p>What AWS permission is required to create a S3 bucket, which causes HTTP/1.1 403 Forbidden on ec2/DescribeAccountAttributes and s3/CreateBucket. Or how to get further information on AWS side to further trouble-shoot.</p>\n\n<p>Added all permissions on EC2 and S3 to the user account, but did not solve the problem.</p>\n\n<h2>Note</h2>\n\n<p>If I have all the permission as the account owner (using different account), this will not happen.</p>\n\n<h2>Problem</h2>\n\n<p>Trying to create a S3 bucket.</p>\n\n<pre><code>resource \"aws_s3_bucket\" \"s3_bucket_tfstate\" {\n  bucket = \"${var.s3_bucket_tfstate}\"\n  acl    = \"private\"\n}    \n</code></pre>\n\n<p>However it causes 403 with the TF_LOG=DEBUG below.</p>\n\n<pre><code>2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Request ec2/DescribeAccountAttributes Details:\n---[ REQUEST POST-SIGN ]-----------------------------\nPOST / HTTP/1.1\nHost: ec2.ap-southeast-2.amazonaws.com\nUser-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\nContent-Length: 87\nAuthorization: AWS4-HMAC-SHA256 Credential=&lt;credential&gt;/20171206/ap-southeast-2/ec2/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature=****\nContent-Type: application/x-www-form-urlencoded; charset=utf-8\nX-Amz-Date: 20171206T075535Z\nAccept-Encoding: gzip\n\nAction=DescribeAccountAttributes&amp;AttributeName.1=supported-platforms&amp;Version=2016-11-15\n-----------------------------------------------------\n2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Response ec2/DescribeAccountAttributes Details:\n---[ RESPONSE ]--------------------------------------\nHTTP/1.1 403 Forbidden\nConnection: close\nTransfer-Encoding: chunked\nDate: Wed, 06 Dec 2017 07:55:37 GMT\nServer: AmazonEC2\n\n\n-----------------------------------------------------\n2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Response&gt;&lt;Errors&gt;&lt;Error&gt;&lt;Code&gt;UnauthorizedOperation&lt;/Code&gt;&lt;Message&gt;You are not authorized to perform this operation.&lt;/Message&gt;&lt;/Error&gt;&lt;/Errors&gt;&lt;RequestID&gt;0b9480d5-a687-46f8-a0ca-a212c37ce3fb&lt;/RequestID&gt;&lt;/Response&gt;\n2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Validate Response ec2/DescribeAccountAttributes failed, not retrying, error UnauthorizedOperation: You are not authorized to perform this operation.\n\n\n2017/12/06 19:55:52 [DEBUG] [aws-sdk-go] DEBUG: Request s3/CreateBucket Details:\n---[ REQUEST POST-SIGN ]-----------------------------\nPUT / HTTP/1.1\nHost: mule-cdr-billing-adapter-config-tfstate.s3.ap-southeast-2.amazonaws.com\nUser-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\nContent-Length: 158\nAuthorization: AWS4-HMAC-SHA256 Credential=****/20171206/ap-southeast-2/s3/aws4_request, SignedHeaders=content-length;host;x-amz-acl;x-amz-content-sha256;x-amz-date, Signature=****\nX-Amz-Acl: private\nX-Amz-Content-Sha256: 8bfaf12a44a138dc6f38eb5c291558f2c551b0f18ab6e2a5e7f9a00176b25240\nX-Amz-Date: 20171206T085552Z\nAccept-Encoding: gzip\n\n&lt;CreateBucketConfiguration xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"&gt;&lt;LocationConstraint&gt;ap-southeast-2&lt;/LocationConstraint&gt;&lt;/CreateBucketConfiguration&gt;\n-----------------------------------------------------\n2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Response s3/CreateBucket Details:\n---[ RESPONSE ]--------------------------------------\nHTTP/1.1 403 Forbidden\nConnection: close\nTransfer-Encoding: chunked\nContent-Type: application/xml\nDate: Wed, 06 Dec 2017 08:55:55 GMT\nServer: AmazonS3\nX-Amz-Id-2: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=\nX-Amz-Request-Id: 9B562398EEFDF96E\n\n\n-----------------------------------------------------\n2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Error&gt;&lt;Code&gt;AccessDenied&lt;/Code&gt;&lt;Message&gt;Access Denied&lt;/Message&gt;&lt;RequestId&gt;9B562398EEFDF96E&lt;/RequestId&gt;&lt;HostId&gt;oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=&lt;/HostId&gt;&lt;/Error&gt;\n2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Validate Response s3/CreateBucket failed, not retrying, error AccessDenied: Access Denied\n    status code: 403, request id: 9B562398EEFDF96E, host id: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=\n</code></pre>\n", "OwnerUserId": "4281353", "LastEditorUserId": "4281353", "LastEditDate": "2017-12-06T19:51:42.983", "LastActivityDate": "2017-12-08T17:39:23.003", "Title": "Terraform S3 bucket creation causes not authorized", "Tags": "<amazon-s3><permissions><terraform>", "AnswerCount": "1", "CommentCount": "2", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "82317844", "PostId": "47669894", "Score": "0", "Text": "As noted in the debug log it's trying to use both ec2 and s3 resources.  So, are you sure the credentials you have supplied to terraform are for the user that you have assigned those permissions through IAM?  If so, did you only give read access to those resources, or did you give full access?", "CreationDate": "2017-12-06T16:45:29.387", "UserId": "1791660", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "82321035", "PostId": "47669894", "Score": "0", "Text": "The problem here isn't Terraform; it's that your credentials do not have the correct permissions. Please include any attached IAM policies that the user you're using has", "CreationDate": "2017-12-06T18:18:40.193", "UserId": "1125714", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "history": [{"Id": "162180916", "PostHistoryTypeId": "2", "PostId": "47669894", "RevisionGUID": "a8dd4b21-3d60-4086-892c-14ae02ee5cae", "CreationDate": "2017-12-06T08:30:38.207", "UserId": "4281353", "Text": "## Question \r\n\r\nWhat AWS permission is required to create a S3 bucket, which causes HTTP/1.1 403 Forbidden on ec2/DescribeAccountAttributes. Or how to get further information on AWS side to further trouble-shoot.\r\n\r\nAdded DescribeAccountAttributes permission on EC2 to the user account, but did not solve the problem.\r\n\r\n## Note\r\n\r\nIf I have all the permission as the account owner (using different account), this will not happen.\r\n\r\n\r\n## Problem\r\n\r\nTrying to create a S3 bucket.\r\n\r\n\r\n    resource \"aws_s3_bucket\" \"s3_bucket_tfstate\" {\r\n      bucket = \"${var.s3_bucket_tfstate}\"\r\n      acl    = \"private\"\r\n    }    \r\n\r\n\r\nHowever it causes 403 with the TF_LOG=DEBUG below.\r\n\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Request ec2/DescribeAccountAttributes Details:\r\n    ---[ REQUEST POST-SIGN ]-----------------------------\r\n    POST / HTTP/1.1\r\n    Host: ec2.ap-southeast-2.amazonaws.com\r\n    User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\r\n    Content-Length: 87\r\n    Authorization: AWS4-HMAC-SHA256 Credential=<credential>/20171206/ap-southeast-2/ec2/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature=****\r\n    Content-Type: application/x-www-form-urlencoded; charset=utf-8\r\n    X-Amz-Date: 20171206T075535Z\r\n    Accept-Encoding: gzip\r\n\r\n    Action=DescribeAccountAttributes&AttributeName.1=supported-platforms&Version=2016-11-15\r\n    -----------------------------------------------------\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Response ec2/DescribeAccountAttributes Details:\r\n    ---[ RESPONSE ]--------------------------------------\r\n    HTTP/1.1 403 Forbidden\r\n    Connection: close\r\n    Transfer-Encoding: chunked\r\n    Date: Wed, 06 Dec 2017 07:55:37 GMT\r\n    Server: AmazonEC2\r\n\r\n\r\n    -----------------------------------------------------\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <Response><Errors><Error><Code>UnauthorizedOperation</Code><Message>You are not authorized to perform this operation.</Message></Error></Errors><RequestID>0b9480d5-a687-46f8-a0ca-a212c37ce3fb</RequestID></Response>\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Validate Response ec2/DescribeAccountAttributes failed, not retrying, error UnauthorizedOperation: You are not authorized to perform this operation.\r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "162180917", "PostHistoryTypeId": "1", "PostId": "47669894", "RevisionGUID": "a8dd4b21-3d60-4086-892c-14ae02ee5cae", "CreationDate": "2017-12-06T08:30:38.207", "UserId": "4281353", "Text": "Terraform S3 bucket creation causes not authorized on ec2/DescribeAccountAttributes", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "162180918", "PostHistoryTypeId": "3", "PostId": "47669894", "RevisionGUID": "a8dd4b21-3d60-4086-892c-14ae02ee5cae", "CreationDate": "2017-12-06T08:30:38.207", "UserId": "4281353", "Text": "<amazon-s3><permissions><terraform>", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "162182839", "PostHistoryTypeId": "5", "PostId": "47669894", "RevisionGUID": "74de4426-9647-4d95-8d61-d8634ee5b3c1", "CreationDate": "2017-12-06T08:59:15.007", "UserId": "4281353", "Comment": "added 2091 characters in body; edited title", "Text": "## Question \r\n\r\nWhat AWS permission is required to create a S3 bucket, which causes HTTP/1.1 403 Forbidden on ec2/DescribeAccountAttributes and s3/CreateBucket. Or how to get further information on AWS side to further trouble-shoot.\r\n\r\nAdded All EC2 permissions on EC2 and S3 permissions to the user account, but did not solve the problem.\r\n\r\n## Note\r\n\r\nIf I have all the permission as the account owner (using different account), this will not happen.\r\n\r\n\r\n## Problem\r\n\r\nTrying to create a S3 bucket.\r\n\r\n\r\n    resource \"aws_s3_bucket\" \"s3_bucket_tfstate\" {\r\n      bucket = \"${var.s3_bucket_tfstate}\"\r\n      acl    = \"private\"\r\n    }    \r\n\r\n\r\nHowever it causes 403 with the TF_LOG=DEBUG below.\r\n\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Request ec2/DescribeAccountAttributes Details:\r\n    ---[ REQUEST POST-SIGN ]-----------------------------\r\n    POST / HTTP/1.1\r\n    Host: ec2.ap-southeast-2.amazonaws.com\r\n    User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\r\n    Content-Length: 87\r\n    Authorization: AWS4-HMAC-SHA256 Credential=<credential>/20171206/ap-southeast-2/ec2/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature=****\r\n    Content-Type: application/x-www-form-urlencoded; charset=utf-8\r\n    X-Amz-Date: 20171206T075535Z\r\n    Accept-Encoding: gzip\r\n\r\n    Action=DescribeAccountAttributes&AttributeName.1=supported-platforms&Version=2016-11-15\r\n    -----------------------------------------------------\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Response ec2/DescribeAccountAttributes Details:\r\n    ---[ RESPONSE ]--------------------------------------\r\n    HTTP/1.1 403 Forbidden\r\n    Connection: close\r\n    Transfer-Encoding: chunked\r\n    Date: Wed, 06 Dec 2017 07:55:37 GMT\r\n    Server: AmazonEC2\r\n\r\n\r\n    -----------------------------------------------------\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <Response><Errors><Error><Code>UnauthorizedOperation</Code><Message>You are not authorized to perform this operation.</Message></Error></Errors><RequestID>0b9480d5-a687-46f8-a0ca-a212c37ce3fb</RequestID></Response>\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Validate Response ec2/DescribeAccountAttributes failed, not retrying, error UnauthorizedOperation: You are not authorized to perform this operation.\r\n\r\n\r\n    2017/12/06 19:55:52 [DEBUG] [aws-sdk-go] DEBUG: Request s3/CreateBucket Details:\r\n    ---[ REQUEST POST-SIGN ]-----------------------------\r\n    PUT / HTTP/1.1\r\n    Host: mule-cdr-billing-adapter-config-tfstate.s3.ap-southeast-2.amazonaws.com\r\n    User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\r\n    Content-Length: 158\r\n    Authorization: AWS4-HMAC-SHA256 Credential=****/20171206/ap-southeast-2/s3/aws4_request, SignedHeaders=content-length;host;x-amz-acl;x-amz-content-sha256;x-amz-date, Signature=****\r\n    X-Amz-Acl: private\r\n    X-Amz-Content-Sha256: 8bfaf12a44a138dc6f38eb5c291558f2c551b0f18ab6e2a5e7f9a00176b25240\r\n    X-Amz-Date: 20171206T085552Z\r\n    Accept-Encoding: gzip\r\n\r\n    <CreateBucketConfiguration xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"><LocationConstraint>ap-southeast-2</LocationConstraint></CreateBucketConfiguration>\r\n    -----------------------------------------------------\r\n    2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Response s3/CreateBucket Details:\r\n    ---[ RESPONSE ]--------------------------------------\r\n    HTTP/1.1 403 Forbidden\r\n    Connection: close\r\n    Transfer-Encoding: chunked\r\n    Content-Type: application/xml\r\n    Date: Wed, 06 Dec 2017 08:55:55 GMT\r\n    Server: AmazonS3\r\n    X-Amz-Id-2: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=\r\n    X-Amz-Request-Id: 9B562398EEFDF96E\r\n\r\n\r\n    -----------------------------------------------------\r\n    2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <Error><Code>AccessDenied</Code><Message>Access Denied</Message><RequestId>9B562398EEFDF96E</RequestId><HostId>oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=</HostId></Error>\r\n    2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Validate Response s3/CreateBucket failed, not retrying, error AccessDenied: Access Denied\r\n     status code: 403, request id: 9B562398EEFDF96E, host id: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "2017/12/06 19:55:52 [DEBUG] [aws-sdk-go] DEBUG: Request s3/CreateBucket Details: ---[ REQUEST POST-SIGN ]----------------------------- PUT / HTTP/1.1 Host: mule-cdr-billing-adapter-config-tfstate.s3.ap-southeast-2.amazonaws.com User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1 Content-Length: 158 Authorization: AWS4-HMAC-SHA256 Credential=****/20171206/ap-southeast-2/s3/aws4_request, SignedHeaders=content-length;host;x-amz-acl;x-amz-content-sha256;x-amz-date, Signature=**** X-Amz-Acl: private X-Amz-Content-Sha256: 8bfaf12a44a138dc6f38eb5c291558f2c551b0f18ab6e2a5e7f9a00176b25240 X-Amz-Date: 20171206T085552Z Accept-Encoding: gzip ap-southeast-2 ----------------------------------------------------- 2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Response s3/CreateBucket Details: ---[ RESPONSE ]-------------------------------------- HTTP/1.1 403 Forbidden Connection: close Transfer-Encoding: chunked Content-Type: application/xml Date: Wed, 06 Dec 2017 08:55:55 GMT Server: AmazonS3 X-Amz-Id-2: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs= X-Amz-Request-Id: 9B562398EEFDF96E ----------------------------------------------------- 2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] AccessDeniedAccess Denied9B562398EEFDF96EoAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs= 2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Validate Response s3/CreateBucket failed, not retrying, error AccessDenied: Access Denied status code: 403, request id: 9B562398EEFDF96E, host id: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=", "keywords": ["bill"]}]}, {"Id": "162182840", "PostHistoryTypeId": "4", "PostId": "47669894", "RevisionGUID": "74de4426-9647-4d95-8d61-d8634ee5b3c1", "CreationDate": "2017-12-06T08:59:15.007", "UserId": "4281353", "Comment": "added 2091 characters in body; edited title", "Text": "Terraform S3 bucket creation causes not authorized", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "162231589", "PostHistoryTypeId": "5", "PostId": "47669894", "RevisionGUID": "bea356fc-9807-49ba-a2c3-bf59e86b7954", "CreationDate": "2017-12-06T19:51:42.983", "UserId": "4281353", "Comment": "deleted 16 characters in body", "Text": "## Question \r\n\r\nWhat AWS permission is required to create a S3 bucket, which causes HTTP/1.1 403 Forbidden on ec2/DescribeAccountAttributes and s3/CreateBucket. Or how to get further information on AWS side to further trouble-shoot.\r\n\r\nAdded all permissions on EC2 and S3 to the user account, but did not solve the problem.\r\n\r\n## Note\r\n\r\nIf I have all the permission as the account owner (using different account), this will not happen.\r\n\r\n\r\n## Problem\r\n\r\nTrying to create a S3 bucket.\r\n\r\n\r\n    resource \"aws_s3_bucket\" \"s3_bucket_tfstate\" {\r\n      bucket = \"${var.s3_bucket_tfstate}\"\r\n      acl    = \"private\"\r\n    }    \r\n\r\n\r\nHowever it causes 403 with the TF_LOG=DEBUG below.\r\n\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Request ec2/DescribeAccountAttributes Details:\r\n    ---[ REQUEST POST-SIGN ]-----------------------------\r\n    POST / HTTP/1.1\r\n    Host: ec2.ap-southeast-2.amazonaws.com\r\n    User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\r\n    Content-Length: 87\r\n    Authorization: AWS4-HMAC-SHA256 Credential=<credential>/20171206/ap-southeast-2/ec2/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature=****\r\n    Content-Type: application/x-www-form-urlencoded; charset=utf-8\r\n    X-Amz-Date: 20171206T075535Z\r\n    Accept-Encoding: gzip\r\n\r\n    Action=DescribeAccountAttributes&AttributeName.1=supported-platforms&Version=2016-11-15\r\n    -----------------------------------------------------\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Response ec2/DescribeAccountAttributes Details:\r\n    ---[ RESPONSE ]--------------------------------------\r\n    HTTP/1.1 403 Forbidden\r\n    Connection: close\r\n    Transfer-Encoding: chunked\r\n    Date: Wed, 06 Dec 2017 07:55:37 GMT\r\n    Server: AmazonEC2\r\n\r\n\r\n    -----------------------------------------------------\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <Response><Errors><Error><Code>UnauthorizedOperation</Code><Message>You are not authorized to perform this operation.</Message></Error></Errors><RequestID>0b9480d5-a687-46f8-a0ca-a212c37ce3fb</RequestID></Response>\r\n    2017/12/06 18:55:35 [DEBUG] [aws-sdk-go] DEBUG: Validate Response ec2/DescribeAccountAttributes failed, not retrying, error UnauthorizedOperation: You are not authorized to perform this operation.\r\n\r\n\r\n    2017/12/06 19:55:52 [DEBUG] [aws-sdk-go] DEBUG: Request s3/CreateBucket Details:\r\n    ---[ REQUEST POST-SIGN ]-----------------------------\r\n    PUT / HTTP/1.1\r\n    Host: mule-cdr-billing-adapter-config-tfstate.s3.ap-southeast-2.amazonaws.com\r\n    User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1\r\n    Content-Length: 158\r\n    Authorization: AWS4-HMAC-SHA256 Credential=****/20171206/ap-southeast-2/s3/aws4_request, SignedHeaders=content-length;host;x-amz-acl;x-amz-content-sha256;x-amz-date, Signature=****\r\n    X-Amz-Acl: private\r\n    X-Amz-Content-Sha256: 8bfaf12a44a138dc6f38eb5c291558f2c551b0f18ab6e2a5e7f9a00176b25240\r\n    X-Amz-Date: 20171206T085552Z\r\n    Accept-Encoding: gzip\r\n\r\n    <CreateBucketConfiguration xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"><LocationConstraint>ap-southeast-2</LocationConstraint></CreateBucketConfiguration>\r\n    -----------------------------------------------------\r\n    2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Response s3/CreateBucket Details:\r\n    ---[ RESPONSE ]--------------------------------------\r\n    HTTP/1.1 403 Forbidden\r\n    Connection: close\r\n    Transfer-Encoding: chunked\r\n    Content-Type: application/xml\r\n    Date: Wed, 06 Dec 2017 08:55:55 GMT\r\n    Server: AmazonS3\r\n    X-Amz-Id-2: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=\r\n    X-Amz-Request-Id: 9B562398EEFDF96E\r\n\r\n\r\n    -----------------------------------------------------\r\n    2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <Error><Code>AccessDenied</Code><Message>Access Denied</Message><RequestId>9B562398EEFDF96E</RequestId><HostId>oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=</HostId></Error>\r\n    2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Validate Response s3/CreateBucket failed, not retrying, error AccessDenied: Access Denied\r\n     status code: 403, request id: 9B562398EEFDF96E, host id: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "2017/12/06 19:55:52 [DEBUG] [aws-sdk-go] DEBUG: Request s3/CreateBucket Details: ---[ REQUEST POST-SIGN ]----------------------------- PUT / HTTP/1.1 Host: mule-cdr-billing-adapter-config-tfstate.s3.ap-southeast-2.amazonaws.com User-Agent: aws-sdk-go/1.12.35 (go1.9; darwin; amd64) APN/1.0 HashiCorp/1.0 Terraform/0.11.0-beta1 Content-Length: 158 Authorization: AWS4-HMAC-SHA256 Credential=****/20171206/ap-southeast-2/s3/aws4_request, SignedHeaders=content-length;host;x-amz-acl;x-amz-content-sha256;x-amz-date, Signature=**** X-Amz-Acl: private X-Amz-Content-Sha256: 8bfaf12a44a138dc6f38eb5c291558f2c551b0f18ab6e2a5e7f9a00176b25240 X-Amz-Date: 20171206T085552Z Accept-Encoding: gzip ap-southeast-2 ----------------------------------------------------- 2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Response s3/CreateBucket Details: ---[ RESPONSE ]-------------------------------------- HTTP/1.1 403 Forbidden Connection: close Transfer-Encoding: chunked Content-Type: application/xml Date: Wed, 06 Dec 2017 08:55:55 GMT Server: AmazonS3 X-Amz-Id-2: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs= X-Amz-Request-Id: 9B562398EEFDF96E ----------------------------------------------------- 2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] AccessDeniedAccess Denied9B562398EEFDF96EoAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs= 2017/12/06 19:55:53 [DEBUG] [aws-sdk-go] DEBUG: Validate Response s3/CreateBucket failed, not retrying, error AccessDenied: Access Denied status code: 403, request id: 9B562398EEFDF96E, host id: oAttLYQ1qxta2qs03RD79G8xZxTSfDtauQZyeQ8lsq2+4LWBghg+bGjpNvL6Xl1qPnIwE8YOyRs=", "keywords": ["bill"]}]}], "answers": [{"Id": "47687200", "PostTypeId": "2", "ParentId": "47669894", "CreationDate": "2017-12-07T03:36:28.920", "Score": "4", "Body": "<h2>Cause</h2>\n\n<p>Simulated the AWS S3 create bucket via the <a href=\"http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_testing-policies.html\" rel=\"nofollow noreferrer\">IAM Policy simulator</a> and found the policy preventing the creation was MFA.</p>\n\n<h2>Solution</h2>\n\n<pre><code>session=$(aws sts get-session-token --profile $AWS_PROFILE --serial-number $SECURITY_DEVICE_ARN --token-code $MFA_TOKEN)\nexport AWS_ACCESS_KEY_ID=$(echo $session | jq  -r .Credentials.AccessKeyId)\nexport AWS_SECRET_ACCESS_KEY=$(echo $session | jq  -r .Credentials.SecretAccessKey)\nexport AWS_SESSION_TOKEN=$(echo $session | jq -r .Credentials.SessionToken)\nexport AWS_MFA_SERIAL_NUMBER=${MFA_TOKEN}\n</code></pre>\n\n<p>Then run the terraform.</p>\n", "OwnerUserId": "4281353", "LastEditorUserId": "4281353", "LastEditDate": "2017-12-08T17:39:23.003", "LastActivityDate": "2017-12-08T17:39:23.003", "CommentCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "162251367", "PostHistoryTypeId": "2", "PostId": "47687200", "RevisionGUID": "8148b4d1-fb2e-4125-9e1f-bb70af423c77", "CreationDate": "2017-12-07T03:36:28.920", "UserId": "4281353", "Text": "## Cause\r\n\r\nSimulated a AWS S3 create bucket via the [IAM Policy simulator][1] and found the policy preventing the creation was MFA.\r\n\r\n## Solution\r\n\r\n    session=$(aws sts get-session-token --profile $AWS_PROFILE --serial-number $SECURITY_DEVICE_ARN --token-code $MFA_TOKEN)\r\n    export AWS_ACCESS_KEY_ID=$(echo $session | jq  -r .Credentials.AccessKeyId)\r\n    export AWS_SECRET_ACCESS_KEY=$(echo $session | jq  -r .Credentials.SecretAccessKey)\r\n    export AWS_SESSION_TOKEN=$(echo $session | jq -r .Credentials.SessionToken)\r\n    export AWS_MFA_SERIAL_NUMBER=${MFA_TOKEN}\r\n\r\nThen run the terraform.\r\n\r\n  [1]: http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_testing-policies.html\r\n\r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "## Cause Simulated a AWS S3 create bucket via the [IAM Policy simulator][1] and found the policy preventing the creation was MFA. ## Solution session=$(aws sts get-session-token --profile $AWS_PROFILE --serial-number $SECURITY_DEVICE_ARN --token-code $MFA_TOKEN) export AWS_ACCESS_KEY_ID=$(echo $session | jq -r .Credentials.AccessKeyId) export AWS_SECRET_ACCESS_KEY=$(echo $session | jq -r .Credentials.SecretAccessKey) export AWS_SESSION_TOKEN=$(echo $session | jq -r .Credentials.SessionToken) export AWS_MFA_SERIAL_NUMBER=${MFA_TOKEN} Then run the terraform. [1]: http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_testing-policies.html", "keywords": ["policy"]}]}, {"Id": "162380141", "PostHistoryTypeId": "5", "PostId": "47687200", "RevisionGUID": "a2337072-04d3-4d15-9488-89cc646e0b48", "CreationDate": "2017-12-08T17:39:23.003", "UserId": "4281353", "Comment": "added 2 characters in body", "Text": "## Cause\r\n\r\nSimulated the AWS S3 create bucket via the [IAM Policy simulator][1] and found the policy preventing the creation was MFA.\r\n\r\n## Solution\r\n\r\n    session=$(aws sts get-session-token --profile $AWS_PROFILE --serial-number $SECURITY_DEVICE_ARN --token-code $MFA_TOKEN)\r\n    export AWS_ACCESS_KEY_ID=$(echo $session | jq  -r .Credentials.AccessKeyId)\r\n    export AWS_SECRET_ACCESS_KEY=$(echo $session | jq  -r .Credentials.SecretAccessKey)\r\n    export AWS_SESSION_TOKEN=$(echo $session | jq -r .Credentials.SessionToken)\r\n    export AWS_MFA_SERIAL_NUMBER=${MFA_TOKEN}\r\n\r\nThen run the terraform.\r\n\r\n  [1]: http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_testing-policies.html\r\n\r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "## Cause Simulated the AWS S3 create bucket via the [IAM Policy simulator][1] and found the policy preventing the creation was MFA. ## Solution session=$(aws sts get-session-token --profile $AWS_PROFILE --serial-number $SECURITY_DEVICE_ARN --token-code $MFA_TOKEN) export AWS_ACCESS_KEY_ID=$(echo $session | jq -r .Credentials.AccessKeyId) export AWS_SECRET_ACCESS_KEY=$(echo $session | jq -r .Credentials.SecretAccessKey) export AWS_SESSION_TOKEN=$(echo $session | jq -r .Credentials.SessionToken) export AWS_MFA_SERIAL_NUMBER=${MFA_TOKEN} Then run the terraform. [1]: http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_testing-policies.html", "keywords": ["policy"]}]}], "filtered-sentences": [{"source": "Body", "text": "Cause Simulated the AWS S3 create bucket via the IAM Policy simulator and found the policy preventing the creation was MFA. ", "keywords": ["policy"]}]}], "contains-topic": true, "filtered-sentences": []}