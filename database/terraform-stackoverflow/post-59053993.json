{"Id": "59053993", "PostTypeId": "1", "AcceptedAnswerId": "59781224", "CreationDate": "2019-11-26T15:16:16.147", "Score": "23", "ViewCount": "34320", "Body": "<p>I was using terraform in cloud build, but it fails at this step</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>steps:\n  # Terraform\n  - id: 'configure_terraform'\n    name: node:10.16.3\n    entrypoint: \"node\"\n    args: [\"./create_terraform_config.js\",\n           \"../terraform/override.tf\",\n           \"${_TERRAFORM_BUCKET_NAME}\",\n           \"${_TERRAFORM_BUCKET_PATH}\"]\n    dir: \"app/scripts\"\n  - id: 'init_terraform'\n    name: hashicorp/terraform:light\n    args: [\"init\"]\n    dir: \"app/terraform\"</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<pre><code>Initializing the backend...\n\nSuccessfully configured the backend &quot;gcs&quot;! Terraform will automatically\nuse this backend unless the backend configuration changes.\n\nError: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist\n</code></pre>\n", "OwnerUserId": "4144616", "LastEditorUserId": "1360888", "LastEditDate": "2022-06-16T16:34:03.433", "LastActivityDate": "2023-07-06T13:51:47.273", "Title": "Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "Tags": "<terraform><google-cloud-build>", "AnswerCount": "4", "CommentCount": "0", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "links": [{"Id": "2050606727", "CreationDate": "2023-06-21T14:42:58.153", "PostId": "59053993", "RelatedPostId": "57453468", "LinkTypeId": "1"}], "history": [{"Id": "210020532", "PostHistoryTypeId": "2", "PostId": "59053993", "RevisionGUID": "1fa7e1a4-747a-40df-a3d3-53b771b86017", "CreationDate": "2019-11-26T15:16:16.147", "UserId": "4144616", "Text": "was using terraform in cloud build, but it fails at this step \r\n\r\nInitializing the backend...\r\n\r\nSuccessfully configured the backend \"gcs\"! Terraform will automatically\r\nuse this backend unless the backend configuration changes.\r\n\r\nError: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Terraform will automatically use this backend unless the backend configuration changes. ", "keywords": ["change"]}, {"source": "Text", "text": "Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "keywords": ["storage"]}]}, {"Id": "210020533", "PostHistoryTypeId": "1", "PostId": "59053993", "RevisionGUID": "1fa7e1a4-747a-40df-a3d3-53b771b86017", "CreationDate": "2019-11-26T15:16:16.147", "UserId": "4144616", "Text": "Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "keywords": ["storage"]}]}, {"Id": "210020534", "PostHistoryTypeId": "3", "PostId": "59053993", "RevisionGUID": "1fa7e1a4-747a-40df-a3d3-53b771b86017", "CreationDate": "2019-11-26T15:16:16.147", "UserId": "4144616", "Text": "<build><cloud><terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "210021370", "PostHistoryTypeId": "5", "PostId": "59053993", "RevisionGUID": "700cf039-7c69-407b-834f-8d252efd61b9", "CreationDate": "2019-11-26T15:26:54.513", "UserId": "4144616", "Comment": "added 584 characters in body; edited tags", "Text": "was using terraform in cloud build, but it fails at this step \r\n\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-js -->\r\n\r\n    steps:\r\n      # Terraform\r\n      - id: 'configure_terraform'\r\n        name: node:10.16.3\r\n        entrypoint: \"node\"\r\n        args: [\"./create_terraform_config.js\",\r\n               \"../terraform/override.tf\",\r\n               \"${_TERRAFORM_BUCKET_NAME}\",\r\n               \"${_TERRAFORM_BUCKET_PATH}\"]\r\n        dir: \"app/scripts\"\r\n      - id: 'init_terraform'\r\n        name: hashicorp/terraform:light\r\n        args: [\"init\"]\r\n        dir: \"app/terraform\"\r\n\r\n<!-- end snippet -->\r\n\r\nInitializing the backend...\r\n\r\nSuccessfully configured the backend \"gcs\"! Terraform will automatically\r\nuse this backend unless the backend configuration changes.\r\n\r\nError: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Terraform will automatically use this backend unless the backend configuration changes", "keywords": ["change"]}, {"source": "Text", "text": "Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "keywords": ["storage"]}]}, {"Id": "210021371", "PostHistoryTypeId": "6", "PostId": "59053993", "RevisionGUID": "700cf039-7c69-407b-834f-8d252efd61b9", "CreationDate": "2019-11-26T15:26:54.513", "UserId": "4144616", "Comment": "added 584 characters in body; edited tags", "Text": "<terraform><google-cloud-build>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "272392478", "PostHistoryTypeId": "5", "PostId": "59053993", "RevisionGUID": "f26f6def-bad8-485c-80c2-36a689dfaa86", "CreationDate": "2022-06-16T16:34:03.433", "UserId": "1360888", "Comment": "better formatting", "Text": "I was using terraform in cloud build, but it fails at this step \r\n\r\n\r\n<!-- begin snippet: js hide: false console: true babel: false -->\r\n\r\n<!-- language: lang-js -->\r\n\r\n    steps:\r\n      # Terraform\r\n      - id: 'configure_terraform'\r\n        name: node:10.16.3\r\n        entrypoint: \"node\"\r\n        args: [\"./create_terraform_config.js\",\r\n               \"../terraform/override.tf\",\r\n               \"${_TERRAFORM_BUCKET_NAME}\",\r\n               \"${_TERRAFORM_BUCKET_PATH}\"]\r\n        dir: \"app/scripts\"\r\n      - id: 'init_terraform'\r\n        name: hashicorp/terraform:light\r\n        args: [\"init\"]\r\n        dir: \"app/terraform\"\r\n\r\n<!-- end snippet -->\r\n\r\n    Initializing the backend...\r\n    \r\n    Successfully configured the backend \"gcs\"! Terraform will automatically\r\n    use this backend unless the backend configuration changes.\r\n    \r\n    Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Terraform will automatically use this backend unless the backend configuration changes", "keywords": ["change"]}, {"source": "Text", "text": "Error: Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "keywords": ["storage"]}]}], "answers": [{"Id": "68397405", "PostTypeId": "2", "ParentId": "59053993", "CreationDate": "2021-07-15T16:20:06.420", "Score": "2", "Body": "<ol>\n<li>State bucket must be pre-existing.\n<a href=\"https://github.com/hashicorp/terraform/issues/18417\" rel=\"nofollow noreferrer\">GCS backend bucket must pre-exist</a></li>\n</ol>\n<p>If it doesn't exist, create the state bucket and version it, using the following commands:</p>\n<pre><code>gsutil mb -p &lt;projectId&gt; -c &lt;storage-class&gt; -l &lt;region&gt; -b gs://&lt;bucket-name&gt;\ngsutil versioning set on gs://&lt;bucket-name&gt;\n</code></pre>\n<ol start=\"2\">\n<li>As specified in the above answer execute terraform init with\n-reconfigure option.</li>\n</ol>\n", "OwnerUserId": "1158695", "LastEditorUserId": "1158695", "LastEditDate": "2021-07-15T17:00:51.800", "LastActivityDate": "2021-07-15T17:00:51.800", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "250304125", "PostHistoryTypeId": "2", "PostId": "68397405", "RevisionGUID": "adc11d5b-7071-48ff-8e62-33c9c8df63e5", "CreationDate": "2021-07-15T16:20:06.420", "UserId": "1158695", "Text": "State bucket must be pre-existing. \r\n[GCS backend bucket must pre-exist][1]\r\n\r\n\r\n  [1]: https://github.com/hashicorp/terraform/issues/18417\r\n\r\nIf doesn't exist, create the state bucket and version it.\r\n\r\n    gsutil mb -p <projectId> -c <storage-class> -l <region> -b gs://<bucket-name>\r\n    gsutil versioning set on gs://<bucket-name>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "250306415", "PostHistoryTypeId": "5", "PostId": "68397405", "RevisionGUID": "e2e91c16-5fb8-4f60-9a7e-13707744d551", "CreationDate": "2021-07-15T17:00:51.800", "UserId": "1158695", "Comment": "added 136 characters in body", "Text": " 1. State bucket must be pre-existing. \r\n[GCS backend bucket must pre-exist][1]\r\n\r\n  [1]: https://github.com/hashicorp/terraform/issues/18417\r\nIf it doesn't exist, create the state bucket and version it, using the following commands:\r\n\r\n    gsutil mb -p <projectId> -c <storage-class> -l <region> -b gs://<bucket-name>\r\n    gsutil versioning set on gs://<bucket-name>\r\n\r\n 2. As specified in the above answer execute terraform init with \r\n-reconfigure option.\r\n\r\n    \r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "59781224", "PostTypeId": "2", "ParentId": "59053993", "CreationDate": "2020-01-17T04:31:47.713", "Score": "36", "Body": "<p>This might fix the issue</p>\n<pre><code>terraform init -reconfigure\n</code></pre>\n<p>reference: <a href=\"https://github.com/hashicorp/terraform/issues/23532#issuecomment-560493391\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/terraform/issues/23532#issuecomment-560493391</a></p>\n", "OwnerUserId": "5524818", "LastEditorUserId": "3542457", "LastEditDate": "2023-02-09T10:11:21.910", "LastActivityDate": "2023-02-09T10:11:21.910", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "132944069", "PostId": "59781224", "Score": "2", "Text": "In my case, `terraform init -reconfigure` produced the same error.\n\nI was able to resolve my issue via [@Oliver](https://stackoverflow.com/a/72382324/3542457)'s solution of changing the [application-default login](https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login).", "CreationDate": "2023-02-04T03:40:58.657", "UserId": "3542457", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I was able to resolve my issue via [@Oliver](https://stackoverflow.com/a/72382324/3542457)'s solution of changing the [application-default login](https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login).", "keywords": ["change"]}]}], "history": [{"Id": "213114346", "PostHistoryTypeId": "2", "PostId": "59781224", "RevisionGUID": "93d180bd-b003-4c11-87fc-3e29dda9dd8a", "CreationDate": "2020-01-17T04:31:47.713", "UserId": "5524818", "Text": "This will fix the issue\r\n\r\nterraform init -reconfigure\r\n\r\nreference: https://github.com/hashicorp/terraform/issues/23532#issuecomment-560493391", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "213115013", "PostHistoryTypeId": "5", "PostId": "59781224", "RevisionGUID": "16d6a510-e9b6-4b73-b295-7f65b10da81c", "CreationDate": "2020-01-17T04:54:30.773", "UserId": "599668", "Comment": "format code", "Text": "This will fix the issue\r\n\r\n    terraform init -reconfigure\r\n\r\nreference: https://github.com/hashicorp/terraform/issues/23532#issuecomment-560493391", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "287745998", "PostHistoryTypeId": "5", "PostId": "59781224", "RevisionGUID": "c44eb9cb-4aea-4da4-ac75-3eb4ec8fe918", "CreationDate": "2023-02-09T10:11:21.910", "UserId": "3542457", "Comment": "Diction change of `will fix` to `might fix`, as in my case an alternative answer was the correct solution.", "Text": "This might fix the issue\r\n\r\n    terraform init -reconfigure\r\n\r\nreference: https://github.com/hashicorp/terraform/issues/23532#issuecomment-560493391", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Comment", "text": "Diction change of `will fix` to `might fix`, as in my case an alternative answer was the correct solution.", "keywords": ["change"]}]}, {"Id": "287745999", "PostHistoryTypeId": "24", "PostId": "59781224", "RevisionGUID": "c44eb9cb-4aea-4da4-ac75-3eb4ec8fe918", "CreationDate": "2023-02-09T10:11:21.910", "Comment": "Proposed by 3542457 approved by 552759, 10306997 edit id of 5475039", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "76629572", "PostTypeId": "2", "ParentId": "59053993", "CreationDate": "2023-07-06T13:51:47.273", "Score": "0", "Body": "<p>This can happen if you have previously exported the <code>GOOGLE_APPLICATION_CREDENTIALS</code> var in your current terminal.</p>\n<p>To check that you can run <code>gcloud auth application-default login</code>. You will have the following output:</p>\n<pre><code>The environment variable [GOOGLE_APPLICATION_CREDENTIALS] is set to:\n  [/home/alphayax/gcp/xxxxxxxxx-123456789abc.json]\nCredentials will still be generated to the default location:\n  [/home/alphayax/.config/gcloud/application_default_credentials.json]\nTo use these credentials, unset this environment variable before\nrunning your application.\n</code></pre>\n<p>So you just have to unset the env var with the following:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>export GOOGLE_APPLICATION_CREDENTIALS=\n</code></pre>\n", "OwnerUserId": "1517814", "LastActivityDate": "2023-07-06T13:51:47.273", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "295052237", "PostHistoryTypeId": "2", "PostId": "76629572", "RevisionGUID": "efeb1505-1c69-4a09-93db-f7bfbba3c555", "CreationDate": "2023-07-06T13:51:47.273", "UserId": "1517814", "Text": "This can happen if you have previously exported the `GOOGLE_APPLICATION_CREDENTIALS` var in your current terminal. \r\n\r\nTo check that you can run `gcloud auth application-default login`. You will have the following output:\r\n\r\n```\r\nThe environment variable [GOOGLE_APPLICATION_CREDENTIALS] is set to:\r\n  [/home/alphayax/gcp/xxxxxxxxx-123456789abc.json]\r\nCredentials will still be generated to the default location:\r\n  [/home/alphayax/.config/gcloud/application_default_credentials.json]\r\nTo use these credentials, unset this environment variable before\r\nrunning your application.\r\n```\r\n\r\nSo you just have to unset the env var with the following:\r\n```bash\r\nexport GOOGLE_APPLICATION_CREDENTIALS=\r\n```\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "72382324", "PostTypeId": "2", "ParentId": "59053993", "CreationDate": "2022-05-25T18:03:33.940", "Score": "23", "Body": "<p>This is what worked for me:</p>\n<pre><code>gcloud auth application-default login --project $PROJECT\n</code></pre>\n<p>Normally I omit the <code>--project</code> arg but that still generated the error. I thought it was only used for billing/quota. This may be a bug related to my specific tool versions:</p>\n<pre><code>Google Cloud SDK 387.0.0\nTerraform v1.1.2\n</code></pre>\n", "OwnerUserId": "1161216", "LastActivityDate": "2022-05-25T18:03:33.940", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "134926186", "PostId": "72382324", "Score": "0", "Text": "This should be the accepted answer, detail in [terraofrm's docs](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/getting_started#adding-credentials). A bit more detail can be found [here](https://stackoverflow.com/a/57455958/799379)", "CreationDate": "2023-06-21T14:42:58.153", "UserId": "799379", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "135697825", "PostId": "72382324", "Score": "0", "Text": "This worked for me too. Selecting a project worked for me.", "CreationDate": "2023-08-25T09:03:31.767", "UserId": "10907864", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "270924325", "PostHistoryTypeId": "2", "PostId": "72382324", "RevisionGUID": "62685c13-429d-4cda-ae9b-3a2c478ca3fb", "CreationDate": "2022-05-25T18:03:33.940", "UserId": "1161216", "Text": "This is what worked for me:\r\n\r\n    gcloud auth application-default login --project $PROJECT\r\n\r\nNormally I omit the `--project` arg but that still generated the error. I thought it was only used for billing/quota. This may be a bug related to my specific tool versions:\r\n\r\n    Google Cloud SDK 387.0.0\r\n    Terraform v1.1.2", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I thought it was only used for billing/quota. ", "keywords": ["bill"]}]}], "filtered-sentences": [{"source": "Body", "text": "I thought it was only used for billing/quota. ", "keywords": ["bill"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "Failed to get existing workspaces: querying Cloud Storage failed: storage: bucket doesn't exist", "keywords": ["storage"]}]}