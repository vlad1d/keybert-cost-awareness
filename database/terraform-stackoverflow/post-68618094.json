{"Id": "68618094", "PostTypeId": "1", "AcceptedAnswerId": "71804499", "CreationDate": "2021-08-02T07:49:18.667", "Score": "5", "ViewCount": "3059", "Body": "<p>I am trying to create a tool to easily create and destroy AWS accounts in my AWS organization (or at least remove them from the organisation if they can not be deleted). Those accounts are going to be sandbox with a small budget and destroyed after a couple of weeks.</p>\n<p>I found that Terraform has a specific resource for that called <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_account\" rel=\"noreferrer\">aws_organizations_account</a>.</p>\n<p>However, this is mentioned that deleting this Terraform resource <strong>will only remove an AWS account from an organization. Terraform will not close the account</strong>. The member account must be prepared to be a standalone account beforehand. See the AWS Organizations documentation for more information.</p>\n<p>I deployed an <code>aws_organizations_account</code> resource using terraform, it worked. But when I am trying to delete that resource, I am a warning issue that <code>The member account must be configured with a valid payment method, such as a credit card</code></p>\n<p><strong>main.tf</strong></p>\n<pre><code>resource &quot;aws_organizations_account&quot; &quot;account&quot; {\n  name      = &quot;sandbox1&quot;\n  email     = &quot;first.last+sandbox1@company.com&quot;\n  role_name = &quot;myOrganizationRole&quot;\n}\n</code></pre>\n<p>Is there any way to get around this issue?</p>\n", "OwnerUserId": "14897019", "LastEditorUserId": "14897019", "LastEditDate": "2021-08-02T08:15:34.653", "LastActivityDate": "2022-08-12T07:21:42.157", "Title": "Create / Destroy AWS account using Terraform?", "Tags": "<amazon-web-services><terraform><aws-organizations>", "AnswerCount": "3", "CommentCount": "2", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "121267578", "PostId": "68618094", "Score": "0", "Text": "By \"projects\", you mean AWS accounts?", "CreationDate": "2021-08-02T08:07:36.120", "UserId": "248823", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "121267692", "PostId": "68618094", "Score": "0", "Text": "yes, correct, I will update my post", "CreationDate": "2021-08-02T08:13:53.753", "UserId": "14897019", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "251275693", "PostHistoryTypeId": "2", "PostId": "68618094", "RevisionGUID": "634071c2-8017-47e1-a9fe-4a9dacbef0ce", "CreationDate": "2021-08-02T07:49:18.667", "UserId": "14897019", "Text": "I am trying to create a tool to easily create and destroy AWS projects in my AWS organization (or at least remove them from the organisation if they can not be deleted). Those projects are going to be sandbox with a small budget and destroyed after a couple of weeks. \r\n\r\nI found that Terraform has a specific resource for that called [aws_organizations_account][1]. \r\n\r\nHowever, this is mentioned that deleting this Terraform resource **will only remove an AWS account from an organization. Terraform will not close the account**. The member account must be prepared to be a standalone account beforehand. See the AWS Organizations documentation for more information.\r\n\r\nI have tried to deploy an aws_organizations_account using terraform, it worked. But when I am trying to delete that ressource, I am a warning issue that `The member account must be configured with a valid payment method, such as a credit card`\r\n\r\n\r\n**main.tf**\r\n\r\n    resource \"aws_organizations_account\" \"account\" {\r\n      name      = \"sandbox1\"\r\n      email     = \"first.last+sandbox1@company.com\"\r\n      role_name = \"myOrganizationRole\"\r\n    }\r\n\r\nIs there any way to get around this issue? \r\n\r\n  [1]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_account", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "251275694", "PostHistoryTypeId": "1", "PostId": "68618094", "RevisionGUID": "634071c2-8017-47e1-a9fe-4a9dacbef0ce", "CreationDate": "2021-08-02T07:49:18.667", "UserId": "14897019", "Text": "Create / Destroy AWS projects using Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "251275695", "PostHistoryTypeId": "3", "PostId": "68618094", "RevisionGUID": "634071c2-8017-47e1-a9fe-4a9dacbef0ce", "CreationDate": "2021-08-02T07:49:18.667", "UserId": "14897019", "Text": "<amazon-web-services><terraform><aws-organizations>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "251276040", "PostHistoryTypeId": "5", "PostId": "68618094", "RevisionGUID": "326f7f7b-5cdf-4ba5-8d3d-518b053996db", "CreationDate": "2021-08-02T07:57:58.520", "UserId": "14897019", "Comment": "deleted 2 characters in body", "Text": "I am trying to create a tool to easily create and destroy AWS projects in my AWS organization (or at least remove them from the organisation if they can not be deleted). Those projects are going to be sandbox with a small budget and destroyed after a couple of weeks. \r\n\r\nI found that Terraform has a specific resource for that called [aws_organizations_account][1]. \r\n\r\nHowever, this is mentioned that deleting this Terraform resource **will only remove an AWS account from an organization. Terraform will not close the account**. The member account must be prepared to be a standalone account beforehand. See the AWS Organizations documentation for more information.\r\n\r\nI deployed an `aws_organizations_account` resource using terraform, it worked. But when I am trying to delete that resource, I am a warning issue that `The member account must be configured with a valid payment method, such as a credit card`\r\n\r\n\r\n**main.tf**\r\n\r\n    resource \"aws_organizations_account\" \"account\" {\r\n      name      = \"sandbox1\"\r\n      email     = \"first.last+sandbox1@company.com\"\r\n      role_name = \"myOrganizationRole\"\r\n    }\r\n\r\nIs there any way to get around this issue? \r\n\r\n  [1]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_account", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "251276951", "PostHistoryTypeId": "5", "PostId": "68618094", "RevisionGUID": "a5e1527e-ce94-4ad8-8734-45b71d2c2e38", "CreationDate": "2021-08-02T08:15:34.653", "UserId": "14897019", "Comment": "edited body; edited title", "Text": "I am trying to create a tool to easily create and destroy AWS accounts in my AWS organization (or at least remove them from the organisation if they can not be deleted). Those accounts are going to be sandbox with a small budget and destroyed after a couple of weeks. \r\n\r\nI found that Terraform has a specific resource for that called [aws_organizations_account][1]. \r\n\r\nHowever, this is mentioned that deleting this Terraform resource **will only remove an AWS account from an organization. Terraform will not close the account**. The member account must be prepared to be a standalone account beforehand. See the AWS Organizations documentation for more information.\r\n\r\nI deployed an `aws_organizations_account` resource using terraform, it worked. But when I am trying to delete that resource, I am a warning issue that `The member account must be configured with a valid payment method, such as a credit card`\r\n\r\n\r\n**main.tf**\r\n\r\n    resource \"aws_organizations_account\" \"account\" {\r\n      name      = \"sandbox1\"\r\n      email     = \"first.last+sandbox1@company.com\"\r\n      role_name = \"myOrganizationRole\"\r\n    }\r\n\r\nIs there any way to get around this issue? \r\n\r\n  [1]: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_account", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "251276952", "PostHistoryTypeId": "4", "PostId": "68618094", "RevisionGUID": "a5e1527e-ce94-4ad8-8734-45b71d2c2e38", "CreationDate": "2021-08-02T08:15:34.653", "UserId": "14897019", "Comment": "edited body; edited title", "Text": "Create / Destroy AWS account using Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "68693537", "PostTypeId": "2", "ParentId": "68618094", "CreationDate": "2021-08-07T15:03:42.843", "Score": "4", "Body": "<p>We have a very similar situation (sandbox accounts). We still need to be able to deprovision accounts as team members off-board. To account for consolidated billing and the inability to remove or delete member accounts, we are allowing those to remain while we remove IAM users and login profiles. The way we do this is to use one set of data for users and another for accounts. This leaves a different type of state that doesn\u2019t fail during user removal.</p>\n<p>I wrote about and shared our terraform setup: <a href=\"https://cromwellhaus.com/leaving-aws-subaccounts-behind\" rel=\"nofollow noreferrer\">https://cromwellhaus.com/leaving-aws-subaccounts-behind</a></p>\n<p>You could be more nuanced with the accounts side of you wanted.</p>\n", "OwnerUserId": "54996", "LastActivityDate": "2021-08-07T15:03:42.843", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "251600740", "PostHistoryTypeId": "2", "PostId": "68693537", "RevisionGUID": "a7d44029-918b-4b53-bd8b-e7af1bf12d3b", "CreationDate": "2021-08-07T15:03:42.843", "UserId": "54996", "Text": "We have a very similar situation (sandbox accounts). We still need to be able to deprovision accounts as team members off-board. To account for consolidated billing and the inability to remove or delete member accounts, we are allowing those to remain while we remove IAM users and login profiles. The way we do this is to use one set of data for users and another for accounts. This leaves a different type of state that doesn\u2019t fail during user removal.\r\n\r\nI wrote about and shared our terraform setup: https://cromwellhaus.com/leaving-aws-subaccounts-behind\r\n\r\nYou could be more nuanced with the accounts side of you wanted. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "To account for consolidated billing and the inability to remove or delete member accounts, we are allowing those to remain while we remove IAM users and login profiles. ", "keywords": ["bill"]}]}], "filtered-sentences": [{"source": "Body", "text": "To account for consolidated billing and the inability to remove or delete member accounts, we are allowing those to remain while we remove IAM users and login profiles. ", "keywords": ["bill"]}]}, {"Id": "68618459", "PostTypeId": "2", "ParentId": "68618094", "CreationDate": "2021-08-02T08:22:10.510", "Score": "6", "Body": "<blockquote>\n<p>Is there any way to get around this issue?</p>\n</blockquote>\n<p>Sadly, no. When you remove AWS Account from AWS org, it becomes <strong>normal standalone account</strong>. You need custom solution for removing accounts from AWS Org, which would require you to full-fill all its prerequisites listed <a href=\"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_accounts_remove.html#orgs_manage_account-before-remove\" rel=\"noreferrer\">here</a>. One of them is having <strong>valid contact and payment info</strong> associated with the account to be removed.</p>\n<p>You can <a href=\"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_accounts_close.html\" rel=\"noreferrer\">delete the account</a> (its different them removing from AWS org), but this can't be done from AWS Org. Account has too be closed from inside, using root.</p>\n", "OwnerUserId": "248823", "LastActivityDate": "2021-08-02T08:22:10.510", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "251277297", "PostHistoryTypeId": "2", "PostId": "68618459", "RevisionGUID": "a2092047-a33b-4544-b53c-16f4f0ae8646", "CreationDate": "2021-08-02T08:22:10.510", "UserId": "248823", "Text": "> Is there any way to get around this issue?\r\n\r\nSadly, no. When you remove AWS Account from AWS org, it becomes **normal standalone account**. You need custom solution for removing accounts from AWS Org, which would require you to full-fill all its prerequisites listed [here](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_accounts_remove.html#orgs_manage_account-before-remove). One of them is having **valid contact and payment info** associated with the account to be removed.\r\n\r\nYou can [delete the account][1] (its different them removing from AWS org), but this can't be done from AWS Org. Account has too be closed from inside, using root. \r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_accounts_close.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "71804499", "PostTypeId": "2", "ParentId": "68618094", "CreationDate": "2022-04-09T01:03:30.687", "Score": "3", "Body": "<p>Deleting an account is now available with the <a href=\"https://docs.aws.amazon.com/organizations/latest/APIReference/API_CloseAccount.html\" rel=\"nofollow noreferrer\">close account api.</a> This functionality is enabled on terraform via the close_on_deletion flag.</p>\n", "OwnerUserId": "18751549", "LastActivityDate": "2022-04-09T01:03:30.687", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "129432059", "PostId": "71804499", "Score": "0", "Text": "`close_on_delete` flag is referenced here: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_account", "CreationDate": "2022-08-09T09:21:57.060", "UserId": "3194408", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "267806123", "PostHistoryTypeId": "2", "PostId": "71804499", "RevisionGUID": "bb6d79e4-5ff7-4479-b9a2-deed8529418c", "CreationDate": "2022-04-09T01:03:30.687", "UserId": "18751549", "Text": "Deleting an account is now available with the [close account api.][1] This functionality is enabled on terraform via the close_on_deletion flag. \r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/organizations/latest/APIReference/API_CloseAccount.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": []}