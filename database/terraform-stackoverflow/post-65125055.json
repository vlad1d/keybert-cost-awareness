{"Id": "65125055", "PostTypeId": "1", "CreationDate": "2020-12-03T11:23:24.337", "Score": "3", "ViewCount": "1250", "Body": "<p>I get this error:</p>\n<blockquote>\n<p>Error: Error launching source instance: InsufficientInstanceCapacity:\nWe currently do not have sufficient t3a.medium capacity in the\nAvailability Zone you requested (eu-central-1c). Our system will be\nworking on provisioning additional capacity. You can currently get\nt3a.medium capacity by not specifying an Availability Zone in your\nrequest or choosing eu-central-1a, eu-central-1b.\nstatus code: 500, request id: (redacted)</p>\n</blockquote>\n<p>I did not specify an Availability Zone directly in <code>packer-build.json</code>. I did, however, specify a <code>subnet_id</code>, and that is automagically linked to one single Availability Zone.</p>\n<pre class=\"lang-json prettyprint-override\"><code>provider &quot;aws&quot; {\n  region = &quot;eu-central-1&quot;\n}\n\nresource &quot;aws_instance&quot; &quot;test-instance&quot; {\n  key_name = &quot;(redacted)&quot;\n  subnet_id = &quot;(redacted)&quot;\n  ami = &quot;(redacted)&quot;\n  instance_type = &quot;t3a.medium&quot;\n  security_groups = [ &quot;(redacted)&quot; ]\n  associate_public_ip_address = &quot;true&quot;\n  disable_api_termination = &quot;false&quot;\n  monitoring = &quot;false&quot;\n  tags = {\n    Name = &quot;test-instance&quot;\n  }\n}\n</code></pre>\n<p>Amazon documentation (<a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/troubleshooting-launch.html#troubleshooting-launch-capacity\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/troubleshooting-launch.html#troubleshooting-launch-capacity</a>) says:</p>\n<blockquote>\n<ol>\n<li>Wait a few minutes and then submit your request again; capacity can shift frequently.</li>\n<li>Submit a new request with a reduced number of instances. For example, if you're making a single request to launch 15 instances, try\nmaking 3 requests for 5 instances, or 15 requests for 1 instance\ninstead.</li>\n<li>If you're launching an instance, submit a new request without specifying an Availability Zone.</li>\n<li>If you're launching an instance, submit a new request using a different instance type (which you can resize at a later stage). For\nmore information, see Changing the instance type.</li>\n<li>If you are launching instances into a cluster placement group, you can get an insufficient capacity error. For more information, see\nPlacement group rules and limitations.</li>\n</ol>\n</blockquote>\n<ol>\n<li>Doesn't work, <code>eu-central-1c</code> is out of <code>t3a.medium</code> capacity for at least 2 days already.</li>\n<li>Is not applicable, I'm requesting only 1 instance.</li>\n<li>This is my question, I don't know how to tell Terraform how to do that.</li>\n<li>I don't want to do that, because I won't be able to change instance type soon, because of (1).</li>\n<li>Not applicable, not using a cluster placement group.</li>\n</ol>\n<p>How do I tell Terraform to use any available subnet from a list of 3 subnets (each linked to their own Availability Zone), so that I no longer get an error?\nI have no preference (do not care) in which Availability Zone the instance runs.</p>\n", "OwnerUserId": "766786", "LastEditorUserId": "766786", "LastEditDate": "2020-12-03T12:09:34.530", "LastActivityDate": "2020-12-03T12:09:34.530", "Title": "Terraform error launching source instance: InsufficientInstanceCapacity in Availability Zone", "Tags": "<amazon-web-services><terraform><terraform-provider-aws>", "AnswerCount": "0", "CommentCount": "9", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "115135721", "PostId": "65125055", "Score": "1", "Text": "\"specify a subnet_id, and apparently that is somehow automagically linked to an Availability Zone\" - a subnet is always in a single AZ.", "CreationDate": "2020-12-03T11:41:01.943", "UserId": "118587", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115136461", "PostId": "65125055", "Score": "0", "Text": "Can I just not specify any `subnet_id` at all? Will that work?", "CreationDate": "2020-12-03T12:10:35.907", "UserId": "766786", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115136502", "PostId": "65125055", "Score": "0", "Text": "When I comment out `subnet_id`, I get another error: Error: Error launching instance, possible mismatch of Security Group IDs and Names. See AWS Instance docs here: https://terraform.io/docs/providers/aws/r/instance.html.\n\n        AWS Error: InvalidParameterValue: Value () for parameter groupId is invalid. The value cannot be empty\n        status code: 400, request id: (redacted)", "CreationDate": "2020-12-03T12:12:21.197", "UserId": "766786", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "When I comment out `subnet_id`, I get another error: Error: Error launching instance, possible mismatch of Security Group IDs and Names. ", "keywords": ["instance"]}, {"source": "Text", "text": "See AWS Instance docs here: https://terraform.io/docs/providers/aws/r/instance.html. AWS Error: InvalidParameterValue: Value () for parameter groupId is invalid. ", "keywords": ["instance"]}]}, {"Id": "115136570", "PostId": "65125055", "Score": "0", "Text": "You should be using `vpc_security_group_ids`, not `security_groups` but that's a separate question really. IIRC you must always specify a subnet for non VPC classic accounts and non default VPCs so if you are using a custom VPC then this doesn't help you. Instead you should specify a subnet ID that is in an AZ that does have capacity. You can look up the subnet ID for an availability zone using the [`aws_subnet` data source](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/subnet)", "CreationDate": "2020-12-03T12:14:41.713", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115136617", "PostId": "65125055", "Score": "1", "Text": "Thank you for the comment about `vpc_security_group_ids`, I just copy/pasted whatever I found on the Terraform website as example, without actually knowing what I am doing. I really appreciate the feedback.", "CreationDate": "2020-12-03T12:16:36.747", "UserId": "766786", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115136664", "PostId": "65125055", "Score": "0", "Text": "I don't know where to find the `vpc_security_group_ids`. I'll open another question about that, later.", "CreationDate": "2020-12-03T12:18:05.597", "UserId": "766786", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "115136730", "PostId": "65125055", "Score": "0", "Text": "Will the subnet ID of an AZ using `aws_subnet` tell me if that AZ has capacity for that specific instance type?", "CreationDate": "2020-12-03T12:20:14.280", "UserId": "766786", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Will the subnet ID of an AZ using `aws_subnet` tell me if that AZ has capacity for that specific instance type?", "keywords": ["instance"]}]}, {"Id": "118973816", "PostId": "65125055", "Score": "0", "Text": "@AmedeeVanGasse could you solve this problem? I'm really start to think there's nothing to do in this case but wait AWS provision more hardware for further instances virtualization. InsufficientInstanceCapacity error even returns status code 500!", "CreationDate": "2021-04-29T00:12:56.897", "UserId": "12500992", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "118980459", "PostId": "65125055", "Score": "0", "Text": "I was not able to solve it. In the end I just started using a different (more expensive) instance type.", "CreationDate": "2021-04-29T08:07:11.367", "UserId": "766786", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "In the end I just started using a different (more expensive) instance type.", "keywords": ["expense", "instance"]}]}], "history": [{"Id": "236166926", "PostHistoryTypeId": "2", "PostId": "65125055", "RevisionGUID": "1bdd432e-3a7e-4383-bdb2-48f490b09193", "CreationDate": "2020-12-03T11:23:24.337", "UserId": "766786", "Text": "I get this error:\r\n\r\n> Error: Error launching source instance: InsufficientInstanceCapacity:\r\n> We currently do not have sufficient t3a.medium capacity in the\r\n> Availability Zone you requested (eu-central-1c). Our system will be\r\n> working on provisioning additional capacity. You can currently get\r\n> t3a.medium capacity by not specifying an Availability Zone in your\r\n> request or choosing eu-central-1a, eu-central-1b.\r\n>         status code: 500, request id: (redacted)\r\n\r\nI did not specify an Availability Zone directly in `packer-build.json`. I did, however, specify a `subnet_id`, and apparently that is somehow automagically linked to an Availability Zone.\r\n\r\n```json\r\nprovider \"aws\" {\r\n  region = \"eu-central-1\"\r\n}\r\n\r\nresource \"aws_instance\" \"test-instance\" {\r\n  key_name = \"(redacted)\"\r\n  subnet_id = \"(redacted)\"\r\n  ami = \"(redacted)\"\r\n  instance_type = \"t3a.medium\"\r\n  security_groups = [ \"(redacted)\" ]\r\n  associate_public_ip_address = \"true\"\r\n  disable_api_termination = \"false\"\r\n  monitoring = \"false\"\r\n  tags = {\r\n    Name = \"test-instance\"\r\n  }\r\n}\r\n```\r\nAmazon documentation (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/troubleshooting-launch.html#troubleshooting-launch-capacity) says:\r\n\r\n> 1. Wait a few minutes and then submit your request again; capacity can shift frequently.\r\n> 2. Submit a new request with a reduced number of instances. For example, if you're making a single request to launch 15 instances, try\r\n> making 3 requests for 5 instances, or 15 requests for 1 instance\r\n> instead.\r\n> 3. If you're launching an instance, submit a new request without specifying an Availability Zone.\r\n> 4. If you're launching an instance, submit a new request using a different instance type (which you can resize at a later stage). For\r\n> more information, see Changing the instance type.\r\n> 5. If you are launching instances into a cluster placement group, you can get an insufficient capacity error. For more information, see\r\n> Placement group rules and limitations.\r\n\r\n1. Doesn't work, `eu-central-1c` is out of `t3a.medium` capacity for at least 2 days already.\r\n2. Is not applicable, I'm requesting only 1 instance.\r\n3. This is my question, I don't know how to tell Terraform how to do that.\r\n4. I don't want to do that, because I won't be able to change instance type soon, because of (1).\r\n5. Not applicable, not using a cluster placement group.\r\n\r\nHow do I tell Terraform to use any available subnet from a list of 3 subnets (each linked to their own Availability Zone), so that I no longer get an error?\r\nI have no preference (do not care) in which Availability Zone the instance runs.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I get this error: > Error: Error launching source instance: InsufficientInstanceCapacity: > We currently do not have sufficient t3a.medium capacity in the > Availability Zone you requested (eu-central-1c). ", "keywords": ["instance"]}, {"source": "Text", "text": "```json provider \"aws\" { region = \"eu-central-1\" } resource \"aws_instance\" \"test-instance\" { key_name = \"(redacted)\" subnet_id = \"(redacted)\" ami = \"(redacted)\" instance_type = \"t3a.medium\" security_groups = [ \"(redacted)\" ] associate_public_ip_address = \"true\" disable_api_termination = \"false\" monitoring = \"false\" tags = { Name = \"test-instance\" } } ``` ", "keywords": ["instance", "provider", "test"]}, {"source": "Text", "text": "For example, if you're making a single request to launch 15 instances, try > making 3 requests for 5 instances, or 15 requests for 1 instance > instead. ", "keywords": ["instance"]}, {"source": "Text", "text": "3. If you're launching an instance, submit a new request without specifying an Availability Zone. ", "keywords": ["instance"]}, {"source": "Text", "text": "4. If you're launching an instance, submit a new request using a different instance type (which you can resize at a later stage). ", "keywords": ["instance"]}, {"source": "Text", "text": "For > more information, see Changing the instance type. ", "keywords": ["instance", "change"]}, {"source": "Text", "text": "5. If you are launching instances into a cluster placement group, you can get an insufficient capacity error. ", "keywords": ["cluster"]}, {"source": "Text", "text": "2. Is not applicable, I'm requesting only 1 instance. ", "keywords": ["instance"]}, {"source": "Text", "text": "4. I don't want to do that, because I won't be able to change instance type soon, because of (1). ", "keywords": ["instance", "change"]}, {"source": "Text", "text": "5. Not applicable, not using a cluster placement group. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I have no preference (do not care) in which Availability Zone the instance runs.", "keywords": ["instance"]}]}, {"Id": "236166927", "PostHistoryTypeId": "1", "PostId": "65125055", "RevisionGUID": "1bdd432e-3a7e-4383-bdb2-48f490b09193", "CreationDate": "2020-12-03T11:23:24.337", "UserId": "766786", "Text": "Terraform error launching source instance: InsufficientInstanceCapacity in Availability Zone", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Terraform error launching source instance: InsufficientInstanceCapacity in Availability Zone", "keywords": ["instance"]}]}, {"Id": "236166928", "PostHistoryTypeId": "3", "PostId": "65125055", "RevisionGUID": "1bdd432e-3a7e-4383-bdb2-48f490b09193", "CreationDate": "2020-12-03T11:23:24.337", "UserId": "766786", "Text": "<amazon-web-services><terraform><terraform-provider-aws>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "236169584", "PostHistoryTypeId": "5", "PostId": "65125055", "RevisionGUID": "dcfc6094-6580-4567-9cad-52bb06e089dd", "CreationDate": "2020-12-03T12:09:34.530", "UserId": "766786", "Comment": "deleted 11 characters in body", "Text": "I get this error:\r\n\r\n> Error: Error launching source instance: InsufficientInstanceCapacity:\r\n> We currently do not have sufficient t3a.medium capacity in the\r\n> Availability Zone you requested (eu-central-1c). Our system will be\r\n> working on provisioning additional capacity. You can currently get\r\n> t3a.medium capacity by not specifying an Availability Zone in your\r\n> request or choosing eu-central-1a, eu-central-1b.\r\n>         status code: 500, request id: (redacted)\r\n\r\nI did not specify an Availability Zone directly in `packer-build.json`. I did, however, specify a `subnet_id`, and that is automagically linked to one single Availability Zone.\r\n\r\n```json\r\nprovider \"aws\" {\r\n  region = \"eu-central-1\"\r\n}\r\n\r\nresource \"aws_instance\" \"test-instance\" {\r\n  key_name = \"(redacted)\"\r\n  subnet_id = \"(redacted)\"\r\n  ami = \"(redacted)\"\r\n  instance_type = \"t3a.medium\"\r\n  security_groups = [ \"(redacted)\" ]\r\n  associate_public_ip_address = \"true\"\r\n  disable_api_termination = \"false\"\r\n  monitoring = \"false\"\r\n  tags = {\r\n    Name = \"test-instance\"\r\n  }\r\n}\r\n```\r\nAmazon documentation (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/troubleshooting-launch.html#troubleshooting-launch-capacity) says:\r\n\r\n> 1. Wait a few minutes and then submit your request again; capacity can shift frequently.\r\n> 2. Submit a new request with a reduced number of instances. For example, if you're making a single request to launch 15 instances, try\r\n> making 3 requests for 5 instances, or 15 requests for 1 instance\r\n> instead.\r\n> 3. If you're launching an instance, submit a new request without specifying an Availability Zone.\r\n> 4. If you're launching an instance, submit a new request using a different instance type (which you can resize at a later stage). For\r\n> more information, see Changing the instance type.\r\n> 5. If you are launching instances into a cluster placement group, you can get an insufficient capacity error. For more information, see\r\n> Placement group rules and limitations.\r\n\r\n1. Doesn't work, `eu-central-1c` is out of `t3a.medium` capacity for at least 2 days already.\r\n2. Is not applicable, I'm requesting only 1 instance.\r\n3. This is my question, I don't know how to tell Terraform how to do that.\r\n4. I don't want to do that, because I won't be able to change instance type soon, because of (1).\r\n5. Not applicable, not using a cluster placement group.\r\n\r\nHow do I tell Terraform to use any available subnet from a list of 3 subnets (each linked to their own Availability Zone), so that I no longer get an error?\r\nI have no preference (do not care) in which Availability Zone the instance runs.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I get this error: > Error: Error launching source instance: InsufficientInstanceCapacity: > We currently do not have sufficient t3a.medium capacity in the > Availability Zone you requested (eu-central-1c). ", "keywords": ["instance"]}, {"source": "Text", "text": "```json provider \"aws\" { region = \"eu-central-1\" } resource \"aws_instance\" \"test-instance\" { key_name = \"(redacted)\" subnet_id = \"(redacted)\" ami = \"(redacted)\" instance_type = \"t3a.medium\" security_groups = [ \"(redacted)\" ] associate_public_ip_address = \"true\" disable_api_termination = \"false\" monitoring = \"false\" tags = { Name = \"test-instance\" } } ``` ", "keywords": ["instance", "provider", "test"]}, {"source": "Text", "text": "For example, if you're making a single request to launch 15 instances, try > making 3 requests for 5 instances, or 15 requests for 1 instance > instead. ", "keywords": ["instance"]}, {"source": "Text", "text": "3. If you're launching an instance, submit a new request without specifying an Availability Zone. ", "keywords": ["instance"]}, {"source": "Text", "text": "4. If you're launching an instance, submit a new request using a different instance type (which you can resize at a later stage). ", "keywords": ["instance"]}, {"source": "Text", "text": "For > more information, see Changing the instance type. ", "keywords": ["instance", "change"]}, {"source": "Text", "text": "5. If you are launching instances into a cluster placement group, you can get an insufficient capacity error. ", "keywords": ["cluster"]}, {"source": "Text", "text": "2. Is not applicable, I'm requesting only 1 instance. ", "keywords": ["instance"]}, {"source": "Text", "text": "4. I don't want to do that, because I won't be able to change instance type soon, because of (1). ", "keywords": ["instance", "change"]}, {"source": "Text", "text": "5. Not applicable, not using a cluster placement group. ", "keywords": ["cluster"]}, {"source": "Text", "text": "I have no preference (do not care) in which Availability Zone the instance runs.", "keywords": ["instance"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "Terraform error launching source instance: InsufficientInstanceCapacity in Availability Zone", "keywords": ["instance"]}, {"source": "Body", "text": "I get this error: Error: Error launching source instance: InsufficientInstanceCapacity: We currently do not have sufficient t3a.medium capacity in the Availability Zone you requested (eu-central-1c). ", "keywords": ["instance"]}, {"source": "Body", "text": "For example, if you're making a single request to launch 15 instances, try making 3 requests for 5 instances, or 15 requests for 1 instance instead. ", "keywords": ["instance"]}, {"source": "Body", "text": "If you're launching an instance, submit a new request without specifying an Availability Zone. ", "keywords": ["instance"]}, {"source": "Body", "text": "If you're launching an instance, submit a new request using a different instance type (which you can resize at a later stage). ", "keywords": ["instance"]}, {"source": "Body", "text": "For more information, see Changing the instance type. ", "keywords": ["instance", "change"]}, {"source": "Body", "text": "If you are launching instances into a cluster placement group, you can get an insufficient capacity error. ", "keywords": ["cluster"]}, {"source": "Body", "text": "Is not applicable, I'm requesting only 1 instance. ", "keywords": ["instance"]}, {"source": "Body", "text": "I don't want to do that, because I won't be able to change instance type soon, because of (1). ", "keywords": ["instance", "change"]}, {"source": "Body", "text": "Not applicable, not using a cluster placement group. ", "keywords": ["cluster"]}, {"source": "Body", "text": "I have no preference (do not care) in which Availability Zone the instance runs.", "keywords": ["instance"]}]}