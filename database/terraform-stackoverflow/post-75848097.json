{"Id": "75848097", "PostTypeId": "1", "AcceptedAnswerId": "75852791", "CreationDate": "2023-03-26T13:38:58.360", "Score": "0", "ViewCount": "142", "Body": "<p>I am trying to figure out how to assign a built-in role from azure to an azure ad group I am creating.\nHowever I don't not understand the logic while reading the documentation.</p>\n<p>Here's my terraform code:</p>\n<p>az-rbac.tf</p>\n<pre><code>data &quot;azurerm_subscription&quot; &quot;current&quot; {\n}\n\noutput &quot;current_subscription_display_name&quot; {\n  value = data.azurerm_subscription.current.display_name\n}\n\ndata &quot;azurerm_client_config&quot; &quot;azuread_sg_cns&quot; {\n}\n\nresource &quot;azurerm_role_assignment&quot; &quot;reader-rbac&quot; {\n  scope                = data.azurerm_subscription.current.id\n  role_definition_name = &quot;Reader&quot;\n  principal_id         = data.azuread_group.azuread_sg_cns.object_id\n}\n</code></pre>\n<p>main.tf</p>\n<pre><code>terraform {\n\n  required_version = &quot;&gt;=0.12&quot;\n  \n  required_providers {\n    azurerm = {\n      source = &quot;hashicorp/azurerm&quot;\n      version = &quot;~&gt;2.0&quot;\n    }\n    azuread = {\n      source  = &quot;hashicorp/azuread&quot;\n      version = &quot;~&gt; 2.15.0&quot;\n    }\n  }\n}\n#Configure the Azure Resource Management Provider\nprovider &quot;azurerm&quot; {\n    subscription_id = var.azure_subscription_id\n    tenant_id = var.azure_tenant_id\n  features {}\n}\n\n# Configure the Azure Active Directory Provider\nprovider &quot;azuread&quot; {\n  tenant_id = var.azure_tenant_id\n}\n\n#create azure active directory group\ndata &quot;azuread_client_config&quot; &quot;current&quot; {}\n\nresource &quot;azuread_group&quot; &quot;azuread_sg&quot; {\n  display_name     = var.azure_sg_name\n  owners           = [data.azuread_client_config.current.object_id]\n  security_enabled = true\n}\n\n#create azure active directory group cns\n\nresource &quot;azuread_group&quot; &quot;azuread_sg_cns&quot; {\n  display_name     = var.azuread_sg_cns\n  owners           = [data.azuread_client_config.current.object_id]\n  security_enabled = true\n}\n\n#create cost reader group\nresource &quot;azuread_group&quot; &quot;azuread_sg_cost-mgmt&quot; {\n  display_name     = var.azuread_sg_cost-mgmt\n  owners           = [data.azuread_client_config.current.object_id]\n  security_enabled = true\n}\n\n#create azure resource group\nresource &quot;azurerm_resource_group&quot; &quot;rg&quot; {\n  name     = var.azure_rg_name\n  location = var.azure_resource_group_location\n}\n\n#create azure key vault\nresource &quot;azurerm_key_vault&quot; &quot;akv&quot; {\n  name                        = lower(&quot;${var.azure_project_code}-${var.azure_env_code}-akv-01&quot;)\n  location                    = var.azure_resource_group_location\n  resource_group_name = azurerm_resource_group.rg.name\n  enabled_for_disk_encryption = true\n  tenant_id                   = var.azure_tenant_id\n  soft_delete_retention_days  = 7\n  purge_protection_enabled    = false\n  sku_name = &quot;standard&quot;\n\n}\n\nresource &quot;azurerm_storage_account&quot; &quot;sa&quot; {\n  name                     = lower(&quot;${var.azure_project_code}${var.azure_env_code}sa01&quot;)\n  resource_group_name      = azurerm_resource_group.rg.name\n  location                 = var.azure_resource_group_location\n  account_tier             = &quot;Standard&quot;\n  account_replication_type = &quot;LRS&quot;\n}\n\nresource &quot;azurerm_storage_container&quot; &quot;ctnr&quot; {\n  name                  = lower(&quot;${var.azure_project_code}${var.azure_env_code}ctnr01&quot;)\n  storage_account_name  = azurerm_storage_account.sa.name\n  container_access_type = &quot;private&quot;\n}\n\n</code></pre>\n<p>variable.tf</p>\n<pre><code>variable &quot;azure_resource_group_location&quot; {\n  default = &quot;west europe&quot;\n  description   = &quot;Location of the resource group.&quot;\n}\n\nvariable &quot;azure_subscription_id&quot; {\n  type        = string\n  description = &quot;Azure Subscription Id&quot;\n}\n\nvariable &quot;azure_tenant_id&quot; {\n  type        = string\n  description = &quot;Azure Tenant Id&quot;\n}\n\nvariable &quot;azure_sg_name&quot; {\n  type        = string\n  description = &quot;Azure AD Security Group Name&quot;\n}\n\nvariable &quot;azuread_sg_cns&quot; {\n  type        = string\n  description = &quot;Azure AD Security Group Name CNS&quot;\n}\n\nvariable &quot;azuread_sg_cost-mgmt&quot; {\n  type        = string\n  description = &quot;Azure AD Security Group Name Cost Mgmt&quot;\n}\n\nvariable &quot;azure_rg_name&quot; {\n  type        = string\n  description = &quot;Azure Resource Group Name&quot;\n}\n\nvariable &quot;azure_client_code&quot; {\n  type        = string\n  description = &quot;Azure Client code&quot;\n}\n\nvariable &quot;azure_project_code&quot; {\n  type        = string\n  description = &quot;Azure Project Code&quot;\n}\n\nvariable &quot;azure_env_code&quot; {\n  type        = string\n  description = &quot;Azure Environment Code&quot;\n}\n</code></pre>\n<p>env.tfvars</p>\n<pre><code>#Azure tenant id\nazure_tenant_id =&quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;\n#Azure subscription\nazure_subscription_id = &quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;\n#Azure resource group location\nazure_resource_group_location = &quot;west europe&quot;\n# #Azure ad Sg\nazure_sg_name = &quot;sg - eu-dev-test-testproject&quot;\n# #Azure ad Sg CNS\nazuread_sg_cns = &quot;sg -cns - eu-dev-test-testproject&quot;\n#Azure Cost Reader\nazuread_sg_cost-mgmt = &quot;sg - Cost Reader - eu-dev-test-testproject&quot;\n#Azure RG name\nazure_rg_name = &quot;eu-dev-test-testproject&quot;\n#Azure project code\nazure_project_code = &quot;testproject&quot;\n#Azure client code\nazure_client_code = &quot;test&quot;\n#Environement code : sbx, dev, ppd, prd\nazure_env_code=&quot;dev&quot;\n</code></pre>\n<p>So I tried to create multiples resources such as:</p>\n<ul>\n<li>azure resource group</li>\n<li>azure key vault</li>\n<li>azure storage account with 1 container</li>\n<li>azure security group x3</li>\n</ul>\n<p>My expectation is to have the cns sg group to get reader role on the created resource group.\nBut I keep failing as I don't understand how to make my code understand it has to assign the role to the resource group level to the security group cns I am creating while running the code.</p>\n<p>Here's the error message with the current code:</p>\n<p><a href=\"https://i.stack.imgur.com/a0ru4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/a0ru4.png\" alt=\"enter image description here\" /></a></p>\n", "OwnerUserId": "8014576", "LastActivityDate": "2023-03-29T17:53:12.260", "Title": "Assign Azure RBAC to Azure AD security group on resource group level", "Tags": "<azure><azure-active-directory><terraform><rbac><azure-rm>", "AnswerCount": "1", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133792972", "PostId": "75848097", "Score": "0", "Text": "`azuread_group.azuread_sg_cns` is a resource in your script, not a data source, therefore drop `data.` prefix.", "CreationDate": "2023-03-26T21:05:35.377", "UserId": "2890093", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "290376190", "PostHistoryTypeId": "2", "PostId": "75848097", "RevisionGUID": "2274eb69-f074-4f4f-b95a-387cd1f8e79c", "CreationDate": "2023-03-26T13:38:58.360", "UserId": "8014576", "Text": "I am trying to figure out how to assign a built-in role from azure to an azure ad group I am creating.\r\nHowever I don't not understand the logic while reading the documentation.\r\n\r\nHere's my terraform code:\r\n\r\naz-rbac.tf\r\n```\r\ndata \"azurerm_subscription\" \"current\" {\r\n}\r\n\r\noutput \"current_subscription_display_name\" {\r\n  value = data.azurerm_subscription.current.display_name\r\n}\r\n\r\ndata \"azurerm_client_config\" \"azuread_sg_cns\" {\r\n}\r\n\r\nresource \"azurerm_role_assignment\" \"reader-rbac\" {\r\n  scope                = data.azurerm_subscription.current.id\r\n  role_definition_name = \"Reader\"\r\n  principal_id         = data.azuread_group.azuread_sg_cns.object_id\r\n}\r\n```\r\n\r\n\r\nmain.tf\r\n\r\n\r\n```\r\nterraform {\r\n\r\n  required_version = \">=0.12\"\r\n  \r\n  required_providers {\r\n    azurerm = {\r\n      source = \"hashicorp/azurerm\"\r\n      version = \"~>2.0\"\r\n    }\r\n    azuread = {\r\n      source  = \"hashicorp/azuread\"\r\n      version = \"~> 2.15.0\"\r\n    }\r\n  }\r\n}\r\n#Configure the Azure Resource Management Provider\r\nprovider \"azurerm\" {\r\n    subscription_id = var.azure_subscription_id\r\n    tenant_id = var.azure_tenant_id\r\n  features {}\r\n}\r\n\r\n# Configure the Azure Active Directory Provider\r\nprovider \"azuread\" {\r\n  tenant_id = var.azure_tenant_id\r\n}\r\n\r\n#create azure active directory group\r\ndata \"azuread_client_config\" \"current\" {}\r\n\r\nresource \"azuread_group\" \"azuread_sg\" {\r\n  display_name     = var.azure_sg_name\r\n  owners           = [data.azuread_client_config.current.object_id]\r\n  security_enabled = true\r\n}\r\n\r\n#create azure active directory group cns\r\n\r\nresource \"azuread_group\" \"azuread_sg_cns\" {\r\n  display_name     = var.azuread_sg_cns\r\n  owners           = [data.azuread_client_config.current.object_id]\r\n  security_enabled = true\r\n}\r\n\r\n#create cost reader group\r\nresource \"azuread_group\" \"azuread_sg_cost-mgmt\" {\r\n  display_name     = var.azuread_sg_cost-mgmt\r\n  owners           = [data.azuread_client_config.current.object_id]\r\n  security_enabled = true\r\n}\r\n\r\n#create azure resource group\r\nresource \"azurerm_resource_group\" \"rg\" {\r\n  name     = var.azure_rg_name\r\n  location = var.azure_resource_group_location\r\n}\r\n\r\n#create azure key vault\r\nresource \"azurerm_key_vault\" \"akv\" {\r\n  name                        = lower(\"${var.azure_project_code}-${var.azure_env_code}-akv-01\")\r\n  location                    = var.azure_resource_group_location\r\n  resource_group_name = azurerm_resource_group.rg.name\r\n  enabled_for_disk_encryption = true\r\n  tenant_id                   = var.azure_tenant_id\r\n  soft_delete_retention_days  = 7\r\n  purge_protection_enabled    = false\r\n  sku_name = \"standard\"\r\n\r\n}\r\n\r\nresource \"azurerm_storage_account\" \"sa\" {\r\n  name                     = lower(\"${var.azure_project_code}${var.azure_env_code}sa01\")\r\n  resource_group_name      = azurerm_resource_group.rg.name\r\n  location                 = var.azure_resource_group_location\r\n  account_tier             = \"Standard\"\r\n  account_replication_type = \"LRS\"\r\n}\r\n\r\nresource \"azurerm_storage_container\" \"ctnr\" {\r\n  name                  = lower(\"${var.azure_project_code}${var.azure_env_code}ctnr01\")\r\n  storage_account_name  = azurerm_storage_account.sa.name\r\n  container_access_type = \"private\"\r\n}\r\n\r\n```\r\n\r\nvariable.tf\r\n\r\n\r\n```\r\nvariable \"azure_resource_group_location\" {\r\n  default = \"west europe\"\r\n  description   = \"Location of the resource group.\"\r\n}\r\n\r\nvariable \"azure_subscription_id\" {\r\n  type        = string\r\n  description = \"Azure Subscription Id\"\r\n}\r\n\r\nvariable \"azure_tenant_id\" {\r\n  type        = string\r\n  description = \"Azure Tenant Id\"\r\n}\r\n\r\nvariable \"azure_sg_name\" {\r\n  type        = string\r\n  description = \"Azure AD Security Group Name\"\r\n}\r\n\r\nvariable \"azuread_sg_cns\" {\r\n  type        = string\r\n  description = \"Azure AD Security Group Name CNS\"\r\n}\r\n\r\nvariable \"azuread_sg_cost-mgmt\" {\r\n  type        = string\r\n  description = \"Azure AD Security Group Name Cost Mgmt\"\r\n}\r\n\r\nvariable \"azure_rg_name\" {\r\n  type        = string\r\n  description = \"Azure Resource Group Name\"\r\n}\r\n\r\nvariable \"azure_client_code\" {\r\n  type        = string\r\n  description = \"Azure Client code\"\r\n}\r\n\r\nvariable \"azure_project_code\" {\r\n  type        = string\r\n  description = \"Azure Project Code\"\r\n}\r\n\r\nvariable \"azure_env_code\" {\r\n  type        = string\r\n  description = \"Azure Environment Code\"\r\n}\r\n```\r\n\r\nenv.tfvars\r\n\r\n\r\n```\r\n#Azure tenant id\r\nazure_tenant_id =\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\r\n#Azure subscription\r\nazure_subscription_id = \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\r\n#Azure resource group location\r\nazure_resource_group_location = \"west europe\"\r\n# #Azure ad Sg\r\nazure_sg_name = \"sg - eu-dev-test-testproject\"\r\n# #Azure ad Sg CNS\r\nazuread_sg_cns = \"sg -cns - eu-dev-test-testproject\"\r\n#Azure Cost Reader\r\nazuread_sg_cost-mgmt = \"sg - Cost Reader - eu-dev-test-testproject\"\r\n#Azure RG name\r\nazure_rg_name = \"eu-dev-test-testproject\"\r\n#Azure project code\r\nazure_project_code = \"testproject\"\r\n#Azure client code\r\nazure_client_code = \"test\"\r\n#Environement code : sbx, dev, ppd, prd\r\nazure_env_code=\"dev\"\r\n```\r\n\r\nSo I tried to create multiples resources such as:\r\n- azure resource group\r\n- azure key vault\r\n- azure storage account with 1 container\r\n- azure security group x3 \r\n\r\nMy expectation is to have the cns sg group to get reader role on the created resource group.\r\nBut I keep failing as I don't understand how to make my code understand it has to assign the role to the resource group level to the security group cns I am creating while running the code.\r\n\r\nHere's the error message with the current code:\r\n\r\n[![enter image description here](https://i.stack.imgur.com/a0ru4.png)](https://i.stack.imgur.com/a0ru4.png)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Here's my terraform code: az-rbac.tf ``` data \"azurerm_subscription\" \"current\" { } output \"current_subscription_display_name\" { value = data.azurerm_subscription.current.display_name } data \"azurerm_client_config\" \"azuread_sg_cns\" { } resource \"azurerm_role_assignment\" \"reader-rbac\" { scope = data.azurerm_subscription.current.id role_definition_name = \"Reader\" principal_id = data.azuread_group.azuread_sg_cns.object_id } ``` main.tf ``` terraform { required_version = \">=0.12\" required_providers { azurerm = { source = \"hashicorp/azurerm\" version = \"~>2.0\" } azuread = { source = \"hashicorp/azuread\" version = \"~> 2.15.0\" } } } #Configure the Azure Resource Management Provider provider \"azurerm\" { subscription_id = var.azure_subscription_id tenant_id = var.azure_tenant_id features {} } # Configure the Azure Active Directory Provider provider \"azuread\" { tenant_id = var.azure_tenant_id } #create azure active directory group data \"azuread_client_config\" \"current\" {} resource \"azuread_group\" \"azuread_sg\" { display_name = var.azure_sg_name owners = [data.azuread_client_config.current.object_id] security_enabled = true } #create azure active directory group cns resource \"azuread_group\" \"azuread_sg_cns\" { display_name = var.azuread_sg_cns owners = [data.azuread_client_config.current.object_id] security_enabled = true } #create cost reader group resource \"azuread_group\" \"azuread_sg_cost-mgmt\" { display_name = var.azuread_sg_cost-mgmt owners = [data.azuread_client_config.current.object_id] security_enabled = true } #create azure resource group resource \"azurerm_resource_group\" \"rg\" { name = var.azure_rg_name location = var.azure_resource_group_location } #create azure key vault resource \"azurerm_key_vault\" \"akv\" { name = lower(\"${var.azure_project_code}-${var.azure_env_code}-akv-01\") location = var.azure_resource_group_location resource_group_name = azurerm_resource_group.rg.name enabled_for_disk_encryption = true tenant_id = var.azure_tenant_id soft_delete_retention_days = 7 purge_protection_enabled = false sku_name = \"standard\" } resource \"azurerm_storage_account\" \"sa\" { name = lower(\"${var.azure_project_code}${var.azure_env_code}sa01\") resource_group_name = azurerm_resource_group.rg.name location = var.azure_resource_group_location account_tier = \"Standard\" account_replication_type = \"LRS\" } resource \"azurerm_storage_container\" \"ctnr\" { name = lower(\"${var.azure_project_code}${var.azure_env_code}ctnr01\") storage_account_name = azurerm_storage_account.sa.name container_access_type = \"private\" } ``` variable.tf ``` variable \"azure_resource_group_location\" { default = \"west europe\" description = \"Location of the resource group.\" } variable \"azure_subscription_id\" { type = string description = \"Azure Subscription Id\" } variable \"azure_tenant_id\" { type = string description = \"Azure Tenant Id\" } variable \"azure_sg_name\" { type = string description = \"Azure AD Security Group Name\" } variable \"azuread_sg_cns\" { type = string description = \"Azure AD Security Group Name CNS\" } variable \"azuread_sg_cost-mgmt\" { type = string description = \"Azure AD Security Group Name Cost Mgmt\" } variable \"azure_rg_name\" { type = string description = \"Azure Resource Group Name\" } variable \"azure_client_code\" { type = string description = \"Azure Client code\" } variable \"azure_project_code\" { type = string description = \"Azure Project Code\" } variable \"azure_env_code\" { type = string description = \"Azure Environment Code\" } ``` env.tfvars ``` #Azure tenant id azure_tenant_id =\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\" #Azure subscription azure_subscription_id = \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\" #Azure resource group location azure_resource_group_location = \"west europe\" # #Azure ad Sg azure_sg_name = \"sg - eu-dev-test-testproject\" # #Azure ad Sg CNS azuread_sg_cns = \"sg -cns - eu-dev-test-testproject\" #Azure Cost Reader azuread_sg_cost-mgmt = \"sg - Cost Reader - eu-dev-test-testproject\" #Azure RG name azure_rg_name = \"eu-dev-test-testproject\" #Azure project code azure_project_code = \"testproject\" #Azure client code azure_client_code = \"test\" #Environement code : sbx, dev, ppd, prd azure_env_code=\"dev\" ``` ", "keywords": ["cost", "provider", "test"]}, {"source": "Text", "text": "So I tried to create multiples resources such as: - azure resource group - azure key vault - azure storage account with 1 container - azure security group x3 My expectation is to have the cns sg group to get reader role on the created resource group. ", "keywords": ["storage"]}]}, {"Id": "290376192", "PostHistoryTypeId": "1", "PostId": "75848097", "RevisionGUID": "2274eb69-f074-4f4f-b95a-387cd1f8e79c", "CreationDate": "2023-03-26T13:38:58.360", "UserId": "8014576", "Text": "Assign Azure RBAC to Azure AD security group on resource group level", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "290376193", "PostHistoryTypeId": "3", "PostId": "75848097", "RevisionGUID": "2274eb69-f074-4f4f-b95a-387cd1f8e79c", "CreationDate": "2023-03-26T13:38:58.360", "UserId": "8014576", "Text": "<azure><azure-active-directory><terraform><rbac><azure-rm>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "290376194", "PostHistoryTypeId": "66", "PostId": "75848097", "RevisionGUID": "2274eb69-f074-4f4f-b95a-387cd1f8e79c", "CreationDate": "2023-03-26T13:38:58.360", "UserId": "8014576", "filtered-sentences": []}], "answers": [{"Id": "75852791", "PostTypeId": "2", "ParentId": "75848097", "CreationDate": "2023-03-27T06:45:23.143", "Score": "1", "Body": "<blockquote>\n<p>My expectation is to have the cns sg group to get reader role on the created resource group.</p>\n</blockquote>\n<p>Thanks to <strong>Kombajn zbo\u017cowy</strong> for suggesting same.</p>\n<blockquote>\n<p>If you are using resource block for creation of azure ad group but calling it as <strong>data.azuread_group</strong>, which is not declared.</p>\n</blockquote>\n<p>You can use the following <strong>Terraform</strong> code to assign the <strong>Reader</strong> role to a group at the resource group level.</p>\n<pre><code>provider  &quot;azurerm&quot; {\nsubscription_id =  &quot;a34e2b59-xxxxxxxxx-b4a8-ebdc1f96c865&quot;\ntenant_id =  &quot;89xxxxx-xxxxxxxxx-55277a8d958a&quot;\nfeatures {}\n}\nprovider  &quot;azuread&quot; {\ntenant_id =  &quot;xxxxxxxxxxxxxxxxx-55277a8d958a&quot;\n}\ndata  &quot;azurerm_client_config&quot;  &quot;azuread_sg_cns&quot; {\n}\nresource  &quot;azurerm_resource_group&quot;  &quot;venkat-rg&quot;{\nname =  &quot;venkat-RG&quot;\nlocation =  &quot;eastus&quot;\n}\nresource  &quot;azuread_group&quot;  &quot;azuread_sg_cns&quot; {\ndisplay_name =  &quot;azuread_sg_cns&quot;\nsecurity_enabled =  true\n}\nresource  &quot;azurerm_role_assignment&quot;  &quot;reader-rbac&quot; {\nscope =  azurerm_resource_group.venkat-rg.id\nrole_definition_name =  &quot;Reader&quot;\nprincipal_id =  azuread_group.azuread_sg_cns.object_id\n}\n</code></pre>\n<p><strong>Terraform plan:</strong></p>\n<p><img src=\"https://i.stack.imgur.com/dvUmv.png\" alt=\"enter image description here\" /></p>\n<p><strong>Terraform apply:</strong></p>\n<p><img src=\"https://i.stack.imgur.com/fdkzg.png\" alt=\"enter image description here\" /></p>\n<p>Once ran the above code resources are created and <strong>Reader</strong> role are also applied to the group.</p>\n<p><img src=\"https://i.stack.imgur.com/0r40N.png\" alt=\"enter image description here\" /></p>\n", "OwnerUserId": "20465725", "LastEditorUserId": "20465725", "LastEditDate": "2023-03-29T17:53:12.260", "LastActivityDate": "2023-03-29T17:53:12.260", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "133801680", "PostId": "75852791", "Score": "0", "Text": "Thank you for clarification, I understood my error with the usage of data instead of resource. Take care!", "CreationDate": "2023-03-27T12:22:00.163", "UserId": "8014576", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "290404677", "PostHistoryTypeId": "2", "PostId": "75852791", "RevisionGUID": "c6d2adf4-f260-4546-b436-f16829508106", "CreationDate": "2023-03-27T06:45:23.143", "UserId": "20465725", "Text": "> My expectation is to have the cns sg group to get reader role on the created resource group. \r\n\r\n  \r\nThanks to **Kombajn zbo\u017cowy** for suggesting same.\r\n\r\n> If you are using resource block for creation of azure ad group but calling it as **data.azuread_group**, which is not declared.\r\n\r\nYou can use the following **Terraform** code to assign the **Reader** role to a group at the resource group level.\r\n\r\n\r\n\r\n    provider  \"azurerm\" {\r\n    subscription_id =  \"a34e2b59-xxxxxxxxx-b4a8-ebdc1f96c865\"\r\n    tenant_id =  \"89xxxxx-xxxxxxxxx-55277a8d958a\"\r\n    features {}\r\n    }\r\n    provider  \"azuread\" {\r\n    tenant_id =  \"xxxxxxxxxxxxxxxxx-55277a8d958a\"\r\n    }\r\n    data  \"azurerm_client_config\"  \"azuread_sg_cns\" {\r\n    }\r\n    resource  \"azurerm_resource_group\"  \"venkat-rg\"{\r\n    name =  \"venkat-RG\"\r\n    location =  \"eastus\"\r\n    }\r\n    resource  \"azuread_group\"  \"azuread_sg_cns\" {\r\n    display_name =  \"azuread_sg_cns\"\r\n    security_enabled =  true\r\n    }\r\n    resource  \"azurerm_role_assignment\"  \"reader-rbac\" {\r\n    scope =  azurerm_resource_group.venkat-rg.id\r\n    role_definition_name =  \"Reader\"\r\n    principal_id =  azuread_group.azuread_sg_cns.object_id\r\n    }\r\n\r\n**Terraform plan:**\r\n\r\n![enter image description here](https://i.stack.imgur.com/dvUmv.png)\r\n\r\n**Terraform apply:**\r\n\r\n![enter image description here](https://i.stack.imgur.com/fdkzg.png)\r\n\r\nOnce ran the above code resource is created and **Reader** role is also applied to the group.\r\n\r\n![enter image description here](https://i.stack.imgur.com/0r40N.png)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can use the following **Terraform** code to assign the **Reader** role to a group at the resource group level. provider \"azurerm\" { subscription_id = \"a34e2b59-xxxxxxxxx-b4a8-ebdc1f96c865\" tenant_id = \"89xxxxx-xxxxxxxxx-55277a8d958a\" features {} } provider \"azuread\" { tenant_id = \"xxxxxxxxxxxxxxxxx-55277a8d958a\" } data \"azurerm_client_config\" \"azuread_sg_cns\" { } resource \"azurerm_resource_group\" \"venkat-rg\"{ name = \"venkat-RG\" location = \"eastus\" } resource \"azuread_group\" \"azuread_sg_cns\" { display_name = \"azuread_sg_cns\" security_enabled = true } resource \"azurerm_role_assignment\" \"reader-rbac\" { scope = azurerm_resource_group.venkat-rg.id role_definition_name = \"Reader\" principal_id = azuread_group.azuread_sg_cns.object_id } **Terraform plan:** ![enter image description here](https://i.stack.imgur.com/dvUmv.png) **Terraform apply:** ![enter image description here](https://i.stack.imgur.com/fdkzg.png) Once ran the above code resource is created and **Reader** role is also applied to the group", "keywords": ["provider"]}]}, {"Id": "290566209", "PostHistoryTypeId": "5", "PostId": "75852791", "RevisionGUID": "5c51bcb2-8c6f-412b-b81b-2c966f845405", "CreationDate": "2023-03-29T17:53:12.260", "UserId": "20465725", "Comment": "Spelling ", "Text": "> My expectation is to have the cns sg group to get reader role on the created resource group. \r\n\r\n  \r\nThanks to **Kombajn zbo\u017cowy** for suggesting same.\r\n\r\n> If you are using resource block for creation of azure ad group but calling it as **data.azuread_group**, which is not declared.\r\n\r\nYou can use the following **Terraform** code to assign the **Reader** role to a group at the resource group level.\r\n\r\n\r\n\r\n    provider  \"azurerm\" {\r\n    subscription_id =  \"a34e2b59-xxxxxxxxx-b4a8-ebdc1f96c865\"\r\n    tenant_id =  \"89xxxxx-xxxxxxxxx-55277a8d958a\"\r\n    features {}\r\n    }\r\n    provider  \"azuread\" {\r\n    tenant_id =  \"xxxxxxxxxxxxxxxxx-55277a8d958a\"\r\n    }\r\n    data  \"azurerm_client_config\"  \"azuread_sg_cns\" {\r\n    }\r\n    resource  \"azurerm_resource_group\"  \"venkat-rg\"{\r\n    name =  \"venkat-RG\"\r\n    location =  \"eastus\"\r\n    }\r\n    resource  \"azuread_group\"  \"azuread_sg_cns\" {\r\n    display_name =  \"azuread_sg_cns\"\r\n    security_enabled =  true\r\n    }\r\n    resource  \"azurerm_role_assignment\"  \"reader-rbac\" {\r\n    scope =  azurerm_resource_group.venkat-rg.id\r\n    role_definition_name =  \"Reader\"\r\n    principal_id =  azuread_group.azuread_sg_cns.object_id\r\n    }\r\n\r\n**Terraform plan:**\r\n\r\n![enter image description here](https://i.stack.imgur.com/dvUmv.png)\r\n\r\n**Terraform apply:**\r\n\r\n![enter image description here](https://i.stack.imgur.com/fdkzg.png)\r\n\r\nOnce ran the above code resources are created and **Reader** role are also applied to the group.\r\n\r\n![enter image description here](https://i.stack.imgur.com/0r40N.png)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can use the following **Terraform** code to assign the **Reader** role to a group at the resource group level. provider \"azurerm\" { subscription_id = \"a34e2b59-xxxxxxxxx-b4a8-ebdc1f96c865\" tenant_id = \"89xxxxx-xxxxxxxxx-55277a8d958a\" features {} } provider \"azuread\" { tenant_id = \"xxxxxxxxxxxxxxxxx-55277a8d958a\" } data \"azurerm_client_config\" \"azuread_sg_cns\" { } resource \"azurerm_resource_group\" \"venkat-rg\"{ name = \"venkat-RG\" location = \"eastus\" } resource \"azuread_group\" \"azuread_sg_cns\" { display_name = \"azuread_sg_cns\" security_enabled = true } resource \"azurerm_role_assignment\" \"reader-rbac\" { scope = azurerm_resource_group.venkat-rg.id role_definition_name = \"Reader\" principal_id = azuread_group.azuread_sg_cns.object_id } **Terraform plan:** ![enter image description here](https://i.stack.imgur.com/dvUmv.png) **Terraform apply:** ![enter image description here](https://i.stack.imgur.com/fdkzg.png) Once ran the above code resources are created and **Reader** role are also applied to the group", "keywords": ["provider"]}]}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "So I tried to create multiples resources such as: azure resource group azure key vault azure storage account with 1 container azure security group x3 My expectation is to have the cns sg group to get reader role on the created resource group. ", "keywords": ["storage"]}]}