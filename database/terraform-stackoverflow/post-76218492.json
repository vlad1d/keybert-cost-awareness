{"Id": "76218492", "PostTypeId": "1", "CreationDate": "2023-05-10T12:34:10.697", "Score": "0", "ViewCount": "182", "Body": "<p>Trying to create a new databricks workspace on Azure from Terraform. I tried with custom parameters and without custom parameters. Both are failing. Azure Activity Log shows the below error.</p>\n<blockquote>\n<p>&quot;statusMessage&quot;: &quot;{status:Failed,error:{code:ResourceOperationFailure,message:The resource operation completed with terminal provisioning state 'Failed'.,details:[{code:Conflict,message:INVALID_STATE: Workspace xyz is missing metadata necessary for cluster management. Please reach out to your Databricks support.}]}}&quot;</p>\n</blockquote>\n<p>Below is the simple code I used.</p>\n<pre><code>resource &quot;azurerm_databricks_workspace&quot; &quot;databricks&quot; {\n  name                      =       &quot;${lower(var.prefix)}-${var.tenant-name}-${var.env}-dbr-ws&quot;\n  resource_group_name       =       data.azurerm_resource_group.rg.name\n  location                  =       data.azurerm_resource_group.rg.location\n  sku                       =       var.databricksVars[&quot;sku&quot;]\n  managed_resource_group_name   =   &quot;${lower(var.prefix)}-${var.tenant-name}-${var.env}-dbr-managed-rg&quot;\n\n  # custom_parameters {\n  # public_subnet_name        =       data.azurerm_subnet.public.name\n  # public_subnet_network_security_group_association_id   =   data.azurerm_subnet.public.id\n  # private_subnet_name       =       data.azurerm_subnet.private.name\n  # private_subnet_network_security_group_association_id  =   data.azurerm_subnet.private.id\n  # virtual_network_id        =       data.azurerm_virtual_network.vnet.id\n  # }      \n\n  tags = {\n        app = var.tenant-name\n        created_by = &quot;xyz&quot;\n        created_on = &quot;9-May-2023&quot;\n        env = &quot;dev&quot;\n        created_from = &quot;terraform&quot;\n  }\n}\n</code></pre>\n<p>Please help me resolve this.</p>\n<p>I tried with custom parameters and without custom parameters. Both are failing</p>\n", "OwnerUserId": "7824784", "LastActivityDate": "2023-05-11T08:02:13.730", "Title": "Azure Databricks Provisioning failed from Terraform", "Tags": "<azure><terraform><databricks>", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "292599150", "PostHistoryTypeId": "2", "PostId": "76218492", "RevisionGUID": "6818f8b6-a066-46f5-a38b-59e6983a6e18", "CreationDate": "2023-05-10T12:34:10.697", "UserId": "7824784", "Text": "Trying to create a new databricks workspace on Azure from Terraform. I tried with custom parameters and without custom parameters. Both are failing. Azure Activity Log shows the below error.\r\n\r\n> \"statusMessage\": \"{status:Failed,error:{code:ResourceOperationFailure,message:The resource operation completed with terminal provisioning state 'Failed'.,details:[{code:Conflict,message:INVALID_STATE: Workspace xyz is missing metadata necessary for cluster management. Please reach out to your Databricks support.}]}}\"\r\n\r\n\r\n\r\nBelow is the simple code I used.\r\n\r\n```\r\nresource \"azurerm_databricks_workspace\" \"databricks\" {\r\n  name                      =       \"${lower(var.prefix)}-${var.tenant-name}-${var.env}-dbr-ws\"\r\n  resource_group_name       =       data.azurerm_resource_group.rg.name\r\n  location                  =       data.azurerm_resource_group.rg.location\r\n  sku                       =       var.databricksVars[\"sku\"]\r\n  managed_resource_group_name   =   \"${lower(var.prefix)}-${var.tenant-name}-${var.env}-dbr-managed-rg\"\r\n\r\n  # custom_parameters {\r\n  # public_subnet_name        =       data.azurerm_subnet.public.name\r\n  # public_subnet_network_security_group_association_id   =   data.azurerm_subnet.public.id\r\n  # private_subnet_name       =       data.azurerm_subnet.private.name\r\n  # private_subnet_network_security_group_association_id  =   data.azurerm_subnet.private.id\r\n  # virtual_network_id        =       data.azurerm_virtual_network.vnet.id\r\n  # }      \r\n\r\n  tags = {\r\n        app = var.tenant-name\r\n        created_by = \"xyz\"\r\n        created_on = \"9-May-2023\"\r\n        env = \"dev\"\r\n        created_from = \"terraform\"\r\n  }\r\n}\r\n```\r\n\r\nPlease help me resolve this.\r\n\r\n\r\nI tried with custom parameters and without custom parameters. Both are failing", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "> \"statusMessage\": \"{status:Failed,error:{code:ResourceOperationFailure,message:The resource operation completed with terminal provisioning state 'Failed'.,details:[{code:Conflict,message:INVALID_STATE: Workspace xyz is missing metadata necessary for cluster management. ", "keywords": ["cluster"]}]}, {"Id": "292599152", "PostHistoryTypeId": "1", "PostId": "76218492", "RevisionGUID": "6818f8b6-a066-46f5-a38b-59e6983a6e18", "CreationDate": "2023-05-10T12:34:10.697", "UserId": "7824784", "Text": "Azure Databricks Provisioning failed from Terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "292599153", "PostHistoryTypeId": "3", "PostId": "76218492", "RevisionGUID": "6818f8b6-a066-46f5-a38b-59e6983a6e18", "CreationDate": "2023-05-10T12:34:10.697", "UserId": "7824784", "Text": "<azure><terraform><databricks>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "292599154", "PostHistoryTypeId": "66", "PostId": "76218492", "RevisionGUID": "6818f8b6-a066-46f5-a38b-59e6983a6e18", "CreationDate": "2023-05-10T12:34:10.697", "UserId": "7824784", "filtered-sentences": []}], "answers": [{"Id": "76225353", "PostTypeId": "2", "ParentId": "76218492", "CreationDate": "2023-05-11T08:02:13.730", "Score": "0", "Body": "<p>Check the following:</p>\n<p>Code:</p>\n<pre><code>resource &quot;azurerm_databricks_workspace&quot; &quot;example&quot; {\n  name                = &quot;databricks-test&quot;\n  location            = data.azurerm_resource_group.example.location\n  resource_group_name = data.azurerm_resource_group.example.name\n  sku                 = &quot;standard&quot;\nmanaged_resource_group_name = azurerm_resource_group.rg.name\n \n}\n</code></pre>\n<p>Make sure to have  necessary permissions in your subscription to create a workspace and managed resource group . SKU must be supported by Databricks service in the region .</p>\n<p><em><strong>You must have azure pay-as-you go subscription.</strong></em></p>\n<p><em><strong>Make sure to have Azure Contributor or Owner role to you.</strong></em></p>\n<p><em><strong>Make sure  managed_resource_group_name  field is unique .</strong></em></p>\n<p><a href=\"https://i.stack.imgur.com/H9MXA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/H9MXA.png\" alt=\"enter image description here\" /></a></p>\n<p><a href=\"https://i.stack.imgur.com/vQeg3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vQeg3.png\" alt=\"enter image description here\" /></a></p>\n<p><a href=\"https://i.stack.imgur.com/1urF9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1urF9.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>Reference</strong> : <a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/databricks_workspace\" rel=\"nofollow noreferrer\">azurerm_databricks_workspace | terraform registry</a></p>\n", "OwnerUserId": "15997509", "LastActivityDate": "2023-05-11T08:02:13.730", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "292639586", "PostHistoryTypeId": "2", "PostId": "76225353", "RevisionGUID": "b80a24f4-9a75-4238-89ac-4e1be0c398cd", "CreationDate": "2023-05-11T08:02:13.730", "UserId": "15997509", "Text": "Check the following:\r\n\r\nCode:\r\n\r\n  \r\n    \r\n    resource \"azurerm_databricks_workspace\" \"example\" {\r\n      name                = \"databricks-test\"\r\n      location            = data.azurerm_resource_group.example.location\r\n      resource_group_name = data.azurerm_resource_group.example.name\r\n      sku                 = \"standard\"\r\n    managed_resource_group_name = azurerm_resource_group.rg.name\r\n     \r\n    }\r\n\r\nMake sure to have  necessary permissions in your subscription to create a workspace and managed resource group . SKU must be supported by Databricks service in the region .\r\n\r\n***You must have azure pay-as-you go subscription.***\r\n\r\n***Make sure to have Azure Contributor or Owner role to you.***\r\n\r\n***Make sure  managed_resource_group_name  field is unique .***\r\n\r\n[![enter image description here][1]][1]\r\n\r\n\r\n[![enter image description here][2]][2]\r\n\r\n\r\n[![enter image description here][3]][3]\r\n\r\n\r\n**Reference** : [azurerm_databricks_workspace | terraform registry][4]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/H9MXA.png\r\n  [2]: https://i.stack.imgur.com/vQeg3.png\r\n  [3]: https://i.stack.imgur.com/1urF9.png\r\n  [4]: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/databricks_workspace", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Check the following: Code: resource \"azurerm_databricks_workspace\" \"example\" { name = \"databricks-test\" location = data.azurerm_resource_group.example.location resource_group_name = data.azurerm_resource_group.example.name sku = \"standard\" managed_resource_group_name = azurerm_resource_group.rg.name } Make sure to have necessary permissions in your subscription to create a workspace and managed resource group . ", "keywords": ["test"]}, {"source": "Text", "text": "***You must have azure pay-as-you go subscription.*** ***Make sure to have Azure Contributor or Owner role to you.*** ***Make sure managed_resource_group_name field is unique .*** [![enter image description here][1]][1] [![enter image description here][2]][2] [![enter image description here][3]][3] **Reference** : [azurerm_databricks_workspace | terraform registry][4] [1]: https://i.stack.imgur.com/H9MXA.png [2]: https://i.stack.imgur.com/vQeg3.png [3]: https://i.stack.imgur.com/1urF9.png [4]: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/databricks_workspace", "keywords": ["pay"]}]}, {"Id": "292639588", "PostHistoryTypeId": "33", "PostId": "76225353", "RevisionGUID": "70248ae7-4d49-497d-9066-cfa2cfaaf70f", "CreationDate": "2023-05-11T08:02:13.730", "UserId": "-1010", "Comment": "318125", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "You must have azure pay-as-you go subscription. ", "keywords": ["pay"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "\"statusMessage\": \"{status:Failed,error:{code:ResourceOperationFailure,message:The resource operation completed with terminal provisioning state 'Failed'.,details:[{code:Conflict,message:INVALID_STATE: Workspace xyz is missing metadata necessary for cluster management. ", "keywords": ["cluster"]}]}