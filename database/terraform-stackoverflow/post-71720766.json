{"Id": "71720766", "PostTypeId": "1", "CreationDate": "2022-04-02T19:53:58.337", "Score": "0", "ViewCount": "882", "Body": "<p>I am using the <strong>terraform-google-project-factory</strong> module to create multiple GCP projects at once. The projects create just fine and I am using the included option to disable the default GCP compute service account and stand-up a new Service Account in each project.\nThe module has an &quot;sa_role&quot; input where I assign &quot;roles/compute.admin&quot; to the new S.A. However, I would also like to assign some additional IAM roles to that Service Account in the same deployment.  The <code>sa_role</code> input seems to only take one string value:</p>\n<pre><code>module &quot;project-factory&quot; {\n  source                  = &quot;terraform-google-modules/project-factory/google&quot;\n  version                 = &quot;12.0.0&quot;\n  for_each                = toset(local.project_names)\n  random_project_id       = true\n  name                    = each.key\n  org_id                  = local.organization_id\n  billing_account         = local.billing_account\n  folder_id               = google_folder.DQS.id\n  default_service_account = &quot;disable&quot;\n  default_network_tier    = &quot;PREMIUM&quot;\n  create_project_sa       = true\n  auto_create_network     = false\n  project_sa_name         = local.service_account\n  sa_role                 = [&quot;roles/compute.admin&quot;]\n  activate_apis           = [&quot;compute.googleapis.com&quot;,&quot;storage.googleapis.com&quot;,&quot;oslogin.googleapis.com&quot;,]\n}\n</code></pre>\n<p>The output for the Service Account email looks like this:</p>\n<pre><code>output &quot;service_account_email&quot; {\n  value       = values(module.project-factory)[*].service_account_email\n  description = &quot;The email of the default service account&quot;\n}\n</code></pre>\n<p>How can I add additional IAM roles to this Service Account in the same main.tf ?  This Stack article comes close to what I wish to achieve:\n<a href=\"https://stackoverflow.com/questions/61661116/want-to-assign-multiple-google-cloud-iam-roles-against-a-service-account-via-ter\">Want to assign multiple Google cloud IAM roles against a service account via terraform</a></p>\n<p>However, I do not know how to reference my Service Account email addresses from the outputs.tf to make them available to the <code>members =</code> part of the <code>data google_iam_policy</code>. My question is, how to get this to work with the <code>data google_iam_policy</code>, or is there another better way to do this?</p>\n", "OwnerUserId": "17029890", "LastActivityDate": "2022-04-02T19:53:58.337", "Title": "GCP terraform-google-project-factory multiple projects update the service account with new bindings?", "Tags": "<google-cloud-platform><terraform><project><service-accounts><google-iam>", "AnswerCount": "0", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "links": [{"Id": "1968387224", "CreationDate": "2022-04-02T19:53:58.337", "PostId": "71720766", "RelatedPostId": "61661116", "LinkTypeId": "1"}], "history": [{"Id": "267352431", "PostHistoryTypeId": "2", "PostId": "71720766", "RevisionGUID": "9d0910e7-1ebd-4fce-8856-f6e0ccf181f1", "CreationDate": "2022-04-02T19:53:58.337", "UserId": "17029890", "Text": "I am using the **terraform-google-project-factory** module to create multiple GCP projects at once. The projects create just fine and I am using the included option to disable the default GCP compute service account and stand-up a new Service Account in each project.\r\nThe module has an \"sa_role\" input where I assign \"roles/compute.admin\" to the new S.A. However, I would also like to assign some additional IAM roles to that Service Account in the same deployment.  The `sa_role` input seems to only take one string value:\r\n\r\n    module \"project-factory\" {\r\n      source                  = \"terraform-google-modules/project-factory/google\"\r\n      version                 = \"12.0.0\"\r\n      for_each                = toset(local.project_names)\r\n      random_project_id       = true\r\n      name                    = each.key\r\n      org_id                  = local.organization_id\r\n      billing_account         = local.billing_account\r\n      folder_id               = google_folder.DQS.id\r\n      default_service_account = \"disable\"\r\n      default_network_tier    = \"PREMIUM\"\r\n      create_project_sa       = true\r\n      auto_create_network     = false\r\n      project_sa_name         = local.service_account\r\n      sa_role                 = [\"roles/compute.admin\"]\r\n      activate_apis           = [\"compute.googleapis.com\",\"storage.googleapis.com\",\"oslogin.googleapis.com\",]\r\n    }\r\n\r\nThe output for the Service Account email looks like this:\r\n\r\n    output \"service_account_email\" {\r\n      value       = values(module.project-factory)[*].service_account_email\r\n      description = \"The email of the default service account\"\r\n    }\r\n\r\nHow can I add additional IAM roles to this Service Account in the same main.tf ?  This Stack article comes close to what I wish to achieve:\r\nhttps://stackoverflow.com/questions/61661116/want-to-assign-multiple-google-cloud-iam-roles-against-a-service-account-via-ter\r\n\r\nHowever, I do not know how to reference my Service Account email addresses from the outputs.tf to make them available to the `members =` part of the `data google_iam_policy`. My question is, how to get this to work with the `data google_iam_policy`, or is there another better way to do this?\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "The `sa_role` input seems to only take one string value: module \"project-factory\" { source = \"terraform-google-modules/project-factory/google\" version = \"12.0.0\" for_each = toset(local.project_names) random_project_id = true name = each.key org_id = local.organization_id billing_account = local.billing_account folder_id = google_folder.DQS.id default_service_account = \"disable\" default_network_tier = \"PREMIUM\" create_project_sa = true auto_create_network = false project_sa_name = local.service_account sa_role = [\"roles/compute.admin\"] activate_apis = [\"compute.googleapis.com\",\"storage.googleapis.com\",\"oslogin.googleapis.com\",] } The output for the Service Account email looks like this: output \"service_account_email\" { value = values(module.project-factory)[*].service_account_email description = \"The email of the default service account\" } How can I add additional IAM roles to this Service Account in the same main.tf ? ", "keywords": ["bill", "storage"]}]}, {"Id": "267352433", "PostHistoryTypeId": "1", "PostId": "71720766", "RevisionGUID": "9d0910e7-1ebd-4fce-8856-f6e0ccf181f1", "CreationDate": "2022-04-02T19:53:58.337", "UserId": "17029890", "Text": "GCP terraform-google-project-factory multiple projects update the service account with new bindings?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "267352434", "PostHistoryTypeId": "3", "PostId": "71720766", "RevisionGUID": "9d0910e7-1ebd-4fce-8856-f6e0ccf181f1", "CreationDate": "2022-04-02T19:53:58.337", "UserId": "17029890", "Text": "<google-cloud-platform><terraform><project><service-accounts><google-iam>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}