{"Id": "60828348", "PostTypeId": "1", "AcceptedAnswerId": "71556294", "CreationDate": "2020-03-24T09:38:37.917", "Score": "8", "ViewCount": "6385", "Body": "<p>I'd like to create Google Cloud <a href=\"https://console.cloud.google.com/apis/credentials\" rel=\"noreferrer\">API keys</a> using Terraform.</p>\n\n<p>Is this possible?</p>\n", "OwnerUserId": "198825", "LastActivityDate": "2022-03-25T08:57:49.437", "Title": "Can I create GCP API keys using Terraform?", "Tags": "<google-cloud-platform><terraform><terraform-provider-gcp>", "AnswerCount": "4", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "107621723", "PostId": "60828348", "Score": "2", "Text": "Does it need to be an API key or can it be a service account? AFAIK there is no API for creating API keys but you can create service accounts and their key pairs with Terraform.", "CreationDate": "2020-03-24T10:05:25.960", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "107623023", "PostId": "60828348", "Score": "0", "Text": "Should be an API key as it's for usage with the Cloud Endpoints. You are right. it seems like it has no API", "CreationDate": "2020-03-24T10:53:36.153", "UserId": "198825", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "107642255", "PostId": "60828348", "Score": "1", "Text": "At this time, I do not believe that there is a Terraform\nmodule to create API keys. You can check the following\nlink for all the Terraform modules that are available for\nGCP\n[1] https://registry.terraform.io/search?provider=hashicorp%2Fgoogle&q=google", "CreationDate": "2020-03-24T22:27:05.090", "UserId": "10811375", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "https://registry.terraform.io/search?provider=hashicorp%2Fgoogle&q=google", "keywords": ["provider"]}]}, {"Id": "126512323", "PostId": "60828348", "Score": "1", "Text": "There is now! https://stackoverflow.com/a/71556294/2023941", "CreationDate": "2022-03-23T03:36:02.697", "UserId": "2023941", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "217558177", "PostHistoryTypeId": "2", "PostId": "60828348", "RevisionGUID": "c792da63-88af-4779-a317-f77b89525704", "CreationDate": "2020-03-24T09:38:37.917", "UserId": "198825", "Text": "I'd like to create Google Cloud [API keys][1] using Terraform.\r\n\r\nIs this possible?\r\n\r\n\r\n  [1]: https://console.cloud.google.com/apis/credentials", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "217558178", "PostHistoryTypeId": "1", "PostId": "60828348", "RevisionGUID": "c792da63-88af-4779-a317-f77b89525704", "CreationDate": "2020-03-24T09:38:37.917", "UserId": "198825", "Text": "Can I create GCP API keys using Terraform?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "217558179", "PostHistoryTypeId": "3", "PostId": "60828348", "RevisionGUID": "c792da63-88af-4779-a317-f77b89525704", "CreationDate": "2020-03-24T09:38:37.917", "UserId": "198825", "Text": "<google-cloud-platform><terraform><terraform-provider-gcp>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "71015744", "PostTypeId": "2", "ParentId": "60828348", "CreationDate": "2022-02-07T08:53:37.343", "Score": "1", "Body": "<p>It seems they\u2019ve declined the ask for Terraform support here:\n<a href=\"https://github.com/hashicorp/terraform-provider-google/issues/6413\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/terraform-provider-google/issues/6413</a></p>\n<p>However there's now this issue for tracking the desire for this again:\n<a href=\"https://github.com/hashicorp/terraform-provider-google/issues/8959\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/terraform-provider-google/issues/8959</a> \u2754</p>\n", "OwnerUserId": "132652", "LastEditorUserId": "132652", "LastEditDate": "2022-02-07T08:59:41.667", "LastActivityDate": "2022-02-07T08:59:41.667", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "263577601", "PostHistoryTypeId": "2", "PostId": "71015744", "RevisionGUID": "2db45ead-2a5b-41e7-947e-2c582098066b", "CreationDate": "2022-02-07T08:53:37.343", "UserId": "132652", "Text": "It seems they\u2019ve declined the ask for Terraform support here:\r\nhttps://github.com/hashicorp/terraform-provider-google/issues/6413\r\n\r\nHowever there's now this issue for tracking the desire for this again:\r\nhttps://github.com/hashicorp/terraform-provider-google/issues/8959", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It seems they\u2019ve declined the ask for Terraform support here: https://github.com/hashicorp/terraform-provider-google/issues/6413 ", "keywords": ["provider"]}, {"source": "Text", "text": "However there's now this issue for tracking the desire for this again: https://github.com/hashicorp/terraform-provider-google/issues/8959", "keywords": ["provider"]}]}, {"Id": "263577995", "PostHistoryTypeId": "5", "PostId": "71015744", "RevisionGUID": "86b64e54-414d-41ed-8e6b-baaefbd475bf", "CreationDate": "2022-02-07T08:59:41.667", "UserId": "132652", "Comment": "added 6 characters in body", "Text": "It seems they\u2019ve declined the ask for Terraform support here:\r\nhttps://github.com/hashicorp/terraform-provider-google/issues/6413\r\n\r\nHowever there's now this issue for tracking the desire for this again:\r\nhttps://github.com/hashicorp/terraform-provider-google/issues/8959 \u2754", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It seems they\u2019ve declined the ask for Terraform support here: https://github.com/hashicorp/terraform-provider-google/issues/6413 However there's now this issue for tracking the desire for this again: https://github.com/hashicorp/terraform-provider-google/issues/8959 \u2754", "keywords": ["provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "It seems they\u2019ve declined the ask for Terraform support here: https://github.com/hashicorp/terraform-provider-google/issues/6413 However there's now this issue for tracking the desire for this again: https://github.com/hashicorp/terraform-provider-google/issues/8959 \u2754", "keywords": ["provider"]}]}, {"Id": "62191049", "PostTypeId": "2", "ParentId": "60828348", "CreationDate": "2020-06-04T09:17:25.217", "Score": "9", "Body": "<p>Not yet, but Google seems to be working on exposing an API for API key management. Latest cloud sdk (tested with 287.0.0) has alpha support, like this:</p>\n\n<pre><code>$ gcloud alpha services api-keys\nERROR: (gcloud.alpha.services.api-keys) Command name argument expected.\n\nAvailable commands for gcloud alpha services api-keys:\n\n      clone                   *(ALPHA)*  Create a new API key with the same\n                              metadata as input key.\n      create                  *(ALPHA)*  Create an API key.\n      delete                  *(ALPHA)*  Delete an API key.\n      describe                *(ALPHA)*  Describe an API key's metadata.\n      get-key-string          *(ALPHA)*  Get key string of an API key.\n      list                    *(ALPHA)*  Lists API keys.\n      lookup                  *(ALPHA)*  Look up resource name of a key string.\n      undelete                *(ALPHA)*  Undelete an API key.\n      update                  *(ALPHA)*  Update an API key's metadata.\n</code></pre>\n\n<p>When listing project API keys with the <code>--log-http</code> you can see the API endpoint used:</p>\n\n<pre><code>$ gcloud alpha services api-keys list --project $PROJECT --log-http\n...\n==== request start ====\nuri: https://apikeys.googleapis.com/v2alpha1/projects/$PROJECT/keys?alt=json\n...\n</code></pre>\n\n<p>Even though cloud sdk is using <code>v2alpha1</code>, there is a <code>v2beta1</code> available. Verified like this:</p>\n\n<pre><code>$ curl -s -H\"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n   https://apikeys.googleapis.com/v2beta1/projects/$PROJECT/keys\n{\n  \"keys\": [\n    {\n      \"name\": \"projects/REDACTED/keys/REDACTED\",\n      \"displayName\": \"REDACTED\",\n      \"createTime\": \"2019-04-15T10:39:53.558Z\",\n      \"updateTime\": \"2019-04-15T10:40:06.616639Z\",\n      \"restrictions\": {\n        \"androidKeyRestrictions\": {},\n        \"apiTargets\": [\n          {\n            \"service\": \"geocoding_backend\"\n          }\n        ]\n      },\n      \"state\": \"ACTIVE\"\n    }\n  ]\n}\n</code></pre>\n\n<p>Since the terraform google provider is usually pretty quick to add new features I can only assume support is coming soon. You may want to create a Github Issue to show your interest. Or watch the <a href=\"https://github.com/terraform-providers/terraform-provider-google-beta\" rel=\"noreferrer\">beta provider</a>'s change log.</p>\n", "OwnerUserId": "1531601", "LastActivityDate": "2020-06-04T09:17:25.217", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "125538050", "PostId": "62191049", "Score": "0", "Text": "It seems they\u2019ve declined the ask for Terraform support here: https://github.com/terraform-providers/terraform-provider-google/issues/6413", "CreationDate": "2022-02-07T08:19:40.573", "UserId": "132652", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It seems they\u2019ve declined the ask for Terraform support here: https://github.com/terraform-providers/terraform-provider-google/issues/6413", "keywords": ["provider"]}]}, {"Id": "126512335", "PostId": "62191049", "Score": "1", "Text": "Terraform support has arrived: https://stackoverflow.com/a/71556294/2023941", "CreationDate": "2022-03-23T03:37:20.740", "UserId": "2023941", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "223273916", "PostHistoryTypeId": "2", "PostId": "62191049", "RevisionGUID": "8f854281-6204-4481-b7db-671c9eaf050c", "CreationDate": "2020-06-04T09:17:25.217", "UserId": "1531601", "Text": "Not yet, but Google seems to be working on exposing an API for API key management. Latest cloud sdk (tested with 287.0.0) has alpha support, like this:\r\n\r\n```\r\n$ gcloud alpha services api-keys\r\nERROR: (gcloud.alpha.services.api-keys) Command name argument expected.\r\n\r\nAvailable commands for gcloud alpha services api-keys:\r\n\r\n      clone                   *(ALPHA)*  Create a new API key with the same\r\n                              metadata as input key.\r\n      create                  *(ALPHA)*  Create an API key.\r\n      delete                  *(ALPHA)*  Delete an API key.\r\n      describe                *(ALPHA)*  Describe an API key's metadata.\r\n      get-key-string          *(ALPHA)*  Get key string of an API key.\r\n      list                    *(ALPHA)*  Lists API keys.\r\n      lookup                  *(ALPHA)*  Look up resource name of a key string.\r\n      undelete                *(ALPHA)*  Undelete an API key.\r\n      update                  *(ALPHA)*  Update an API key's metadata.\r\n```\r\n\r\nWhen listing project API keys with the `--log-http` you can see the API endpoint used:\r\n\r\n```\r\n$ gcloud alpha services api-keys list --project $PROJECT --log-http\r\n...\r\n==== request start ====\r\nuri: https://apikeys.googleapis.com/v2alpha1/projects/$PROJECT/keys?alt=json\r\n...\r\n```\r\n\r\nEven though cloud sdk is using `v2alpha1`, there is a `v2beta1` available. Verified like this:\r\n\r\n```\r\n$ curl -s -H\"Authorization: Bearer $(gcloud auth print-access-token)\" \\\r\n   https://apikeys.googleapis.com/v2beta1/projects/$PROJECT/keys\r\n{\r\n  \"keys\": [\r\n    {\r\n      \"name\": \"projects/REDACTED/keys/REDACTED\",\r\n      \"displayName\": \"REDACTED\",\r\n      \"createTime\": \"2019-04-15T10:39:53.558Z\",\r\n      \"updateTime\": \"2019-04-15T10:40:06.616639Z\",\r\n      \"restrictions\": {\r\n        \"androidKeyRestrictions\": {},\r\n        \"apiTargets\": [\r\n          {\r\n            \"service\": \"geocoding_backend\"\r\n          }\r\n        ]\r\n      },\r\n      \"state\": \"ACTIVE\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nSince the terraform google provider is usually pretty quick to add new features I can only assume support is coming soon. You may want to create a Github Issue to show your interest. Or watch the [beta provider][1]'s change log.\r\n\r\n\r\n  [1]: https://github.com/terraform-providers/terraform-provider-google-beta", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Latest cloud sdk (tested with 287.0.0) has alpha support, like this: ``` $ gcloud alpha services api-keys ERROR: (gcloud.alpha.services.api-keys) Command name argument expected. ", "keywords": ["test"]}, {"source": "Text", "text": "Since the terraform google provider is usually pretty quick to add new features ", "keywords": ["provider"]}, {"source": "Text", "text": "Or watch the [beta provider][1]'s change log. [1]: https://github.com/terraform-providers/terraform-provider-google-beta", "keywords": ["provider", "change"]}]}], "filtered-sentences": [{"source": "Body", "text": "Latest cloud sdk (tested with 287.0.0) has alpha support, like this: When listing project API keys with the --log-http you can see the API endpoint used: Even though cloud sdk is using v2alpha1, there is a v2beta1 available. ", "keywords": ["test"]}, {"source": "Body", "text": "Verified like this: Since the terraform google provider is usually pretty quick to add new features I can only assume support is coming soon. ", "keywords": ["provider"]}, {"source": "Body", "text": "Or watch the beta provider's change log.", "keywords": ["provider", "change"]}]}, {"Id": "71556294", "PostTypeId": "2", "ParentId": "60828348", "CreationDate": "2022-03-21T10:47:04.547", "Score": "9", "Body": "<p>Google Cloud provider (version &gt;= 4.14.0) for Terraform now <a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/apikeys_key\" rel=\"noreferrer\">supports creating API Keys</a>.</p>\n<p>Updating the answer with an example (as suggested by @noamt, thanks).</p>\n<p>The key, in this case, restrict the possible APIs that can use to some GMaps ones:</p>\n<pre><code>resource &quot;google_apikeys_key&quot; &quot;maps&quot; {\n  name         = &quot;maps-api-key&quot;\n  display_name = &quot;Nice name displayed in the UI&quot;\n\n  restrictions {\n        # Example of whitelisting Maps Javascript API and Places API only\n        api_targets {\n            service = &quot;maps-backend.googleapis.com&quot;\n        }\n        api_targets {\n            service = &quot;places-backend.googleapis.com&quot;\n        }\n  }\n}\n</code></pre>\n", "OwnerUserId": "7660942", "LastEditorUserId": "7660942", "LastEditDate": "2022-03-25T08:57:49.437", "LastActivityDate": "2022-03-25T08:57:49.437", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "126528352", "PostId": "71556294", "Score": "1", "Text": "Great news. Please edit the answer to include an example, rather than a link to external docs. Links can be broken, pages can be removed", "CreationDate": "2022-03-23T16:24:33.437", "UserId": "198825", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "129025967", "PostId": "71556294", "Score": "0", "Text": "It'd be great also a data source to retrieve the key. My goal is putting that key into a Secret after it has been created.", "CreationDate": "2022-07-20T15:05:46.570", "UserId": "7425361", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "129417952", "PostId": "71556294", "Score": "1", "Text": "I am using provider version 4.31.0 and I am unable to create a key and getting an error requiring to setup service account and billing. Tried with `user_project_override` and `billing_project` setup but still getting an error. Any extra configuration needed?", "CreationDate": "2022-08-08T16:28:43.547", "UserId": "1221966", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I am using provider version 4.31.0 and I am unable to create a key and getting an error requiring to setup service account and billing. ", "keywords": ["bill", "provider"]}, {"source": "Text", "text": "Tried with `user_project_override` and `billing_project` setup but still getting an error. ", "keywords": ["bill"]}]}], "history": [{"Id": "266456513", "PostHistoryTypeId": "2", "PostId": "71556294", "RevisionGUID": "fb462007-869c-4f07-978e-a5c6fe8c1e4b", "CreationDate": "2022-03-21T10:47:04.547", "UserId": "7660942", "Text": "Google Cloud provider (version >= 4.14.0) for Terraform now [supports creating API Keys](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/apikeys_key).", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Google Cloud provider (version >= 4.14.0) for Terraform now [supports creating API Keys](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/apikeys_key).", "keywords": ["provider"]}]}, {"Id": "266763999", "PostHistoryTypeId": "5", "PostId": "71556294", "RevisionGUID": "e6ea64e3-1ed6-4f60-a478-7e20fb993003", "CreationDate": "2022-03-25T08:57:49.437", "UserId": "7660942", "Comment": "added 484 characters in body", "Text": "Google Cloud provider (version >= 4.14.0) for Terraform now [supports creating API Keys](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/apikeys_key).\r\n\r\nUpdating the answer with an example (as suggested by @noamt, thanks).\r\n\r\nThe key, in this case, restrict the possible APIs that can use to some GMaps ones:\r\n```\r\nresource \"google_apikeys_key\" \"maps\" {\r\n  name         = \"maps-api-key\"\r\n  display_name = \"Nice name displayed in the UI\"\r\n\r\n  restrictions {\r\n  # Example of whitelisting Maps Javascript API and Places API only\r\n  api_targets {\r\n   service = \"maps-backend.googleapis.com\"\r\n  }\r\n  api_targets {\r\n   service = \"places-backend.googleapis.com\"\r\n  }\r\n  }\r\n}\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Google Cloud provider (version >= 4.14.0) for Terraform now [supports creating API Keys](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/apikeys_key). ", "keywords": ["provider"]}]}], "filtered-sentences": [{"source": "Body", "text": "Google Cloud provider (version >= 4.14.0) for Terraform now supports creating API Keys. ", "keywords": ["provider"]}]}, {"Id": "60845987", "PostTypeId": "2", "ParentId": "60828348", "CreationDate": "2020-03-25T09:25:32.593", "Score": "2", "Body": "<p>Many people use API Keys for securing access to API. However, Google considers unsecured this kind of authentication (the API key never rotate compare to an OAuth token that have 1H of life. If your authentication secret is stolen, with API key the effect is unlimited in the time).</p>\n\n<p>That's why, for discouraging this bad usage, you can't easily generate (and also validate) the API keys, I mean, there isn't public API to call for creating or checking the API Keys. And thus, terraform can't perform this task.</p>\n", "OwnerUserId": "11372593", "LastActivityDate": "2020-03-25T09:25:32.593", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "107658130", "PostId": "60845987", "Score": "0", "Text": "So in a context where I require authentication, but don't care about the actual identity, what's the best way to go?\nKeeping secrets on the client side (which is a mobile app) is of course also not recommended.", "CreationDate": "2020-03-25T13:12:50.220", "UserId": "198825", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "107659827", "PostId": "60845987", "Score": "1", "Text": "Roughtly, I see 2 cases: Either your app is secured and each user have to be authenticated (user account with a password for example, Google Play account, or Google account,...) and you can select which users to authorize or not. At least, you can required an authenticated user to know who block in case of not appropriate use of your service. Or your app is public and adding security layer is useless.", "CreationDate": "2020-03-25T14:01:08.827", "UserId": "11372593", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "217632874", "PostHistoryTypeId": "2", "PostId": "60845987", "RevisionGUID": "25569993-03f7-4b77-b38c-908e5f3cf76f", "CreationDate": "2020-03-25T09:25:32.593", "UserId": "11372593", "Text": "Many people use API Keys for securing access to API. However, Google considers unsecured this kind of authentication (the API key never rotate compare to an OAuth token that have 1H of life. If your authentication secret is stolen, with API key the effect is unlimited in the time).\r\n\r\nThat's why, for discouraging this bad usage, you can't easily generate (and also validate) the API keys, I mean, there isn't public API to call for creating or checking the API Keys. And thus, terraform can't perform this task.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}