{"Id": "69795376", "PostTypeId": "1", "CreationDate": "2021-11-01T10:07:13.643", "Score": "0", "ViewCount": "866", "Body": "<p>I have a service account that's being used in a pipeline for Terraform. Currently, it has the owner role, but I want to restrict what roles it can assign via the Terraform configuration. I want to avoid a scenario where a user can elevate their role to the owner role and bypass the pipeline. This also includes the users who are responsible for reviewing and approving.</p>\n<p>I'm following this guide but it shows assigning a role that ONLY assigns roles, I need to deploy resources as well. <a href=\"https://cloud.google.com/iam/docs/setting-limits-on-granting-roles#use-cases\" rel=\"nofollow noreferrer\">https://cloud.google.com/iam/docs/setting-limits-on-granting-roles#use-cases</a></p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n      &quot;members&quot;: [\n        &quot;finn@example.com&quot;\n      ],\n      &quot;role&quot;: &quot;roles/resourcemanager.projectIamAdmin&quot;,\n      &quot;condition&quot;: {\n        &quot;title&quot;: &quot;only_billing_roles&quot;,\n        &quot;description&quot;: &quot;Only allows changes to role bindings for billing accounts&quot;,\n        &quot;expression&quot;:\n          &quot;api.getAttribute('iam.googleapis.com/modifiedGrantsByRole', []).hasOnly(['roles/billing.admin', 'roles/billing.user'])&quot;\n      }\n    }\n</code></pre>\n<p>Is there a way to specify the owner role on the service account but then limit what roles it can assign and what resources it can deploy?</p>\n", "OwnerUserId": "5091805", "LastEditorUserId": "15745153", "LastEditDate": "2021-11-01T14:19:54.397", "LastActivityDate": "2021-11-02T09:38:25.467", "Title": "Best practice to limit what roles and resources service account can provision", "Tags": "<google-cloud-platform><terraform><google-cloud-iam>", "AnswerCount": "0", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "123382042", "PostId": "69795376", "Score": "0", "Text": "A role contains a set of permissions that allows you to perform specific actions on resources. You can also select a role that allows a principal to set the IAM policy for specific resources within a project,folder,or organization.[Example](https://cloud.google.com/iam/docs/setting-limits-on-granting-roles#manage-admins-example). [Compute Admin Role](https://cloud.google.com/iam/docs/understanding-roles#compute-engine-roles) means it takes full control of all Compute Engine resources. For more info refer [roles](https://cloud.google.com/iam/docs/understanding-roles#compute-engine-roles).", "CreationDate": "2021-11-01T18:03:03.690", "UserId": "15745106", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You can also select a role that allows a principal to set the IAM policy for specific resources within a project,folder,or organization.[Example](https://cloud.google.com/iam/docs/setting-limits-on-granting-roles#manage-admins-example). ", "keywords": ["policy"]}]}, {"Id": "123389033", "PostId": "69795376", "Score": "0", "Text": "I want the service account to be able to deploy ALL resources without the ability to assign ALL roles. Is there a straight forward way to do this without creating a monster of a custom role?", "CreationDate": "2021-11-02T01:52:53.827", "UserId": "5091805", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "123393584", "PostId": "69795376", "Score": "0", "Text": "I see 2 options here - either create a custom role with all permissions you need but that will be cumbersome. second option is elevate the role of service account when running terraform and remove it afterwards", "CreationDate": "2021-11-02T08:30:17.007", "UserId": "9684373", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "123416748", "PostId": "69795376", "Score": "0", "Text": "@Prany the second option almost sounds like the way to go but it still wouldn't stop a user from assigning themselves the owner role within the Terraform config. I really need to restrict the service account from being able to assign certain roles. I think the cumbersome option is my only way.", "CreationDate": "2021-11-03T04:52:12.743", "UserId": "5091805", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "257041830", "PostHistoryTypeId": "2", "PostId": "69795376", "RevisionGUID": "f38060db-62e9-4115-8de4-6cd44091ebd5", "CreationDate": "2021-11-01T10:07:13.643", "UserId": "5091805", "Text": "I have a service account that's being used in a pipeline for Terraform. Currently, it has the owner role, but I want to restrict what roles it can assign via the Terraform configuration. I want to avoid a scenario where a user can elevate their role to the owner role and bypass the pipeline. This also includes the users who are responsible for reviewing and approving.\r\n\r\nI'm following this guide but it shows assigning a role that ONLY assigns roles, I need to deploy resources as well. https://cloud.google.com/iam/docs/setting-limits-on-granting-roles#use-cases\r\n\r\n```json\r\n{\r\n      \"members\": [\r\n        \"finn@example.com\"\r\n      ],\r\n      \"role\": \"roles/resourcemanager.projectIamAdmin\",\r\n      \"condition\": {\r\n        \"title\": \"only_billing_roles\",\r\n        \"description\": \"Only allows changes to role bindings for billing accounts\",\r\n        \"expression\":\r\n          \"api.getAttribute('iam.googleapis.com/modifiedGrantsByRole', []).hasOnly(['roles/billing.admin', 'roles/billing.user'])\"\r\n      }\r\n    }\r\n```\r\n\r\nIs there a way to specify the owner role on the service account but then limit what roles it can assign and what resources it can deploy?\r\n\r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "https://cloud.google.com/iam/docs/setting-limits-on-granting-roles#use-cases ```json { \"members\": [ \"finn@example.com\" ], \"role\": \"roles/resourcemanager.projectIamAdmin\", \"condition\": { \"title\": \"only_billing_roles\", \"description\": \"Only allows changes to role bindings for billing accounts\", \"expression\": \"api.getAttribute('iam.googleapis.com/modifiedGrantsByRole', []).hasOnly(['roles/billing.admin', 'roles/billing.user'])\" } } ``` ", "keywords": ["bill", "change"]}]}, {"Id": "257041832", "PostHistoryTypeId": "1", "PostId": "69795376", "RevisionGUID": "f38060db-62e9-4115-8de4-6cd44091ebd5", "CreationDate": "2021-11-01T10:07:13.643", "UserId": "5091805", "Text": "Best practice to limit what roles and resources service account can provision", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "257041833", "PostHistoryTypeId": "3", "PostId": "69795376", "RevisionGUID": "f38060db-62e9-4115-8de4-6cd44091ebd5", "CreationDate": "2021-11-01T10:07:13.643", "UserId": "5091805", "Text": "<google-cloud-platform><google-cloud-iam>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "257057481", "PostHistoryTypeId": "6", "PostId": "69795376", "RevisionGUID": "df751140-bf95-4d1e-b984-c71e22156964", "CreationDate": "2021-11-01T14:19:54.397", "UserId": "15745153", "Comment": "fixed tags", "Text": "<google-cloud-platform><terraform><google-cloud-iam>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "257057482", "PostHistoryTypeId": "24", "PostId": "69795376", "RevisionGUID": "df751140-bf95-4d1e-b984-c71e22156964", "CreationDate": "2021-11-01T14:19:54.397", "Comment": "Proposed by 15745153 approved by 4372, 4294399 edit id of 5276515", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}