{"Id": "61082321", "PostTypeId": "1", "CreationDate": "2020-04-07T14:26:18.300", "Score": "0", "ViewCount": "477", "Body": "<p>I have some AWS RDS databases that I want to distribute over different availability zones, this can be done like this:</p>\n\n<pre><code>resource \"random_shuffle\" \"az\" {\n  input        = [\"eu-west-1a\", \"eu-west-1b\", \"eu-west-1c\"]\n  result_count = 1\n}\n\nresource \"aws_db_instance\" \"mydb\" {\n  availability_zone = random_shuffle.az.result[0]\n}\n</code></pre>\n\n<p>The problem is that I do not want the az to ever change after the resource is created, because this would cause the resource to be destroyed.</p>\n\n<p>This is a problem, because if I add/remove a item to the list a new random value will be picked.</p>\n\n<p>How can I achieve this \"pick a random value only once\" behavior? </p>\n", "OwnerUserId": "572635", "LastActivityDate": "2020-04-07T14:26:18.300", "Title": "Generate random value once in terraform", "Tags": "<terraform>", "AnswerCount": "0", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "108063318", "PostId": "61082321", "Score": "1", "Text": "What are you hoping to gain by distributing individual RDS instances across different AZs instead of using the multi-AZ option?", "CreationDate": "2020-04-07T14:40:43.970", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "108064348", "PostId": "61082321", "Score": "0", "Text": "This is for a \"large\" number of resource that do not need the availability (and cost) of multi-AZ, but distributing them among AZs still seems like a good idea.", "CreationDate": "2020-04-07T15:04:37.527", "UserId": "572635", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "This is for a \"large\" number of resource that do not need the availability (and cost) of multi-AZ, but distributing them among AZs still seems like a good idea.", "keywords": ["cost"]}]}, {"Id": "108064626", "PostId": "61082321", "Score": "0", "Text": "https://stackoverflow.com/questions/49271475/weird-behavior-of-terraforms-random-shuffle-provider", "CreationDate": "2020-04-07T15:11:59.690", "UserId": "2597174", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "https://stackoverflow.com/questions/49271475/weird-behavior-of-terraforms-random-shuffle-provider", "keywords": ["provider"]}]}, {"Id": "108065153", "PostId": "61082321", "Score": "0", "Text": "If your database subnet group is spread across multiple availability zones then the RDS instances will automatically be randomly placed across them anyway.", "CreationDate": "2020-04-07T15:25:27.013", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "links": [{"Id": "1742817365", "CreationDate": "2020-04-07T15:11:59.690", "PostId": "61082321", "RelatedPostId": "49271475", "LinkTypeId": "1"}], "history": [{"Id": "218645954", "PostHistoryTypeId": "2", "PostId": "61082321", "RevisionGUID": "6259aa8a-9030-4286-b4e8-087b7c523a6e", "CreationDate": "2020-04-07T14:26:18.300", "UserId": "572635", "Text": "I have some AWS RDS databases that I want to distribute over different availability zones, this can be done like this:\r\n\r\n```\r\nresource \"random_shuffle\" \"az\" {\r\n  input        = [\"eu-west-1a\", \"eu-west-1b\", \"eu-west-1c\"]\r\n  result_count = 1\r\n}\r\n\r\nresource \"aws_db_instance\" \"mydb\" {\r\n  availability_zone = random_shuffle.az.result[0]\r\n}\r\n```\r\n\r\nThe problem is that I do not want the az to ever change after the resource is created, because this would cause the resource to be destroyed.\r\n\r\nThis is a problem, because if I add/remove a item to the list a new random value will be picked.\r\n\r\nHow can I achieve this \"pick a random value only once\" behavior? ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "The problem is that I do not want the az to ever change after the resource is created, because this would cause the resource to be destroyed. ", "keywords": ["change"]}]}, {"Id": "218645955", "PostHistoryTypeId": "1", "PostId": "61082321", "RevisionGUID": "6259aa8a-9030-4286-b4e8-087b7c523a6e", "CreationDate": "2020-04-07T14:26:18.300", "UserId": "572635", "Text": "Generate random value once in terraform", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "218645956", "PostHistoryTypeId": "3", "PostId": "61082321", "RevisionGUID": "6259aa8a-9030-4286-b4e8-087b7c523a6e", "CreationDate": "2020-04-07T14:26:18.300", "UserId": "572635", "Text": "<terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "The problem is that I do not want the az to ever change after the resource is created, because this would cause the resource to be destroyed. ", "keywords": ["change"]}]}