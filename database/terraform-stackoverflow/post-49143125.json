{"Id": "49143125", "PostTypeId": "1", "AcceptedAnswerId": "49144467", "CreationDate": "2018-03-07T02:25:35.480", "Score": "1", "ViewCount": "4187", "Body": "<p>I want to set the life cycle rule of S3 bucket so that the each file in the bucket will be deleted 7 days after they are generated. </p>\n\n<p>If I set the lifecycle rule as follows (the below is terraform code, similar to console setting, so I just use it here), will all the files in the bucket \"test\" be removed after 7 days from today or will each file be deleted on different date since they are created in different day? I want them to be deleted on different date, not together. </p>\n\n<p>BTW, I guess I do not need to configure: Permanently delete previous versions because my s3 is not version enabled. Please correct me if I am wrong.</p>\n\n<pre><code>resource \"aws_s3_bucket\" \"s3\" {\n  bucket        = \"test\"\n  lifecycle_rule {\n    id      = \"remove_after_7d\"\n    enabled = true\n    expiration {\n      days = 7\n    }\n  }\n}\n</code></pre>\n", "OwnerUserId": "389955", "LastEditorUserId": "947171", "LastEditDate": "2018-08-28T21:00:58.720", "LastActivityDate": "2019-02-06T11:53:43.407", "Title": "AWS S3 life cycle configuration", "Tags": "<amazon-s3><terraform><terraform-provider-aws>", "AnswerCount": "2", "CommentCount": "0", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "168370299", "PostHistoryTypeId": "2", "PostId": "49143125", "RevisionGUID": "c8802a38-b847-4ed0-9edd-dffd7928160a", "CreationDate": "2018-03-07T02:25:35.480", "UserId": "389955", "Text": "I want to set the life cycle rule of S3 bucket so that the each file in the bucket will be deleted 7 days after they are generated. \r\n\r\nIf I set the lifecycle rule as follows (the below is terraform code, similar to console setting, so I just use it here), will all the files in the bucket \"test\" be removed after 7 days from today or will each file be deleted on different date since they are created in different day? I want them to be deleted on different date, not together. \r\n\r\nBTW, I guess I do not need to configure: Permanently delete previous versions because my s3 is not version enabled. Please correct me if I am wrong.\r\n\r\n  \r\n    resource \"aws_s3_bucket\" \"s3\" {\r\n      bucket        = \"test\"\r\n      lifecycle_rule {\r\n        id      = \"remove_after_7d\"\r\n        enabled = true\r\n        expiration {\r\n          days = 7\r\n        }\r\n      }\r\n    }", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "If I set the lifecycle rule as follows (the below is terraform code, similar to console setting, so I just use it here), will all the files in the bucket \"test\" be removed after 7 days from today or will each file be deleted on different date since they are created in different day? ", "keywords": ["test"]}, {"source": "Text", "text": "Please correct me if I am wrong. resource \"aws_s3_bucket\" \"s3\" { bucket = \"test\" lifecycle_rule { id = \"remove_after_7d\" enabled = true expiration { days = 7 } } }", "keywords": ["test"]}]}, {"Id": "168370300", "PostHistoryTypeId": "1", "PostId": "49143125", "RevisionGUID": "c8802a38-b847-4ed0-9edd-dffd7928160a", "CreationDate": "2018-03-07T02:25:35.480", "UserId": "389955", "Text": "AWS S3 life cycle configuration", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "168370301", "PostHistoryTypeId": "3", "PostId": "49143125", "RevisionGUID": "c8802a38-b847-4ed0-9edd-dffd7928160a", "CreationDate": "2018-03-07T02:25:35.480", "UserId": "389955", "Text": "<amazon-s3>", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "180665298", "PostHistoryTypeId": "6", "PostId": "49143125", "RevisionGUID": "5f99d458-1629-4969-978f-ff84eff46ee8", "CreationDate": "2018-08-28T21:00:58.720", "UserId": "947171", "Comment": "Add Terraform tags.", "Text": "<amazon-s3><terraform><terraform-provider-aws>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "180665299", "PostHistoryTypeId": "24", "PostId": "49143125", "RevisionGUID": "5f99d458-1629-4969-978f-ff84eff46ee8", "CreationDate": "2018-08-28T21:00:58.720", "Comment": "Proposed by 947171 approved by 2425802, 6485651 edit id of 3887126", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "49144467", "PostTypeId": "2", "ParentId": "49143125", "CreationDate": "2018-03-07T05:01:30.150", "Score": "6", "Body": "<p>The objects will be removed 7 days after their individual creation -- not 7 days after you create the rule.  If, for example, all the objects in a bucket are at least 7 days old, they should all be gone within approximately 24 hours after you create the rule.</p>\n\n<p>Note that the timing is not precise, because the deletion process is done in the background, so objects will usually linger a few hours longer than you might expect, if you assume exacrly 7 \u00d7 24 hours is how long the objects will remain in the bucket. It may take a day or two for the objects to disappear after the policy is first created. However, once the policy has been fully evaluated against all the objects, S3 will stop billing you for storage of expired objects when their expiration time arrives, even if the delete process hasn't gotten around to actually removing them, yet.</p>\n\n<p>For non-versioned buckets, you are correct -- there is no previous version to delete.  Using versioned buckets is generally a good idea, though, since it eliminates the risk of data loss from inadvertently deleting or overwriting an object, for whatever reason (like a bug in your application).</p>\n", "OwnerUserId": "1695906", "LastActivityDate": "2018-03-07T05:01:30.150", "CommentCount": "4", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "85363135", "PostId": "49144467", "Score": "0", "Text": "Thanks your answer is very clear. one comment: I guess it is based on when object is modified, not only created.", "CreationDate": "2018-03-08T17:18:58.970", "UserId": "389955", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "85374281", "PostId": "49144467", "Score": "0", "Text": "In a casual sense, that's true.  Strictly speaking, objects in S3 are immutable -- they can never be modified.  When you \"modify\" an object, what you're actually doing is creating a new object with the same object key.  The `Last-Modified` date is the same as the creation date, as far as S3 is concerned.", "CreationDate": "2018-03-08T23:29:58.893", "UserId": "1695906", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "85416418", "PostId": "49144467", "Score": "0", "Text": "Thanks, I understand now.", "CreationDate": "2018-03-10T05:19:44.333", "UserId": "389955", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "116207167", "PostId": "49144467", "Score": "0", "Text": "@Michael-sqlbot If our expiration policy is 1 day and it's already been 2 days since the lifecycle configuration was added, what could the problem be here if no files has been deleted in the bucket still?", "CreationDate": "2021-01-14T19:15:20.843", "UserId": "9912116", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If our expiration policy is 1 day and it's already been 2 days since the lifecycle configuration was added, what could the problem be here if no files has been deleted in the bucket still?", "keywords": ["policy"]}]}], "history": [{"Id": "168376218", "PostHistoryTypeId": "2", "PostId": "49144467", "RevisionGUID": "5b1b132d-ff15-41f6-843b-b962ade2a277", "CreationDate": "2018-03-07T05:01:30.150", "UserId": "1695906", "Text": "The objects will be removed 7 days after their individual creation -- not 7 days after you create the rule.  If, for example, all the objects in a bucket are at least 7 days old, they should all be gone within approximately 24 hours after you create the rule.\r\n\r\nNote that the timing is not precise, because the deletion process is done in the background, so objects will usually linger a few hours longer than you might expect, if you assume exacrly 7 \u00d7 24 hours is how long the objects will remain in the bucket. It may take a day or two for the objects to disappear after the policy is first created. However, once the policy has been fully evaluated against all the objects, S3 will stop billing you for storage of expired objects when their expiration time arrives, even if the delete process hasn't gotten around to actually removing them, yet.\r\n\r\nFor non-versioned buckets, you are correct -- there is no previous version to delete.  Using versioned buckets is generally a good idea, though, since it eliminates the risk of data loss from inadvertently deleting or overwriting an object, for whatever reason (like a bug in your application).", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "It may take a day or two for the objects to disappear after the policy is first created. ", "keywords": ["policy"]}, {"source": "Text", "text": "However, once the policy has been fully evaluated against all the objects, S3 will stop billing you for storage of expired objects when their expiration time arrives, even if the delete process hasn't gotten around to actually removing them, yet. ", "keywords": ["bill", "storage", "policy"]}]}], "filtered-sentences": [{"source": "Body", "text": "It may take a day or two for the objects to disappear after the policy is first created. ", "keywords": ["policy"]}, {"source": "Body", "text": "However, once the policy has been fully evaluated against all the objects, S3 will stop billing you for storage of expired objects when their expiration time arrives, even if the delete process hasn't gotten around to actually removing them, yet. ", "keywords": ["bill", "storage", "policy"]}]}, {"Id": "54553059", "PostTypeId": "2", "ParentId": "49143125", "CreationDate": "2019-02-06T11:53:43.407", "Score": "0", "Body": "<p>As i know, above configuration will delete the bucket after 7 days from the bucket creation. If you want to delete a specific file after a specific days from that object creation, then you have to mention the path as prefix. eg. delete log.txt which is inside log folder of the bucket:</p>\n\n<pre><code>resource \"aws_s3_bucket\" \"bucket\" \n {\n  bucket = \"&lt;&lt;bucket_name&gt;&gt;\"\n  acl    = \"private\"\n\n  lifecycle_rule {\n  id      = \"log\"\n  enabled = true\n  prefix = \"log/log.txt\"\n\n\n  expiration {\n           days = 7\n             }\n</code></pre>\n\n<p>}\n}</p>\n\n<p>But i was facing an issue(error 409) while updating an existing bucket.</p>\n", "OwnerUserId": "10086614", "LastActivityDate": "2019-02-06T11:53:43.407", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "95914650", "PostId": "54553059", "Score": "0", "Text": "@Vasilisa this isn't a new question. This is very clearly an answer to the question posed by OP", "CreationDate": "2019-02-06T15:48:17.223", "UserId": "4515720", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "history": [{"Id": "191065815", "PostHistoryTypeId": "2", "PostId": "54553059", "RevisionGUID": "e45d4041-31d9-40f3-af87-24bf84ecfd63", "CreationDate": "2019-02-06T11:53:43.407", "UserId": "10086614", "Text": "As i know, above configuration will delete the bucket after 7 days from the bucket creation. If you want to delete a specific file after a specific days from that object creation, then you have to mention the path as prefix. eg. delete log.txt which is inside log folder of the bucket:\r\n\r\n    resource \"aws_s3_bucket\" \"bucket\" \r\n     {\r\n      bucket = \"<<bucket_name>>\"\r\n      acl    = \"private\"\r\n\r\n      lifecycle_rule {\r\n      id      = \"log\"\r\n      enabled = true\r\n      prefix = \"log/log.txt\"\r\n\r\n\r\n      expiration {\r\n               days = 7\r\n                 }\r\n  }\r\n}\r\n\r\nBut i was facing an issue(error 409) while updating an existing bucket.\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "If I set the lifecycle rule as follows (the below is terraform code, similar to console setting, so I just use it here), will all the files in the bucket \"test\" be removed after 7 days from today or will each file be deleted on different date since they are created in different day? ", "keywords": ["test"]}]}