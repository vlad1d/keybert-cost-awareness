{"Id": "56336942", "PostTypeId": "1", "CreationDate": "2019-05-28T07:21:35.900", "Score": "1", "ViewCount": "2398", "Body": "<p>I sometime see that <em>Terraform Apply</em> has different \"plan\" than <em>Terraform Plan</em>.</p>\n\n<p>For instance, today i have seen one of TF files that I am trying to \"<em>Terraform Apply</em>\" resulted in only 1 \"change\" and 1 \"add\" while it got \"3 add\", \"1 change\" and \"3 destroy\" when using \"<em>Terraform Plan</em>\"</p>\n\n<p>I have been using Terraform for just two months. Is this intended behavior in Terraform?  </p>\n\n<p>Could anyone give an explanation for this behavior? Thanks!</p>\n\n<pre><code>Terraform version: 0.11.13\n</code></pre>\n", "OwnerUserId": "5406339", "LastEditorUserId": "5406339", "LastEditDate": "2019-05-28T09:36:40.270", "LastActivityDate": "2022-07-19T09:37:33.407", "Title": "Terraform Apply has different \"plan\" than Terraform Plan", "Tags": "<terraform>", "AnswerCount": "7", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "99279949", "PostId": "56336942", "Score": "0", "Text": "Can you edit your question to share your existing Terraform code, the plan and apply outputs that differ and potentially anything that's special about your environment here?", "CreationDate": "2019-05-28T07:33:35.363", "UserId": "2291321", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "100025647", "PostId": "56336942", "Score": "1", "Text": "Does this also happen when you run Terraform like this: `terraform plan -out \"planfile\"` and `terraform apply -input=false \"planfile\"`? Terraform should then apply exactly (and only) those changes form the terraform plan command...", "CreationDate": "2019-06-24T09:11:48.093", "UserId": "10975889", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Terraform should then apply exactly (and only) those changes form the terraform plan command...", "keywords": ["change"]}]}], "history": [{"Id": "198580458", "PostHistoryTypeId": "2", "PostId": "56336942", "RevisionGUID": "0c7d78ae-ec91-454c-9154-7ae0be3a5a1b", "CreationDate": "2019-05-28T07:21:35.900", "UserId": "5406339", "Text": "I sometime see that *Terraform Apply* has different \"plan\" than *Terraform Plan*.\r\n\r\nFor instance, today i have seen one of TF files that I am trying to \"*Terraform Apply*\" has only 1 \"change\" and 1 \"add\" while I got \"3 add\" and \"3 destroy\" when using \"*Terraform Plan*\"\r\n\r\nI have been using Terraform for just two months. Is this intended behavior in Terraform?  \r\n\r\nCould anyone give an explanation for this behavior? Thanks!\r\n\r\n    Terraform version: 0.11.13", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For instance, today i have seen one of TF files that I am trying to \"*Terraform Apply*\" has only 1 \"change\" and 1 \"add\" while I got \"3 add\" and \"3 destroy\" when using \"*Terraform Plan*\" ", "keywords": ["instance", "change"]}]}, {"Id": "198580459", "PostHistoryTypeId": "1", "PostId": "56336942", "RevisionGUID": "0c7d78ae-ec91-454c-9154-7ae0be3a5a1b", "CreationDate": "2019-05-28T07:21:35.900", "UserId": "5406339", "Text": "Terraform Apply has different \"plan\" than Terraform Plan", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "198580460", "PostHistoryTypeId": "3", "PostId": "56336942", "RevisionGUID": "0c7d78ae-ec91-454c-9154-7ae0be3a5a1b", "CreationDate": "2019-05-28T07:21:35.900", "UserId": "5406339", "Text": "<terraform>", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "198580787", "PostHistoryTypeId": "5", "PostId": "56336942", "RevisionGUID": "b0608770-5c88-4691-8f19-a2660e347b88", "CreationDate": "2019-05-28T07:26:44.363", "UserId": "5406339", "Comment": "added 9 characters in body", "Text": "I sometime see that *Terraform Apply* has different \"plan\" than *Terraform Plan*.\r\n\r\nFor instance, today i have seen one of TF files that I am trying to \"*Terraform Apply*\" resulted in only 1 \"change\" and 1 \"add\" while it got \"3 add\" and \"3 destroy\" when using \"*Terraform Plan*\"\r\n\r\nI have been using Terraform for just two months. Is this intended behavior in Terraform?  \r\n\r\nCould anyone give an explanation for this behavior? Thanks!\r\n\r\n    Terraform version: 0.11.13", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For instance, today i have seen one of TF files that I am trying to \"*Terraform Apply*\" resulted in only 1 \"change\" and 1 \"add\" while it got \"3 add\" and \"3 destroy\" when using \"*Terraform Plan*\" ", "keywords": ["instance", "change"]}]}, {"Id": "198589600", "PostHistoryTypeId": "5", "PostId": "56336942", "RevisionGUID": "2c3b4647-1c49-4b6e-81c5-d74ded1e9d3e", "CreationDate": "2019-05-28T09:36:40.270", "UserId": "5406339", "Comment": "added 12 characters in body", "Text": "I sometime see that *Terraform Apply* has different \"plan\" than *Terraform Plan*.\r\n\r\nFor instance, today i have seen one of TF files that I am trying to \"*Terraform Apply*\" resulted in only 1 \"change\" and 1 \"add\" while it got \"3 add\", \"1 change\" and \"3 destroy\" when using \"*Terraform Plan*\"\r\n\r\nI have been using Terraform for just two months. Is this intended behavior in Terraform?  \r\n\r\nCould anyone give an explanation for this behavior? Thanks!\r\n\r\n    Terraform version: 0.11.13", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For instance, today i have seen one of TF files that I am trying to \"*Terraform Apply*\" resulted in only 1 \"change\" and 1 \"add\" while it got \"3 add\", \"1 change\" and \"3 destroy\" when using \"*Terraform Plan*\" ", "keywords": ["instance", "change"]}]}], "answers": [{"Id": "58721494", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2019-11-06T00:42:01.470", "Score": "0", "Body": "<p>Terraform builds a graph of all the resources.It, then creates the non-dependent resources in parallel to make resource creation slightly efficient. Is any the resource creation fails, It leaves terraform in partially applied state which gets recorded in the tfstate file. After fixing the issue with resource, when you reapply the .tf files it shows you only the new resources to be changed. In your case, I think it has got more to do with the fact that some resource have a policy of \"destroy-before-creation\" which shows up in result. so when you apply change to 1 resource it ends up showing 1 resource deleted 1 created. This when occurs with some  non \"destroy-before-creation\" type resources, ends up giving you output like what you mentioned above</p>\n", "OwnerUserId": "5421427", "LastActivityDate": "2019-11-06T00:42:01.470", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "208637625", "PostHistoryTypeId": "2", "PostId": "58721494", "RevisionGUID": "9420952c-a957-4426-8fd8-b8679671a438", "CreationDate": "2019-11-06T00:42:01.470", "UserId": "5421427", "Text": "Terraform builds a graph of all the resources.It, then creates the non-dependent resources in parallel to make resource creation slightly efficient. Is any the resource creation fails, It leaves terraform in partially applied state which gets recorded in the tfstate file. After fixing the issue with resource, when you reapply the .tf files it shows you only the new resources to be changed. In your case, I think it has got more to do with the fact that some resource have a policy of \"destroy-before-creation\" which shows up in result. so when you apply change to 1 resource it ends up showing 1 resource deleted 1 created. This when occurs with some  non \"destroy-before-creation\" type resources, ends up giving you output like what you mentioned above", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It, then creates the non-dependent resources in parallel to make resource creation slightly efficient. ", "keywords": ["efficient"]}, {"source": "Text", "text": "After fixing the issue with resource, when you reapply the .tf files it shows you only the new resources to be changed. ", "keywords": ["change"]}, {"source": "Text", "text": "In your case, I think it has got more to do with the fact that some resource have a policy of \"destroy-before-creation\" which shows up in result. ", "keywords": ["policy"]}, {"source": "Text", "text": "so when you apply change to 1 resource it ends up showing 1 resource deleted 1 created. ", "keywords": ["change"]}]}], "filtered-sentences": [{"source": "Body", "text": "It, then creates the non-dependent resources in parallel to make resource creation slightly efficient. ", "keywords": ["efficient"]}, {"source": "Body", "text": "After fixing the issue with resource, when you reapply the .tf files it shows you only the new resources to be changed. ", "keywords": ["change"]}, {"source": "Body", "text": "In your case, I think it has got more to do with the fact that some resource have a policy of \"destroy-before-creation\" which shows up in result. ", "keywords": ["policy"]}, {"source": "Body", "text": "so when you apply change to 1 resource it ends up showing 1 resource deleted 1 created. ", "keywords": ["change"]}]}, {"Id": "71626049", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2022-03-26T07:12:53.693", "Score": "1", "Body": "<p>Try to follow these steps when trying to perform a Terraform apply .</p>\n<ul>\n<li>First make sure the changes to the terraform file has been saved.</li>\n<li>Try running a terraform plan <code>terraform-plan</code> before running <code>terraform-apply</code></li>\n</ul>\n<p>Sounds like some the files changes have been made to are not saved with the current terraform file</p>\n", "OwnerUserId": "11396961", "LastActivityDate": "2022-03-26T07:12:53.693", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "266836927", "PostHistoryTypeId": "2", "PostId": "71626049", "RevisionGUID": "942e8a67-e318-45a6-be18-8aeef36db0bc", "CreationDate": "2022-03-26T07:12:53.693", "UserId": "11396961", "Text": "Try to follow these steps when trying to perform a Terraform apply .\r\n- First make sure the changes to the terraform file has been saved.\r\n- Try running a terraform plan `terraform-plan` before running `terraform-apply` \r\n\r\nSounds like some the files changes have been made to are not saved with the current terraform file\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "- First make sure the changes to the terraform file has been saved. ", "keywords": ["change"]}, {"source": "Text", "text": "Sounds like some the files changes have been made to are not saved with the current terraform file", "keywords": ["change"]}]}], "filtered-sentences": [{"source": "Body", "text": "First make sure the changes to the terraform file has been saved. ", "keywords": ["change"]}, {"source": "Body", "text": "Try running a terraform plan terraform-plan before running terraform-apply Sounds like some the files changes have been made to are not saved with the current terraform file", "keywords": ["change"]}]}, {"Id": "57049244", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2019-07-16T02:18:50.643", "Score": "0", "Body": "<p>Can you explain the full scenario? Normally, in my experience it is same. \nDifference i can only see -- Either you are using variable file with plan and apply and some variables causes some resources and other way might be if you using a remote location for state and some other job/person also updating the state. \nIf you are running everything locally, it should not happen like this. </p>\n", "OwnerUserId": "6944056", "LastActivityDate": "2019-07-16T02:18:50.643", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "201602489", "PostHistoryTypeId": "2", "PostId": "57049244", "RevisionGUID": "bf62dbcf-8061-4be7-8787-556589cad5b6", "CreationDate": "2019-07-16T02:18:50.643", "UserId": "6944056", "Text": "Can you explain the full scenario? Normally, in my experience it is same. \r\nDifference i can only see -- Either you are using variable file with plan and apply and some variables causes some resources and other way might be if you using a remote location for state and some other job/person also updating the state. \r\nIf you are running everything locally, it should not happen like this. ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "62718139", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2020-07-03T15:05:06.177", "Score": "2", "Body": "<p>This is unexpected behaviour, but the best practice it to:</p>\n<ol>\n<li>terraform plan -out deploy.tfplan</li>\n</ol>\n<p>it will save the plan in the deploy.tfplan file.</p>\n<ol start=\"2\">\n<li>Now, terraform apply deploy.tfplan.</li>\n</ol>\n<p>this will ensure that the plan you want is executed all the Time without fail.</p>\n", "OwnerUserId": "11846859", "LastActivityDate": "2020-07-03T15:05:06.177", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "225825627", "PostHistoryTypeId": "2", "PostId": "62718139", "RevisionGUID": "5bdb07df-d395-442a-8fff-07f092a642fa", "CreationDate": "2020-07-03T15:05:06.177", "UserId": "11846859", "Text": "This is unexpected behaviour, but the best practice it to:\r\n\r\n1) terraform plan -out deploy.tfplan\r\n\r\nit will save the plan in the deploy.tfplan file.\r\n\r\n2) Now, terraform apply deploy.tfplan.\r\n\r\nthis will ensure that the plan you want is executed all the Time without fail.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "59446717", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2019-12-22T17:53:53.760", "Score": "1", "Body": "<p>This is not an intended behaviour of terraform unless if there is a mess anywhere. I never saw this kind of issue any time till now. Did you ever edited or deleted your .tfstate state file after you passed the terraform plan command? If you are observing this issue again or still facing this kind of issue, probably you can open an issue with the product owner. But I don't think this is an issue and you will never face this kind of issue again.</p>\n", "OwnerUserId": "7519440", "LastActivityDate": "2019-12-22T17:53:53.760", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "211697821", "PostHistoryTypeId": "2", "PostId": "59446717", "RevisionGUID": "961fa5d1-6041-4138-b048-5c11fa89835d", "CreationDate": "2019-12-22T17:53:53.760", "UserId": "7519440", "Text": "This is not an intended behaviour of terraform unless if there is a mess anywhere. I never saw this kind of issue any time till now. Did you ever edited or deleted your .tfstate state file after you passed the terraform plan command? If you are observing this issue again or still facing this kind of issue, probably you can open an issue with the product owner. But I don't think this is an issue and you will never face this kind of issue again.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "70513070", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2021-12-28T22:09:57.487", "Score": "0", "Body": "<p>Did you comment any of the resources in terraform file while triggering command : terraform apply ?</p>\n<p>If yes Please check the same as commenting resources in existing terraform file will result in destroying those resources in terraform.</p>\n", "OwnerUserId": "14913392", "LastEditorUserId": "8372853", "LastEditDate": "2021-12-29T04:49:44.867", "LastActivityDate": "2021-12-29T04:49:44.867", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "260896977", "PostHistoryTypeId": "2", "PostId": "70513070", "RevisionGUID": "ca24b5e4-05b2-4c2c-b910-5eb274f4a832", "CreationDate": "2021-12-28T22:09:57.487", "UserId": "14913392", "Text": "Did you comment any of the resources in terraform file while triggering command : terraform apply ?\r\n\r\nIf yes Please check the same as commenting resources in existing terraform file will result in destroying those resources in terraform. \r\n\r\nThank you!", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "260908543", "PostHistoryTypeId": "5", "PostId": "70513070", "RevisionGUID": "2b454c19-fe50-4fed-a3ea-1bc8920cd4b5", "CreationDate": "2021-12-29T04:49:44.867", "UserId": "8372853", "Comment": "removed pleasantries", "Text": "Did you comment any of the resources in terraform file while triggering command : terraform apply ?\r\n\r\nIf yes Please check the same as commenting resources in existing terraform file will result in destroying those resources in terraform. \r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "72949775", "PostTypeId": "2", "ParentId": "56336942", "CreationDate": "2022-07-12T09:11:11.347", "Score": "0", "Body": "<p>Have been using terraform for quite a long time and this is not an intended behaviour. It looks like something has changed in between plan and apply.\nBut what you can do is save the plan in a file using</p>\n<pre><code>terraform plan -out plan.tfplan \n</code></pre>\n<p>and then deploy using same file</p>\n<pre><code>terraform apply plan.tfplan.\n</code></pre>\n", "OwnerUserId": "19511315", "LastEditorUserId": "1173358", "LastEditDate": "2022-07-19T09:37:33.407", "LastActivityDate": "2022-07-19T09:37:33.407", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "274030783", "PostHistoryTypeId": "2", "PostId": "72949775", "RevisionGUID": "9e4ce0d8-bf21-4c22-87dc-42c31576b657", "CreationDate": "2022-07-12T09:11:11.347", "UserId": "19511315", "Text": "Have been using terraform for quite a long time and this is not an intended behaviour. It looks like something has changed in between plan and apply. \r\nBut what you can do is save the plan in a file using \r\nterraform plan -out plan.tfplan \r\nand then deploy using same file \r\nterraform apply plan.tfplan.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It looks like something has changed in between plan and apply. ", "keywords": ["change"]}]}, {"Id": "274501204", "PostHistoryTypeId": "5", "PostId": "72949775", "RevisionGUID": "b9455803-797f-4997-9268-e985a6606ef5", "CreationDate": "2022-07-19T09:37:33.407", "UserId": "1173358", "Comment": "formatting", "Text": "Have been using terraform for quite a long time and this is not an intended behaviour. It looks like something has changed in between plan and apply. \r\nBut what you can do is save the plan in a file using \r\n```\r\nterraform plan -out plan.tfplan \r\n```\r\nand then deploy using same file \r\n```\r\nterraform apply plan.tfplan.\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It looks like something has changed in between plan and apply. ", "keywords": ["change"]}]}, {"Id": "274501205", "PostHistoryTypeId": "24", "PostId": "72949775", "RevisionGUID": "b9455803-797f-4997-9268-e985a6606ef5", "CreationDate": "2022-07-19T09:37:33.407", "Comment": "Proposed by 1173358 approved by 19511315 edit id of 5394643", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "It looks like something has changed in between plan and apply. ", "keywords": ["change"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "For instance, today i have seen one of TF files that I am trying to \"Terraform Apply\" resulted in only 1 \"change\" and 1 \"add\" while it got \"3 add\", \"1 change\" and \"3 destroy\" when using \"Terraform Plan\" I have been using Terraform for just two months. ", "keywords": ["instance", "change"]}]}